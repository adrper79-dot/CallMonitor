# OpenNext Cloudflare Configuration
# Deploys to Cloudflare Workers (not Pages)
name = "wordisbond-production"
main = ".open-next/worker.js"
compatibility_date = "2026-02-01"
workers_dev = true
pages_build_output_dir = ".vercel/output/static"

compatibility_flags = [
  # Enable Node.js API
  "nodejs_compat",
  # Allow to fetch URLs in your app
  "global_fetch_strictly_public"
]

[assets]
directory = ".open-next/assets"

[[services]]
binding = "WORKER_SELF_REFERENCE"
service = "wordisbond-production"

# Custom domain routes
[[routes]]
pattern = "wordis-bond.com/*"
zone_name = "wordis-bond.com"

[[routes]]
pattern = "www.wordis-bond.com/*"
zone_name = "wordis-bond.com"

# Cron triggers for scheduled tasks
[[triggers.crons]]
cron = "0 */6 * * *"
path = "/api/cron/cleanup-recordings"

[[triggers.crons]]  
cron = "0 2 * * *"
path = "/api/cron/daily-metrics"

[[triggers.crons]]
cron = "*/5 * * * *" 
path = "/api/cron/health-monitor"

[[routes]]
pattern = "voxsouth.online/*"
zone_name = "voxsouth.online"

[[routes]]
pattern = "www.voxsouth.online/*"
zone_name = "voxsouth.online"

# Database acceleration with Hyperdrive
[[hyperdrive]]
binding = "HYPERDRIVE"
id = "3948fde8207649108d77e82020091b56"

# R2 storage for recordings and media
[[r2_buckets]]
binding = "RECORDINGS_BUCKET"
bucket_name = "wordisbond01"

# KV namespace for session management
[[kv_namespaces]]
binding = "KV"
id = "928d90ba89524fdfa9fec1043abdb229"
