name = "wordisbond"
compatibility_date = "2025-01-25"
compatibility_flags = ["nodejs_compat"]
pages_build_output_dir = ".open-next/assets"

[vars]
# Public Variables (Safe to commit)
NEXT_PUBLIC_APP_URL = "https://wordisbond.pages.dev"
NODE_VERSION = "20"

[[hyperdrive]]
binding = "HYPERDRIVE"
id = "3948fde8207649108d77e82020091b56"

[[r2_buckets]]
binding = "RECORDINGS_BUCKET"
bucket_name = "wordisbond01"

[[r2_buckets]]
binding = "EVIDENCE_BUCKET"
bucket_name = "evidence"

[[r2_buckets]]
binding = "EXPORTS_BUCKET"
bucket_name = "exports"

[ai]
binding = "AI"

# WAF Rules
[[rules]]
type = "http"
method = "GET"
path = "/api/*"
action = "block"
description = "Block direct API access"

# Rate limiting
[rate_limits]
requests_per_minute = 100

# Queues for background jobs
[[queues.producers]]
queue = "transcription_queue"
binding = "TRANSCRIPTION_QUEUE"

[[queues.consumers]]
queue = "transcription_queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "dlq_transcription"

# Cron triggers for background jobs
[[triggers.crons]]
cron = "*/5 * * * *"

