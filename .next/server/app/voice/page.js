(()=>{var e={};e.id=288,e.ids=[288],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},44392:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>o}),s(20153),s(99802),s(35866);var a=s(23191),r=s(88716),l=s(37922),i=s.n(l),n=s(95231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);s.d(t,c);let o=["",{children:["voice",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,20153)),"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\voice\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,99802)),"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\voice\\page.tsx"],u="/voice/page",x={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/voice/page",pathname:"/voice",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},20457:(e,t,s)=>{Promise.resolve().then(s.bind(s,45144))},90772:(e,t,s)=>{"use strict";s.d(t,{z:()=>r});var a=s(10326);function r({children:e,className:t="",variant:s="default",size:r="md",...l}){return a.jsx("button",{className:`inline-flex items-center justify-center rounded-md focus:outline-none ${{default:"bg-indigo-600 text-white hover:bg-indigo-500",outline:"border border-slate-700 text-slate-100",ghost:"bg-transparent text-slate-100"}[s]} ${{sm:"px-2 py-1 text-sm",md:"px-3 py-2",lg:"px-4 py-2"}[r]} ${t}`,...l,children:e})}s(17577)},51956:(e,t,s)=>{"use strict";function a({title:e,description:t,variant:s}){console.log("TOAST",{title:e,description:t,variant:s})}s.d(t,{A:()=>a})},45144:(e,t,s)=>{"use strict";s.d(t,{default:()=>L});var a=s(10326),r=s(17577);function l(e){let[t,s]=(0,r.useState)({role:null,plan:null,loading:!0,error:null});return t}var i=s(90772);function n({children:e,className:t="",variant:s="default",...r}){return a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${{default:"bg-slate-700 text-slate-100",success:"bg-green-600 text-white",warning:"bg-yellow-600 text-white",error:"bg-red-600 text-white",info:"bg-blue-600 text-white"}[s]} ${t}`,...r,children:e})}function c({organizationId:e,organizationName:t}){let{role:s,plan:r,loading:c}=l(e),o=r?r.charAt(0).toUpperCase()+r.slice(1):"Loading...",d=s?s.charAt(0).toUpperCase()+s.slice(1):"",u=r&&!["global","enterprise"].includes(r.toLowerCase());return a.jsx("header",{className:"w-full border-b border-slate-800 bg-slate-950 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx("h1",{className:"text-xl font-semibold text-slate-100",children:"CallMonitor – Voice Operations"}),t&&(0,a.jsxs)("span",{className:"text-sm text-slate-400",children:["Org: ",t]})]}),a.jsx("div",{className:"flex items-center gap-4",children:!c&&(0,a.jsxs)(a.Fragment,{children:[r&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Plan:"}),a.jsx(n,{variant:"info",children:o})]}),s&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Role:"}),a.jsx(n,{variant:"default",children:d})]}),u&&a.jsx(i.z,{variant:"outline",size:"sm",onClick:()=>{window.location.href="/settings/billing?upgrade=true"},"aria-label":"Upgrade plan",children:"Upgrade"})]})})]})})}function o({className:e="",label:t,error:s,id:r,...l}){let i=r||`input-${Math.random().toString(36).substr(2,9)}`;return(0,a.jsxs)("div",{className:"w-full",children:[t&&a.jsx("label",{className:"block text-sm font-medium text-slate-100 mb-1",htmlFor:i,children:t}),a.jsx("input",{id:i,className:`w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-md text-slate-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 ${s?"border-red-500":""} ${e}`,...l}),s&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:s})]})}function d({children:e,className:t="",label:s,error:r,...l}){return(0,a.jsxs)("div",{className:"w-full",children:[s&&a.jsx("label",{className:"block text-sm font-medium text-slate-100 mb-1",htmlFor:l.id,children:s}),a.jsx("select",{className:`w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-md text-slate-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 ${t}`,...l,children:e}),r&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:r})]})}function u(e){let[t,s]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1);return(0,r.useRef)([]),{updates:t,connected:a,clearUpdates:()=>s([])}}function x(e,t=5e3,s=!0){let[a,l]=(0,r.useState)([]),[i,n]=(0,r.useState)(!0);return{data:a,loading:i}}function m({calls:e,selectedCallId:t,organizationId:s,onSelect:l}){let[c,m]=(0,r.useState)(e),[h,p]=(0,r.useState)(e),[f,g]=(0,r.useState)(0),[v,j]=(0,r.useState)("all"),[b,y]=(0,r.useState)(""),[N,w]=(0,r.useState)("date"),[_,S]=(0,r.useState)(1),[C,k]=(0,r.useState)(!1),z=(0,r.useRef)(null),{updates:O,connected:D}=u(s||null),{data:A}=x(async()=>{if(!s)return[];try{let e=await fetch(`/api/calls?orgId=${encodeURIComponent(s)}&page=${_}&limit=20`);if(e.ok)return(await e.json()).calls||[];return[]}catch{return[]}},5e3,!D&&null!==s),$=h.slice(0,20*_),P=h.length>20*_;function T(e){g(e);let t=z.current,s=t?.querySelectorAll('[role="listitem"]')[e];s?.focus()}let R=e=>"completed"===e?"success":"in_progress"===e||"ringing"===e?"info":"failed"===e||"no-answer"===e||"busy"===e?"error":"default";return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-slate-800 space-y-3",children:[a.jsx(o,{label:"Search",type:"search",value:b,onChange:e=>y(e.target.value),placeholder:"Search by ID, SID, or user...",className:"w-full"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)(d,{label:"Status",value:v,onChange:e=>j(e.target.value),children:[a.jsx("option",{value:"all",children:"All"}),a.jsx("option",{value:"active",children:"Active"}),a.jsx("option",{value:"completed",children:"Completed"}),a.jsx("option",{value:"failed",children:"Failed"})]}),(0,a.jsxs)(d,{label:"Sort By",value:N,onChange:e=>w(e.target.value),children:[a.jsx("option",{value:"date",children:"Date (Newest)"}),a.jsx("option",{value:"score",children:"Score"}),a.jsx("option",{value:"duration",children:"Duration"})]})]}),!D&&(0,a.jsxs)("div",{className:"text-xs text-amber-400 flex items-center gap-1",children:[a.jsx("span",{children:"⚠"}),a.jsx("span",{children:"Real-time disconnected. Using polling."})]})]}),(0,a.jsxs)("div",{ref:z,role:"list","aria-label":"Calls list",onKeyDown:function(e){if($&&0!==$.length){if("ArrowDown"===e.key)e.preventDefault(),T(Math.min($.length-1,f+1));else if("ArrowUp"===e.key)e.preventDefault(),T(Math.max(0,f-1));else if("Enter"===e.key||" "===e.key){e.preventDefault();let t=$[f];t&&l?.(t.id)}}},tabIndex:0,className:"flex-1 overflow-y-auto p-4 space-y-2",children:[C?a.jsx("div",{className:"text-center text-slate-400 py-8",children:"Loading calls..."}):0===$.length?a.jsx("div",{className:"text-center text-slate-400 py-8",children:"No calls found"}):$.map((e,s)=>{let r=t===e.id;return a.jsx("div",{role:"listitem",tabIndex:-1,"aria-selected":r,onClick:()=>l?.(e.id),onFocus:()=>g(s),className:`w-full p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500 transition-colors cursor-pointer bg-slate-800 hover:bg-slate-700 ${r?"ring-2 ring-indigo-500":""}`,children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("h4",{className:"text-sm font-medium text-slate-100 truncate",children:e.id}),a.jsx(n,{variant:R(e.status),children:e.status??"unknown"})]}),a.jsx("div",{className:"mt-1 text-xs text-slate-400 truncate",children:e.started_at?new Date(e.started_at).toLocaleString():"—"}),e.created_by&&(0,a.jsxs)("div",{className:"mt-0.5 text-xs text-slate-500 truncate",children:["By: ",e.created_by]})]}),e.call_sid&&a.jsx("div",{className:"ml-3 text-right",children:a.jsx("div",{className:"text-xs text-slate-500 font-mono truncate max-w-[100px]",children:e.call_sid})})]})},e.id)}),P&&a.jsx("div",{className:"pt-4 text-center",children:(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:function(){S(e=>e+1)},children:["Load More (",h.length-$.length," remaining)"]})})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-slate-800 text-xs text-slate-400",children:["Showing ",$.length," of ",h.length," calls"]})]})}function h({children:e,className:t="",...s}){return a.jsx("label",{className:`text-sm font-medium ${t}`,...s,children:e})}function p({checked:e=!1,onChange:t,onCheckedChange:s,className:r="",...l}){return a.jsx("button",{type:"button",role:"switch","aria-checked":e,onClick:()=>{let a=!e;t?.(a),s?.(a)},className:`inline-flex items-center h-7 w-12 rounded-full p-1 ${e?"bg-indigo-600":"bg-slate-700"} ${r}`,...l,children:a.jsx("span",{className:`inline-block h-5 w-5 rounded-full bg-white transform ${e?"translate-x-5":"translate-x-0"}`})})}let f={recording:["pro","insights","global","enterprise","standard","active"],transcription:["pro","insights","global","enterprise","standard","active"],translation:["global","enterprise"],real_time_translation_preview:["business","enterprise"],survey:["insights","global","enterprise"],secret_shopper:["insights","global","enterprise"]};function g(e){let[t,s]=(0,r.useState)(null),[a,l]=(0,r.useState)(!0),[i,n]=(0,r.useState)(null);return{config:t,loading:a,error:i,updateConfig:async function(t){if(!e)throw Error("Organization ID required");try{n(null);let a=await fetch("/api/voice/config",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({orgId:e,...t})});if(!a.ok){let e=await a.json().catch(()=>({error:"Failed to update config"}));throw Error(e.error||"Failed to update config")}let r=await a.json();return s(r.config||{}),r.config}catch(e){throw n(e?.message||"Failed to update config"),e}}}}let v=[{key:"record",label:"Recording",desc:"Capture call audio",feature:"recording",plan:"Pro+"},{key:"transcribe",label:"Transcribe",desc:"Generate transcript",feature:"transcription",plan:"Pro+"},{key:"translate",label:"Translate",desc:"Translate transcript",feature:"translation",plan:"Global+"},{key:"survey",label:"After-call Survey",desc:"Run after-call survey",feature:"survey",plan:"Insights+"},{key:"synthetic_caller",label:"Secret Shopper",desc:"Use secret shopper script",feature:"secret_shopper",plan:"Insights+"}];function j({callId:e,organizationId:t,initialModulations:s,onChange:i}){let{role:c,plan:o,loading:u}=l(t),{config:x,updateConfig:m}=g(t),{capabilities:j,loading:b}=function(e){let[t,s]=(0,r.useState)({}),[a,l]=(0,r.useState)(!0);return{capabilities:t,loading:a}}(0),[y,N]=(0,r.useState)(()=>({...s})),[w,_]=(0,r.useState)(()=>({record:!1,transcribe:!1,translate:!1,survey:!1,synthetic_caller:!1})),[S,C]=(0,r.useState)(null),k="owner"===c||"admin"===c;async function z(e){if(!k){C("Only Owners and Admins can modify modulations");return}C(null);let t={...y},s={...y,[e]:!y[e]};N(s),_(t=>({...t,[e]:!0}));try{await m({["record"===e?"recording_enabled":"transcribe"===e?"transcription_enabled":"translate"===e?"translation_enabled":"survey"===e?"survey_enabled":"secret_shopper_enabled"]:s[e]}),await i(s)}catch(e){N(t),C(e?.message??"Update failed")}finally{_(t=>({...t,[e]:!1}))}}return(0,a.jsxs)("section",{"aria-labelledby":`call-modulations-${e}`,className:"w-full p-4 bg-slate-950 rounded-md border border-slate-800",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{id:`call-modulations-${e}`,className:"text-lg font-medium text-slate-100",children:"Call Modulations"}),!k&&a.jsx("p",{className:"text-sm text-slate-400",children:"Read-only (Owner/Admin can modify)"})]}),a.jsx("div",{className:"mt-4 grid grid-cols-1 gap-3",children:v.map(e=>{var t,s;let{disabled:r,reason:l}=(t=e.key,s=e.feature,u?{disabled:!0,reason:"Loading permissions..."}:o?!function(e,t){let s=e.toLowerCase(),a=f[t];return!a||a.includes(s)}(o,s)?{disabled:!0,reason:`This feature requires ${v.find(e=>e.key===t)?.plan||"a higher plan"}`}:k||"record"===t||"transcribe"===t?{disabled:!1}:{disabled:!0,reason:"Only Owners and Admins can modify this"}:{disabled:!0,reason:"Plan not available"}),i=y[e.key],c="translate"===e.key&&!0===j.real_time_translation_preview,g=c?"Live Translation":e.label,b=c?"Real-time voice translation (post-call transcripts are authoritative)":e.desc;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-md bg-slate-800 hover:bg-slate-700",children:[(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(h,{htmlFor:`mod-${e.key}`,className:"text-sm text-slate-100",children:g}),c&&a.jsx(n,{variant:"default",className:"text-xs bg-blue-600 text-white",children:"Preview"}),c&&a.jsx("span",{className:"text-xs text-blue-400 cursor-help","aria-label":"Live translation info",title:"Live translation is immediate. Post-call transcripts are authoritative.",children:"ℹ️"}),r&&l&&!c&&a.jsx("span",{className:"text-xs text-amber-400","aria-label":l,title:l,children:"⚠"})]}),a.jsx("span",{className:"text-xs text-slate-400",children:b}),i&&"translate"===e.key&&(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[(0,a.jsxs)(d,{label:"From Language",value:x?.translation_from||"",onChange:e=>m({translation_from:e.target.value}),disabled:!k,className:"text-sm",children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"en",children:"English"}),a.jsx("option",{value:"es",children:"Spanish"}),a.jsx("option",{value:"fr",children:"French"}),a.jsx("option",{value:"de",children:"German"})]}),(0,a.jsxs)(d,{label:"To Language",value:x?.translation_to||"",onChange:e=>m({translation_to:e.target.value}),disabled:!k,className:"text-sm",children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"en",children:"English"}),a.jsx("option",{value:"es",children:"Spanish"}),a.jsx("option",{value:"fr",children:"French"}),a.jsx("option",{value:"de",children:"German"})]})]}),i&&"survey"===e.key&&a.jsx("div",{className:"mt-2",children:a.jsx(d,{label:"Survey",value:x?.survey_id||"",onChange:e=>m({survey_id:e.target.value||null}),disabled:!k,className:"text-sm",children:a.jsx("option",{value:"",children:"Select a survey..."})})}),i&&"synthetic_caller"===e.key&&a.jsx("div",{className:"mt-2",children:a.jsx(d,{label:"Script",value:x?.script_id||"",onChange:e=>m({script_id:e.target.value||null}),disabled:!k,className:"text-sm",children:a.jsx("option",{value:"",children:"Select a script..."})})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 ml-4",children:[a.jsx(p,{id:`mod-${e.key}`,checked:i,onCheckedChange:()=>!r&&!w[e.key]&&z(e.key),disabled:r||w[e.key],"aria-label":e.label,"aria-describedby":r&&l?`mod-${e.key}-hint`:void 0}),a.jsx("div",{className:"text-xs text-slate-400 w-12 text-right",children:w[e.key]?a.jsx("span",{"aria-live":"polite",children:"Updating…"}):i?"On":"Off"})]})]},e.key)})}),S&&a.jsx("div",{role:"status","aria-live":"assertive",className:"mt-3 text-sm text-red-400",children:S})]})}let b=(0,r.createContext)(null);function y({defaultValue:e,children:t,className:s=""}){let[l,i]=(0,r.useState)(e);return a.jsx(b.Provider,{value:{activeTab:l,setActiveTab:i},children:a.jsx("div",{className:s,children:t})})}function N({children:e,className:t=""}){return a.jsx("div",{className:`flex border-b border-slate-800 ${t}`,role:"tablist",children:e})}function w({value:e,children:t,className:s=""}){let l=(0,r.useContext)(b);if(!l)throw Error("TabsTrigger must be used within Tabs");let{activeTab:i,setActiveTab:n}=l,c=i===e;return a.jsx("button",{role:"tab","aria-selected":c,onClick:()=>n(e),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 ${c?"border-indigo-500 text-indigo-400":"border-transparent text-slate-400 hover:text-slate-100"} ${s}`,children:t})}function _({value:e,children:t,className:s=""}){let l=(0,r.useContext)(b);if(!l)throw Error("TabsContent must be used within Tabs");let{activeTab:i}=l;return i!==e?null:a.jsx("div",{role:"tabpanel",className:s,children:t})}function S({recordingUrl:e,transcriptPreview:t,onPlay:s}){let l=(0,r.useRef)(null),[n,c]=(0,r.useState)(!1),[o,d]=(0,r.useState)(0),[u,x]=(0,r.useState)(null),[m,h]=(0,r.useState)(1);function p(){let e=l.current;e&&(e.paused?e.play().catch(()=>{}):e.pause())}function f(e){let t=l.current;t&&(t.currentTime=Math.max(0,Math.min(t.duration||0,t.currentTime+e)))}function g(e){return null===e?"0:00":`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}return(0,a.jsxs)("section",{"aria-label":"Audio player",role:"region",className:"w-full space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:p,onKeyDown:function(e){" "===e.key||"Spacebar"===e.key?(e.preventDefault(),p()):"ArrowRight"===e.key?(e.preventDefault(),f(5)):"ArrowLeft"===e.key?(e.preventDefault(),f(-5)):"ArrowUp"===e.key?(e.preventDefault(),h(Math.min(1,m+.1))):"ArrowDown"===e.key&&(e.preventDefault(),h(Math.max(0,m-.1)))},"aria-pressed":n,"aria-label":n?"Pause audio":"Play audio",className:"inline-flex items-center justify-center h-12 w-12 rounded-full bg-indigo-600 text-white hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2 focus:ring-offset-slate-950",children:a.jsx("span",{"aria-hidden":!0,children:n?"▮▮":"▶"})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("div",{className:"text-sm text-slate-100 mb-1",children:"Recording"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"range",min:"0",max:u||0,value:o,onChange:function(e){let t=l.current;if(!t)return;let s=parseFloat(e.target.value);t.currentTime=s,d(s)},className:"flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-600","aria-label":"Seek position"}),(0,a.jsxs)("span",{className:"text-xs text-slate-400 font-mono min-w-[4rem] text-right",children:[g(o)," / ",g(u)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:"text-xs text-slate-400",htmlFor:"volume-control",children:"Volume"}),a.jsx("input",{id:"volume-control",type:"range",min:"0",max:"1",step:"0.1",value:m,onChange:e=>h(parseFloat(e.target.value)),className:"w-20 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-600","aria-label":"Volume control"})]}),a.jsx(i.z,{variant:"outline",size:"sm",onClick:function(){let t=document.createElement("a");t.href=e,t.download=`recording-${Date.now()}.mp3`,t.click()},"aria-label":"Download recording",children:"Download"})]}),a.jsx("audio",{ref:l,src:e,className:"hidden",preload:"metadata","aria-label":"Audio recording"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>f(-5),"aria-label":"Rewind 5 seconds",children:"-5s"}),a.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>f(5),"aria-label":"Forward 5 seconds",children:"+5s"}),t&&a.jsx("a",{href:"#transcript",className:"text-xs text-indigo-400 hover:underline ml-auto",onClick:e=>{e.preventDefault(),document.getElementById("artifact-transcript")?.scrollIntoView({behavior:"smooth"})},children:"View Transcript →"})]}),t&&(0,a.jsxs)("div",{className:"p-3 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Transcript Preview"}),a.jsx("div",{className:"text-sm text-slate-200 line-clamp-3",children:t})]})]})}function C({transcript:e}){let[t,s]=(0,r.useState)(!1),l="string"==typeof e?e:e?.text?e.text:e?.transcript?e.transcript:JSON.stringify(e,null,2),n=e?.words||e?.segments||[],c=n.length>0;async function o(){try{await navigator.clipboard.writeText(l),s(!0),setTimeout(()=>s(!1),2e3)}catch(e){console.error("Failed to copy",e)}}return(0,a.jsxs)("section",{"aria-labelledby":"transcript-view",className:"w-full space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{id:"transcript-view",className:"text-lg font-medium text-slate-100",children:"Transcript"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(i.z,{variant:"outline",size:"sm",onClick:o,children:t?"Copied!":"Copy"}),a.jsx(i.z,{variant:"outline",size:"sm",onClick:function(){let e=new Blob([l],{type:"text/plain"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`transcript-${Date.now()}.txt`,s.click(),URL.revokeObjectURL(t)},children:"Export TXT"}),a.jsx(i.z,{variant:"outline",size:"sm",onClick:function(){let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`transcript-${Date.now()}.json`,a.click(),URL.revokeObjectURL(s)},children:"Export JSON"})]})]}),c?a.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:n.map((e,t)=>(0,a.jsxs)("div",{className:"p-3 bg-slate-900 rounded-md border border-slate-800",children:[void 0!==e.start&&void 0!==e.end&&(0,a.jsxs)("div",{className:"text-xs text-slate-400 mb-1 font-mono",children:[k(e.start)," - ",k(e.end)]}),e.speaker&&(0,a.jsxs)("div",{className:"text-xs text-indigo-400 mb-1",children:["Speaker ",e.speaker]}),a.jsx("div",{className:"text-sm text-slate-100",children:e.text||e.word}),void 0!==e.confidence&&(0,a.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:["Confidence: ",(100*e.confidence).toFixed(1),"%"]})]},t))}):a.jsx("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:a.jsx("pre",{className:"text-sm text-slate-100 whitespace-pre-wrap font-sans",children:l})})]})}function k(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}function z({translation:e,originalTranscript:t}){let[s,l]=(0,r.useState)("side-by-side"),[c,o]=(0,r.useState)(!0),d="string"==typeof e?e:e?.text?e.text:e?.translation?e.translation:JSON.stringify(e,null,2),u=t?.text||("string"==typeof t?t:"")||"Original transcript not available",x=e?.from_language||e?.from||"Unknown",m=e?.to_language||e?.to||"Unknown";return(0,a.jsxs)("section",{"aria-labelledby":"translation-view",className:"w-full space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{id:"translation-view",className:"text-lg font-medium text-slate-100",children:"Translation"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(n,{variant:"info",children:[x," → ",m]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(i.z,{variant:"side-by-side"===s?"default":"outline",size:"sm",onClick:()=>l("side-by-side"),children:"Side by Side"}),a.jsx(i.z,{variant:"toggle"===s?"default":"outline",size:"sm",onClick:()=>l("toggle"),children:"Toggle"})]})]})]}),"side-by-side"===s?(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx(n,{variant:"default",children:x})}),a.jsx("div",{className:"text-sm text-slate-100 whitespace-pre-wrap max-h-[50vh] overflow-y-auto",children:u})]}),(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx(n,{variant:"info",children:m})}),a.jsx("div",{className:"text-sm text-slate-100 whitespace-pre-wrap max-h-[50vh] overflow-y-auto",children:d})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.z,{variant:c?"default":"outline",size:"sm",onClick:()=>o(!0),children:["Original (",x,")"]}),(0,a.jsxs)(i.z,{variant:c?"outline":"default",size:"sm",onClick:()=>o(!1),children:["Translation (",m,")"]})]}),a.jsx("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:a.jsx("div",{className:"text-sm text-slate-100 whitespace-pre-wrap max-h-[50vh] overflow-y-auto",children:c?u:d})})]})]})}function O({survey:e}){let t=e?.results||e?.responses||e||{},s=e?.questions||[],r=e?.sentiment||e?.sentiment_analysis,l=e?.score||e?.overall_score;return(0,a.jsxs)("section",{"aria-labelledby":"survey-results",className:"w-full space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{id:"survey-results",className:"text-lg font-medium text-slate-100",children:"Survey Results"}),void 0!==l&&(0,a.jsxs)(n,{variant:l>=4?"success":l>=3?"warning":"error",children:["Score: ",l,"/5"]})]}),r&&(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"text-sm font-medium text-slate-100 mb-2",children:"Sentiment Analysis"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(n,{variant:"positive"===r?"success":"negative"===r?"error":"warning",children:r}),e?.sentiment_score&&(0,a.jsxs)("span",{className:"text-sm text-slate-400",children:["Confidence: ",(100*e.sentiment_score).toFixed(1),"%"]})]})]}),s.length>0?a.jsx("div",{className:"space-y-4",children:s.map((e,t)=>(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"text-sm font-medium text-slate-100 mb-2",children:e.question||e.text}),(0,a.jsxs)("div",{className:"text-sm text-slate-300 mb-2",children:["Response: ",e.response||e.answer||"No response"]}),void 0!==e.score&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"Score:"}),(0,a.jsxs)(n,{variant:e.score>=4?"success":e.score>=3?"warning":"error",children:[e.score,"/5"]})]})]},t))}):(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"Survey Responses:"}),a.jsx("pre",{className:"text-xs text-slate-200 whitespace-pre-wrap font-mono",children:JSON.stringify(t,null,2)})]}),e?.breakdown&&(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"text-sm font-medium text-slate-100 mb-2",children:"Score Breakdown"}),a.jsx("div",{className:"space-y-2",children:Object.entries(e.breakdown).map(([e,t])=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-slate-300",children:e}),a.jsx(n,{variant:"default",children:t})]},e))})]})]})}function D({manifest:e}){let[t,s]=(0,r.useState)(!1);if(!e)return a.jsx("div",{className:"p-4 bg-slate-950 rounded-md text-slate-400 text-sm",children:"No evidence manifest available"});let l=e.manifest_id||e.id||"unknown",i=e.created_at||e.createdAt||"unknown",n=Array.isArray(e.artifacts)?e.artifacts.length:0,c=e.manifest_hash||e.hash||e.manifestHash||"n/a";return(0,a.jsxs)("section",{role:"region","aria-label":"Evidence manifest summary",className:"w-full p-4 bg-slate-950 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-xs text-slate-400",children:"Manifest"}),a.jsx("div",{className:"text-sm text-slate-100 font-medium",children:l}),a.jsx("div",{className:"text-xs text-slate-400",children:new Date(i).toLocaleString()})]}),(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("div",{className:"text-xs text-slate-400",children:"Artifacts"}),a.jsx("div",{className:"text-sm text-slate-100",children:n}),a.jsx("div",{className:"text-xs text-slate-400 mt-1",children:c})]})]}),a.jsx("div",{className:"mt-3 flex items-center justify-end",children:a.jsx("button",{onClick:()=>s(e=>!e),"aria-expanded":t,className:"text-xs text-indigo-400 hover:underline focus:outline-none focus:ring-2 focus:ring-indigo-400 rounded px-2 py-1",children:t?"Hide JSON":"Show full manifest"})}),t?a.jsx("pre",{className:"mt-3 p-3 rounded bg-slate-800 text-slate-100 text-xs font-mono overflow-auto max-h-80",tabIndex:0,"aria-label":"Full evidence manifest JSON",children:a.jsx("code",{children:JSON.stringify(e,null,2)})}):null]})}function A({manifest:e}){let[t,s]=(0,r.useState)(!1);function l(){let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`evidence-manifest-${e.id||Date.now()}.json`,a.click(),URL.revokeObjectURL(s)}return(0,a.jsxs)("section",{"aria-labelledby":"manifest-view",className:"w-full space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{id:"manifest-view",className:"text-lg font-medium text-slate-100",children:"Evidence Manifest"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(i.z,{variant:"outline",size:"sm",onClick:l,children:"Export JSON"}),a.jsx(i.z,{variant:"outline",size:"sm",onClick:function(){l()},children:"Download"})]})]}),a.jsx(D,{manifest:e}),t&&(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"text-sm font-medium text-slate-100 mb-2",children:"Provenance Metadata"}),(0,a.jsxs)("div",{className:"space-y-2 text-xs text-slate-300",children:[e.producer&&(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Producer:"})," ",e.producer]}),e.created_at&&(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Created:"})," ",new Date(e.created_at).toLocaleString()]}),e.manifest_hash&&(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Hash:"})," ",a.jsx("code",{className:"text-slate-200",children:e.manifest_hash})]})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Full Manifest JSON"}),a.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>s(!t),"aria-expanded":t,children:t?"Collapse":"Expand"})]}),t&&a.jsx("pre",{className:"text-xs text-slate-200 whitespace-pre-wrap font-mono max-h-[60vh] overflow-y-auto",children:JSON.stringify(e,null,2)})]})]})}function $({score:e}){let t=e.score,s=e.breakdown||{},r=e.scorecard_id;return(0,a.jsxs)("section",{"aria-labelledby":"score-view",className:"w-full space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{id:"score-view",className:"text-lg font-medium text-slate-100",children:"Call Score"}),r&&(0,a.jsxs)(n,{variant:"info",children:["Scorecard: ",r]})]}),(0,a.jsxs)("div",{className:"p-6 bg-slate-900 rounded-md border border-slate-800 text-center",children:[(0,a.jsxs)("div",{className:"text-4xl font-bold text-slate-100 mb-2",children:[t,"%"]}),a.jsx(n,{variant:t>=80?"success":t>=60?"warning":"error",className:"text-lg px-4 py-1",children:t>=90?"Excellent":t>=80?"Good":t>=70?"Fair":t>=60?"Needs Improvement":"Poor"})]}),Object.keys(s).length>0&&(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"text-sm font-medium text-slate-100 mb-4",children:"Score Breakdown"}),a.jsx("div",{className:"space-y-3",children:Object.entries(s).map(([e,t])=>{let s="number"==typeof t?t:t?.score||0;return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("div",{className:"text-sm text-slate-100",children:e}),"object"==typeof t&&t?.notes&&a.jsx("div",{className:"text-xs text-slate-400 mt-1",children:t.notes})]}),(0,a.jsxs)(n,{variant:s>=80?"success":s>=60?"warning":"error",children:[s,"%"]})]},e)})})]}),r&&(0,a.jsxs)("div",{className:"p-4 bg-slate-900 rounded-md border border-slate-800",children:[a.jsx("div",{className:"text-sm font-medium text-slate-100 mb-2",children:"Scorecard Information"}),(0,a.jsxs)("div",{className:"text-xs text-slate-400",children:["This score was calculated using scorecard: ",a.jsx("code",{className:"text-slate-200",children:r})]})]})]})}function P({callId:e,recording:t,transcript:s,translation:r,manifest:l,score:i,survey:n}){let c=!!t?.recording_url,o=!!s,d=!!r,u=!!n,x=!!l,m=!!i,h=c?"recording":o?"transcript":x?"manifest":"recording";return(0,a.jsxs)("section",{"aria-labelledby":"artifact-viewer",className:"w-full bg-slate-950 rounded-md border border-slate-800",children:[a.jsx("h3",{id:"artifact-viewer",className:"text-lg font-medium text-slate-100 p-4 border-b border-slate-800",children:"Artifacts"}),(0,a.jsxs)(y,{defaultValue:h,className:"w-full",children:[(0,a.jsxs)(N,{className:"w-full border-b border-slate-800",children:[c&&a.jsx(w,{value:"recording",id:"artifact-recording",children:"Recording"}),o&&a.jsx(w,{value:"transcript",id:"artifact-transcript",children:"Transcript"}),d&&a.jsx(w,{value:"translation",id:"artifact-translation",children:"Translation"}),u&&a.jsx(w,{value:"survey",id:"artifact-survey",children:"Survey"}),x&&a.jsx(w,{value:"manifest",id:"artifact-manifest",children:"Manifest"}),m&&a.jsx(w,{value:"score",id:"artifact-score",children:"Score"})]}),c&&a.jsx(_,{value:"recording",className:"p-4",children:a.jsx(S,{recordingUrl:t.recording_url,transcriptPreview:t.transcript_json?.text||null})}),o&&a.jsx(_,{value:"transcript",className:"p-4",children:a.jsx(C,{transcript:s})}),d&&a.jsx(_,{value:"translation",className:"p-4",children:a.jsx(z,{translation:r,originalTranscript:s})}),u&&a.jsx(_,{value:"survey",className:"p-4",children:a.jsx(O,{survey:n})}),x&&a.jsx(_,{value:"manifest",className:"p-4",children:a.jsx(A,{manifest:l})}),m&&a.jsx(_,{value:"score",className:"p-4",children:a.jsx($,{score:i})}),!c&&!o&&!d&&!u&&!x&&!m&&a.jsx("div",{className:"p-8 text-center text-slate-400",children:"No artifacts available for this call yet."})]})]})}function T({callId:e,organizationId:t,onModulationChange:s}){let{call:l,recording:c,transcript:o,translation:d,manifest:u,score:x,loading:m,error:h}=function(e){let[t,s]=(0,r.useState)(null),[a,l]=(0,r.useState)(!0),[i,n]=(0,r.useState)(null);return{call:t?.call||null,recording:t?.recording||null,transcript:t?.transcript||null,translation:t?.translation||null,manifest:t?.manifest||null,score:t?.score||null,survey:t?.survey||null,loading:a,error:i}}(0);if(!e)return a.jsx("div",{className:"flex items-center justify-center h-full text-slate-400",children:"Select a call from the list to view details"});if(m)return a.jsx("div",{className:"flex items-center justify-center h-full text-slate-400",children:"Loading call details..."});if(h)return(0,a.jsxs)("div",{className:"p-4 bg-red-900/20 border border-red-800 rounded-md text-red-400",children:["Error: ",h]});if(!l)return a.jsx("div",{className:"p-4 bg-slate-900 rounded-md text-slate-400",children:"Call not found"});let p="completed"===l.status?"success":"failed"===l.status||"no-answer"===l.status||"busy"===l.status?"error":"in_progress"===l.status?"info":"default";return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("section",{"aria-labelledby":"call-header",className:"p-4 bg-slate-950 rounded-md border border-slate-800",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{id:"call-header",className:"text-xl font-semibold text-slate-100 mb-2",children:["Call ",l.id]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Status:"}),a.jsx(n,{variant:p,children:l.status||"unknown"})]}),l.call_sid&&(0,a.jsxs)("div",{className:"text-xs text-slate-500 font-mono",children:["SID: ",l.call_sid]})]}),(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("div",{className:"text-sm text-slate-400 mb-1",children:"Duration"}),a.jsx("div",{className:"text-lg font-mono text-slate-100",children:((e,t)=>{if(!e)return"—";if(!t)return"In progress...";let s=new Date(e),a=Math.floor((new Date(t).getTime()-s.getTime())/1e3);return`${Math.floor(a/60)}:${(a%60).toString().padStart(2,"0")}`})(l.started_at,l.ended_at)}),x&&(0,a.jsxs)("div",{className:"mt-2",children:[a.jsx("div",{className:"text-sm text-slate-400 mb-1",children:"Score"}),(0,a.jsxs)(n,{variant:x.score>=80?"success":x.score>=60?"warning":"error",children:[x.score,"%"]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-slate-400",children:"Started"}),a.jsx("div",{className:"text-slate-100",children:l.started_at?new Date(l.started_at).toLocaleString():"—"})]}),l.ended_at&&(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-slate-400",children:"Ended"}),a.jsx("div",{className:"text-slate-100",children:new Date(l.ended_at).toLocaleString()})]})]})]}),(0,a.jsxs)("section",{"aria-label":"Quick actions",className:"flex gap-2",children:[c?.recording_url&&a.jsx(i.z,{variant:"outline",size:"sm",onClick:()=>{document.getElementById("artifact-recording")?.scrollIntoView({behavior:"smooth"})},children:"Play Recording"}),o&&a.jsx(i.z,{variant:"outline",size:"sm",onClick:()=>{document.getElementById("artifact-transcript")?.scrollIntoView({behavior:"smooth"})},children:"View Transcript"}),u&&a.jsx(i.z,{variant:"outline",size:"sm",onClick:()=>{document.getElementById("artifact-manifest")?.scrollIntoView({behavior:"smooth"})},children:"View Manifest"})]}),t&&a.jsx(j,{callId:l.id,organizationId:t,initialModulations:{record:!1,transcribe:!1,translate:!1,survey:!1,synthetic_caller:!1},onChange:s||(async()=>{})}),a.jsx(P,{callId:l.id,recording:c,transcript:o,translation:d,manifest:u,score:x})]})}function R({open:e,onOpenChange:t,title:s,children:l,footer:i}){let n=(0,r.useRef)(null);return e?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",role:"dialog","aria-modal":"true","aria-labelledby":s?"dialog-title":void 0,children:(0,a.jsxs)("div",{ref:n,className:"bg-slate-900 border border-slate-800 rounded-lg shadow-lg max-w-lg w-full mx-4 max-h-[90vh] overflow-auto",children:[s&&a.jsx("div",{className:"px-6 py-4 border-b border-slate-800",children:a.jsx("h2",{id:"dialog-title",className:"text-lg font-semibold text-slate-100",children:s})}),a.jsx("div",{className:"px-6 py-4",children:l}),i&&a.jsx("div",{className:"px-6 py-4 border-t border-slate-800 flex justify-end gap-2",children:i})]})}):null}var U=s(51956);function I({organizationId:e}){let{config:t,loading:s,updateConfig:n}=g(e),{role:c}=l(e),{toast:u}=(0,U.useToast)(),[x,m]=(0,r.useState)([]),[h,p]=(0,r.useState)([]),[f,v]=(0,r.useState)(!0),[j,b]=(0,r.useState)(!1),[y,N]=(0,r.useState)(!1),[w,_]=(0,r.useState)({phone_number:"",name:""}),S="owner"===c||"admin"===c;async function C(){if(e&&S)try{b(!0),await n({target_id:t?.target_id,campaign_id:t?.campaign_id}),u({title:"Configuration saved",description:"Target and campaign selection saved successfully."})}catch(e){u({title:"Error",description:e?.message||"Failed to save configuration",variant:"destructive"})}finally{b(!1)}}async function k(){if(e&&S)try{N(!1),_({phone_number:"",name:""}),u({title:"Target added",description:"New target will be available after refresh."})}catch(e){u({title:"Error",description:e?.message||"Failed to add target",variant:"destructive"})}}return f||s?a.jsx("div",{className:"p-4 text-slate-400 text-sm",children:"Loading..."}):(0,a.jsxs)("section",{"aria-labelledby":"target-campaign-selector",className:"w-full p-4 bg-slate-950 rounded-md border border-slate-800",children:[a.jsx("h3",{id:"target-campaign-selector",className:"text-lg font-medium text-slate-100 mb-4",children:"Target & Campaign"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(d,{label:"Target Number",value:t?.target_id||"",onChange:e=>{S&&n({target_id:e.target.value||null})},disabled:!S,"aria-label":"Select target phone number",children:[a.jsx("option",{value:"",children:"Select a target..."}),x.filter(e=>e.is_active).map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name||e.phone_number," (",e.phone_number,")"]},e.id))]}),S&&a.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>N(!0),className:"mt-2",children:"+ Add Target"})]}),a.jsx("div",{children:(0,a.jsxs)(d,{label:"Campaign (Optional)",value:t?.campaign_id||"",onChange:e=>{S&&n({campaign_id:e.target.value||null})},disabled:!S,"aria-label":"Select campaign",children:[a.jsx("option",{value:"",children:"None"}),h.filter(e=>e.is_active).map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})}),S&&a.jsx(i.z,{onClick:C,disabled:j,className:"w-full","aria-label":"Save configuration",children:j?"Saving...":"Save Configuration"}),!S&&a.jsx("p",{className:"text-xs text-slate-400",children:"Only Owners and Admins can modify configuration."})]}),(0,a.jsxs)(R,{open:y,onOpenChange:N,title:"Add Target",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx(o,{label:"Phone Number",type:"tel",value:w.phone_number,onChange:e=>_({...w,phone_number:e.target.value}),placeholder:"+1234567890",required:!0}),a.jsx(o,{label:"Name (Optional)",value:w.name,onChange:e=>_({...w,name:e.target.value}),placeholder:"Main Office"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[a.jsx(i.z,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),a.jsx(i.z,{onClick:k,children:"Add Target"})]})]})]})}function E({organizationId:e,onCallPlaced:t}){let{role:s}=l(e),c=function(e,t,s){let{role:a,plan:r,loading:i}=l(e);return!i&&!!a&&!!r&&(["owner","admin"].includes(a)||"read"===s&&["operator","analyst","viewer"].includes(a)||"execute"===s&&"operator"===a)&&("free"!==r||"call"===t)}(e,"call","execute"),{config:o}=g(e),{toast:d}=(0,U.useToast)(),{updates:x,connected:m}=u(e),[h,p]=(0,r.useState)(!1),[f,v]=(0,r.useState)(null),[j,b]=(0,r.useState)(null),[y,N]=(0,r.useState)(0);async function w(){if(!e||!c||!o?.target_id){d({title:"Error",description:"Cannot place call: missing target or insufficient permissions",variant:"destructive"});return}try{p(!0),b("initiating");let s=await fetch("/api/voice/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organization_id:e,target_id:o.target_id,campaign_id:o.campaign_id||null,modulations:{record:o.recording_enabled||!1,transcribe:o.transcription_enabled||!1,translate:o.translation_enabled||!1,survey:o.survey_enabled||!1,synthetic_caller:o.secret_shopper_enabled||!1}})});if(!s.ok){let e=await s.json().catch(()=>({error:"Failed to place call"}));throw Error(e.error||"Failed to place call")}let a=(await s.json()).call_id;v(a),b("ringing"),N(0),t?.(a),d({title:"Call placed",description:`Call ${a} is being initiated...`})}catch(e){b(null),d({title:"Error",description:e?.message||"Failed to place call",variant:"destructive"})}finally{p(!1)}}let _="completed"===j?"success":"failed"===j||"no-answer"===j||"busy"===j?"error":"in_progress"===j?"info":"ringing"===j?"warning":"default";return c?(0,a.jsxs)("section",{"aria-labelledby":"execution-controls",className:"w-full p-4 bg-slate-950 rounded-md border border-slate-800",children:[a.jsx("h3",{id:"execution-controls",className:"text-lg font-medium text-slate-100 mb-4",children:"Execution Controls"}),(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx(i.z,{onClick:w,disabled:h||!o?.target_id||null!==f,className:"w-full",size:"lg","aria-label":"Place call",children:h?"Placing Call...":f?"Call in Progress":"Place Call"}),f&&j&&(0,a.jsxs)("div",{className:"p-3 bg-slate-900 rounded-md border border-slate-800",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Call Status:"}),a.jsx(n,{variant:_,children:j})]}),"in_progress"===j&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Duration:"}),a.jsx("span",{className:"text-sm font-mono text-slate-100",children:`${Math.floor(y/60)}:${(y%60).toString().padStart(2,"0")}`})]}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["Call ID: ",f]}),!m&&a.jsx("div",{className:"mt-2 text-xs text-amber-400",children:"Real-time updates disconnected. Using polling fallback."})]}),!o?.target_id&&a.jsx("p",{className:"text-sm text-amber-400",children:"Please select a target number before placing a call."})]})]}):a.jsx("div",{className:"p-4 bg-slate-950 rounded-md border border-slate-800",children:a.jsx("p",{className:"text-sm text-slate-400",children:"Only Owners, Admins, and Operators can place calls."})})}function M({callId:e,organizationId:t,limit:s=10,events:l}){let[c,o]=(0,r.useState)(l||[]),[d,m]=(0,r.useState)("all"),{updates:h,connected:p}=u(t||null),{data:f}=x(async()=>{if(!t)return[];try{let e=await fetch(`/api/audit-logs?orgId=${encodeURIComponent(t)}&limit=${s}`);if(e.ok)return(await e.json()).events||[];return[]}catch{return[]}},1e4,!p&&null!==t),g=c.filter(t=>e?t.call_id===e:"all"===d||t.type.includes(d)).slice(0,s);return(0,a.jsxs)("section",{"aria-label":"Activity feed",className:"w-full bg-slate-950 rounded-md border border-slate-800",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-slate-800",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h4",{className:"text-sm font-medium text-slate-100",children:"Activity"}),!p&&a.jsx("span",{className:"text-xs text-amber-400","aria-label":"Real-time disconnected",children:"⚠"})]}),!e&&(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(i.z,{variant:"all"===d?"default":"outline",size:"sm",onClick:()=>m("all"),className:"text-xs",children:"All"}),a.jsx(i.z,{variant:"call"===d?"default":"outline",size:"sm",onClick:()=>m("call"),className:"text-xs",children:"Calls"}),a.jsx(i.z,{variant:"transcript"===d?"default":"outline",size:"sm",onClick:()=>m("transcript"),className:"text-xs",children:"Transcripts"})]})]}),(0,a.jsxs)("div",{role:"status","aria-live":"polite",className:"sr-only",children:[g.length," events shown"]}),a.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:0===g.length?a.jsx("div",{className:"p-4 text-center text-slate-400 text-sm",children:"No recent activity"}):a.jsx("ul",{role:"list",className:"divide-y divide-slate-800",children:g.map(e=>{var t;return a.jsx("li",{className:`p-3 hover:bg-slate-900 transition-colors ${e.call_id?"cursor-pointer":""}`,onClick:()=>e.call_id&&void(e.call_id&&window.dispatchEvent(new CustomEvent("call:select",{detail:{callId:e.call_id}}))),"aria-labelledby":`evt-${e.id}-title`,children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"text-lg","aria-hidden":!0,children:(t=e.type).includes("error")||t.includes("failed")?"❌":t.includes("record")?"⏺️":t.includes("transcript")||t.includes("transcription")?"\uD83D\uDCDD":t.includes("translation")?"\uD83C\uDF10":t.includes("survey")?"\uD83D\uDCCB":t.includes("score")?"⭐":t.includes("call.started")||t.includes("call_started")?"\uD83D\uDCDE":t.includes("call.ended")||t.includes("call_ended")||t.includes("call.completed")?"\uD83D\uDD1A":"ℹ️"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{id:`evt-${e.id}-title`,className:"text-sm text-slate-100",children:e.title}),a.jsx("div",{className:"text-xs text-slate-400 mt-1",children:new Date(e.timestamp).toLocaleString()}),e.call_id&&(0,a.jsxs)("div",{className:"text-xs text-indigo-400 mt-1",children:["Call: ",e.call_id]})]}),a.jsx(n,{variant:"error"===e.status?"error":"warning"===e.status?"warning":"success"===e.status?"success":"default",className:"text-xs",children:e.status||"info"})]})},e.id)})})})]})}function L({initialCalls:e,organizationId:t,organizationName:s}){let[l,i]=(0,r.useState)(null);async function n(e){console.log("Modulation change:",e)}return(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-slate-950 text-slate-100",children:[a.jsx(c,{organizationId:t,organizationName:s}),(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[a.jsx("aside",{className:"w-1/4 border-r border-slate-800 flex flex-col overflow-hidden",children:a.jsx(m,{calls:e,selectedCallId:l,organizationId:t,onSelect:i})}),a.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(I,{organizationId:t}),a.jsx(E,{organizationId:t}),a.jsx("div",{id:"call-detail-container",children:a.jsx(T,{callId:l,organizationId:t,onModulationChange:n})})]})}),a.jsx("aside",{className:"w-1/4 border-l border-slate-800 overflow-y-auto p-4",children:a.jsx(M,{organizationId:t,limit:20})})]})]})}},20153:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(19510);s(71159);var r=s(62632),l=s(45609);let i=(0,s(68570).createProxy)(String.raw`C:\Users\Ultimate Warrior\My project\gemini-project\components\voice\VoiceOperationsClient.tsx#default`);async function n(e){let t=await (0,l.getServerSession)();if(!t?.user?.id)return a.jsx("div",{className:"flex h-screen items-center justify-center bg-slate-950 text-slate-100",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("h2",{className:"text-xl",children:"Authentication required"}),a.jsx("p",{className:"mt-2 text-slate-400",children:"Please sign in to view Voice Operations."})]})});let s=null,n=null;try{let{data:e}=await r.default.from("users").select("organization_id").eq("id",t.user.id).single();if(e?.organization_id){s=e.organization_id;let{data:t}=await r.default.from("organizations").select("name").eq("id",s).single();n=t?.name||null}}catch(e){console.error("Failed to fetch organization",e)}let c=[];try{let e=r.default.from("calls").select("id,organization_id,system_id,status,started_at,ended_at,created_by,call_sid").order("started_at",{ascending:!1}).limit(50);s&&e.eq("organization_id",s);let{data:t,error:a}=await e;if(a)throw a;c=t||[]}catch(e){return a.jsx("div",{className:"flex h-screen items-center justify-center bg-slate-950 text-slate-100",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto h-12 w-12 text-red-500 text-4xl",children:"⚠️"}),a.jsx("h2",{className:"mt-4 text-xl",children:"Error loading calls"}),a.jsx("p",{className:"mt-2 text-slate-400",children:String(e?.message??"Failed to load calls")})]})})}return a.jsx(i,{initialCalls:c,organizationId:s,organizationName:n||void 0})}},62632:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a={from:e=>({insert:async e=>({data:[e],error:null}),update:async e=>({data:[e],error:null}),select:t=>(function(e,t){let s={_table:e,_cols:t,eq:(e,t)=>s,in:(e,t)=>s,limit:e=>s,order:(e,t)=>s,single:async()=>({data:null,error:null})};return s.then=(e,t)=>Promise.resolve({data:null,error:null}).then(e,t),s.catch=e=>Promise.resolve({data:null,error:null}).catch(e),s})(e,t),in:(e,t)=>({data:null,error:null})})}},79925:e=>{"use strict";var t=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,l={};function i(e){var t;let s=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),a=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===s.length?a:`${a}; ${s.join("; ")}`}function n(e){let t=new Map;for(let s of e.split(/; */)){if(!s)continue;let e=s.indexOf("=");if(-1===e){t.set(s,"true");continue}let[a,r]=[s.slice(0,e),s.slice(e+1)];try{t.set(a,decodeURIComponent(null!=r?r:"true"))}catch{}}return t}function c(e){var t,s;if(!e)return;let[[a,r],...l]=n(e),{domain:i,expires:c,httponly:u,maxage:x,path:m,samesite:h,secure:p,partitioned:f,priority:g}=Object.fromEntries(l.map(([e,t])=>[e.toLowerCase(),t]));return function(e){let t={};for(let s in e)e[s]&&(t[s]=e[s]);return t}({name:a,value:decodeURIComponent(r),domain:i,...c&&{expires:new Date(c)},...u&&{httpOnly:!0},..."string"==typeof x&&{maxAge:Number(x)},path:m,...h&&{sameSite:o.includes(t=(t=h).toLowerCase())?t:void 0},...p&&{secure:!0},...g&&{priority:d.includes(s=(s=g).toLowerCase())?s:void 0},...f&&{partitioned:!0}})}((e,s)=>{for(var a in s)t(e,a,{get:s[a],enumerable:!0})})(l,{RequestCookies:()=>u,ResponseCookies:()=>x,parseCookie:()=>n,parseSetCookie:()=>c,stringifyCookie:()=>i}),e.exports=((e,l,i,n)=>{if(l&&"object"==typeof l||"function"==typeof l)for(let i of a(l))r.call(e,i)||void 0===i||t(e,i,{get:()=>l[i],enumerable:!(n=s(l,i))||n.enumerable});return e})(t({},"__esModule",{value:!0}),l);var o=["strict","lax","none"],d=["low","medium","high"],u=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t)for(let[e,s]of n(t))this._parsed.set(e,{name:e,value:s})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let s=Array.from(this._parsed);if(!e.length)return s.map(([e,t])=>t);let a="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return s.filter(([e])=>e===a).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,s]=1===e.length?[e[0].name,e[0].value]:e,a=this._parsed;return a.set(t,{name:t,value:s}),this._headers.set("cookie",Array.from(a).map(([e,t])=>i(t)).join("; ")),this}delete(e){let t=this._parsed,s=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>i(t)).join("; ")),s}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},x=class{constructor(e){var t,s,a;this._parsed=new Map,this._headers=e;let r=null!=(a=null!=(s=null==(t=e.getSetCookie)?void 0:t.call(e))?s:e.get("set-cookie"))?a:[];for(let e of Array.isArray(r)?r:function(e){if(!e)return[];var t,s,a,r,l,i=[],n=0;function c(){for(;n<e.length&&/\s/.test(e.charAt(n));)n+=1;return n<e.length}for(;n<e.length;){for(t=n,l=!1;c();)if(","===(s=e.charAt(n))){for(a=n,n+=1,c(),r=n;n<e.length&&"="!==(s=e.charAt(n))&&";"!==s&&","!==s;)n+=1;n<e.length&&"="===e.charAt(n)?(l=!0,n=r,i.push(e.substring(t,a)),t=n):n=a+1}else n+=1;(!l||n>=e.length)&&i.push(e.substring(t,e.length))}return i}(r)){let t=c(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let s=Array.from(this._parsed.values());if(!e.length)return s;let a="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return s.filter(e=>e.name===a)}has(e){return this._parsed.has(e)}set(...e){let[t,s,a]=1===e.length?[e[0].name,e[0].value,e[0]]:e,r=this._parsed;return r.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:s,...a})),function(e,t){for(let[,s]of(t.delete("set-cookie"),e)){let e=i(s);t.append("set-cookie",e)}}(r,this._headers),this}delete(...e){let[t,s,a]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:s,domain:a,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(i).join("; ")}}},92044:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{RequestCookies:function(){return a.RequestCookies},ResponseCookies:function(){return a.ResponseCookies},stringifyCookie:function(){return a.stringifyCookie}});let a=s(79925)},6649:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var a=s(84770),r=s.n(a);let l=new Uint8Array(256),i=l.length;function n(){return i>l.length-16&&(r().randomFillSync(l),i=0),l.slice(i,i+=16)}},16099:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var a=s(30900);let r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).substr(1));let l=function(e,t=0){let s=(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase();if(!(0,a.Z)(s))throw TypeError("Stringified UUID is invalid");return s}},79843:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var a=s(6649),r=s(16099);let l=function(e,t,s){let l=(e=e||{}).random||(e.rng||a.Z)();if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=l[e];return t}return(0,r.Z)(l)}},30900:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,r=function(e){return"string"==typeof e&&a.test(e)}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,609,159,184],()=>s(44392));module.exports=a})();