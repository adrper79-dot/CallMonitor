"use strict";(()=>{var e={};e.id=984,e.ids=[984],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},12652:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>v,patchFetch:()=>S,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>_});var n={};t.r(n),t.d(n,{GET:()=>m,POST:()=>p});var r=t(49303),i=t(88716),o=t(60670),s=t(87070),l=t(62632);function u(e){return({en:"English","en-US":"English (US)",es:"Spanish","es-US":"Spanish (US)","es-ES":"Spanish (Spain)",fr:"French","fr-FR":"French",de:"German","de-DE":"German",it:"Italian","it-IT":"Italian",pt:"Portuguese","pt-BR":"Portuguese (Brazil)","pt-PT":"Portuguese (Portugal)",ja:"Japanese","ja-JP":"Japanese",zh:"Chinese","zh-CN":"Chinese (Simplified)",ko:"Korean","ko-KR":"Korean"})[e.toLowerCase()]||"English"}function d(e){return({en:"rime.spore","en-US":"rime.spore",es:"rime.alberto","es-US":"rime.alberto","es-ES":"rime.alberto",fr:"rime.viola","fr-FR":"rime.viola",de:"rime.stella","de-DE":"rime.stella",it:"rime.paola","it-IT":"rime.paola",pt:"rime.luana","pt-BR":"rime.luana","pt-PT":"rime.luana",ja:"rime.akari","ja-JP":"rime.akari",zh:"rime.ling","zh-CN":"rime.ling",ko:"rime.yeonjun","ko-KR":"rime.yeonjun"})[e.toLowerCase()]||"rime.spore"}var c=t(70332);async function p(e){try{let a=String(e.headers.get("content-type")||""),t={};try{if(a.includes("application/json"))t=await e.json();else{let a=await e.text();t=function(e){try{let a=new URLSearchParams(e),t={};return Array.from(a.entries()).forEach(([e,a])=>{t[e]=a}),t}catch{return{}}}(a)}}catch(a){try{t=await e.json()}catch{t={}}}let n=t.From??t.from,r=t.To??t.to,i=t.CallSid??t.CallSid??t.call_sid,o=new URL(e.url).searchParams.get("callId");console.log("swml/outbound webhook",{from:n,to:r,callSid:i?"[REDACTED]":null,callId:o});let p=null,m=null;if(i){let{data:e}=await l.default.from("calls").select("id, organization_id").eq("call_sid",i).limit(1);e&&e[0]&&(p=e[0].organization_id)}else if(o){let{data:e}=await l.default.from("calls").select("organization_id").eq("id",o).limit(1);e&&e[0]&&(p=e[0].organization_id)}if(!p)return console.warn("swml/outbound: could not find organization_id",{callSid:i?"[REDACTED]":null,callId:o}),s.NextResponse.json({version:"1.0.0",sections:{main:[{answer:{}},{hangup:{}}]}},{status:200,headers:{"Content-Type":"application/json"}});let{data:g}=await l.default.from("voice_configs").select("record, translate, translate_from, translate_to").eq("organization_id",p).limit(1);if(m=g?.[0]||null,!m?.translate||!m?.translate_from||!m?.translate_to)return console.warn("swml/outbound: translation not enabled in voice_configs",{organizationId:p}),s.NextResponse.json({version:"1.0.0",sections:{main:[{answer:{}},{hangup:{}}]}},{status:200,headers:{"Content-Type":"application/json"}});if(!(0,c.Au)())return console.warn("swml/outbound: feature flag disabled",{organizationId:p}),s.NextResponse.json({version:"1.0.0",sections:{main:[{answer:{}},{hangup:{}}]}},{status:200,headers:{"Content-Type":"application/json"}});let h=o||i||`swml-${Date.now()}`,_=function(e,a=!0){let t=function(e){let{callId:a,organizationId:t,translationFrom:n,translationTo:r,detectedLanguage:i=n}=e,o=e=>({en:"en-US-Neural2-J","en-US":"en-US-Neural2-J",es:"es-US-Neural2-A","es-US":"es-US-Neural2-A","es-ES":"es-ES-Neural2-A",fr:"fr-FR-Neural2-A","fr-FR":"fr-FR-Neural2-A",de:"de-DE-Neural2-A","de-DE":"de-DE-Neural2-A",it:"it-IT-Neural2-A","it-IT":"it-IT-Neural2-A",pt:"pt-BR-Neural2-A","pt-BR":"pt-BR-Neural2-A","pt-PT":"pt-PT-Neural2-A",ja:"ja-JP-Neural2-A","ja-JP":"ja-JP-Neural2-A",zh:"zh-CN-Neural2-A","zh-CN":"zh-CN-Neural2-A",ko:"ko-KR-Neural2-A","ko-KR":"ko-KR-Neural2-A"})[e.toLowerCase()]||"en-US-Neural2-J",s=o(r),l=o(i);return{agent:{name:"CallMonitor Live Translation Agent (Preview)",version:"1.0.0",description:"Real-time bi-directional translation executed by SignalWire AI. Canonical transcript and evidence provided by AssemblyAI.",languages:{primary:r||"en-US",secondary:i||n||"en-US",target:r||"en-US"},prompt:{system:"You are a live, real-time translator for phone calls. Your role is to listen to one speaker, translate their speech accurately and naturally into the target language, and speak the translation immediately. Do NOT add commentary, summaries, or opinions. Preserve tone, intent, and nuance. Speak clearly and at natural speed. If the speaker switches languages, detect and adapt seamlessly. Do NOT persist any data â€” this is ephemeral execution only.",user:`Translate from ${n||"auto"} to ${r||"en-US"} in real time.`},voice:{primary:s,secondary:l},model:"gpt-4o-mini",temperature:.3,max_tokens:150,timeout:3e4},execution:{type:"live_translation",trigger:"call_answered",on_event:["speech_detected","language_changed","silence_timeout"]},metadata:{callmonitor_call_id:a,callmonitor_org_id:t,callmonitor_provider:"signalwire",canonical_transcript_source:"assemblyai",feature_flag:"translation_live_assist_preview"},fallback:{on_failure:"continue_without_translation",log_to:"callmonitor_audit_logs",notify:"callmonitor_kpi_live_translation_failure"}}}(e),n=[];n.push({answer:{}});let r={prompt:{text:t.agent.prompt.system},languages:[{name:u(t.agent.languages.primary),code:t.agent.languages.primary,voice:d(t.agent.languages.primary)}],model:t.agent.model,temperature:t.agent.temperature,max_tokens:t.agent.max_tokens};return t.agent.languages.secondary!==t.agent.languages.primary&&r.languages.push({name:u(t.agent.languages.secondary),code:t.agent.languages.secondary,voice:d(t.agent.languages.secondary)}),n.push({ai:r}),a&&n.push({record_call:{format:"mp3",stereo:!1,recording_status_callback:"https://voxsouth.online/api/webhooks/signalwire"}}),{version:"1.0.0",sections:{main:n}}}({callId:h,organizationId:p,translationFrom:m.translate_from,translationTo:m.translate_to},!0===m.record);return console.log("swml/outbound: generated SWML",{organizationId:p,callId:h,hasAI:!0}),s.NextResponse.json(_,{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("swml/outbound error",{error:e?.message??String(e)}),s.NextResponse.json({version:"1.0.0",sections:{main:[{answer:{}},{hangup:{}}]}},{status:200,headers:{"Content-Type":"application/json"}})}}async function m(e){return s.NextResponse.json({ok:!0,route:"/api/voice/swml/outbound",method:"Use POST for SWML generation",description:"SWML endpoint for live translation calls with SignalWire AI Agent"})}let g=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/voice/swml/outbound/route",pathname:"/api/voice/swml/outbound",filename:"route",bundlePath:"app/api/voice/swml/outbound/route"},resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\voice\\swml\\outbound\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:_,serverHooks:f}=g,v="/api/voice/swml/outbound/route";function S(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:_})}},70332:(e,a,t)=>{t.d(a,{Au:()=>i,PF:()=>r});let n=[{name:"SIGNALWIRE_PROJECT_ID",required:!0,description:"SignalWire project ID for call execution",validate:e=>e.length>0||"Must not be empty"},{name:"SIGNALWIRE_TOKEN",required:!0,description:"SignalWire API token",validate:e=>e.length>0||"Must not be empty"},{name:"SIGNALWIRE_SPACE",required:!0,description:"SignalWire space URL",validate:e=>e.includes("signalwire.com")||"Must be a valid SignalWire space URL"},{name:"ASSEMBLYAI_API_KEY",required:!0,description:"AssemblyAI API key for transcription",validate:e=>e.length>0||"Must not be empty"},{name:"NEXT_PUBLIC_SUPABASE_URL",required:!0,description:"Supabase project URL",validate:e=>e.startsWith("https://")||"Must be a valid HTTPS URL"},{name:"NEXT_PUBLIC_SUPABASE_ANON_KEY",required:!0,description:"Supabase anonymous key",validate:e=>e.length>0||"Must not be empty"},{name:"SUPABASE_SERVICE_ROLE_KEY",required:!0,description:"Supabase service role key (server-side only)",validate:e=>e.length>0||"Must not be empty"},{name:"NEXT_PUBLIC_APP_URL",required:!0,description:"Public application URL for webhooks",validate:e=>e.startsWith("https://")||e.startsWith("http://localhost")||"Must be a valid URL"},{name:"NEXTAUTH_SECRET",required:!0,description:"NextAuth secret for session encryption",validate:e=>e.length>=32||"Must be at least 32 characters"},{name:"OPENAI_API_KEY",required:!1,description:"OpenAI API key for translation (optional)",validate:e=>e.length>0||"Must not be empty if provided"},{name:"TRANSLATION_LIVE_ASSIST_PREVIEW",required:!1,description:"Enable live translation preview feature (SignalWire AI Agents)",validate:e=>"true"===e||"false"===e||'Must be "true" or "false"'}];function r(){let e=[],a=[];for(let t of n){let n=process.env[t.name];if(n){if(t.validate){let r=t.validate(n);if(!0!==r){let n="string"==typeof r?r:"Invalid value";t.required?e.push({name:t.name,message:`${t.description}: ${n}`}):a.push({name:t.name,message:`${t.description}: ${n}`})}}}else t.required?e.push({name:t.name,message:`Required environment variable missing: ${t.description}`}):a.push({name:t.name,message:`Optional environment variable not set: ${t.description}`})}return{valid:0===e.length,errors:e,warnings:a}}function i(){return"true"===process.env.TRANSLATION_LIVE_ASSIST_PREVIEW}},62632:(e,a,t)=>{t.r(a),t.d(a,{default:()=>n});let n={from:e=>({insert:async e=>({data:[e],error:null}),update:async e=>({data:[e],error:null}),select:a=>(function(e,a){let t={_table:e,_cols:a,eq:(e,a)=>t,in:(e,a)=>t,limit:e=>t,order:(e,a)=>t,single:async()=>({data:null,error:null})};return t.then=(e,a)=>Promise.resolve({data:null,error:null}).then(e,a),t.catch=e=>Promise.resolve({data:null,error:null}).catch(e),t})(e,a),in:(e,a)=>({data:null,error:null})})}}};var a=require("../../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),n=a.X(0,[276,972],()=>t(12652));module.exports=n})();