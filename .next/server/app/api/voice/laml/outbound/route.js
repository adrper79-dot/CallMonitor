"use strict";(()=>{var e={};e.id=19,e.ids=[19],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},52105:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var r={};a.r(r),a.d(r,{GET:()=>h,POST:()=>u});var l=a(49303),o=a(88716),n=a(60670),i=a(87070),s=a(62632);async function u(e){let t=String(e.headers.get("content-type")||""),a={};try{if(t.includes("application/json"))a=await e.json();else{let t=await e.text();a=function(e){try{let t=new URLSearchParams(e),a={};return Array.from(t.entries()).forEach(([e,t])=>{a[e]=t}),a}catch{return{}}}(t)}}catch(t){try{a=await e.json()}catch{a={}}}let r=a.From??a.from,l=a.To??a.to,o=a.CallSid??a.CallSid??a.call_sid;console.log("laml/outbound webhook",{from:r,to:l,callSid:o?"[REDACTED]":null});let n=await c(o);if(n)return new i.NextResponse(n,{status:200,headers:{"Content-Type":"application/xml"}});let s=await p(o,l);return new i.NextResponse(s,{status:200,headers:{"Content-Type":"application/xml"}})}let c=async e=>{try{let t=String("https://voxsouth.online");if(!t||!e)return null;let a=`${t.replace(/\/$/,"")}/api/voice/script?callSid=${encodeURIComponent(e)}`,r=new AbortController,l=setTimeout(()=>r.abort(),3e3),o=await fetch(a,{signal:r.signal});if(clearTimeout(l),!o.ok)return null;let n=await o.text();if(!n)return null;return n}catch(e){return null}};async function p(e,t){let a=null,r=null;if(e){let{data:t}=await s.default.from("calls").select("organization_id").eq("call_sid",e).limit(1);if(r=t?.[0]?.organization_id||null){let{data:e}=await s.default.from("voice_configs").select("record, transcribe, translate, translate_from, translate_to, survey, synthetic_caller").eq("organization_id",r).limit(1);a=e?.[0]||null}}let l=[];if(a?.synthetic_caller){let e=null;try{let{data:t}=await s.default.from("voice_configs").select("*").eq("organization_id",r||"").limit(1);e="Hello, I'm calling to inquire about your services. Do you have any availability this week?"}catch{e="Hello, I'm calling to inquire about your services. Do you have any availability this week?"}let t=(e||"").split(/\n|\|/).filter(e=>e.trim());for(let e=0;e<t.length;e++){let a=t[e].trim();a&&(l.push(`<Say voice="alice">${d(a)}</Say>`),e<t.length-1&&l.push('<Pause length="2"/>'))}}a?.translate&&a?.translate_from&&a?.translate_to;let o=a?.record===!0,n="https://voxsouth.online/api/webhooks/signalwire";if(a?.survey&&(l.push('<Say voice="alice">Thank you for your time. Before we end, I have a quick survey.</Say>'),l.push('<Pause length="1"/>'),l.push("<Say>On a scale of 1 to 5, how satisfied were you with this call?</Say>"),l.push('<Gather numDigits="1" action="/api/webhooks/survey" method="POST" timeout="10"/>')),t){let e=[];o?(e.push(`<Number>${d(t)}</Number>`),l.push(`<Dial record="record-from-answer" recordingStatusCallback="${n}" recordingStatusCallbackEvent="completed">`),l.push(...e),l.push("</Dial>")):l.push(`<Dial><Number>${d(t)}</Number></Dial>`)}else{let t=e||`conf-${Date.now()}`;l.push(`<Dial><Conference>${d(t)}</Conference></Dial>`)}return o&&!t&&l.push(`<Record action="https://voxsouth.online/api/webhooks/signalwire" recordingStatusCallback="${n}" maxLength="3600"/>`),a?.synthetic_caller&&l.push('<Say voice="alice">Thank you for your time. Goodbye.</Say>'),`<?xml version="1.0" encoding="UTF-8"?>
<Response>
${l.map(e=>`  ${e}`).join("\n")}
</Response>`}function d(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}async function h(){return i.NextResponse.json({ok:!0,route:"/api/voice/laml/outbound"})}let m=new l.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/voice/laml/outbound/route",pathname:"/api/voice/laml/outbound",filename:"route",bundlePath:"app/api/voice/laml/outbound/route"},resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\voice\\laml\\outbound\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:g}=m,v="/api/voice/laml/outbound/route";function w(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},62632:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});let r={from:e=>({insert:async e=>({data:[e],error:null}),update:async e=>({data:[e],error:null}),select:t=>(function(e,t){let a={_table:e,_cols:t,eq:(e,t)=>a,in:(e,t)=>a,limit:e=>a,order:(e,t)=>a,single:async()=>({data:null,error:null})};return a.then=(e,t)=>Promise.resolve({data:null,error:null}).then(e,t),a.catch=e=>Promise.resolve({data:null,error:null}).catch(e),a})(e,t),in:(e,t)=>({data:null,error:null})})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(52105));module.exports=r})();