"use strict";(()=>{var e={};e.id=19,e.ids=[19],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},52105:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>w,patchFetch:()=>b,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y});var r={};a.r(r),a.d(r,{GET:()=>m,POST:()=>u});var o=a(49303),n=a(88716),l=a(60670),i=a(87070),s=a(62632);async function u(e){let t=new URL(e.url),a=t.searchParams.get("callId"),r=t.searchParams.get("conference"),o=t.searchParams.get("leg");if(r&&a){let e=await d(r,a,"1"===o||"2"===o?parseInt(o):void 0);return new i.NextResponse(e,{status:200,headers:{"Content-Type":"application/xml"}})}let n=String(e.headers.get("content-type")||""),l={};try{if(n.includes("application/json"))l=await e.json();else{let t=await e.text();l=function(e){try{let t=new URLSearchParams(e),a={};return Array.from(t.entries()).forEach(([e,t])=>{a[e]=t}),a}catch{return{}}}(t)}}catch(t){try{l=await e.json()}catch{l={}}}let s=l.From??l.from,u=l.To??l.to,h=l.CallSid??l.CallSid??l.call_sid;console.log("laml/outbound webhook",{from:s,to:u,callSid:h?"[REDACTED]":null});let m=await c(h);if(m)return new i.NextResponse(m,{status:200,headers:{"Content-Type":"application/xml"}});let f=await p(h,u);return new i.NextResponse(f,{status:200,headers:{"Content-Type":"application/xml"}})}let c=async e=>{try{let t=String("https://voxsouth.online");if(!t||!e)return null;let a=`${t.replace(/\/$/,"")}/api/voice/script?callSid=${encodeURIComponent(e)}`,r=new AbortController,o=setTimeout(()=>r.abort(),3e3),n=await fetch(a,{signal:r.signal});if(clearTimeout(o),!n.ok)return null;let l=await n.text();if(!l)return null;return l}catch(e){return null}};async function p(e,t){let a=null,r=null;if(e){let{data:t}=await s.default.from("calls").select("organization_id").eq("call_sid",e).limit(1);if(r=t?.[0]?.organization_id||null){let{data:e}=await s.default.from("voice_configs").select("record, transcribe, translate, translate_from, translate_to, survey, synthetic_caller").eq("organization_id",r).limit(1);a=e?.[0]||null}}let o=[];if(a?.synthetic_caller){let e=null;try{let{data:t}=await s.default.from("voice_configs").select("*").eq("organization_id",r||"").limit(1);e="Hello, I'm calling to inquire about your services. Do you have any availability this week?"}catch{e="Hello, I'm calling to inquire about your services. Do you have any availability this week?"}let t=(e||"").split(/\n|\|/).filter(e=>e.trim());for(let e=0;e<t.length;e++){let a=t[e].trim();a&&(o.push(`<Say voice="alice">${h(a)}</Say>`),e<t.length-1&&o.push('<Pause length="2"/>'))}}a?.translate&&a?.translate_from&&a?.translate_to;let n=a?.record===!0,l="https://voxsouth.online/api/webhooks/signalwire";if(a?.survey&&(o.push('<Say voice="alice">Thank you for your time. Before we end, I have a quick survey.</Say>'),o.push('<Pause length="1"/>'),o.push("<Say>On a scale of 1 to 5, how satisfied were you with this call?</Say>"),o.push('<Gather numDigits="1" action="/api/webhooks/survey" method="POST" timeout="10"/>')),t){let e=[];n?(e.push(`<Number>${h(t)}</Number>`),o.push(`<Dial record="record-from-answer" recordingStatusCallback="${l}" recordingStatusCallbackEvent="completed">`),o.push(...e),o.push("</Dial>")):o.push(`<Dial><Number>${h(t)}</Number></Dial>`)}else{let t=e||`conf-${Date.now()}`;o.push(`<Dial><Conference>${h(t)}</Conference></Dial>`)}return n&&!t&&o.push(`<Record action="https://voxsouth.online/api/webhooks/signalwire" recordingStatusCallback="${l}" maxLength="3600"/>`),a?.synthetic_caller&&o.push('<Say voice="alice">Thank you for your time. Goodbye.</Say>'),`<?xml version="1.0" encoding="UTF-8"?>
<Response>
${o.map(e=>`  ${e}`).join("\n")}
</Response>`}async function d(e,t,a){let{data:r}=await s.default.from("calls").select("organization_id").eq("id",t).limit(1),o=r?.[0]?.organization_id,n=!1;if(o){let{data:e}=await s.default.from("voice_configs").select("record").eq("organization_id",o).limit(1);n=e?.[0]?.record===!0}let l=[];return n?l.push('<Dial record="record-from-answer" recordingStatusCallback="https://voxsouth.online/api/webhooks/signalwire" recordingStatusCallbackEvent="completed">'):l.push("<Dial>"),l.push(`<Conference>${h(e)}</Conference>`),l.push("</Dial>"),`<?xml version="1.0" encoding="UTF-8"?>
<Response>
${l.map(e=>`  ${e}`).join("\n")}
</Response>`}function h(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}async function m(e){return i.NextResponse.json({ok:!0,route:"/api/voice/laml/outbound",method:"Use POST for LaML generation"})}let f=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/voice/laml/outbound/route",pathname:"/api/voice/laml/outbound",filename:"route",bundlePath:"app/api/voice/laml/outbound/route"},resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\voice\\laml\\outbound\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:v}=f,w="/api/voice/laml/outbound/route";function b(){return(0,l.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},62632:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});let r={from:e=>({insert:async e=>({data:[e],error:null}),update:async e=>({data:[e],error:null}),select:t=>(function(e,t){let a={_table:e,_cols:t,eq:(e,t)=>a,in:(e,t)=>a,limit:e=>a,order:(e,t)=>a,single:async()=>({data:null,error:null})};return a.then=(e,t)=>Promise.resolve({data:null,error:null}).then(e,t),a.catch=e=>Promise.resolve({data:null,error:null}).catch(e),a})(e,t),in:(e,t)=>({data:null,error:null})})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(52105));module.exports=r})();