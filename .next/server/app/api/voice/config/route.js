"use strict";(()=>{var e={};e.id=70,e.ids=[70],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},2157:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>E,patchFetch:()=>S,requestAsyncStorage:()=>v,routeModule:()=>h,serverHooks:()=>R,staticGenerationAsyncStorage:()=>A});var r={};s.r(r),s.d(r,{GET:()=>f,PUT:()=>I});var a=s(49303),i=s(88716),n=s(60670),o=s(87070),l=s(79843),c=s(62632),u=s(45609),d=s(23151),g=s(98373),m=s(18902);function p(e){return!!e&&"string"==typeof e&&/^[a-z]{2}(-[A-Z]{2})?$/.test(e)}async function _(e){try{let t=new URL(e.url).searchParams.get("orgId")??void 0;if(!t){let e=new d.g({code:"INVALID_INPUT",message:"orgId required",user_message:"Organization id required",severity:"MEDIUM"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:400})}let s=await (0,u.getServerSession)().catch(()=>null),r=s?.user?.id??null;if(!r){let e=new d.g({code:"AUTH_REQUIRED",message:"Authentication required",user_message:"Authentication required",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:401})}let{data:a,error:i}=await c.default.from("org_members").select("id,role").eq("organization_id",t).eq("user_id",r).limit(1);if(i){let e=new d.g({code:"DB_ERROR",message:"Membership lookup failed",user_message:"Unable to verify membership",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}if(!a||0===a.length){let e=new d.g({code:"UNAUTHORIZED",message:"Not authorized",user_message:"Not authorized for this organization",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:401})}let{data:n,error:l}=await c.default.from("voice_configs").select("*").eq("organization_id",t).limit(1);if(l){let e=new d.g({code:"DB_ERROR",message:"Failed to fetch voice configs",user_message:"Failed to fetch voice configuration",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}let g=n&&n[0]?n[0]:null;return o.NextResponse.json({success:!0,config:g})}catch(t){let e=t instanceof d.g?t:new d.g({code:"VOICE_CONFIG_GET_FAILED",message:t?.message??"Unexpected",user_message:"Failed to read voice configuration",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}}async function y(e){try{let t=await e.json(),s=t?.orgId??void 0,r=t?.modulations??{};if(!s){let e=new d.g({code:"INVALID_INPUT",message:"orgId required",user_message:"Organization id required",severity:"MEDIUM"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:400})}let a=await (0,u.getServerSession)().catch(()=>null),i=a?.user?.id??null;if(!i){let e=new d.g({code:"AUTH_REQUIRED",message:"Authentication required",user_message:"Authentication required",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:401})}let{data:n,error:g}=await c.default.from("org_members").select("id,role").eq("organization_id",s).eq("user_id",i).limit(1);if(g){let e=new d.g({code:"DB_ERROR",message:"Membership lookup failed",user_message:"Unable to verify membership",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}if(!n||0===n.length){let e=new d.g({code:"UNAUTHORIZED",message:"Not authorized",user_message:"Not authorized for this organization",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:401})}let m=["record","transcribe","translate","translate_from","translate_to","survey","synthetic_caller"],_={updated_by:i};for(let e of Object.keys(r||{})){let t=r[e];m.includes(e)&&("translate_from"===e||"translate_to"===e?(null===t||"string"==typeof t)&&(_[e]=t):"boolean"==typeof t&&(_[e]=t))}if(!0===_.translate){let e=_.translate_from??r.translate_from,t=_.translate_to??r.translate_to;if(!p(e)||!p(t)){let e=new d.g({code:"INVALID_LANGUAGE",message:"Invalid language codes",user_message:"Invalid language codes for translation",severity:"MEDIUM"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:400})}_.translate_from=e,_.translate_to=t}let{data:y}=await c.default.from("voice_configs").select("*").eq("organization_id",s).limit(1),f=y&&y[0]?y[0]:null;if(!f){let e={id:(0,l.Z)(),..._},{error:t}=await c.default.from("voice_configs").insert(e);if(t){let e=new d.g({code:"DB_INSERT_FAILED",message:"Failed to insert voice config",user_message:"Could not save configuration",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}try{await c.default.from("audit_logs").insert({id:(0,l.Z)(),organization_id:s,user_id:i,system_id:null,resource_type:"voice_configs",resource_id:e.id,action:"create",before:null,after:e,created_at:new Date().toISOString()})}catch(e){}return o.NextResponse.json({success:!0,config:e})}let{error:I}=await c.default.from("voice_configs").update(_).eq("organization_id",s);if(I){let e=new d.g({code:"DB_UPDATE_FAILED",message:"Failed to update voice config",user_message:"Could not update configuration",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}let h={...f,..._};try{await c.default.from("audit_logs").insert({id:(0,l.Z)(),organization_id:s,user_id:i,system_id:null,resource_type:"voice_configs",resource_id:f.id??null,action:"update",before:f,after:h,created_at:new Date().toISOString()})}catch(e){}return o.NextResponse.json({success:!0,config:h})}catch(t){let e=t instanceof d.g?t:new d.g({code:"VOICE_CONFIG_PUT_FAILED",message:t?.message??"Unexpected",user_message:"Failed to save voice configuration",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}}let f=(0,g.er)(_,{identifier:e=>{let t=new URL(e.url).searchParams.get("orgId");return`${(0,g.H9)(e)}-${t||"anonymous"}`},config:{maxAttempts:30,windowMs:6e4,blockMs:3e5}}),I=(0,g.er)((0,m.ax)(y,{ttlSeconds:300}),{identifier:e=>`${(0,g.H9)(e)}-config`,config:{maxAttempts:20,windowMs:6e4,blockMs:3e5}}),h=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/voice/config/route",pathname:"/api/voice/config",filename:"route",bundlePath:"app/api/voice/config/route"},resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\voice\\config\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:v,staticGenerationAsyncStorage:A,serverHooks:R}=h,E="/api/voice/config/route";function S(){return(0,n.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:A})}},6781:(e,t,s)=>{s.r(t),s.d(t,{ERROR_CATALOG:()=>r,getDefaultError:()=>i,getErrorDefinition:()=>a});let r={AUTH_REQUIRED:{code:"AUTH_REQUIRED",category:"AUTH",severity:"HIGH",internalMessage:"Authentication required",userMessage:"Please sign in to continue",httpStatus:401,shouldAlert:!1,trackKPI:!0},AUTH_ORG_MISMATCH:{code:"AUTH_ORG_MISMATCH",category:"AUTH",severity:"HIGH",internalMessage:"User not authorized for organization",userMessage:"You do not have access to this organization",httpStatus:401,shouldAlert:!1,trackKPI:!0},FORBIDDEN:{code:"FORBIDDEN",category:"AUTH",severity:"HIGH",internalMessage:"Insufficient permissions",userMessage:"You do not have permission to perform this action",httpStatus:403,shouldAlert:!1,trackKPI:!0},DB_QUERY_FAILED:{code:"DB_QUERY_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database query failed",userMessage:"Could not retrieve data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},DB_INSERT_FAILED:{code:"DB_INSERT_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database insert failed",userMessage:"Could not save data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},DB_UPDATE_FAILED:{code:"DB_UPDATE_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database update failed",userMessage:"Could not update data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},CALL_START_FAILED:{code:"CALL_START_FAILED",category:"VOICE",severity:"HIGH",internalMessage:"Failed to start call",userMessage:"Unable to place call. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SIGNALWIRE_CONFIG_MISSING:{code:"SIGNALWIRE_CONFIG_MISSING",category:"EXTERNAL",severity:"CRITICAL",internalMessage:"SignalWire credentials missing",userMessage:"System configuration error. Please contact support.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SIGNALWIRE_API_ERROR:{code:"SIGNALWIRE_API_ERROR",category:"EXTERNAL",severity:"HIGH",internalMessage:"SignalWire API error",userMessage:"Call service temporarily unavailable. Please try again.",httpStatus:502,shouldAlert:!0,trackKPI:!0},ASSEMBLYAI_API_ERROR:{code:"ASSEMBLYAI_API_ERROR",category:"AI",severity:"HIGH",internalMessage:"AssemblyAI API error",userMessage:"Transcription service temporarily unavailable.",httpStatus:502,shouldAlert:!0,trackKPI:!0},TRANSCRIPTION_FAILED:{code:"TRANSCRIPTION_FAILED",category:"AI",severity:"MEDIUM",internalMessage:"Transcription processing failed",userMessage:"Transcription could not be completed.",httpStatus:500,shouldAlert:!1,trackKPI:!0},PLAN_LIMIT_EXCEEDED:{code:"PLAN_LIMIT_EXCEEDED",category:"ORG",severity:"MEDIUM",internalMessage:"Plan limit exceeded",userMessage:"This feature is not available on your current plan. Please upgrade.",httpStatus:403,shouldAlert:!1,trackKPI:!0},ORG_NOT_FOUND:{code:"ORG_NOT_FOUND",category:"ORG",severity:"MEDIUM",internalMessage:"Organization not found",userMessage:"Organization not found",httpStatus:404,shouldAlert:!1,trackKPI:!1},SYSTEM_ERROR:{code:"SYSTEM_ERROR",category:"SYSTEM",severity:"CRITICAL",internalMessage:"Unexpected system error",userMessage:"An unexpected error occurred. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SERVICE_UNAVAILABLE:{code:"SERVICE_UNAVAILABLE",category:"SYSTEM",severity:"HIGH",internalMessage:"Service temporarily unavailable",userMessage:"Service temporarily unavailable. Please try again later.",httpStatus:503,shouldAlert:!0,trackKPI:!0},INVALID_INPUT:{code:"INVALID_INPUT",category:"USER",severity:"MEDIUM",internalMessage:"Invalid input provided",userMessage:"Invalid input. Please check your request and try again.",httpStatus:400,shouldAlert:!1,trackKPI:!1},INVALID_PHONE:{code:"INVALID_PHONE",category:"USER",severity:"MEDIUM",internalMessage:"Invalid phone number format",userMessage:"The phone number provided is invalid. Please verify and try again.",httpStatus:400,shouldAlert:!1,trackKPI:!1}};function a(e){return r[e]||null}function i(){return r.SYSTEM_ERROR}},18902:(e,t,s)=>{s.d(t,{ax:()=>o});var r=s(62632),a=s(79843);async function i(e,t,s=3600){try{let{data:a,error:i}=await r.default.from("audit_logs").select("id, after").eq("resource_type","idempotency").eq("resource_id",e).gte("created_at",new Date(Date.now()-1e3*s).toISOString()).limit(1);if(!i&&a&&a.length>0){let e=a[0];if(e.after?.request_hash===t)return{cached:!0,response:e.after?.response}}return{cached:!1}}catch(e){return console.warn("idempotency check failed",e),{cached:!1}}}async function n(e,t,s,i,n=3600){try{await r.default.from("audit_logs").insert({id:(0,a.Z)(),organization_id:i||null,user_id:null,system_id:null,resource_type:"idempotency",resource_id:e,action:"create",before:null,after:{request_hash:t,response:s,expires_at:new Date(Date.now()+1e3*n).toISOString()},created_at:new Date().toISOString()})}catch(e){console.warn("storeIdempotency failed",e)}}function o(e,t){return async s=>{let r=s.headers.get("Idempotency-Key")||t?.getKey?.(s)||null;if(!r)return await e(s);let a=null;try{let e=s.clone();a=await e.json().catch(()=>({}))}catch{}let o=function(e){let t=JSON.stringify(e),s=0;for(let e=0;e<t.length;e++)s=(s<<5)-s+t.charCodeAt(e),s&=s;return Math.abs(s).toString(36)}({key:r,body:a}),l=await i(r,o,t?.ttlSeconds);if(l.cached&&l.response)return new Response(JSON.stringify(l.response),{status:200,headers:{"Content-Type":"application/json","X-Idempotency-Key":r,"X-Idempotency-Cached":"true"}});let c=await e(s);if(c.ok){let e=await c.clone().json().catch(()=>({})),a=new URL(s.url).searchParams.get("orgId");await n(r,o,e,a||void 0,t?.ttlSeconds)}let u=new Headers(c.headers);return u.set("X-Idempotency-Key",r),new Response(c.body,{status:c.status,statusText:c.statusText,headers:u})}}},98373:(e,t,s)=>{s.d(t,{H9:()=>n,er:()=>o});var r=s(62632);let a={maxAttempts:5,windowMs:9e5,blockMs:9e5};async function i(e,t=a){let s=Date.now(),i=s-t.windowMs;try{let{data:a,error:n}=await r.default.from("login_attempts").select("attempted_at, succeeded").eq("username",e).gte("attempted_at",new Date(i).toISOString()).order("attempted_at",{ascending:!1});if(!n&&a){let e;let r=a.filter(e=>!e.succeeded),i=r.length,n=r[0];if(n&&i>=t.maxAttempts&&(e=new Date(n.attempted_at).getTime()+t.blockMs)>s)return{allowed:!1,remaining:0,resetAt:e,blockedUntil:e};let o=Math.max(0,t.maxAttempts-i);return{allowed:o>0,remaining:o,resetAt:s+t.windowMs,blockedUntil:e}}}catch(e){console.warn("rateLimit: DB query failed, using in-memory fallback",e)}global.__rateLimiter||(global.__rateLimiter=new Map);let n=global.__rateLimiter,o=n.get(e)||{attempts:[],blockedUntil:0};if(o.attempts=o.attempts.filter(e=>e>i),o.blockedUntil&&o.blockedUntil>s)return{allowed:!1,remaining:0,resetAt:o.blockedUntil,blockedUntil:o.blockedUntil};let l=o.attempts.length;return l>=t.maxAttempts?(o.blockedUntil=s+t.blockMs,n.set(e,o),{allowed:!1,remaining:0,resetAt:o.blockedUntil,blockedUntil:o.blockedUntil}):{allowed:!0,remaining:t.maxAttempts-l,resetAt:s+t.windowMs}}function n(e){let t=e.headers.get("x-forwarded-for");return t?t.split(",")[0].trim():e.headers.get("x-real-ip")||"unknown"}function o(e,t){return async s=>{let r=t?.identifier?t.identifier(s):n(s),o=t?.config||a,l=await i(r,o);if(!l.allowed)return new Response(JSON.stringify({success:!1,error:{code:"RATE_LIMIT_EXCEEDED",message:"Too many requests. Please try again later.",severity:"MEDIUM"}}),{status:429,headers:{"Content-Type":"application/json","X-RateLimit-Limit":String(o.maxAttempts),"X-RateLimit-Remaining":String(l.remaining),"X-RateLimit-Reset":String(Math.ceil(l.resetAt/1e3)),...l.blockedUntil?{"Retry-After":String(Math.ceil((l.blockedUntil-Date.now())/1e3))}:{}}});let c=await e(s);return c.headers.set("X-RateLimit-Limit",String(o.maxAttempts)),c.headers.set("X-RateLimit-Remaining",String(l.remaining)),c.headers.set("X-RateLimit-Reset",String(Math.ceil(l.resetAt/1e3))),c}}},62632:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});let r={from:e=>({insert:async e=>({data:[e],error:null}),update:async e=>({data:[e],error:null}),select:t=>(function(e,t){let s={_table:e,_cols:t,eq:(e,t)=>s,in:(e,t)=>s,limit:e=>s,order:(e,t)=>s,single:async()=>({data:null,error:null})};return s.then=(e,t)=>Promise.resolve({data:null,error:null}).then(e,t),s.catch=e=>Promise.resolve({data:null,error:null}).catch(e),s})(e,t),in:(e,t)=>({data:null,error:null})})}},6649:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(84770),a=s.n(r);let i=new Uint8Array(256),n=i.length;function o(){return n>i.length-16&&(a().randomFillSync(i),n=0),i.slice(n,n+=16)}},16099:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(30900);let a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).substr(1));let i=function(e,t=0){let s=(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase();if(!(0,r.Z)(s))throw TypeError("Stringified UUID is invalid");return s}},79843:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(6649),a=s(16099);let i=function(e,t,s){let i=(e=e||{}).random||(e.rng||r.Z)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=i[e];return t}return(0,a.Z)(i)}},30900:(e,t,s)=>{s.d(t,{Z:()=>a});let r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&r.test(e)}},23151:(e,t,s)=>{s.d(t,{g:()=>r});class r extends Error{constructor(e){super(e.message),this.id=e.id??"err_"+Math.random().toString(36).slice(2,9),this.code=e.code,this.user_message=e.user_message,this.severity=e.severity??"MEDIUM",this.retriable=!!e.retriable,this.details=e.details;try{let{getErrorDefinition:e}=s(6781),t=e(this.code);this.httpStatus=t?.httpStatus||500}catch{this.httpStatus=500}}toJSON(){return{id:this.id,code:this.code,message:this.message,user_message:this.user_message,severity:this.severity,httpStatus:this.httpStatus}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,609],()=>s(2157));module.exports=r})();