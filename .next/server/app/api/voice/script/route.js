"use strict";(()=>{var e={};e.id=619,e.ids=[619],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},11266:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>u});var i=r(49303),o=r(88716),s=r(60670),l=r(87070),n=r(62632);async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("callSid");if(!r)return l.NextResponse.json({success:!1,error:{code:"MISSING_CALL_SID",message:"callSid query parameter required"}},{status:400});let{data:a,error:i}=await n.default.from("calls").select("organization_id").eq("call_sid",r).limit(1);if(i||!a||0===a.length)return new l.NextResponse("",{status:404});let o=a[0].organization_id,{data:s}=await n.default.from("voice_configs").select("record, transcribe, translate, translate_from, translate_to, survey, synthetic_caller, shopper_script").eq("organization_id",o).limit(1),u=s?.[0]||null,p=[];if(u?.synthetic_caller){let e=(u.shopper_script||"Hello, I'm calling to inquire about your services. Do you have any availability this week?").split(/\n|\|/).filter(e=>e.trim());for(let t=0;t<e.length;t++){let r=e[t].trim();r&&(p.push(`<Say voice="alice">${c(r)}</Say>`),t<e.length-1&&p.push('<Pause length="2"/>'))}}u?.survey&&(p.push('<Say voice="alice">Thank you for your time. Before we end, I have a quick survey.</Say>'),p.push('<Pause length="1"/>'),p.push("<Say>On a scale of 1 to 5, how satisfied were you with this call?</Say>"),p.push('<Gather numDigits="1" action="/api/webhooks/survey" method="POST" timeout="10"/>'));let{data:d}=await n.default.from("calls").select("to_number").eq("call_sid",r).limit(1),h=d?.[0]?.to_number;if(h)u?.record===!0?(p.push('<Dial record="record-from-answer" recordingStatusCallback="https://voxsouth.online/api/webhooks/signalwire" recordingStatusCallbackEvent="completed">'),p.push(`<Number>${c(h)}</Number>`),p.push("</Dial>")):p.push(`<Dial><Number>${c(h)}</Number></Dial>`);else{let e=r||`conf-${Date.now()}`;p.push(`<Dial><Conference>${c(e)}</Conference></Dial>`)}u?.synthetic_caller&&p.push('<Say voice="alice">Thank you for your time. Goodbye.</Say>');let m=`<?xml version="1.0" encoding="UTF-8"?>
<Response>
${p.map(e=>`  ${e}`).join("\n")}
</Response>`;return new l.NextResponse(m,{status:200,headers:{"Content-Type":"application/xml"}})}catch(e){return console.error("voice/script endpoint error",{error:e?.message??String(e)}),new l.NextResponse("",{status:500})}}function c(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}let p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/voice/script/route",pathname:"/api/voice/script",filename:"route",bundlePath:"app/api/voice/script/route"},resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\voice\\script\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:m}=p,g="/api/voice/script/route";function y(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},62632:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});let a={from:e=>({insert:async e=>({data:[e],error:null}),update:async e=>({data:[e],error:null}),select:t=>(function(e,t){let r={_table:e,_cols:t,eq:(e,t)=>r,in:(e,t)=>r,limit:e=>r,order:(e,t)=>r,single:async()=>({data:null,error:null})};return r.then=(e,t)=>Promise.resolve({data:null,error:null}).then(e,t),r.catch=e=>Promise.resolve({data:null,error:null}).catch(e),r})(e,t),in:(e,t)=>({data:null,error:null})})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(11266));module.exports=a})();