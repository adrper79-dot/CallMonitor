"use strict";(()=>{var e={};e.id=977,e.ids=[977],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},62291:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>A});var s={};r.r(s),r.d(s,{POST:()=>I});var a=r(49303),n=r(88716),o=r(60670),i=r(87070),l=r(79843),u=r(62632),c=r(45609),d=r(23151);async function I(e){try{let t=await e.json(),r=t?.callId,s=t?.modulations??{};if(!r||"string"!=typeof r)return i.NextResponse.json({success:!1,error:{code:"INVALID_INPUT",message:"callId required"}},{status:400});let{data:a,error:n}=await u.default.from("calls").select("id,organization_id").eq("id",r).limit(1);if(n)return i.NextResponse.json({success:!1,error:{code:"DB_ERROR",message:"Failed to fetch call"}},{status:500});let o=a?.[0];if(!o)return i.NextResponse.json({success:!1,error:{code:"CALL_NOT_FOUND",message:"Call not found"}},{status:404});let d=o.organization_id,I=null;try{let e=await (0,c.getServerSession)();I=e?.user?.id??null}catch(e){I=null}let g={};for(let e of["record","transcribe","translate","survey","synthetic_caller"]){let t=s[e];"boolean"==typeof t&&(g[e]=t)}try{await u.default.from("audit_logs").insert({id:(0,l.Z)(),organization_id:d,user_id:I,system_id:null,resource_type:"calls",resource_id:r,action:"intent:modulations_update",before:null,after:{config:g,requested_at:new Date().toISOString()},created_at:new Date().toISOString()})}catch(e){return i.NextResponse.json({success:!1,error:{code:"AUDIT_WRITE_FAILED",message:String(e?.message??e)}},{status:500})}return i.NextResponse.json({success:!0})}catch(t){let e=new d.g({code:"MODULATION_INTENT_ERROR",message:t?.message??"Unexpected",user_message:"Failed to record modulation intent",severity:"HIGH",retriable:!0});return i.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message}},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/calls/recordModulationIntent/route",pathname:"/api/calls/recordModulationIntent",filename:"route",bundlePath:"app/api/calls/recordModulationIntent/route"},resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\calls\\recordModulationIntent\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:A,serverHooks:h}=g,y="/api/calls/recordModulationIntent/route";function _(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:A})}},6781:(e,t,r)=>{r.r(t),r.d(t,{ERROR_CATALOG:()=>s,getDefaultError:()=>n,getErrorDefinition:()=>a});let s={AUTH_REQUIRED:{code:"AUTH_REQUIRED",category:"AUTH",severity:"HIGH",internalMessage:"Authentication required",userMessage:"Please sign in to continue",httpStatus:401,shouldAlert:!1,trackKPI:!0},AUTH_ORG_MISMATCH:{code:"AUTH_ORG_MISMATCH",category:"AUTH",severity:"HIGH",internalMessage:"User not authorized for organization",userMessage:"You do not have access to this organization",httpStatus:401,shouldAlert:!1,trackKPI:!0},FORBIDDEN:{code:"FORBIDDEN",category:"AUTH",severity:"HIGH",internalMessage:"Insufficient permissions",userMessage:"You do not have permission to perform this action",httpStatus:403,shouldAlert:!1,trackKPI:!0},DB_QUERY_FAILED:{code:"DB_QUERY_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database query failed",userMessage:"Could not retrieve data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},DB_INSERT_FAILED:{code:"DB_INSERT_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database insert failed",userMessage:"Could not save data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},DB_UPDATE_FAILED:{code:"DB_UPDATE_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database update failed",userMessage:"Could not update data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},CALL_START_FAILED:{code:"CALL_START_FAILED",category:"VOICE",severity:"HIGH",internalMessage:"Failed to start call",userMessage:"Unable to place call. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SIGNALWIRE_CONFIG_MISSING:{code:"SIGNALWIRE_CONFIG_MISSING",category:"EXTERNAL",severity:"CRITICAL",internalMessage:"SignalWire credentials missing",userMessage:"System configuration error. Please contact support.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SIGNALWIRE_API_ERROR:{code:"SIGNALWIRE_API_ERROR",category:"EXTERNAL",severity:"HIGH",internalMessage:"SignalWire API error",userMessage:"Call service temporarily unavailable. Please try again.",httpStatus:502,shouldAlert:!0,trackKPI:!0},ASSEMBLYAI_API_ERROR:{code:"ASSEMBLYAI_API_ERROR",category:"AI",severity:"HIGH",internalMessage:"AssemblyAI API error",userMessage:"Transcription service temporarily unavailable.",httpStatus:502,shouldAlert:!0,trackKPI:!0},TRANSCRIPTION_FAILED:{code:"TRANSCRIPTION_FAILED",category:"AI",severity:"MEDIUM",internalMessage:"Transcription processing failed",userMessage:"Transcription could not be completed.",httpStatus:500,shouldAlert:!1,trackKPI:!0},PLAN_LIMIT_EXCEEDED:{code:"PLAN_LIMIT_EXCEEDED",category:"ORG",severity:"MEDIUM",internalMessage:"Plan limit exceeded",userMessage:"This feature is not available on your current plan. Please upgrade.",httpStatus:403,shouldAlert:!1,trackKPI:!0},ORG_NOT_FOUND:{code:"ORG_NOT_FOUND",category:"ORG",severity:"MEDIUM",internalMessage:"Organization not found",userMessage:"Organization not found",httpStatus:404,shouldAlert:!1,trackKPI:!1},SYSTEM_ERROR:{code:"SYSTEM_ERROR",category:"SYSTEM",severity:"CRITICAL",internalMessage:"Unexpected system error",userMessage:"An unexpected error occurred. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SERVICE_UNAVAILABLE:{code:"SERVICE_UNAVAILABLE",category:"SYSTEM",severity:"HIGH",internalMessage:"Service temporarily unavailable",userMessage:"Service temporarily unavailable. Please try again later.",httpStatus:503,shouldAlert:!0,trackKPI:!0},INVALID_INPUT:{code:"INVALID_INPUT",category:"USER",severity:"MEDIUM",internalMessage:"Invalid input provided",userMessage:"Invalid input. Please check your request and try again.",httpStatus:400,shouldAlert:!1,trackKPI:!1},INVALID_PHONE:{code:"INVALID_PHONE",category:"USER",severity:"MEDIUM",internalMessage:"Invalid phone number format",userMessage:"The phone number provided is invalid. Please verify and try again.",httpStatus:400,shouldAlert:!1,trackKPI:!1}};function a(e){return s[e]||null}function n(){return s.SYSTEM_ERROR}},62632:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s});let s={from:e=>({insert:async e=>({data:[e],error:null}),update:async e=>({data:[e],error:null}),select:t=>(function(e,t){let r={_table:e,_cols:t,eq:(e,t)=>r,in:(e,t)=>r,limit:e=>r,order:(e,t)=>r,single:async()=>({data:null,error:null})};return r.then=(e,t)=>Promise.resolve({data:null,error:null}).then(e,t),r.catch=e=>Promise.resolve({data:null,error:null}).catch(e),r})(e,t),in:(e,t)=>({data:null,error:null})})}},6649:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(84770),a=r.n(s);let n=new Uint8Array(256),o=n.length;function i(){return o>n.length-16&&(a().randomFillSync(n),o=0),n.slice(o,o+=16)}},16099:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(30900);let a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).substr(1));let n=function(e,t=0){let r=(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase();if(!(0,s.Z)(r))throw TypeError("Stringified UUID is invalid");return r}},79843:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(6649),a=r(16099);let n=function(e,t,r){let n=(e=e||{}).random||(e.rng||s.Z)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return(0,a.Z)(n)}},30900:(e,t,r)=>{r.d(t,{Z:()=>a});let s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)}},23151:(e,t,r)=>{r.d(t,{g:()=>s});class s extends Error{constructor(e){super(e.message),this.id=e.id??"err_"+Math.random().toString(36).slice(2,9),this.code=e.code,this.user_message=e.user_message,this.severity=e.severity??"MEDIUM",this.retriable=!!e.retriable,this.details=e.details;try{let{getErrorDefinition:e}=r(6781),t=e(this.code);this.httpStatus=t?.httpStatus||500}catch{this.httpStatus=500}}toJSON(){return{id:this.id,code:this.code,message:this.message,user_message:this.user_message,severity:this.severity,httpStatus:this.httpStatus}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,609],()=>r(62291));module.exports=s})();