"use strict";(()=>{var e={};e.id=585,e.ids=[585],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},78543:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>y,requestAsyncStorage:()=>_,routeModule:()=>I,serverHooks:()=>A,staticGenerationAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{GET:()=>p});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),l=r(62632),u=r(45609),c=r(23151),d=r(70332);let g=()=>({record:!1,transcribe:!1,translate:!1,survey:!1,synthetic_caller:!1,real_time_translation_preview:!1});async function p(e){try{let t=new URL(e.url),r=t.searchParams.get("callId")??void 0,s=t.searchParams.get("orgId")??void 0;if(!s&&!r){let e=new c.g({code:"INVALID_INPUT",message:"orgId or callId required",user_message:"orgId or callId required",severity:"MEDIUM"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:400})}let a=s;if(!a&&r){let{data:e,error:t}=await l.default.from("calls").select("organization_id").eq("id",r).limit(1);if(t){let e=new c.g({code:"DB_ERROR",message:"Failed to fetch call",user_message:"Failed to fetch call",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}let s=e?.[0];if(!s){let e=new c.g({code:"CALL_NOT_FOUND",message:"Call not found",user_message:"Call not found",severity:"MEDIUM"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:404})}a=s.organization_id}if(!a){let e=new c.g({code:"INVALID_INPUT",message:"organization id not resolved",user_message:"organization id not resolved",severity:"MEDIUM"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:400})}let i=await (0,u.getServerSession)().catch(()=>null),n=i?.user?.id??null;if(!n){let e=new c.g({code:"AUTH_REQUIRED",message:"Authentication required",user_message:"Authentication required",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:401})}let{data:p,error:I}=await l.default.from("org_members").select("id,role").eq("organization_id",a).eq("user_id",n).limit(1);if(I){let e=new c.g({code:"DB_ERROR",message:"Failed to verify membership",user_message:"Failed to verify membership",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}if(!p||0===p.length){let e=new c.g({code:"AUTH_ORG_MISMATCH",message:"Actor not authorized for organization",user_message:"Not authorized for this organization",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:401})}let{data:_,error:v}=await l.default.from("organizations").select("plan").eq("id",a).limit(1);if(v){let e=new c.g({code:"DB_ERROR",message:"Failed to fetch organization",user_message:"Failed to fetch organization",severity:"HIGH"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}let A=_?.[0];if(!A){let e=new c.g({code:"ORG_NOT_FOUND",message:"Organization not found",user_message:"Organization not found",severity:"MEDIUM"});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:404})}let m=String(A.plan??"").toLowerCase(),y=g();y="enterprise"===m?{record:!0,transcribe:!0,translate:!0,survey:!0,synthetic_caller:!0,real_time_translation_preview:!1}:["pro","standard","active","trial"].includes(m)?{record:!0,transcribe:!0,translate:!1,survey:!0,synthetic_caller:!1,real_time_translation_preview:!1}:g();let E=["business","enterprise"].includes(m),h=(0,d.Au)();y.real_time_translation_preview=E&&h;try{let{data:e,error:t}=await l.default.from("voice_configs").select("record,transcribe,translate,survey,synthetic_caller,translate_from,translate_to").eq("organization_id",a).limit(1);if(t);else if(e&&e[0]){let t=e[0];["record","transcribe","translate","survey","synthetic_caller"].forEach(e=>{let r=t[e];"boolean"==typeof r&&(y[e]=r)})}}catch(e){}return o.NextResponse.json({success:!0,capabilities:y})}catch(t){let e=t instanceof c.g?t:new c.g({code:"CALL_CAPS_ERROR",message:t?.message??"Unexpected",user_message:"Failed to determine call capabilities",severity:"HIGH",retriable:!0});return o.NextResponse.json({success:!1,error:{id:e.id,code:e.code,message:e.user_message,severity:e.severity}},{status:500})}}let I=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/call-capabilities/route",pathname:"/api/call-capabilities",filename:"route",bundlePath:"app/api/call-capabilities/route"},resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\call-capabilities\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:v,serverHooks:A}=I,m="/api/call-capabilities/route";function y(){return(0,n.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:v})}},70332:(e,t,r)=>{r.d(t,{Au:()=>i,PF:()=>a});let s=[{name:"SIGNALWIRE_PROJECT_ID",required:!0,description:"SignalWire project ID for call execution",validate:e=>e.length>0||"Must not be empty"},{name:"SIGNALWIRE_TOKEN",required:!0,description:"SignalWire API token",validate:e=>e.length>0||"Must not be empty"},{name:"SIGNALWIRE_SPACE",required:!0,description:"SignalWire space URL",validate:e=>e.includes("signalwire.com")||"Must be a valid SignalWire space URL"},{name:"ASSEMBLYAI_API_KEY",required:!0,description:"AssemblyAI API key for transcription",validate:e=>e.length>0||"Must not be empty"},{name:"NEXT_PUBLIC_SUPABASE_URL",required:!0,description:"Supabase project URL",validate:e=>e.startsWith("https://")||"Must be a valid HTTPS URL"},{name:"NEXT_PUBLIC_SUPABASE_ANON_KEY",required:!0,description:"Supabase anonymous key",validate:e=>e.length>0||"Must not be empty"},{name:"SUPABASE_SERVICE_ROLE_KEY",required:!0,description:"Supabase service role key (server-side only)",validate:e=>e.length>0||"Must not be empty"},{name:"NEXT_PUBLIC_APP_URL",required:!0,description:"Public application URL for webhooks",validate:e=>e.startsWith("https://")||e.startsWith("http://localhost")||"Must be a valid URL"},{name:"NEXTAUTH_SECRET",required:!0,description:"NextAuth secret for session encryption",validate:e=>e.length>=32||"Must be at least 32 characters"},{name:"OPENAI_API_KEY",required:!1,description:"OpenAI API key for translation (optional)",validate:e=>e.length>0||"Must not be empty if provided"},{name:"TRANSLATION_LIVE_ASSIST_PREVIEW",required:!1,description:"Enable live translation preview feature (SignalWire AI Agents)",validate:e=>"true"===e||"false"===e||'Must be "true" or "false"'}];function a(){let e=[],t=[];for(let r of s){let s=process.env[r.name];if(s){if(r.validate){let a=r.validate(s);if(!0!==a){let s="string"==typeof a?a:"Invalid value";r.required?e.push({name:r.name,message:`${r.description}: ${s}`}):t.push({name:r.name,message:`${r.description}: ${s}`})}}}else r.required?e.push({name:r.name,message:`Required environment variable missing: ${r.description}`}):t.push({name:r.name,message:`Optional environment variable not set: ${r.description}`})}return{valid:0===e.length,errors:e,warnings:t}}function i(){return"true"===process.env.TRANSLATION_LIVE_ASSIST_PREVIEW}},6781:(e,t,r)=>{r.r(t),r.d(t,{ERROR_CATALOG:()=>s,getDefaultError:()=>i,getErrorDefinition:()=>a});let s={AUTH_REQUIRED:{code:"AUTH_REQUIRED",category:"AUTH",severity:"HIGH",internalMessage:"Authentication required",userMessage:"Please sign in to continue",httpStatus:401,shouldAlert:!1,trackKPI:!0},AUTH_ORG_MISMATCH:{code:"AUTH_ORG_MISMATCH",category:"AUTH",severity:"HIGH",internalMessage:"User not authorized for organization",userMessage:"You do not have access to this organization",httpStatus:401,shouldAlert:!1,trackKPI:!0},FORBIDDEN:{code:"FORBIDDEN",category:"AUTH",severity:"HIGH",internalMessage:"Insufficient permissions",userMessage:"You do not have permission to perform this action",httpStatus:403,shouldAlert:!1,trackKPI:!0},DB_QUERY_FAILED:{code:"DB_QUERY_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database query failed",userMessage:"Could not retrieve data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},DB_INSERT_FAILED:{code:"DB_INSERT_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database insert failed",userMessage:"Could not save data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},DB_UPDATE_FAILED:{code:"DB_UPDATE_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database update failed",userMessage:"Could not update data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},CALL_START_FAILED:{code:"CALL_START_FAILED",category:"VOICE",severity:"HIGH",internalMessage:"Failed to start call",userMessage:"Unable to place call. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SIGNALWIRE_CONFIG_MISSING:{code:"SIGNALWIRE_CONFIG_MISSING",category:"EXTERNAL",severity:"CRITICAL",internalMessage:"SignalWire credentials missing",userMessage:"System configuration error. Please contact support.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SIGNALWIRE_API_ERROR:{code:"SIGNALWIRE_API_ERROR",category:"EXTERNAL",severity:"HIGH",internalMessage:"SignalWire API error",userMessage:"Call service temporarily unavailable. Please try again.",httpStatus:502,shouldAlert:!0,trackKPI:!0},ASSEMBLYAI_API_ERROR:{code:"ASSEMBLYAI_API_ERROR",category:"AI",severity:"HIGH",internalMessage:"AssemblyAI API error",userMessage:"Transcription service temporarily unavailable.",httpStatus:502,shouldAlert:!0,trackKPI:!0},TRANSCRIPTION_FAILED:{code:"TRANSCRIPTION_FAILED",category:"AI",severity:"MEDIUM",internalMessage:"Transcription processing failed",userMessage:"Transcription could not be completed.",httpStatus:500,shouldAlert:!1,trackKPI:!0},LIVE_TRANSLATE_EXECUTION_FAILED:{code:"LIVE_TRANSLATE_EXECUTION_FAILED",category:"EXTERNAL",severity:"MEDIUM",internalMessage:"Live translation execution failed",userMessage:"Live translation encountered an issue. Post-call transcript is still available.",httpStatus:500,shouldAlert:!1,trackKPI:!0},LIVE_TRANSLATE_VENDOR_DOWN:{code:"LIVE_TRANSLATE_VENDOR_DOWN",category:"EXTERNAL",severity:"HIGH",internalMessage:"Live translation vendor service unavailable",userMessage:"Live translation service is temporarily unavailable. Post-call transcript will be available.",httpStatus:503,shouldAlert:!0,trackKPI:!0},PLAN_LIMIT_EXCEEDED:{code:"PLAN_LIMIT_EXCEEDED",category:"ORG",severity:"MEDIUM",internalMessage:"Plan limit exceeded",userMessage:"This feature is not available on your current plan. Please upgrade.",httpStatus:403,shouldAlert:!1,trackKPI:!0},ORG_NOT_FOUND:{code:"ORG_NOT_FOUND",category:"ORG",severity:"MEDIUM",internalMessage:"Organization not found",userMessage:"Organization not found",httpStatus:404,shouldAlert:!1,trackKPI:!1},SYSTEM_ERROR:{code:"SYSTEM_ERROR",category:"SYSTEM",severity:"CRITICAL",internalMessage:"Unexpected system error",userMessage:"An unexpected error occurred. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SERVICE_UNAVAILABLE:{code:"SERVICE_UNAVAILABLE",category:"SYSTEM",severity:"HIGH",internalMessage:"Service temporarily unavailable",userMessage:"Service temporarily unavailable. Please try again later.",httpStatus:503,shouldAlert:!0,trackKPI:!0},INVALID_INPUT:{code:"INVALID_INPUT",category:"USER",severity:"MEDIUM",internalMessage:"Invalid input provided",userMessage:"Invalid input. Please check your request and try again.",httpStatus:400,shouldAlert:!1,trackKPI:!1},INVALID_PHONE:{code:"INVALID_PHONE",category:"USER",severity:"MEDIUM",internalMessage:"Invalid phone number format",userMessage:"The phone number provided is invalid. Please verify and try again.",httpStatus:400,shouldAlert:!1,trackKPI:!1}};function a(e){return s[e]||null}function i(){return s.SYSTEM_ERROR}},62632:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s});let s={from:e=>({insert:async e=>({data:[e],error:null}),update:async e=>({data:[e],error:null}),select:t=>(function(e,t){let r={_table:e,_cols:t,eq:(e,t)=>r,in:(e,t)=>r,limit:e=>r,order:(e,t)=>r,single:async()=>({data:null,error:null})};return r.then=(e,t)=>Promise.resolve({data:null,error:null}).then(e,t),r.catch=e=>Promise.resolve({data:null,error:null}).catch(e),r})(e,t),in:(e,t)=>({data:null,error:null})})}},6649:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(84770),a=r.n(s);let i=new Uint8Array(256),n=i.length;function o(){return n>i.length-16&&(a().randomFillSync(i),n=0),i.slice(n,n+=16)}},16099:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(30900);let a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).substr(1));let i=function(e,t=0){let r=(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase();if(!(0,s.Z)(r))throw TypeError("Stringified UUID is invalid");return r}},79843:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(6649),a=r(16099);let i=function(e,t,r){let i=(e=e||{}).random||(e.rng||s.Z)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return(0,a.Z)(i)}},30900:(e,t,r)=>{r.d(t,{Z:()=>a});let s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)}},23151:(e,t,r)=>{r.d(t,{g:()=>s});class s extends Error{constructor(e){super(e.message),this.id=e.id??"err_"+Math.random().toString(36).slice(2,9),this.code=e.code,this.user_message=e.user_message,this.severity=e.severity??"MEDIUM",this.retriable=!!e.retriable,this.details=e.details;try{let{getErrorDefinition:e}=r(6781),t=e(this.code);this.httpStatus=t?.httpStatus||500}catch{this.httpStatus=500}}toJSON(){return{id:this.id,code:this.code,message:this.message,user_message:this.user_message,severity:this.severity,httpStatus:this.httpStatus}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,609],()=>r(78543));module.exports=s})();