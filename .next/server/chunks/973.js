"use strict";exports.id=973,exports.ids=[973],exports.modules={92973:(e,r,o)=>{o.d(r,{ensureRecordingsBucket:()=>i,storeRecording:()=>a});var t=o(62632);async function a(e,r,o,a){try{let i=await fetch(e,{method:"GET",headers:{Accept:"audio/*"}});if(!i.ok)return console.error("recordingStorage: failed to download from SignalWire",{status:i.status,recordingUrl:"[REDACTED]"}),null;let n=await i.arrayBuffer(),s=new Blob([n]),d=i.headers.get("content-type")||"audio/mpeg",c=d.includes("wav")?"wav":(d.includes("mp3"),"mp3"),u=`${r}/${o}/${a}.${c}`,{data:l,error:g}=await t.default.storage.from("recordings").upload(u,s,{contentType:d,upsert:!1});if(g)return console.error("recordingStorage: failed to upload to Supabase Storage",{error:g.message,storagePath:u}),null;return await t.default.from("recordings").update({updated_at:new Date().toISOString()}).eq("id",a),console.log("recordingStorage: stored recording",{recordingId:a,storagePath:u}),u}catch(e){return console.error("recordingStorage: error",{error:e?.message,recordingId:a}),null}}async function i(){try{let{data:e,error:r}=await t.default.storage.listBuckets();if(r)return console.error("recordingStorage: failed to list buckets",{error:r.message}),!1;if(!e?.find(e=>"recordings"===e.name)){let{data:e,error:r}=await t.default.storage.createBucket("recordings",{public:!1,fileSizeLimit:104857600,allowedMimeTypes:["audio/mpeg","audio/wav","audio/mp3","audio/m4a"]});if(r)return console.error("recordingStorage: failed to create bucket",{error:r.message}),!1;console.log("recordingStorage: created recordings bucket")}return!0}catch(e){return console.error("recordingStorage: ensure bucket error",{error:e?.message}),!1}}}};