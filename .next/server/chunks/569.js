"use strict";exports.id=569,exports.ids=[569],exports.modules={47569:(t,e,a)=>{a.d(e,{translateText:()=>n});var o=a(62632);async function n(t){let{callId:e,translationRunId:a,text:n,fromLanguage:r,toLanguage:s,organizationId:l}=t;try{let{data:t}=await o.default.from("organizations").select("plan").eq("id",l).limit(1),i=t?.[0]?.plan?.toLowerCase();if("global"!==i&&"enterprise"!==i){console.warn("translation: plan does not support translation",{organizationId:l,plan:i}),await o.default.from("ai_runs").update({status:"failed",completed_at:new Date().toISOString(),output:{error:"Plan does not support translation",plan:i}}).eq("id",a);return}let u=null,p=null;if(process.env.OPENAI_API_KEY)try{let t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"auto"===r||"auto"===s?"You are a professional translator. First detect the language of the following text. Then translate it to the most appropriate target language. If the text is in English, translate to Spanish. If the text is in Spanish, translate to English. If the text is in another language, translate to English. Only return the translated text, no explanations or language labels.":`You are a professional translator. Translate the following text from ${r} to ${s}. Only return the translated text, no explanations.`},{role:"user",content:n}],temperature:.3,max_tokens:2e3})});if(t.ok){let o=await t.json();(u=o.choices?.[0]?.message?.content?.trim()||null)&&console.log("translation: OpenAI translation successful",{translationRunId:a,callId:e})}else{let e=await t.text();p=`OpenAI API error: ${t.status} - ${e}`}}catch(t){p=`OpenAI translation failed: ${t?.message||"Unknown error"}`}else p="No translation provider configured (OPENAI_API_KEY not set)";u?(await o.default.from("ai_runs").update({status:"completed",completed_at:new Date().toISOString(),output:{from_language:r,to_language:s,source_text:n,translated_text:u,provider:"openai",completed_at:new Date().toISOString()}}).eq("id",a),console.log("translation: completed",{translationRunId:a,callId:e,fromLanguage:r,toLanguage:s})):(await o.default.from("ai_runs").update({status:"failed",completed_at:new Date().toISOString(),output:{from_language:r,to_language:s,source_text:n,error:p||"Translation failed",failed_at:new Date().toISOString()}}).eq("id",a),console.error("translation: failed",{translationRunId:a,callId:e,error:p}))}catch(t){console.error("translation: service error",{error:t?.message,translationRunId:a,callId:e}),await o.default.from("ai_runs").update({status:"failed",completed_at:new Date().toISOString(),output:{error:t?.message||"Translation service error",failed_at:new Date().toISOString()}}).eq("id",a)}}}};