(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[288],{8786:function(e,t,s){Promise.resolve().then(s.bind(s,2869)),Promise.resolve().then(s.bind(s,8582)),Promise.resolve().then(s.bind(s,1321)),Promise.resolve().then(s.bind(s,5368))},2869:function(e,t,s){"use strict";s.d(t,{Button:function(){return n}});var l=s(7437);function n(e){let{children:t,className:s="",variant:n="default",size:a="md",...i}=e;return(0,l.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md focus:outline-none"," ").concat({default:"bg-indigo-600 text-white hover:bg-indigo-500",outline:"border border-slate-700 text-slate-100",ghost:"bg-transparent text-slate-100"}[n]," ").concat({sm:"px-2 py-1 text-sm",md:"px-3 py-2",lg:"px-4 py-2"}[a]," ").concat(s),...i,children:t})}s(2265)},8582:function(e,t,s){"use strict";s.d(t,{default:function(){return n}});var l=s(7437);function n(e){let{callId:t,limit:s=10,events:n}=e,a=Array.isArray(n)?n:[],i=(t?a.filter(e=>e.call_id===t):a).slice(0,s);return(0,l.jsxs)("section",{"aria-label":"Activity feed",className:"w-full bg-slate-950 rounded-md p-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-slate-100",children:"Activity"}),(0,l.jsx)("div",{className:"text-xs text-slate-400",children:t?"Call: ".concat(t):"All events"})]}),(0,l.jsxs)("div",{role:"status","aria-live":"polite",className:"sr-only",children:[i.length," events shown"]}),(0,l.jsx)("ul",{role:"list",className:"space-y-2",children:0===i.length?(0,l.jsx)("li",{className:"p-3 bg-slate-900 rounded text-slate-400 text-sm",children:"No recent activity"}):i.map(e=>{var t;return(0,l.jsxs)("li",{className:"p-3 bg-slate-900 rounded flex items-start gap-3","aria-labelledby":"evt-".concat(e.id,"-title"),children:[(0,l.jsx)("div",{className:"text-lg","aria-hidden":!0,children:(t=e.type).includes("error")?"❌":t.includes("record")?"⏺️":t.includes("transcript")||t.includes("transcription")?"\uD83D\uDCDD":t.includes("call.started")?"\uD83D\uDCDE":t.includes("call.ended")?"\uD83D\uDD1A":"ℹ️"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{id:"evt-".concat(e.id,"-title"),className:"text-sm text-slate-100",children:e.title}),(0,l.jsx)("div",{className:"text-xs text-slate-400",children:new Date(e.timestamp).toLocaleString()})]}),(0,l.jsx)("div",{className:"text-xs font-medium ".concat("error"===e.status?"text-rose-400":"warning"===e.status?"text-amber-400":"text-slate-400"),children:e.status||"info"})]},e.id)})})]})}s(2265)},1321:function(e,t,s){"use strict";s.d(t,{default:function(){return a}});var l=s(7437),n=s(2265);function a(e){let{calls:t,selectedCallId:s,onSelect:a}=e,[i,r]=(0,n.useState)(()=>{if(!s)return 0;let e=t.findIndex(e=>e.id===s);return e>=0?e:0}),c=(0,n.useRef)(null);function d(e){r(e);let t=c.current,s=null==t?void 0:t.querySelectorAll('[role="listitem"]')[e];null==s||s.focus()}return(0,n.useEffect)(()=>{if(s){let e=t.findIndex(e=>e.id===s);e>=0&&r(e)}},[s,t]),(0,l.jsx)("div",{ref:c,role:"list","aria-label":"Calls list",onKeyDown:function(e){if(t&&0!==t.length){if("ArrowDown"===e.key)e.preventDefault(),d(Math.min(t.length-1,i+1));else if("ArrowUp"===e.key)e.preventDefault(),d(Math.max(0,i-1));else if("Enter"===e.key||" "===e.key){e.preventDefault();let s=t[i];s&&(null==a||a(s.id))}}},tabIndex:0,className:"space-y-2",children:t.map((e,t)=>{var n,i,c;let d=s===e.id;return(0,l.jsx)("div",{role:"listitem",tabIndex:-1,"aria-selected":d,onClick:()=>null==a?void 0:a(e.id),onFocus:()=>r(t),className:"w-full p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500 transition-colors cursor-pointer bg-slate-800 hover:bg-slate-700 ".concat(d?"ring-2 ring-indigo-500":""),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-slate-100 truncate",children:e.id}),(0,l.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full ".concat("completed"===e.status?"bg-green-600":"in_progress"===e.status?"bg-indigo-600":"bg-gray-600"," text-slate-100"),children:null!==(n=e.status)&&void 0!==n?n:"unknown"})]}),(0,l.jsxs)("div",{className:"mt-1 text-xs text-slate-400 truncate",children:["Started: ",null!==(i=e.started_at)&&void 0!==i?i:"—"]}),(0,l.jsxs)("div",{className:"mt-0.5 text-xs text-slate-400 truncate",children:["Created by: ",null!==(c=e.created_by)&&void 0!==c?c:"—"]})]}),(0,l.jsx)("div",{className:"ml-3 text-right",children:e.call_sid?(0,l.jsxs)("div",{className:"text-xs text-slate-300",children:["SID: ",e.call_sid]}):null})]})},e.id)})})}},5368:function(e,t,s){"use strict";s.d(t,{default:function(){return m}});var l=s(7437),n=s(2265);function a(e){let{children:t,className:s="",...n}=e;return(0,l.jsx)("label",{className:"text-sm font-medium ".concat(s),...n,children:t})}var i=s(2869);function r(e){let{children:t,content:s}=e;return s?(0,l.jsxs)("div",{className:"relative inline-block group",children:[(0,l.jsx)("div",{className:"inline-block",children:t}),(0,l.jsx)("div",{className:"pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity absolute z-10 mt-2 left-1/2 -translate-x-1/2 w-max bg-slate-800 text-white text-xs rounded px-2 py-1",children:s})]}):(0,l.jsx)("div",{className:"inline-block",children:t})}let c=[{key:"record",label:"Recording",desc:"Capture call audio"},{key:"transcribe",label:"Transcribe",desc:"Generate transcript"},{key:"translate",label:"Translate",desc:"Translate transcript"},{key:"survey",label:"After-call Survey",desc:"Run after-call survey"},{key:"synthetic_caller",label:"Synthetic Caller",desc:"Use synthetic caller voice for tests"}];function d(e){let{callId:t,initialModulations:s,onChange:d}=e,[o,u]=(0,n.useState)(()=>({...s})),[x,m]=(0,n.useState)(()=>({record:!1,transcribe:!1,translate:!1,survey:!1,synthetic_caller:!1})),[f,h]=(0,n.useState)(null);async function v(e){h(null);let t={...o},s={...o,[e]:!o[e]};u(s),m(t=>({...t,[e]:!0}));try{await d(s)}catch(e){var l;u(t),h(null!==(l=null==e?void 0:e.message)&&void 0!==l?l:"Update failed")}finally{m(t=>({...t,[e]:!1}))}}return(0,n.useEffect)(()=>{u({...s})},[s]),(0,l.jsxs)("section",{"aria-labelledby":"call-modulations-".concat(t),className:"w-full p-4 bg-slate-950 rounded-md",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{id:"call-modulations-".concat(t),className:"text-lg font-medium text-slate-100",children:"Call Modulations"}),(0,l.jsx)("p",{className:"text-sm text-slate-400",children:"Preview (modulations only — no writes)"})]}),(0,l.jsx)("div",{className:"mt-4 grid grid-cols-1 gap-3",children:c.map(e=>{let t="synthetic_caller"===e.key;return(0,l.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-slate-800 hover:bg-slate-700",children:[(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)(a,{className:"text-sm text-slate-100",children:e.label}),(0,l.jsx)("span",{className:"text-xs text-slate-400",children:e.desc})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[t?(0,l.jsx)(r,{content:"Requires elevated permissions",children:(0,l.jsx)("div",{children:(0,l.jsx)("button",{role:"switch","aria-checked":!!o[e.key],"aria-label":e.label,tabIndex:0,disabled:!0,className:"inline-flex items-center h-7 w-12 rounded-full p-1 bg-gray-700 opacity-60 cursor-not-allowed",children:(0,l.jsx)("span",{className:"inline-block h-5 w-5 rounded-full bg-white transform ".concat(o[e.key]?"translate-x-5":"translate-x-0")})})})}):(0,l.jsx)("button",{role:"switch","aria-checked":!!o[e.key],"aria-label":e.label,tabIndex:0,onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),x[e.key]||v(e.key))},onClick:()=>{x[e.key]||v(e.key)},className:"inline-flex items-center h-7 w-12 rounded-full p-1 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 ".concat(o[e.key]?"bg-indigo-600":"bg-slate-700"),children:(0,l.jsx)("span",{className:"inline-block h-5 w-5 rounded-full bg-white transform transition-transform ".concat(o[e.key]?"translate-x-5":"translate-x-0")})}),(0,l.jsx)("div",{className:"text-xs text-slate-400 w-12 text-right",children:x[e.key]?(0,l.jsx)("span",{"aria-live":"polite",children:"Updating…"}):o[e.key]?"On":"Off"})]})]},e.key)})}),f?(0,l.jsx)("div",{role:"status","aria-live":"assertive",className:"mt-3 text-sm text-red-400",children:f}):null,(0,l.jsx)("div",{className:"mt-4 text-right",children:(0,l.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>u({...s}),className:"text-xs",children:"Reset Preview"})})]})}function o(e){let{recordingUrl:t,transcriptPreview:s,onPlay:a}=e,i=(0,n.useRef)(null),[r,c]=(0,n.useState)(!1),[d,o]=(0,n.useState)(0),[u,x]=(0,n.useState)(null),[m,f]=(0,n.useState)(!1);function h(){let e=i.current;e&&(e.paused?e.play().catch(()=>{}):e.pause())}function v(e){let t=i.current;t&&(t.currentTime=Math.max(0,Math.min(t.duration||0,t.currentTime+e)))}return(0,n.useEffect)(()=>{let e=i.current;if(e)return e.addEventListener("timeupdate",t),e.addEventListener("durationchange",s),e.addEventListener("play",l),e.addEventListener("pause",n),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("durationchange",s),e.removeEventListener("play",l),e.removeEventListener("pause",n)};function t(){o(e.currentTime)}function s(){x(isFinite(e.duration)?e.duration:null)}function l(){c(!0),null==a||a()}function n(){c(!1)}},[a]),(0,l.jsxs)("section",{"aria-label":"Audio player",role:"region",className:"w-full p-4 bg-slate-950 rounded-md",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{children:(0,l.jsx)("button",{onClick:h,onKeyDown:function(e){" "===e.key||"Spacebar"===e.key?(e.preventDefault(),h()):"ArrowRight"===e.key?(e.preventDefault(),v(5)):"ArrowLeft"===e.key&&(e.preventDefault(),v(-5))},"aria-pressed":r,"aria-label":r?"Pause audio":"Play audio",className:"inline-flex items-center justify-center h-10 w-10 rounded-full bg-indigo-600 text-white focus:outline-none focus:ring-2 focus:ring-indigo-400",children:(0,l.jsx)("span",{"aria-hidden":!0,children:r?"▮▮":"▶"})})}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("div",{className:"text-sm text-slate-100",children:"Audio"}),(0,l.jsx)("div",{className:"text-xs text-slate-400",children:t?"Ready to play":"No recording available"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("div",{className:"text-xs text-slate-400",children:[Math.floor(d),"s ",u?" / ".concat(Math.floor(u),"s"):""]}),(0,l.jsxs)("div",{className:"text-xs",children:[(0,l.jsx)("button",{onClick:()=>v(-5),className:"text-slate-200 px-2 py-1 rounded hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-400",children:"-5s"}),(0,l.jsx)("button",{onClick:()=>v(5),className:"ml-2 text-slate-200 px-2 py-1 rounded hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-400",children:"+5s"})]})]})]}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)("audio",{ref:i,src:t||void 0,controls:!0,className:"w-full rounded bg-black"})}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-slate-100",children:"Transcript"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("a",{href:"#transcript",className:"text-xs text-indigo-400 hover:underline",children:"Captions"}),(0,l.jsx)("button",{onClick:()=>f(e=>!e),"aria-expanded":m,className:"text-xs text-slate-300 focus:outline-none focus:ring-2 focus:ring-indigo-400",children:m?"Collapse":"Expand"})]})]}),(0,l.jsx)("div",{id:"transcript",tabIndex:-1,className:"mt-2 p-3 rounded bg-slate-800 ".concat(m?"max-h-[40vh] overflow-auto":"max-h-16 overflow-hidden"),children:s?(0,l.jsx)("pre",{className:"text-xs text-slate-200 whitespace-pre-wrap",children:s}):(0,l.jsx)("div",{className:"text-xs text-slate-500",children:"No transcript available"})})]})]})}function u(e){let{manifest:t}=e,[s,a]=(0,n.useState)(!1);if(!t)return(0,l.jsx)("div",{className:"p-4 bg-slate-950 rounded-md text-slate-400 text-sm",children:"No evidence manifest available"});let i=t.manifest_id||t.id||"unknown",r=t.created_at||t.createdAt||"unknown",c=Array.isArray(t.artifacts)?t.artifacts.length:0,d=t.manifest_hash||t.hash||t.manifestHash||"n/a";return(0,l.jsxs)("section",{role:"region","aria-label":"Evidence manifest summary",className:"w-full p-4 bg-slate-950 rounded-md",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Manifest"}),(0,l.jsx)("div",{className:"text-sm text-slate-100 font-medium",children:i}),(0,l.jsx)("div",{className:"text-xs text-slate-400",children:new Date(r).toLocaleString()})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Artifacts"}),(0,l.jsx)("div",{className:"text-sm text-slate-100",children:c}),(0,l.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:d})]})]}),(0,l.jsx)("div",{className:"mt-3 flex items-center justify-end",children:(0,l.jsx)("button",{onClick:()=>a(e=>!e),"aria-expanded":s,className:"text-xs text-indigo-400 hover:underline focus:outline-none focus:ring-2 focus:ring-indigo-400 rounded px-2 py-1",children:s?"Hide JSON":"Show full manifest"})}),s?(0,l.jsx)("pre",{className:"mt-3 p-3 rounded bg-slate-800 text-slate-100 text-xs font-mono overflow-auto max-h-80",tabIndex:0,"aria-label":"Full evidence manifest JSON",children:(0,l.jsx)("code",{children:JSON.stringify(t,null,2)})}):null]})}var x=s(8582);function m(e){var t,s,a,i,r,c,m;let{initialCalls:f}=e,[h,v]=n.useState(null),[p,j]=n.useState(!1),[g,N]=n.useState(null),[y,b]=n.useState(null);async function w(e){try{await fetch("/api/calls/recordModulationIntent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({callId:h,modulations:e})})}catch(e){console.error("modulation intent failed",e)}}return(0,l.jsxs)("div",{className:"space-y-4",children:[h?null:(0,l.jsx)("div",{className:"text-slate-400",children:"Select a call from the left to view details."}),g?(0,l.jsxs)("div",{className:"p-3 bg-rose-900 text-rose-100 rounded",children:["Error: ",g]}):null,p?(0,l.jsx)("div",{className:"p-3 bg-slate-900 text-slate-400 rounded",children:"Loading call..."}):null,y?(0,l.jsxs)("article",{className:"space-y-4",children:[(0,l.jsx)("header",{className:"flex items-center justify-between",children:(0,l.jsxs)("div",{children:[(0,l.jsxs)("h2",{className:"text-lg font-semibold",children:["Call ",(null===(t=y.call)||void 0===t?void 0:t.id)||h]}),(0,l.jsxs)("div",{className:"text-xs text-slate-400",children:["Status: ",(null===(s=y.call)||void 0===s?void 0:s.status)||"unknown"]})]})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,l.jsx)(d,{callId:(null===(a=y.call)||void 0===a?void 0:a.id)||"unknown",initialModulations:y.modulations||{record:!1,transcribe:!1,translate:!1,survey:!1,synthetic_caller:!1},onChange:w}),(0,l.jsx)(o,{recordingUrl:(null===(i=y.recording)||void 0===i?void 0:i.recording_url)||null,transcriptPreview:(null===(c=y.recording)||void 0===c?void 0:null===(r=c.transcript_json)||void 0===r?void 0:r.text)||null}),(0,l.jsx)(u,{manifest:y.evidence_manifest||null})]}),(0,l.jsxs)("aside",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"p-3 bg-slate-900 rounded",children:[(0,l.jsx)("div",{className:"text-sm text-slate-400",children:"Call SID"}),(0,l.jsx)("div",{className:"text-sm text-slate-100",children:(null===(m=y.call)||void 0===m?void 0:m.call_sid)||"—"})]}),(0,l.jsx)(x.default,{callId:h||void 0,events:y.activity||[]})]})]})]}):null,(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)("div",{className:"text-xs text-slate-500",children:"Note: UI is read-first; modulation changes record an intent."})}),(0,l.jsx)("script",{dangerouslySetInnerHTML:{__html:"\n        (function(){\n          document.addEventListener('call:selected', function(e){\n            try{ const id = e.detail?.id; if(id) { window.fetch('/_next/static/chunks/empty.js'); /* noop to satisfy bundler */ } }\n            catch(e){ }\n          })\n        })()\n      "}})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=8786)}),_N_E=e.O()}]);