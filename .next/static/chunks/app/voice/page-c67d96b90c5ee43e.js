(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[288],{9745:function(e,t,s){Promise.resolve().then(s.bind(s,7805))},7805:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var l=s(7437),a=s(2265);class i{order(){return this}limit(){return this}eq(){return this}async single(){return{data:null}}then(e){return Promise.resolve(this._res).then(e)}constructor(e={data:[]}){this._res=e}}var n={from:e=>({select:e=>new i({data:[]})})},c=s(5475);function r(e){let{calls:t,selectedCallId:s,onSelect:a}=e;return(0,l.jsxs)("div",{className:"space-y-2",children:[0===t.length&&(0,l.jsx)("div",{className:"text-slate-500",children:"No calls"}),t.map(e=>(0,l.jsxs)("div",{className:"p-2 rounded-md cursor-pointer ".concat(s===e.id?"bg-slate-800":"hover:bg-slate-900"),onClick:()=>a(e.id),children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("div",{className:"font-medium",children:e.id}),(0,l.jsx)("div",{className:"text-sm text-slate-400",children:e.status})]}),(0,l.jsx)("div",{className:"text-xs text-slate-500",children:e.started_at?new Date(e.started_at).toLocaleString():"—"})]},e.id))]})}function d(e){let{callId:t,initialModulations:s,onChange:i}=e,[n,c]=(0,a.useState)(s);return(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(n).map(e=>(0,l.jsxs)("label",{className:"flex items-center gap-2 p-2 bg-slate-900 rounded-md",children:[(0,l.jsx)("input",{type:"checkbox",checked:n[e],onChange:()=>(function(e){let t={...n,[e]:!n[e]};c(t),i(t)})(e)}),(0,l.jsx)("span",{className:"capitalize",children:e.replace(/_/g," ")})]},e))})}function o(e){let{recordingUrl:t,transcriptPreview:s}=e;return(0,l.jsxs)("div",{className:"space-y-4",children:[t?(0,l.jsx)("audio",{controls:!0,src:t,className:"w-full"}):(0,l.jsx)("div",{className:"text-slate-500",children:"No recording available"}),s?(0,l.jsx)("pre",{className:"max-h-48 overflow-auto text-sm bg-slate-900 p-3 rounded",children:s}):null]})}function u(e){let{manifest:t}=e;return t?(0,l.jsx)("div",{className:"bg-slate-900 p-3 rounded",children:(0,l.jsx)("pre",{className:"text-sm max-h-80 overflow-auto",children:JSON.stringify(t,null,2)})}):(0,l.jsx)("div",{className:"text-slate-500",children:"No evidence manifest"})}function m(e){let{callId:t,limit:s=20}=e;return(0,l.jsxs)("div",{className:"space-y-2",children:[!t&&(0,l.jsx)("div",{className:"text-slate-500",children:"Select a call to see activity"}),t&&(0,l.jsxs)("div",{className:"text-slate-400",children:["Activity feed for ",t," (mock)"]})]})}var x=s(2869),h=s(4895);function f(){var e;(0,c.useRouter)();let[t,s]=(0,a.useState)([]),[i,f]=(0,a.useState)(null),[v,j]=(0,a.useState)(null),[N,g]=(0,a.useState)(null),[p,b]=(0,a.useState)(null),[y,w]=(0,a.useState)({record:!1,transcribe:!1,translate:!1,survey:!1,synthetic_caller:!1}),[S,_]=(0,a.useState)(!0),[k,C]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async function(){_(!0),C(null);try{let e=await n.from("calls").select("*").order("started_at",{ascending:!1}).limit(50);s(e.data||[])}catch(s){var e,t;C(null!==(e=null==s?void 0:s.message)&&void 0!==e?e:"Failed to load calls"),(0,h.A)({title:"Error",description:String(null!==(t=null==s?void 0:s.message)&&void 0!==t?t:s),variant:"destructive"})}finally{_(!1)}})()},[]),(0,a.useEffect)(()=>{i&&e();async function e(){var e,t;_(!0);try{let t=(await n.from("calls").select("*").eq("id",i).single()).data;j(t||null);let s=await n.from("recordings").select("*").eq("call_id",i).single();g(s.data||null);let l=await n.from("evidence_manifests").select("*").eq("recording_id",(null===(e=s.data)||void 0===e?void 0:e.id)||"").single();b(l.data||null),w((null==t?void 0:t.modulations)||y)}catch(e){C(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"Failed to load call details")}finally{_(!1)}}},[i]);let E=async e=>{try{await fetch("/api/actions/updateModulations",{method:"POST",body:JSON.stringify({callId:i,modulations:e})}),(0,h.A)({title:"Success",description:"Modulations updated"})}catch(e){var t;(0,h.A)({title:"Error",description:String(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:e),variant:"destructive"})}};return k?(0,l.jsx)("div",{className:"flex h-screen items-center justify-center bg-slate-950 text-slate-100",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"mx-auto h-12 w-12 text-red-500 text-4xl",children:"⚠️"}),(0,l.jsx)("h2",{className:"mt-4 text-xl",children:"Error loading calls"}),(0,l.jsx)("p",{className:"mt-2 text-slate-400",children:k}),(0,l.jsx)(x.z,{onClick:()=>location.reload(),className:"mt-4",children:"Retry"})]})}):S?(0,l.jsx)("div",{className:"flex h-screen items-center justify-center bg-slate-950 text-slate-100",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto"}),(0,l.jsx)("p",{className:"mt-4",children:"Loading Voice Operations..."})]})}):(0,l.jsxs)("div",{className:"flex h-screen bg-slate-950 text-slate-100",children:[(0,l.jsxs)("aside",{className:"w-1/4 border-r border-slate-800 overflow-y-auto p-4",children:[(0,l.jsx)("h1",{className:"text-lg font-semibold mb-4",children:"Calls"}),(0,l.jsx)(r,{calls:t,selectedCallId:i,onSelect:f})]}),(0,l.jsx)("main",{className:"flex-1 p-6 overflow-y-auto",children:v?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("header",{className:"flex justify-between items-center mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h2",{className:"text-xl font-semibold",children:["Call ",v.id]}),(0,l.jsxs)("p",{className:"text-slate-400",children:["Status: ",v.status," • Duration: ",null!==(e=v.duration)&&void 0!==e?e:"N/A"," min"]})]}),(0,l.jsx)(x.z,{variant:"outline",children:"Start New Call"})]}),(0,l.jsxs)("section",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-lg mb-2",children:"Modulations"}),(0,l.jsx)(d,{callId:v.id,initialModulations:y,onChange:E})]}),(0,l.jsxs)("section",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-lg mb-2",children:"Recording"}),(0,l.jsx)(o,{recordingUrl:(null==N?void 0:N.recording_url)||null,transcriptPreview:(null==N?void 0:N.transcript_json)?JSON.stringify(N.transcript_json,null,2):null})]}),(0,l.jsxs)("section",{children:[(0,l.jsx)("h3",{className:"text-lg mb-2",children:"Evidence & Score"}),(0,l.jsx)(u,{manifest:p})]})]}):(0,l.jsx)("div",{className:"flex h-full items-center justify-center text-slate-400",children:"Select a call from the left to view details"})}),(0,l.jsxs)("section",{className:"w-1/4 border-l border-slate-800 overflow-y-auto p-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Activity Feed"}),(0,l.jsx)(m,{callId:i,limit:20})]})]})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return a}});var l=s(7437);function a(e){return(0,l.jsx)("button",{...e,className:(e.className||"")+" px-3 py-1 rounded bg-indigo-600 text-white",children:e.children})}s(2265)},4895:function(e,t,s){"use strict";function l(e){let{title:t,description:s,variant:l}=e;console.log("TOAST",{title:t,description:s,variant:l})}s.d(t,{A:function(){return l}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=9745)}),_N_E=e.O()}]);