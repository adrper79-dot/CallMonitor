(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[75],{7235:(e,t,r)=>{"use strict";r.d(t,{d:()=>a});var s=r(95155);function a(e){let{checked:t=!1,onChange:r,onCheckedChange:a,disabled:n=!1,className:l="",...i}=e;return(0,s.jsx)("button",{type:"button",role:"switch","aria-checked":t,"aria-disabled":n,onClick:()=>{if(n)return;let e=!t;null==r||r(e),null==a||a(e)},disabled:n,className:"inline-flex items-center h-6 w-11 rounded-full p-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 ".concat(n?"bg-gray-200 cursor-not-allowed opacity-60":t?"bg-primary-600 cursor-pointer":"bg-gray-300 cursor-pointer hover:bg-gray-400"," ").concat(l),...i,children:(0,s.jsx)("span",{className:"inline-block h-5 w-5 rounded-full bg-white transform transition-transform shadow-sm ".concat(t?"translate-x-5":"translate-x-0")})})}r(12115)},16286:(e,t,r)=>{"use strict";r.d(t,{dj:()=>s.d});var s=r(28460)},28460:(e,t,r)=>{"use strict";r.d(t,{ToastProvider:()=>o,d:()=>c});var s=r(95155),a=r(12115),n=r(47650);let l=(0,a.createContext)(null),i=0;function o(e){let{children:t}=e,[r,n]=(0,a.useState)([]),o=(0,a.useCallback)(e=>{var t;let r="toast-".concat(++i,"-").concat(Date.now()),s=null!=(t=e.duration)?t:5e3;n(t=>[...t,{...e,id:r}]),s>0&&setTimeout(()=>{n(e=>e.filter(e=>e.id!==r))},s)},[]);a.useEffect(()=>{function e(e){let{title:t,description:r,variant:s}=e.detail||{};o({title:t,description:r,variant:s})}return window.addEventListener("toast",e),()=>window.removeEventListener("toast",e)},[o]);let c=(0,a.useCallback)(e=>{n(t=>t.filter(t=>t.id!==e))},[]);return(0,s.jsxs)(l.Provider,{value:{toasts:r,toast:o,dismiss:c},children:[t,(0,s.jsx)(d,{})]})}function c(){let e=(0,a.useContext)(l);return e||{toast:e=>{let{title:t,description:r,variant:s}=e;console.debug("[Toast]",s,t,r)},dismiss:()=>{},toasts:[]}}function d(){let e=(0,a.useContext)(l),[t,r]=(0,a.useState)(!1);if(a.useEffect(()=>{r(!0)},[]),!t||!e)return null;let{toasts:i,dismiss:o}=e;return 0===i.length?null:(0,n.createPortal)((0,s.jsx)("div",{className:"fixed bottom-4 right-4 z-[100] flex flex-col gap-2 pointer-events-none","aria-live":"polite","aria-label":"Notifications",children:i.map(e=>(0,s.jsx)(u,{toast:e,onDismiss:()=>o(e.id)},e.id))}),document.body)}function u(e){let{toast:t,onDismiss:r}=e,a={default:(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),success:(0,s.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),destructive:(0,s.jsx)("svg",{className:"w-5 h-5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),warning:(0,s.jsx)("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})};return(0,s.jsx)("div",{role:"alert",className:"\n        pointer-events-auto\n        w-80 max-w-[calc(100vw-2rem)]\n        p-4 rounded-lg border shadow-lg\n        animate-in slide-in-from-right-full fade-in duration-300\n        ".concat({default:"bg-white border-gray-200 text-gray-900",success:"bg-green-50 border-green-200 text-green-900",destructive:"bg-red-50 border-red-200 text-red-900",warning:"bg-amber-50 border-amber-200 text-amber-900"}[t.variant||"default"],"\n      "),children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:a[t.variant||"default"]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[t.title&&(0,s.jsx)("p",{className:"text-sm font-semibold",children:t.title}),t.description&&(0,s.jsx)("p",{className:"text-sm opacity-90 mt-0.5",children:t.description})]}),(0,s.jsx)("button",{onClick:r,className:"flex-shrink-0 p-1 rounded hover:bg-black/5 transition-colors","aria-label":"Dismiss notification",children:(0,s.jsx)("svg",{className:"w-4 h-4 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}},67812:(e,t,r)=>{"use strict";r.d(t,{E:()=>a});var s=r(95155);function a(e){let{children:t,className:r="",variant:a="default",...n}=e;return(0,s.jsx)("span",{className:"".concat("inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"," ").concat({default:"bg-gray-100 text-gray-700",secondary:"bg-gray-100 text-gray-700",success:"bg-success-light text-green-700",warning:"bg-warning-light text-amber-700",error:"bg-error-light text-red-700",info:"bg-info-light text-blue-700"}[a]," ").concat(r),...n,children:t})}r(12115)},68882:(e,t,r)=>{"use strict";r.d(t,{TroubleshootChatToggle:()=>i});var s=r(95155),a=r(12115),n=r(40674);function l(e){let{endpoint:t,orgId:r}=e,{messages:l,input:i,handleInputChange:o,handleSubmit:c,isLoading:d}=(0,n.Y_)({api:t,body:{orgId:r}}),u=(0,a.useRef)(null);return(0,a.useEffect)(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[l]),(0,s.jsxs)("div",{className:"flex flex-col h-full bg-gray-50",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",ref:u,children:[0===l.length&&(0,s.jsxs)("div",{className:"text-center text-gray-400 mt-20 text-sm",children:[(0,s.jsx)("p",{children:"Connected to Stack Troubleshoot."}),(0,s.jsx)("p",{children:"Analyzing Neon + Workers + Telnyx checks..."}),(0,s.jsx)("p",{className:"mt-2 text-xs",children:'Try: "Fix my DB connection" or "Why did the last call fail?"'})]}),l.map(e=>(0,s.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,s.jsx)("div",{className:"max-w-[85%] rounded-lg p-3 text-sm whitespace-pre-wrap ".concat("user"===e.role?"bg-blue-600 text-white":"bg-white border border-gray-200 text-gray-800 shadow-sm"),children:"assistant"===e.role?(0,s.jsx)("code",{className:"font-mono text-xs block bg-gray-50 p-2 rounded border border-gray-100 mt-1",children:e.content}):e.content})},e.id)),d&&(0,s.jsx)("div",{className:"flex justify-start",children:(0,s.jsx)("div",{className:"bg-gray-100 rounded-lg p-2 text-xs text-gray-500 animate-pulse",children:"Analyzing stack..."})})]}),(0,s.jsx)("div",{className:"p-3 bg-white border-t border-gray-200",children:(0,s.jsxs)("form",{onSubmit:c,className:"flex gap-2",children:[(0,s.jsx)("input",{className:"flex-1 p-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-500",value:i,onChange:o,placeholder:"Describe the error..."}),(0,s.jsx)("button",{type:"submit",disabled:d||!i.trim(),className:"bg-[#0f172a] text-white px-4 py-2 rounded text-sm font-medium hover:bg-opacity-90 disabled:opacity-50",children:"Send"})]})})]})}function i(){let[e,t]=(0,a.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,s.jsx)("button",{onClick:()=>t(!e),className:"bg-navy-900 text-white p-3 rounded-full shadow-lg hover:bg-navy-800 transition-colors border border-navy-700",style:{backgroundColor:"#0f172a"},"aria-label":"Toggle Stack Troubleshoot Bot",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})})})}),e&&(0,s.jsxs)("div",{className:"fixed bottom-20 right-4 z-50 w-[400px] h-[600px] bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden flex flex-col",children:[(0,s.jsxs)("div",{className:"bg-[#0f172a] text-white p-3 flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"font-semibold text-sm",children:"Stack Troubleshoot Bot"}),(0,s.jsx)("button",{onClick:()=>t(!1),className:"text-gray-400 hover:text-white",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,s.jsx)("div",{className:"flex-1 overflow-hidden relative",children:(0,s.jsx)(l,{endpoint:"/api/chat/troubleshoot-stream",orgId:"default"})})]})]})}},81606:(e,t,r)=>{"use strict";r.d(t,{default:()=>eD});var s=r(95155),a=r(12115),n=r(98075),l=r(12862);let i=(0,a.createContext)(null);function o(e){let{organizationId:t,children:n}=e,o=function(e){let[t,s]=(0,a.useState)("disconnected"),[n,i]=(0,a.useState)(null),[o,c]=(0,a.useState)("idle"),[d,u]=(0,a.useState)(null),[m,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[g,f]=(0,a.useState)(null),b=(0,a.useRef)(null),v=(0,a.useRef)(null),j=(0,a.useRef)(null),y=(0,a.useRef)(null),N=(0,a.useRef)(null),w=(0,a.useRef)(null);(0,a.useEffect)(()=>{{let e=document.createElement("audio");e.autoplay=!0,e.id="remote-audio",document.body.appendChild(e),y.current=e}return()=>{y.current&&y.current.remove()}},[]),(0,a.useEffect)(()=>("active"===o&&d?w.current=setInterval(()=>{u(e=>e?{...e,duration:Math.floor((Date.now()-e.started_at.getTime())/1e3)}:null)},1e3):w.current&&clearInterval(w.current),()=>{w.current&&clearInterval(w.current)}),[o,null==d?void 0:d.id]),(0,a.useEffect)(()=>()=>{if(w.current&&clearInterval(w.current),j.current)try{j.current.bye()}catch(e){}if(v.current)try{v.current.unregister()}catch(e){}if(b.current)try{b.current.stop()}catch(e){}N.current&&N.current.getTracks().forEach(e=>e.stop())},[]);let k=(0,a.useCallback)(async()=>{if(!e)return void i("Organization ID required");if("registered"!==t&&"connecting"!==t)try{s("initializing"),i(null),console.log("[SIP.js] Fetching SIP credentials...");let e=await (0,l.$P)("/api/webrtc/session");if(!e.success||!e.session)throw Error("Failed to get SIP session");let{id:t,sip_username:a,sip_password:n,sip_domain:o,websocket_url:d,ice_servers:m}=e.session;p(t),console.log("[SIP.js] Got credentials, importing library..."),s("connecting");let{UserAgent:x,Registerer:h}=await r.e(1654).then(r.bind(r,71654));console.log("[SIP.js] Requesting microphone access..."),N.current=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});let g="sip:".concat(a,"@").concat(o);console.log("[SIP.js] Connecting as:",g);let f=new x({uri:x.makeURI(g),transportOptions:{server:d},authorizationUsername:a,authorizationPassword:n,sessionDescriptionHandlerFactoryOptions:{peerConnectionConfiguration:{iceServers:m}},logLevel:"warn",delegate:{onInvite:e=>{var t,r;console.log("[SIP.js] Incoming call from:",null==(r=e.remoteIdentity)||null==(t=r.uri)?void 0:t.toString()),e.accept({sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!1},peerConnectionConfiguration:{iceServers:m}}}).then(()=>{console.log("[SIP.js] Call accepted"),j.current=e,c("active"),s("on_call");let t=e.sessionDescriptionHandler;(null==t?void 0:t.peerConnection)&&(N.current&&N.current.getTracks().forEach(e=>{t.peerConnection.addTrack(e,N.current),console.log("[SIP.js] Added local track:",e.kind)}),t.peerConnection.ontrack=e=>{if("audio"===e.track.kind&&y.current){console.log("[SIP.js] Got remote audio track");let t=new MediaStream([e.track]);y.current.srcObject=t,y.current.play().catch(e=>console.error("[SIP.js] Audio play error",e))}},t.peerConnection.getReceivers().forEach(e=>{var t;if((null==(t=e.track)?void 0:t.kind)==="audio"&&y.current){let t=new MediaStream([e.track]);y.current.srcObject=t,y.current.play().catch(e=>console.error("[SIP.js] Audio play error",e))}})),e.stateChange.addListener(e=>{console.log("[SIP.js] Inbound call state:",e),"Terminated"===e&&(c("idle"),u(null),s("registered"),j.current=null)})}).catch(e=>{console.error("[SIP.js] Failed to accept call",e),i("Failed to accept incoming call"),c("idle")})}}});b.current=f,await f.start(),console.log("[SIP.js] UserAgent started");let w=new h(f);v.current=w,w.stateChange.addListener(e=>{console.log("[SIP.js] Registerer state:",e),"Registered"===e?s("registered"):"Unregistered"===e&&s("disconnected")}),await w.register(),console.log("[SIP.js] Registration sent")}catch(e){console.error("[SIP.js] Connect Error",e),i(e.message||"Connection failed"),s("error")}},[e,t]),C=(0,a.useCallback)(async()=>{try{if(j.current){try{j.current.bye()}catch(e){}j.current=null}v.current&&(await v.current.unregister(),v.current=null),b.current&&(await b.current.stop(),b.current=null),N.current&&(N.current.getTracks().forEach(e=>e.stop()),N.current=null),await (0,l.Al)("/api/webrtc/session").catch(()=>{}),s("disconnected"),c("idle"),u(null)}catch(e){console.error("[SIP.js] Disconnect error",e),s("disconnected")}},[]),_=(0,a.useCallback)(async e=>{if("registered"!==t)return void i("Not registered with SIP server");try{c("dialing"),i(null),console.log("[SIP.js] Requesting server-side dial:",e);let t=await (0,l.$P)("/api/webrtc/dial",{phoneNumber:e,sessionId:h});if(!t.success){var r;throw Error((null==(r=t.error)?void 0:r.message)||"Failed to dial")}console.log("[SIP.js] Server dial initiated:",t.callSid),u({id:t.callId||"server-call",phone_number:e,started_at:new Date,duration:0})}catch(e){console.error("[SIP.js] Call error",e),i(e.message||"Call failed"),c("idle")}},[t,h]),S=(0,a.useCallback)(async()=>{if(j.current)try{c("ending"),"Established"===j.current.state?await j.current.bye():await j.current.cancel(),j.current=null,c("idle"),u(null),s("registered")}catch(e){console.error("[SIP.js] Hangup error",e),c("idle"),u(null),j.current=null}},[]);return{connect:k,disconnect:C,status:t,error:n,makeCall:_,hangUp:S,callState:o,currentCall:d,mute:(0,a.useCallback)(()=>{N.current&&(N.current.getAudioTracks().forEach(e=>{e.enabled=!1}),x(!0))},[]),unmute:(0,a.useCallback)(()=>{N.current&&(N.current.getAudioTracks().forEach(e=>{e.enabled=!0}),x(!1))},[]),isMuted:m,quality:g,sessionId:h}}(t);return(0,s.jsx)(i.Provider,{value:o,children:n})}function c(){let e=(0,a.useContext)(i);if(!e)throw Error("useWebRTCContext must be used within WebRTCProvider");return e}let d=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[r,n]=(0,a.useState)(""),l=/^\+[1-9]\d{1,14}$/.test(r);return(0,s.jsx)(d.Provider,{value:{targetNumber:r,setTargetNumber:n,isValid:l},children:t})}function m(){let e=(0,a.useContext)(d);if(!e)throw Error("useTargetNumber must be used within a TargetNumberProvider");return e}let x=(0,a.createContext)(null);function h(e){let{children:t}=e,r=(0,a.useRef)(null);return(0,s.jsx)(x.Provider,{value:{sdkPromiseRef:r},children:t})}var p=r(21297),g=r(97003),f=r(67812);function b(e){let{organizationId:t,organizationName:r}=e,{role:a,plan:n,loading:l}=(0,p.e)(t),i=n?n.charAt(0).toUpperCase()+n.slice(1):"",o=a?a.charAt(0).toUpperCase()+a.slice(1):"",c=n&&!["global","enterprise"].includes(n.toLowerCase());return(0,s.jsxs)("header",{className:"w-full h-14 border-b border-gray-200 bg-white px-6 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Wordis Bond"}),r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-gray-300",children:"|"}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:r})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:!l&&(0,s.jsxs)(s.Fragment,{children:[n&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Plan:"}),(0,s.jsx)(f.E,{variant:"info",children:i})]}),a&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Role:"}),(0,s.jsx)(f.E,{variant:"default",children:o})]}),c&&(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>{window.location.href="/settings/billing?upgrade=true"},"aria-label":"Upgrade plan",children:"Upgrade"})]})})]})}var v=r(33789),j=r(63350),y=r(24033),N=r(12108),w=r(5917);let k=j.bL;j.YJ;let C=j.WT,_=a.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsxs)(j.l9,{ref:t,className:"flex h-10 w-full items-center justify-between rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-background placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 ".concat(r||""),...n,children:[a,(0,s.jsx)(j.In,{asChild:!0,children:(0,s.jsx)(y.A,{className:"h-4 w-4 opacity-50"})})]})});_.displayName=j.l9.displayName;let S=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(j.PP,{ref:t,className:"flex cursor-default items-center justify-center py-1 ".concat(r||""),...a,children:(0,s.jsx)(N.A,{className:"h-4 w-4"})})});S.displayName=j.PP.displayName;let E=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(j.wn,{ref:t,className:"flex cursor-default items-center justify-center py-1 ".concat(r||""),...a,children:(0,s.jsx)(y.A,{className:"h-4 w-4"})})});E.displayName=j.wn.displayName;let A=a.forwardRef((e,t)=>{let{className:r,children:a,position:n="popper",...l}=e;return(0,s.jsx)(j.ZL,{children:(0,s.jsxs)(j.UC,{ref:t,className:"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white text-gray-900 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 ".concat("popper"===n?"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1":""," ").concat(r||""),position:n,...l,children:[(0,s.jsx)(S,{}),(0,s.jsx)(j.LM,{className:"p-1 ".concat("popper"===n?"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]":""),children:a}),(0,s.jsx)(E,{})]})})});A.displayName=j.UC.displayName,a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(j.JU,{ref:t,className:"py-1.5 pl-8 pr-2 text-sm font-semibold ".concat(r||""),...a})}).displayName=j.JU.displayName;let I=a.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsxs)(j.q7,{ref:t,className:"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 ".concat(r||""),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(j.VF,{children:(0,s.jsx)(w.A,{className:"h-4 w-4"})})}),(0,s.jsx)(j.p4,{children:a})]})});I.displayName=j.q7.displayName,a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(j.wv,{ref:t,className:"-mx-1 my-1 h-px bg-gray-200 ".concat(r||""),...a})}).displayName=j.wv.displayName;var T=r(48038),L=r(79288);function z(e){let{calls:t,selectedCallId:r,organizationId:n,onSelect:l}=e,[i,o]=(0,a.useState)(t),[c,d]=(0,a.useState)(t),[u,m]=(0,a.useState)(0),[x,h]=(0,a.useState)("all"),[p,b]=(0,a.useState)(""),[j,y]=(0,a.useState)("date"),[N,w]=(0,a.useState)(1),[S,E]=(0,a.useState)(!1),z=(0,a.useRef)(null),{updates:F,connected:R}=(0,L.x)(n||null),{data:D}=(0,L.n)(async()=>{if(!n)return[];try{let e=await fetch("/api/calls?orgId=".concat(encodeURIComponent(n),"&page=").concat(N,"&limit=").concat(20),{credentials:"include"});if(e.ok)return(await e.json()).calls||[];return[]}catch(e){return[]}},5e3,!R&&null!==n);(0,a.useEffect)(()=>{F.length&&F.forEach(e=>{if("calls"===e.table&&("INSERT"===e.eventType||"UPDATE"===e.eventType)){let t=e.new;o(e=>{let r=e.findIndex(e=>e.id===t.id);if(!(r>=0))return[t,...e];{let s=[...e];return s[r]={...s[r],...t},s}})}})},[F]),(0,a.useEffect)(()=>{!R&&D.length>0&&o(D)},[D,R]),(0,a.useEffect)(()=>{let e=[...i];if("all"!==x&&(e=e.filter(e=>"active"===x?"in_progress"===e.status||"ringing"===e.status:"completed"===x?"completed"===e.status:"failed"!==x||"failed"===e.status||"no-answer"===e.status||"busy"===e.status)),p){let t=p.toLowerCase();e=e.filter(e=>{var r,s;return e.id.toLowerCase().includes(t)||(null==(r=e.call_sid)?void 0:r.toLowerCase().includes(t))||(null==(s=e.created_by)?void 0:s.toLowerCase().includes(t))})}e.sort((e,t)=>{if("date"===j){let r=e.started_at?new Date(e.started_at).getTime():0;return(t.started_at?new Date(t.started_at).getTime():0)-r}return 0}),d(e),w(1)},[i,x,p,j]);let M=c.slice(0,20*N),O=c.length>20*N;function P(e){m(e);let t=z.current,r=null==t?void 0:t.querySelectorAll('[role="listitem"]')[e];null==r||r.focus()}return(0,a.useEffect)(()=>{if(r){let e=M.findIndex(e=>e.id===r);e>=0&&m(e)}},[r,M]),(0,s.jsxs)("div",{className:"h-full flex flex-col bg-gray-50",children:[(0,s.jsxs)("div",{className:"p-4 bg-white border-b border-gray-200 space-y-3",children:[(0,s.jsx)(v.p,{type:"search",value:p,onChange:e=>b(e.target.value),placeholder:"Search calls...",className:"w-full"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)(k,{value:x,onValueChange:e=>h(e),children:[(0,s.jsx)(_,{children:(0,s.jsx)(C,{placeholder:"All Status"})}),(0,s.jsxs)(A,{children:[(0,s.jsx)(I,{value:"all",children:"All Status"}),(0,s.jsx)(I,{value:"active",children:"Active"}),(0,s.jsx)(I,{value:"completed",children:"Completed"}),(0,s.jsx)(I,{value:"failed",children:"Failed"})]})]}),(0,s.jsxs)(k,{value:j,onValueChange:e=>y(e),children:[(0,s.jsx)(_,{children:(0,s.jsx)(C,{placeholder:"Newest First"})}),(0,s.jsxs)(A,{children:[(0,s.jsx)(I,{value:"date",children:"Newest First"}),(0,s.jsx)(I,{value:"score",children:"By Score"}),(0,s.jsx)(I,{value:"duration",children:"By Duration"})]})]})]}),!R&&(0,s.jsx)("div",{className:"text-xs text-warning",children:"Offline mode - using cached data"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-auto",ref:z,onKeyDown:function(e){if(M&&0!==M.length){if("ArrowDown"===e.key)e.preventDefault(),P(Math.min(M.length-1,u+1));else if("ArrowUp"===e.key)e.preventDefault(),P(Math.max(0,u-1));else if("Enter"===e.key||" "===e.key){e.preventDefault();let t=M[u];t&&(null==l||l(t.id))}}},children:[S?(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"Loading..."}):0===M.length?(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"No calls found"}):(0,s.jsxs)("table",{className:"w-full border-collapse bg-white",children:[(0,s.jsx)("thead",{className:"sticky top-0 bg-gray-50 border-b border-gray-200 z-10",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-xs font-medium text-gray-500 uppercase tracking-wide text-left",children:"ID"}),(0,s.jsx)("th",{className:"px-4 py-3 text-xs font-medium text-gray-500 uppercase tracking-wide text-left",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-3 text-xs font-medium text-gray-500 uppercase tracking-wide text-left",children:"Date"}),(0,s.jsx)("th",{className:"px-4 py-3 text-xs font-medium text-gray-500 uppercase tracking-wide text-left",children:"User"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-100",children:M.map((e,t)=>{var a,n;let i=r===e.id;return(0,s.jsxs)("tr",{role:"listitem",tabIndex:0,"aria-selected":i,onClick:()=>null==l?void 0:l(e.id),onFocus:()=>m(t),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),null==l||l(e.id))},className:"cursor-pointer transition-colors ".concat(i?"bg-primary-50":"hover:bg-gray-50"),children:[(0,s.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,s.jsxs)("span",{className:"font-mono text-xs text-gray-900",children:[e.id.slice(0,8),"..."]})}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)(f.E,{variant:"completed"===(n=e.status)?"success":"in_progress"===n||"ringing"===n?"info":"failed"===n||"no-answer"===n||"busy"===n?"error":"default",children:null!=(a=e.status)?a:"unknown"})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:(0,s.jsx)(T.u,{date:e.started_at,format:"short"})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.created_by||"—"})]},e.id)})})]}),O&&(0,s.jsx)("div",{className:"p-4 bg-white border-t border-gray-200 text-center",children:(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:function(){w(e=>e+1)},children:["Load More (",c.length-M.length," remaining)"]})})]}),(0,s.jsxs)("div",{className:"p-3 bg-white border-t border-gray-200 text-xs text-gray-500",children:[M.length," of ",c.length," calls"]})]})}var F=r(52619),R=r.n(F);let D=["completed","failed","no-answer","busy","cancelled"];var M=r(16286);let O=(0,a.createContext)(null);function P(e){let{defaultValue:t,children:r,className:n=""}=e,[l,i]=(0,a.useState)(t);return(0,s.jsx)(O.Provider,{value:{activeTab:l,setActiveTab:i},children:(0,s.jsx)("div",{className:n,children:r})})}function B(e){let{children:t,className:r=""}=e;return(0,s.jsx)("div",{className:"flex border-b border-slate-800 ".concat(r),role:"tablist",children:t})}function W(e){let{value:t,children:r,className:n=""}=e,l=(0,a.useContext)(O);if(!l)throw Error("TabsTrigger must be used within Tabs");let{activeTab:i,setActiveTab:o}=l,c=i===t;return(0,s.jsx)("button",{role:"tab","aria-selected":c,onClick:()=>o(t),className:"px-4 py-2 text-sm font-medium border-b-2 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 ".concat(c?"border-indigo-500 text-indigo-400":"border-transparent text-slate-400 hover:text-slate-100"," ").concat(n),children:r})}function q(e){let{value:t,children:r,className:n=""}=e,l=(0,a.useContext)(O);if(!l)throw Error("TabsContent must be used within Tabs");let{activeTab:i}=l;return i!==t?null:(0,s.jsx)("div",{role:"tabpanel",className:n,children:r})}function U(e){let{recordingUrl:t,transcriptPreview:r,onPlay:n}=e,l=(0,a.useRef)(null),[i,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(0),[u,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(1);function p(){let e=l.current;e&&(e.paused?e.play().catch(()=>{}):e.pause())}function f(e){let t=l.current;t&&(t.currentTime=Math.max(0,Math.min(t.duration||0,t.currentTime+e)))}function b(e){if(null===e)return"0:00";let t=Math.floor(e/60),r=Math.floor(e%60);return"".concat(t,":").concat(r.toString().padStart(2,"0"))}return(0,a.useEffect)(()=>{let e=l.current;if(!e)return;let t=()=>{e&&d(e.currentTime)},r=()=>{e&&m(isFinite(e.duration)?e.duration:null)},s=()=>{o(!0),null==n||n()},a=()=>{o(!1)},i=()=>{o(!1),d(0)};return e.addEventListener("timeupdate",t),e.addEventListener("durationchange",r),e.addEventListener("play",s),e.addEventListener("pause",a),e.addEventListener("ended",i),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("durationchange",r),e.removeEventListener("play",s),e.removeEventListener("pause",a),e.removeEventListener("ended",i)}},[n]),(0,a.useEffect)(()=>{let e=l.current;e&&(e.volume=x)},[x]),(0,s.jsxs)("section",{"aria-label":"Audio player",role:"region",className:"w-full space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("button",{onClick:p,onKeyDown:function(e){" "===e.key||"Spacebar"===e.key?(e.preventDefault(),p()):"ArrowRight"===e.key?(e.preventDefault(),f(5)):"ArrowLeft"===e.key?(e.preventDefault(),f(-5)):"ArrowUp"===e.key?(e.preventDefault(),h(Math.min(1,x+.1))):"ArrowDown"===e.key&&(e.preventDefault(),h(Math.max(0,x-.1)))},"aria-pressed":i,"aria-label":i?"Pause audio":"Play audio",className:"inline-flex items-center justify-center h-12 w-12 rounded-full bg-[#1E3A5F] text-white hover:bg-[#15294A] focus:outline-none focus:ring-2 focus:ring-[#1E3A5F] focus:ring-offset-2",children:(0,s.jsx)("span",{"aria-hidden":!0,children:i?"▮▮":"▶"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"text-sm text-gray-800 mb-1",children:"Recording"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"range",min:"0",max:u||0,value:c,onChange:function(e){let t=l.current;if(!t)return;let r=parseFloat(e.target.value);t.currentTime=r,d(r)},className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-[#1E3A5F]","aria-label":"Seek position"}),(0,s.jsxs)("span",{className:"text-xs text-gray-500 font-mono min-w-[4rem] text-right",children:[b(c)," / ",b(u)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",htmlFor:"volume-control",children:"Volume"}),(0,s.jsx)("input",{id:"volume-control",type:"range",min:"0",max:"1",step:"0.1",value:x,onChange:e=>h(parseFloat(e.target.value)),className:"w-20 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-[#1E3A5F]","aria-label":"Volume control"})]}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:function(){let e=document.createElement("a");e.href=t,e.download="recording-".concat(Date.now(),".mp3"),e.click()},"aria-label":"Download recording",children:"Download"})]}),(0,s.jsx)("audio",{ref:l,src:t,className:"hidden",preload:"metadata","aria-label":"Audio recording"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>f(-5),"aria-label":"Rewind 5 seconds",children:"-5s"}),(0,s.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>f(5),"aria-label":"Forward 5 seconds",children:"+5s"}),r&&(0,s.jsx)("a",{href:"#transcript",className:"text-xs text-[#1E3A5F] hover:underline ml-auto",onClick:e=>{var t;e.preventDefault(),null==(t=document.getElementById("artifact-transcript"))||t.scrollIntoView({behavior:"smooth"})},children:"View Transcript →"})]}),r&&(0,s.jsxs)("div",{className:"p-3 bg-gray-50 rounded-md border border-gray-200",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Transcript Preview"}),(0,s.jsx)("div",{className:"text-sm text-gray-700 line-clamp-3",children:r})]})]})}var $=r(2479);function V(e){let{transcript:t}=e,[r,n]=(0,a.useState)(!1),l="string"==typeof t?t:(null==t?void 0:t.text)?t.text:(null==t?void 0:t.transcript)?t.transcript:JSON.stringify(t,null,2),i=(null==t?void 0:t.words)||(null==t?void 0:t.segments)||[],o=i.length>0;async function c(){try{await navigator.clipboard.writeText(l),n(!0),setTimeout(()=>n(!1),2e3)}catch(e){$.v.error("TranscriptView: clipboard copy failed",e)}}function d(e){let t=Math.floor(e/1e3),r=Math.floor(t/60);return"".concat(r,":").concat((t%60).toString().padStart(2,"0"))}return(0,s.jsxs)("section",{"aria-labelledby":"transcript-view",className:"w-full space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{id:"transcript-view",className:"text-base font-semibold text-[#333333]",children:"Transcript"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:c,"aria-label":r?"Copied to clipboard":"Copy transcript to clipboard",children:r?"Copied!":"Copy"}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:function(){let e=new Blob([l],{type:"text/plain"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="transcript-".concat(Date.now(),".txt"),r.click(),URL.revokeObjectURL(t)},"aria-label":"Export transcript as text file",children:"Export TXT"}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:function(){let e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),s=document.createElement("a");s.href=r,s.download="transcript-".concat(Date.now(),".json"),s.click(),URL.revokeObjectURL(r)},"aria-label":"Export transcript as JSON file",children:"Export JSON"})]})]}),o?(0,s.jsx)("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto bg-white border border-[#E5E5E5] rounded p-4",children:i.map((e,t)=>(0,s.jsx)("div",{className:"p-3 bg-[#FAFAFA] border-l-4 border-[#4E79A7] rounded",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(void 0!==e.start||void 0!==e.end)&&(0,s.jsxs)("div",{className:"text-xs text-[#999999] font-mono whitespace-nowrap flex-shrink-0",children:[void 0!==e.start&&d(e.start),void 0!==e.start&&void 0!==e.end&&" - ",void 0!==e.end&&d(e.end)]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[e.speaker&&(0,s.jsxs)("div",{className:"text-xs font-medium text-[#4E79A7] mb-1",children:["Speaker ",e.speaker]}),(0,s.jsx)("div",{className:"text-sm text-[#333333]",children:e.text||e.word}),void 0!==e.confidence&&(0,s.jsxs)("div",{className:"text-xs text-[#666666] mt-1",children:["Confidence: ",(100*e.confidence).toFixed(1),"%"]})]})]})},t))}):(0,s.jsx)("div",{className:"p-4 bg-white border border-[#E5E5E5] rounded",children:(0,s.jsx)("pre",{className:"text-sm text-[#333333] whitespace-pre-wrap font-sans max-h-[60vh] overflow-y-auto",children:l})})]})}function J(e){let{translation:t,originalTranscript:r}=e,[n,l]=(0,a.useState)("side-by-side"),[i,o]=(0,a.useState)(!0),c="string"==typeof t?t:(null==t?void 0:t.text)?t.text:(null==t?void 0:t.translation)?t.translation:JSON.stringify(t,null,2),d=(null==r?void 0:r.text)||("string"==typeof r?r:"")||"Original transcript not available",u=(null==t?void 0:t.from_language)||(null==t?void 0:t.from)||"Unknown",m=(null==t?void 0:t.to_language)||(null==t?void 0:t.to)||"Unknown",x=(null==t?void 0:t.translated_audio_url)||(null==t?void 0:t.audio_url)||null;return(0,s.jsxs)("section",{"aria-labelledby":"translation-view",className:"w-full space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{id:"translation-view",className:"text-lg font-medium text-gray-800",children:"Translation"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(f.E,{variant:"info",children:[u," → ",m]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(g.$,{variant:"side-by-side"===n?"default":"outline",size:"sm",onClick:()=>l("side-by-side"),children:"Side by Side"}),(0,s.jsx)(g.$,{variant:"toggle"===n?"default":"outline",size:"sm",onClick:()=>l("toggle"),children:"Toggle"})]})]})]}),"side-by-side"===n?(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)(f.E,{variant:"default",children:u})}),(0,s.jsx)("div",{className:"text-sm text-gray-800 whitespace-pre-wrap max-h-[50vh] overflow-y-auto",children:d})]}),(0,s.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)(f.E,{variant:"info",children:m})}),x&&(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsxs)("audio",{controls:!0,className:"w-full h-8",style:{maxWidth:"100%"},preload:"metadata",children:[(0,s.jsx)("source",{src:x,type:"audio/mpeg"}),"Your browser does not support audio playback."]})}),(0,s.jsx)("div",{className:"text-sm text-gray-800 whitespace-pre-wrap max-h-[50vh] overflow-y-auto",children:c})]})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(g.$,{variant:i?"default":"outline",size:"sm",onClick:()=>o(!0),children:["Original (",u,")"]}),(0,s.jsxs)(g.$,{variant:i?"outline":"default",size:"sm",onClick:()=>o(!1),children:["Translation (",m,")"]})]}),(0,s.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200",children:[!i&&x&&(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsxs)("audio",{controls:!0,className:"w-full h-8",style:{maxWidth:"100%"},preload:"metadata",children:[(0,s.jsx)("source",{src:x,type:"audio/mpeg"}),"Your browser does not support audio playback."]})}),(0,s.jsx)("div",{className:"text-sm text-gray-800 whitespace-pre-wrap max-h-[50vh] overflow-y-auto",children:i?d:c})]})]})]})}function H(e){var t,r;let{survey:a}=e,n=(null==a?void 0:a.results)||(null==a?void 0:a.responses)||a||{},l=(null==a?void 0:a.questions)||[],i=(null==a?void 0:a.sentiment)||(null==a?void 0:a.sentiment_analysis),o=(null==a?void 0:a.score)||(null==a?void 0:a.overall_score),c=Array.isArray(null==a?void 0:a.responses)?a.responses:Array.isArray(null==a||null==(t=a.results)?void 0:t.responses)?a.results.responses:[],d=c.length>0&&(null==(r=c[0])?void 0:r.question_index)!==void 0;return(0,s.jsxs)("section",{"aria-labelledby":"survey-results",className:"w-full space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{id:"survey-results",className:"text-lg font-medium text-gray-800",children:"Survey Results"}),void 0!==o&&(0,s.jsxs)(f.E,{variant:o>=4?"success":o>=3?"warning":"error",children:["Score: ",o,"/5"]})]}),i&&(0,s.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-800 mb-2",children:"Sentiment Analysis"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(f.E,{variant:"positive"===i?"success":"negative"===i?"error":"warning",children:i}),(null==a?void 0:a.sentiment_score)&&(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["Confidence: ",(100*a.sentiment_score).toFixed(1),"%"]})]})]}),d?(0,s.jsx)("div",{className:"space-y-4",children:c.map(e=>(0,s.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-gray-800 mb-2",children:["Q",e.question_index,": ",e.question||"Question"]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:e.value||e.digit||"No response"}),e.digit&&(0,s.jsxs)(f.E,{variant:"info",children:["DTMF: ",e.digit]})]})]},"".concat(e.question_index,"-").concat(e.digit||e.value)))}):l.length>0?(0,s.jsx)("div",{className:"space-y-4",children:l.map((e,t)=>(0,s.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-800 mb-2",children:e.question||e.text}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["Response: ",e.response||e.answer||"No response"]}),void 0!==e.score&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"Score:"}),(0,s.jsxs)(f.E,{variant:e.score>=4?"success":e.score>=3?"warning":"error",children:[e.score,"/5"]})]})]},t))}):(0,s.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500 mb-2",children:"Survey Responses:"}),(0,s.jsx)("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono",children:JSON.stringify(n,null,2)})]}),(null==a?void 0:a.breakdown)&&(0,s.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-800 mb-2",children:"Score Breakdown"}),(0,s.jsx)("div",{className:"space-y-2",children:Object.entries(a.breakdown).map(e=>{let[t,r]=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-slate-300",children:t}),(0,s.jsx)(f.E,{variant:"default",children:r})]},t)})})]})]})}function G(e){let{manifest:t}=e,[r,n]=(0,a.useState)(!1);if(!t)return(0,s.jsx)("div",{className:"p-4 bg-gray-50 rounded-md text-gray-500 text-sm border border-gray-200",children:"No evidence manifest available"});let l=t.manifest_id||t.id||"unknown",i=t.created_at||t.createdAt||"unknown",o=Array.isArray(t.artifacts)?t.artifacts.length:0,c=t.manifest_hash||t.hash||t.manifestHash||"n/a";return(0,s.jsxs)("section",{role:"region","aria-label":"Evidence manifest summary",className:"w-full p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Manifest"}),(0,s.jsx)("div",{className:"text-sm text-gray-800 font-medium",children:l}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:new Date(i).toLocaleString()})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Artifacts"}),(0,s.jsx)("div",{className:"text-sm text-gray-800",children:o}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:c})]})]}),(0,s.jsx)("div",{className:"mt-3 flex items-center justify-end",children:(0,s.jsx)("button",{onClick:()=>n(e=>!e),"aria-expanded":r,className:"text-xs text-[#1E3A5F] hover:underline focus:outline-none focus:ring-2 focus:ring-[#1E3A5F] rounded px-2 py-1",children:r?"Hide JSON":"Show full manifest"})}),r?(0,s.jsx)("pre",{className:"mt-3 p-3 rounded bg-gray-50 text-gray-800 text-xs font-mono overflow-auto max-h-80 border border-gray-200",tabIndex:0,"aria-label":"Full evidence manifest JSON",children:(0,s.jsx)("code",{children:JSON.stringify(t,null,2)})}):null]})}function K(e){let{manifest:t}=e,[r,n]=(0,a.useState)(!1);function l(){let e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),s=document.createElement("a");s.href=r,s.download="evidence-manifest-".concat(t.id||Date.now(),".json"),s.click(),URL.revokeObjectURL(r)}return(0,s.jsxs)("section",{"aria-labelledby":"manifest-view",className:"w-full space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{id:"manifest-view",className:"text-base font-semibold text-[#333333]",children:"Evidence Manifest"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:l,"aria-label":"Export manifest as JSON",children:"Export JSON"}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:function(){l()},"aria-label":"Download manifest",children:"Download"})]})]}),(0,s.jsx)(G,{manifest:t}),r&&(0,s.jsxs)("div",{className:"p-4 bg-white border border-[#E5E5E5] rounded",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[#333333] mb-3",children:"Provenance Metadata"}),(0,s.jsxs)("div",{className:"space-y-2 text-xs",children:[t.producer&&(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("span",{className:"text-[#666666] font-medium min-w-[80px]",children:"Producer:"}),(0,s.jsx)("span",{className:"text-[#333333]",children:t.producer})]}),t.created_at&&(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("span",{className:"text-[#666666] font-medium min-w-[80px]",children:"Created:"}),(0,s.jsx)("span",{className:"text-[#333333]",children:new Date(t.created_at).toLocaleString()})]}),t.manifest_hash&&(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("span",{className:"text-[#666666] font-medium min-w-[80px]",children:"Hash:"}),(0,s.jsx)("code",{className:"text-[#333333] font-mono bg-[#FAFAFA] px-2 py-1 rounded",children:t.manifest_hash})]})]})]}),(0,s.jsxs)("div",{className:"bg-white border border-[#E5E5E5] rounded",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[#E5E5E5]",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[#333333]",children:"Full Manifest JSON"}),(0,s.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>n(!r),"aria-expanded":r,"aria-label":r?"Collapse manifest JSON":"Expand manifest JSON",children:r?"Collapse":"Expand"})]}),r&&(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("pre",{className:"text-xs text-[#333333] whitespace-pre-wrap font-mono max-h-[60vh] overflow-y-auto bg-[#FAFAFA] p-4 rounded",children:JSON.stringify(t,null,2)})})]})]})}var Y=r(2521);function Q(e){let{score:t}=e,r=t.score,a=t.breakdown||{},n=t.scorecard_id;return(0,s.jsxs)("section",{"aria-labelledby":"score-view",className:"w-full space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{id:"score-view",className:"text-base font-semibold text-[#333333]",children:"Call Score"}),n&&(0,s.jsxs)(f.E,{variant:"info","aria-label":"Scorecard: ".concat(n),children:["Scorecard: ",n]})]}),(0,s.jsxs)("div",{className:"p-6 bg-white border border-[#E5E5E5] rounded text-center",children:[(0,s.jsxs)("div",{className:"text-4xl font-semibold text-[#333333] mb-3 tabular-nums",children:[r,"%"]}),(0,s.jsx)(f.E,{variant:r>=80?"success":r>=60?"warning":"error",className:"text-base px-4 py-1.5",children:r>=90?"Excellent":r>=80?"Good":r>=70?"Fair":r>=60?"Needs Improvement":"Poor"})]}),Object.keys(a).length>0&&(0,s.jsxs)("div",{className:"p-5 bg-white border border-[#E5E5E5] rounded",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[#333333] mb-4",children:"Score Breakdown"}),(0,s.jsx)("div",{className:"space-y-4",children:Object.entries(a).map(e=>{let[t,r]=e,a="number"==typeof r?r:(null==r?void 0:r.score)||0,n=a>=80?"green":a>=60?"orange":"red";return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-[#333333]",children:t}),"object"==typeof r&&(null==r?void 0:r.notes)&&(0,s.jsx)("div",{className:"text-xs text-[#666666] mt-0.5",children:r.notes})]}),(0,s.jsxs)("span",{className:"text-sm font-medium text-[#333333] tabular-nums ml-4",children:[a,"%"]})]}),(0,s.jsx)(Y.z,{value:a,color:n,showValue:!1})]},t)})})]}),n&&(0,s.jsxs)("div",{className:"p-4 bg-white border border-[#E5E5E5] rounded",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[#333333] mb-2",children:"Scorecard Information"}),(0,s.jsxs)("div",{className:"text-xs text-[#666666]",children:["This score was calculated using scorecard: ",(0,s.jsx)("code",{className:"text-[#333333] font-mono bg-[#FAFAFA] px-1 py-0.5 rounded",children:n})]})]})]})}function X(e){var t;let{callId:r,organizationId:n,recording:l,transcript:i,translation:o,manifest:c,score:d,survey:u,transcriptionStatus:m}=e,x=!!(null==l?void 0:l.recording_url),h=!!i,p=!!o,f=!!u,b=!!c,j=!!d,y=x||h||p,N="queued"===m||"processing"===m,[w,k]=(0,a.useState)(!1),[C,_]=(0,a.useState)(""),[S,E]=(0,a.useState)(!1),[A,I]=(0,a.useState)(null),T=async()=>{if(!C||!C.includes("@"))return void I({type:"error",message:"Please enter a valid email address"});E(!0),I(null);try{let e=await fetch("/api/calls/".concat(r,"/email"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:C,includeRecording:x,includeTranscript:h,includeTranslation:p})}),t=await e.json();t.success?(I({type:"success",message:"Artifacts sent to ".concat(C)}),_(""),setTimeout(()=>{k(!1),I(null)},3e3)):I({type:"error",message:t.error||"Failed to send email"})}catch(e){I({type:"error",message:(null==e?void 0:e.message)||"Failed to send email"})}finally{E(!1)}},L=x?"recording":h?"transcript":b?"manifest":"recording";return(0,s.jsxs)("section",{"aria-labelledby":"artifact-viewer",className:"w-full bg-white rounded-md border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,s.jsx)("h3",{id:"artifact-viewer",className:"text-lg font-medium text-gray-800",children:"Artifacts"}),y&&(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>k(!w),className:"text-sm",children:"Email Artifacts"})]}),w&&(0,s.jsxs)("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Send all artifacts as email attachments (files, not links):"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(v.p,{type:"email",placeholder:"recipient@example.com",value:C,onChange:e=>_(e.target.value),className:"flex-1",disabled:S}),(0,s.jsx)(g.$,{onClick:T,disabled:S||!C,className:"whitespace-nowrap",children:S?"Sending...":"Send"})]}),A&&(0,s.jsx)("p",{className:"text-sm mt-2 ".concat("success"===A.type?"text-green-600":"text-red-600"),children:A.message}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Includes: ",[x&&"Recording",h&&"Transcript",p&&"Translation"].filter(Boolean).join(", ")||"No artifacts"]})]}),(0,s.jsxs)(P,{defaultValue:L,className:"w-full",children:[(0,s.jsxs)(B,{className:"w-full border-b border-gray-200",children:[x&&(0,s.jsx)(W,{value:"recording",children:"Recording"}),h&&(0,s.jsx)(W,{value:"transcript",children:"Transcript"}),p&&(0,s.jsx)(W,{value:"translation",children:"Translation"}),f&&(0,s.jsx)(W,{value:"survey",children:"Survey"}),b&&(0,s.jsx)(W,{value:"manifest",children:"Manifest"}),j&&(0,s.jsx)(W,{value:"score",children:"Score"})]}),x&&(0,s.jsx)(q,{value:"recording",className:"p-4",children:(0,s.jsx)(U,{recordingUrl:l.recording_url,transcriptPreview:(null==(t=l.transcript_json)?void 0:t.text)||null})}),h&&(0,s.jsx)(q,{value:"transcript",className:"p-4",children:(0,s.jsx)(V,{transcript:i})}),p&&(0,s.jsx)(q,{value:"translation",className:"p-4",children:(0,s.jsx)(J,{translation:o,originalTranscript:i})}),f&&(0,s.jsx)(q,{value:"survey",className:"p-4",children:(0,s.jsx)(H,{survey:u})}),b&&(0,s.jsx)(q,{value:"manifest",className:"p-4",children:(0,s.jsx)(K,{manifest:c})}),j&&(0,s.jsx)(q,{value:"score",className:"p-4",children:(0,s.jsx)(Q,{score:d})}),!x&&!h&&!p&&!f&&!b&&!j&&!N&&(0,s.jsx)("div",{className:"p-8 text-center text-slate-400",children:"No artifacts available for this call yet."}),N&&!h&&(0,s.jsx)("div",{className:"p-6 text-center",children:(0,s.jsxs)("div",{className:"inline-flex items-center gap-3 px-4 py-3 bg-blue-900/30 border border-blue-700/50 rounded-lg",children:[(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5 text-blue-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-blue-300",children:"queued"===m?"Transcription queued":"Transcribing audio..."}),(0,s.jsx)("p",{className:"text-xs text-blue-400/70",children:"This typically takes 1-3 minutes"})]})]})}),"failed"===m&&!h&&(0,s.jsx)("div",{className:"p-6 text-center",children:(0,s.jsxs)("div",{className:"inline-flex items-center gap-3 px-4 py-3 bg-red-900/30 border border-red-700/50 rounded-lg",children:[(0,s.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-red-300",children:"Transcription failed"}),(0,s.jsx)("p",{className:"text-xs text-red-400/70",children:"The audio could not be transcribed"})]})]})})]})]})}function Z(e){let{transcriptJson:t}=e,{sentiment_analysis:r,sentiment_summary:a,entities:n,chapters:l,utterances:i,content_safety:o,iab_categories:c}=t;return r||n||l||i?(0,s.jsxs)("div",{className:"space-y-4",children:[a&&(0,s.jsxs)("section",{"aria-label":"Sentiment Analysis",className:"bg-white border border-[#E5E5E5] rounded p-5",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-[#333333] mb-4",children:"Sentiment Analysis"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full mb-3 ".concat("POSITIVE"===a.overall?"bg-[#E8F5E9]":"NEGATIVE"===a.overall?"bg-[#FFEBEE]":"bg-gray-100"),children:(0,s.jsx)("span",{className:"text-3xl ".concat("POSITIVE"===a.overall?"text-[#59A14F]":"NEGATIVE"===a.overall?"text-[#E15759]":"text-gray-500"),children:"POSITIVE"===a.overall?"\uD83D\uDE0A":"NEGATIVE"===a.overall?"\uD83D\uDE1F":"\uD83D\uDE10"})}),(0,s.jsx)("p",{className:"text-xl font-semibold text-[#333333] capitalize mb-1",children:a.overall.toLowerCase()}),(0,s.jsx)("p",{className:"text-xs text-[#666666]",children:"Overall Sentiment"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(Y.z,{label:"Positive",value:a.positive_percent,color:"green",showValue:!0}),(0,s.jsx)(Y.z,{label:"Neutral",value:a.neutral_percent,color:"blue",showValue:!0}),(0,s.jsx)(Y.z,{label:"Negative",value:a.negative_percent,color:"red",showValue:!0}),(0,s.jsxs)("p",{className:"text-xs text-[#999999] text-right",children:["Based on ",a.segment_count," analyzed segments"]})]})]})]}),l&&l.length>0&&(0,s.jsxs)("section",{"aria-label":"Call Topics",className:"bg-white border border-[#E5E5E5] rounded p-5",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-[#333333] mb-4",children:"Call Topics"}),(0,s.jsx)("div",{className:"space-y-3",children:l.map((e,t)=>(0,s.jsx)("div",{className:"p-4 bg-[#FAFAFA] border-l-4 border-[#4E79A7] rounded",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-medium text-[#333333] text-sm",children:e.headline}),(0,s.jsx)("p",{className:"text-sm text-[#666666] mt-1",children:e.summary})]}),(0,s.jsxs)("span",{className:"text-xs text-[#999999] whitespace-nowrap",children:[ee(e.start)," - ",ee(e.end)]})]})},t))})]}),n&&n.length>0&&(0,s.jsxs)("section",{"aria-label":"Detected Entities",className:"bg-white border border-[#E5E5E5] rounded p-5",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-[#333333] mb-4",children:"Detected Entities"}),(0,s.jsx)("div",{className:"space-y-4",children:(function(e){let t={};return e.forEach(e=>{t[e.entity_type]||(t[e.entity_type]=[]),t[e.entity_type].some(t=>t.text===e.text)||t[e.entity_type].push(e)}),Object.entries(t)})(n).map(e=>{var t;let[r,a]=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-[#666666] uppercase tracking-wide mb-2",children:{person_name:"People",organization:"Companies",location:"Places",phone_number:"Phone Numbers",email_address:"Emails",date:"Dates",money_amount:"Money",occupation:"Occupations",medical_condition:"Medical",blood_type:"Medical",drug:"Medications"}[t=r]||t.replace(/_/g," ")}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:a.map((e,t)=>(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded ".concat({person_name:"bg-[#E3F2FD] text-[#4E79A7] border border-[#BBDEFB]",organization:"bg-[#F3E5F5] text-[#AF7AA1] border border-[#E1BEE7]",location:"bg-[#E8F5E9] text-[#59A14F] border border-[#C8E6C9]",phone_number:"bg-[#FFF8E1] text-[#F57C00] border border-[#FFE082]",email_address:"bg-[#E0F2F1] text-[#76B7B2] border border-[#B2DFDB]",date:"bg-[#FCE4EC] text-[#C2185B] border border-[#F8BBD0]",money_amount:"bg-[#E8F5E9] text-[#388E3C] border border-[#C8E6C9]"}[r]||"bg-gray-100 text-[#666666] border border-gray-200"),children:e.text},t))})]},r)})})]}),i&&i.length>0&&(0,s.jsxs)("section",{"aria-label":"Speaker Timeline",className:"bg-white border border-[#E5E5E5] rounded p-5",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-[#333333] mb-4",children:"Speaker Timeline"}),(0,s.jsxs)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[i.slice(0,20).map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-3 p-3 rounded border-l-4 ".concat("A"===e.speaker?"bg-[#E3F2FD] border-l-[#4E79A7]":"bg-[#F3E5F5] border-l-[#AF7AA1]"),children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold text-white flex-shrink-0 ".concat("A"===e.speaker?"bg-[#4E79A7]":"bg-[#AF7AA1]"),children:e.speaker}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm text-[#333333]",children:e.text}),(0,s.jsx)("p",{className:"text-xs text-[#666666] mt-1",children:ee(e.start)})]})]},t)),i.length>20&&(0,s.jsxs)("p",{className:"text-xs text-[#999999] text-center pt-2",children:["+",i.length-20," more segments"]})]})]}),o&&o.results&&o.results.length>0&&(0,s.jsxs)("section",{"aria-label":"Content Safety",className:"bg-white border border-[#E5E5E5] rounded p-5",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-[#333333] mb-4",children:"Content Flags"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:o.results.map((e,t)=>(0,s.jsxs)("span",{className:"inline-flex items-center px-3 py-1 bg-[#FFF8E1] text-[#F57C00] border border-[#FFE082] rounded text-sm font-medium",children:[e.label," (",Math.round(100*e.confidence),"%)"]},t))})]}),c&&c.results&&c.results.length>0&&(0,s.jsxs)("section",{"aria-label":"Topic Categories",className:"bg-white border border-[#E5E5E5] rounded p-5",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-[#333333] mb-4",children:"Topic Categories"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:c.results.slice(0,10).map((e,t)=>{var r;return(0,s.jsx)("span",{className:"inline-flex items-center px-3 py-1 bg-gray-100 text-[#666666] border border-gray-200 rounded text-sm",title:"Relevance: ".concat(Math.round(100*e.relevance),"%"),children:(null==(r=e.label.split(">").pop())?void 0:r.trim())||e.label},t)})})]})]}):(0,s.jsxs)("div",{className:"p-6 bg-white border border-[#E5E5E5] rounded text-center",children:[(0,s.jsx)("p",{className:"text-sm text-[#666666] mb-2",children:"Analytics not available for this call"}),(0,s.jsx)("p",{className:"text-xs text-[#999999]",children:"Enable transcription to unlock AI-powered insights"})]})}function ee(e){let t=Math.floor(e/1e3),r=Math.floor(t/60);return"".concat(r,":").concat((t%60).toString().padStart(2,"0"))}let et={agreed:{label:"Agreed",description:"All parties agreed on the terms",icon:"✓",color:"bg-green-100 text-green-800"},declined:{label:"Declined",description:"Customer/party declined the offer",icon:"✗",color:"bg-red-100 text-red-800"},partial:{label:"Partial Agreement",description:"Some items agreed, some not",icon:"◐",color:"bg-yellow-100 text-yellow-800"},inconclusive:{label:"Inconclusive",description:"No clear outcome from the call",icon:"?",color:"bg-gray-100 text-gray-800"},pending_review:{label:"Pending Review",description:"Needs management review",icon:"⏳",color:"bg-blue-100 text-blue-800"},follow_up_required:{label:"Follow-up Required",description:"Requires a follow-up call",icon:"↻",color:"bg-purple-100 text-purple-800"}},er={high:{label:"High Confidence",description:"Clear, explicit agreement or decline",color:"bg-green-100 text-green-800"},medium:{label:"Medium Confidence",description:"Somewhat implicit or ambiguous",color:"bg-yellow-100 text-yellow-800"},low:{label:"Low Confidence",description:"Many uncertainties, needs review",color:"bg-orange-100 text-orange-800"},disputed:{label:"Disputed",description:"Parties disagree on the outcome",color:"bg-red-100 text-red-800"}};function es(e){let{callId:t,organizationId:r,callCompleted:n,existingOutcome:l,onOutcomeSaved:i,enableAISummary:o=!0}=e,[c,d]=(0,a.useState)((null==l?void 0:l.outcomeStatus)||"inconclusive"),[u,m]=(0,a.useState)((null==l?void 0:l.confidenceLevel)||"high"),[x,h]=(0,a.useState)((null==l?void 0:l.summaryText)||""),[p,f]=(0,a.useState)((null==l?void 0:l.summarySource)||"human"),[b,v]=(0,a.useState)((null==l?void 0:l.readbackConfirmed)||!1),[j,y]=(0,a.useState)((null==l?void 0:l.agreedItems)||[]),[N,w]=(0,a.useState)((null==l?void 0:l.declinedItems)||[]),[k,C]=(0,a.useState)((null==l?void 0:l.ambiguities)||[]),[_,S]=(0,a.useState)((null==l?void 0:l.followUpActions)||[]),[E,A]=(0,a.useState)(!l),[I,T]=(0,a.useState)(!1),[L,z]=(0,a.useState)(!1),[F,R]=(0,a.useState)(!1),[D,M]=(0,a.useState)(null),[O,P]=(0,a.useState)(""),[B,W]=(0,a.useState)(""),[q,U]=(0,a.useState)(""),[$,V]=(0,a.useState)(""),J=(0,a.useCallback)(async()=>{z(!0),M(null),R(!1);try{var e,r,s,a;let n=await fetch("/api/calls/".concat(t,"/summary"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({use_call_transcript:!0,include_structured_extraction:!0})});if(!n.ok){let e=await n.json();throw Error((null==(a=e.error)?void 0:a.message)||"Failed to generate summary")}let l=(await n.json()).data;h(l.summary_text),f("ai_generated"),R(!0),(null==(e=l.potential_agreements)?void 0:e.length)>0&&y(l.potential_agreements.map(e=>({term:e,confirmed:!1}))),(null==(r=l.potential_concerns)?void 0:r.length)>0&&C(l.potential_concerns.map(e=>({issue:e}))),(null==(s=l.recommended_followup)?void 0:s.length)>0&&S(l.recommended_followup.map(e=>({action:e})))}catch(e){M(e.message||"Failed to generate AI summary")}finally{z(!1)}},[t]),H=(0,a.useCallback)(async()=>{T(!0),M(null);try{let r="ai_generated"===p?"ai_confirmed":p,s=await fetch("/api/calls/".concat(t,"/outcome"),{method:l?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({outcome_status:c,confidence_level:u,agreed_items:j,declined_items:N,ambiguities:k,follow_up_actions:_,summary_text:x,summary_source:r,readback_confirmed:b})});if(!s.ok){var e;let t=await s.json();throw Error((null==(e=t.error)?void 0:e.message)||"Failed to save outcome")}let a=await s.json();i&&i(a.data.outcome),A(!1),R(!1)}catch(e){M(e.message||"Failed to save outcome declaration")}finally{T(!1)}},[t,l,c,u,j,N,k,_,x,p,b,i]),G=()=>{O.trim()&&(y([...j,{term:O.trim(),confirmed:!0}]),P(""))},K=()=>{B.trim()&&(w([...N,{term:B.trim()}]),W(""))},Y=()=>{q.trim()&&(C([...k,{issue:q.trim()}]),U(""))},Q=()=>{$.trim()&&(S([..._,{action:$.trim()}]),V(""))};if(!n)return null;if(!E&&l){let e=et[l.outcomeStatus]||et.inconclusive;return(0,s.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-lg ".concat(e.color),children:e.icon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"Outcome Declared"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.label})]})]}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>A(!0),children:"Edit"})]}),l.summaryText&&(0,s.jsxs)("p",{className:"mt-3 text-sm text-gray-600 border-t border-gray-100 pt-3",children:[l.summaryText.slice(0,200),l.summaryText.length>200?"...":""]})]})})}return(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,s.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"Declare Outcome"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Record what was agreed, declined, or left unclear"})]}),l&&(0,s.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>A(!1),children:"Cancel"})]})}),(0,s.jsxs)("div",{className:"p-4 space-y-6",children:[D&&(0,s.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md text-sm text-red-700",children:D}),F&&(0,s.jsxs)("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-md",children:[(0,s.jsx)("p",{className:"text-sm text-amber-800 font-medium",children:"AI-Generated Summary - Requires Human Review"}),(0,s.jsx)("p",{className:"text-xs text-amber-700 mt-1",children:"This summary was generated by AI. Please review carefully and edit if needed before confirming."})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Outcome Status ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.keys(et).map(e=>{let t=et[e];return(0,s.jsx)("button",{onClick:()=>d(e),className:"\n                    p-3 rounded-md border text-left transition-colors\n                    ".concat(c===e?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300","\n                  "),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-6 h-6 rounded-full flex items-center justify-center text-sm ".concat(t.color),children:t.icon}),(0,s.jsx)("span",{className:"font-medium text-gray-900 text-sm",children:t.label})]})},e)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confidence Level"}),(0,s.jsx)("div",{className:"flex gap-2 flex-wrap",children:Object.keys(er).map(e=>{let t=er[e];return(0,s.jsx)("button",{onClick:()=>m(e),className:"\n                    px-3 py-1.5 rounded-md text-sm font-medium transition-colors\n                    ".concat(u===e?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200","\n                  "),children:t.label},e)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"What Was Agreed"}),(0,s.jsxs)("div",{className:"space-y-2",children:[j.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-green-50 rounded-md",children:[(0,s.jsx)("span",{className:"text-green-600",children:"✓"}),(0,s.jsx)("span",{className:"flex-1 text-sm text-gray-900",children:e.term}),(0,s.jsx)("button",{onClick:()=>y(j.filter((e,r)=>r!==t)),className:"text-gray-400 hover:text-red-500",children:"\xd7"})]},t)),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:O,onChange:e=>P(e.target.value),onKeyDown:e=>"Enter"===e.key&&G(),placeholder:"Add agreed item...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm"}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:G,children:"Add"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"What Was Declined / Not Agreed"}),(0,s.jsxs)("div",{className:"space-y-2",children:[N.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-red-50 rounded-md",children:[(0,s.jsx)("span",{className:"text-red-600",children:"✗"}),(0,s.jsx)("span",{className:"flex-1 text-sm text-gray-900",children:e.term}),(0,s.jsx)("button",{onClick:()=>w(N.filter((e,r)=>r!==t)),className:"text-gray-400 hover:text-red-500",children:"\xd7"})]},t)),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:B,onChange:e=>W(e.target.value),onKeyDown:e=>"Enter"===e.key&&K(),placeholder:"Add declined item...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm"}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:K,children:"Add"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ambiguities / Unclear Items"}),(0,s.jsxs)("div",{className:"space-y-2",children:[k.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-yellow-50 rounded-md",children:[(0,s.jsx)("span",{className:"text-yellow-600",children:"?"}),(0,s.jsx)("span",{className:"flex-1 text-sm text-gray-900",children:e.issue}),(0,s.jsx)("button",{onClick:()=>C(k.filter((e,r)=>r!==t)),className:"text-gray-400 hover:text-red-500",children:"\xd7"})]},t)),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:q,onChange:e=>U(e.target.value),onKeyDown:e=>"Enter"===e.key&&Y(),placeholder:"Add ambiguity...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm"}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:Y,children:"Add"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Follow-up Actions"}),(0,s.jsxs)("div",{className:"space-y-2",children:[_.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-blue-50 rounded-md",children:[(0,s.jsx)("span",{className:"text-blue-600",children:"→"}),(0,s.jsx)("span",{className:"flex-1 text-sm text-gray-900",children:e.action}),(0,s.jsx)("button",{onClick:()=>S(_.filter((e,r)=>r!==t)),className:"text-gray-400 hover:text-red-500",children:"\xd7"})]},t)),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:$,onChange:e=>V(e.target.value),onKeyDown:e=>"Enter"===e.key&&Q(),placeholder:"Add follow-up action...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm"}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:Q,children:"Add"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Summary"}),o&&(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:J,disabled:L,children:L?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"w-4 h-4 mr-1.5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Generating..."]}):"✨ Generate AI Summary"})]}),(0,s.jsx)("textarea",{value:x,onChange:e=>{h(e.target.value),"ai_generated"===p&&(f("human"),R(!1))},placeholder:"Enter a summary of the call outcome...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm resize-none",rows:4}),"human"!==p&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Summary source: ","ai_generated"===p?"AI-generated (pending confirmation)":"AI-confirmed"]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-md",children:[(0,s.jsx)("input",{type:"checkbox",id:"readback-confirmed",checked:b,onChange:e=>v(e.target.checked),className:"mt-1"}),(0,s.jsxs)("label",{htmlFor:"readback-confirmed",className:"text-sm text-gray-700",children:[(0,s.jsx)("span",{className:"font-medium",children:"Read-back Confirmed"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:"Check if the summary was read back to the customer and they confirmed it was accurate."})]})]}),(0,s.jsx)("div",{className:"p-3 bg-blue-50 border border-blue-100 rounded-md",children:(0,s.jsxs)("p",{className:"text-xs text-blue-700",children:[(0,s.jsx)("strong",{children:"Reminder:"})," You are declaring the outcome. The system records your declaration. AI may assist with summary generation, but you are responsible for verifying accuracy."]})})]}),(0,s.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex gap-2 justify-end",children:[l&&(0,s.jsx)(g.$,{variant:"outline",onClick:()=>A(!1),disabled:I,children:"Cancel"}),(0,s.jsx)(g.$,{onClick:H,disabled:I,className:"bg-primary-600 hover:bg-primary-700 text-white",children:I?"Saving...":l?"Update Outcome":"Declare Outcome"})]})]})}function ea(e){let{callId:t,organizationId:r,onModulationChange:l}=e,{call:i,recording:o,transcript:c,translation:d,manifest:u,score:m,survey:x,transcriptionStatus:h,loading:p,error:b}=function(e){let[t,r]=(0,a.useState)(null),[s,n]=(0,a.useState)(!0),[l,i]=(0,a.useState)(null),o=(0,a.useRef)(null),c=(0,a.useRef)(!0),d=(0,a.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e)return null;try{t&&(n(!0),i(null));let a=await fetch("/api/calls/".concat(encodeURIComponent(e)),{credentials:"include"});if(!a.ok){var s;let t=await fetch("/api/calls/getCallStatus?callId=".concat(encodeURIComponent(e)),{credentials:"include"});if(!t.ok)throw Error("Failed to fetch call details");let a=await t.json(),n={call:a.call||null,recording:a.recording||null,transcript:(null==(s=a.recording)?void 0:s.transcript_json)||null,translation:null,manifest:a.evidence_manifest||null,score:null,survey:null,transcriptionStatus:null};return c.current&&r(n),n}let l=await a.json();return c.current&&r(l),l}catch(e){return c.current&&(i((null==e?void 0:e.message)||"Failed to load call details"),r(null)),null}finally{t&&c.current&&n(!1)}},[e]),u=(0,a.useCallback)(()=>d(!0),[d]);return(0,a.useEffect)(()=>{if(c.current=!0,!e){r(null),n(!1);return}return d(!0).then(e=>{var t;let r=null==e||null==(t=e.call)?void 0:t.status;r&&!D.includes(r)&&(o.current=setInterval(async()=>{var e;let t=await d(!1);(null==t||null==(e=t.call)?void 0:e.status)&&D.includes(t.call.status)&&o.current&&(clearInterval(o.current),o.current=null)},5e3))}),()=>{c.current=!1,o.current&&(clearInterval(o.current),o.current=null)}},[e,d]),{call:(null==t?void 0:t.call)||null,recording:(null==t?void 0:t.recording)||null,transcript:(null==t?void 0:t.transcript)||null,translation:(null==t?void 0:t.translation)||null,manifest:(null==t?void 0:t.manifest)||null,score:(null==t?void 0:t.score)||null,survey:(null==t?void 0:t.survey)||null,transcriptionStatus:(null==t?void 0:t.transcriptionStatus)||null,loading:s,error:l,refetch:u}}(t),{config:v}=(0,n.g)(r),{toast:j}=(0,M.dj)(),[y,N]=(0,a.useState)(!1),[w,k]=(0,a.useState)(null),[C,_]=(0,a.useState)(!1),S=(0,a.useCallback)(async()=>{if(t){_(!0);try{let e=await fetch("/api/calls/".concat(t,"/outcome"),{method:"GET",credentials:"include"});if(e.ok){let t=await e.json();t.success&&t.data.outcome&&k(t.data.outcome)}}catch(e){console.debug("No existing outcome found")}finally{_(!1)}}},[t]);(0,a.useEffect)(()=>{t&&(null==i?void 0:i.status)==="completed"?S():k(null)},[t,null==i?void 0:i.status,S]);let E=(0,a.useCallback)(e=>{k(e),j({title:"Outcome Declared",description:"Call outcome has been recorded successfully"})},[j]);async function A(){if(t)try{N(!0);let e=await fetch("/api/calls/".concat(t,"/export"),{method:"GET",credentials:"include"});if(!e.ok){let t=await e.json().catch(()=>({error:"Export failed"}));throw Error(t.error||"Failed to export evidence")}let r=await e.blob(),s=window.URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.download="evidence-".concat(t.slice(0,8),".zip"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),j({title:"Evidence Downloaded",description:"Complete evidence bundle exported successfully"})}catch(e){j({title:"Export Failed",description:(null==e?void 0:e.message)||"Failed to download evidence bundle",variant:"destructive"})}finally{N(!1)}}if(!t)return(0,s.jsx)("div",{className:"flex items-center justify-center py-12 text-gray-400",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,s.jsx)("p",{className:"text-sm",children:"Select a call to view details"})]})});if(p)return(0,s.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("span",{className:"ml-3 text-gray-500",children:"Loading call details..."})]});if(b)return(0,s.jsxs)("div",{className:"p-4 bg-error-light border border-red-200 rounded-md text-error",children:["Error: ",b]});if(!i)return(0,s.jsx)("div",{className:"p-4 bg-gray-50 rounded-md text-gray-500 text-center",children:"Call not found"});let I="completed"===i.status?"success":"failed"===i.status||"no-answer"===i.status||"busy"===i.status?"error":(i.status,"default");return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("section",{"aria-labelledby":"call-header",className:"p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{id:"call-header",className:"text-lg font-semibold text-gray-900 mb-2",children:"Call Details"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status:"}),(0,s.jsx)(f.E,{variant:I,children:i.status||"unknown"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-400 font-mono",children:["ID: ",i.id.slice(0,8),"..."]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wide",children:"Duration"}),(0,s.jsx)("div",{className:"text-lg font-mono text-gray-900 tabular-nums",children:((e,t)=>{if(!e)return"—";if(!t)return"In progress...";let r=new Date(e),s=Math.floor((new Date(t).getTime()-r.getTime())/1e3),a=Math.floor(s/60);return"".concat(a,":").concat((s%60).toString().padStart(2,"0"))})(i.started_at,i.ended_at)}),m&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wide",children:"Score"}),(0,s.jsxs)(f.E,{variant:m.score>=80?"success":m.score>=60?"warning":"error",children:[m.score,"%"]})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm border-t border-gray-100 pt-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Started"}),(0,s.jsx)("div",{className:"text-gray-900",children:i.started_at?new Date(i.started_at).toLocaleString():"—"})]}),i.ended_at&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Ended"}),(0,s.jsx)("div",{className:"text-gray-900",children:new Date(i.ended_at).toLocaleString()})]})]})]}),(0,s.jsxs)("section",{"aria-label":"Quick actions",className:"flex flex-wrap gap-2",children:["completed"===i.status&&(0,s.jsx)(R(),{href:"/review?callId=".concat(i.id),children:(0,s.jsxs)(g.$,{variant:"outline",size:"sm",className:"gap-1.5",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Review Evidence"]})}),"completed"===i.status&&(0,s.jsx)(g.$,{variant:"outline",size:"sm",className:"gap-1.5",onClick:A,disabled:y,children:y?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Exporting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download Evidence"]})}),(null==o?void 0:o.recording_url)&&(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>{var e;null==(e=document.getElementById("artifact-recording"))||e.scrollIntoView({behavior:"smooth"})},className:"gap-1.5",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),"Recording"]}),c&&(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>{var e;null==(e=document.getElementById("artifact-transcript"))||e.scrollIntoView({behavior:"smooth"})},className:"gap-1.5",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Transcript"]}),(null==c?void 0:c.sentiment_analysis)&&(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>{var e;null==(e=document.getElementById("call-analytics"))||e.scrollIntoView({behavior:"smooth"})},className:"gap-1.5",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Analytics"]}),u&&(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>{var e;null==(e=document.getElementById("artifact-manifest"))||e.scrollIntoView({behavior:"smooth"})},className:"gap-1.5",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),"Manifest"]})]}),["completed","failed","no-answer","busy","in_progress"].includes(i.status||"")&&r&&(0,s.jsx)("section",{"aria-label":"Outcome Declaration",children:(0,s.jsx)(es,{callId:i.id,organizationId:r,callCompleted:["completed","failed","no-answer","busy"].includes(i.status||""),existingOutcome:w,onOutcomeSaved:E,enableAISummary:!0})}),c&&(c.sentiment_analysis||c.entities||c.chapters)&&(0,s.jsx)("section",{id:"call-analytics","aria-label":"Call Analytics",children:(0,s.jsx)(Z,{transcriptJson:c})}),r&&(0,s.jsxs)("section",{"aria-labelledby":"modulations-used",className:"p-4 bg-white rounded-md border border-gray-200",children:[(0,s.jsx)("h3",{id:"modulations-used",className:"text-sm font-semibold text-gray-900 mb-3",children:"Features Used for This Call"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[(0,s.jsx)(en,{label:"Recording",enabled:null==v?void 0:v.record}),(0,s.jsx)(en,{label:"Transcribe",enabled:null==v?void 0:v.transcribe}),(0,s.jsx)(en,{label:"Translate",enabled:null==v?void 0:v.translate}),(0,s.jsx)(en,{label:"Survey",enabled:null==v?void 0:v.survey}),(0,s.jsx)(en,{label:"Shopper",enabled:null==v?void 0:v.synthetic_caller})]}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-3 italic",children:"These are the features that were active when this call was placed."})]}),(0,s.jsx)(X,{callId:i.id,recording:o,transcript:c,translation:d,manifest:u,score:m,survey:x,transcriptionStatus:h})]})}function en(e){let{label:t,enabled:r}=e;return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[r?(0,s.jsx)("svg",{className:"w-4 h-4 text-success",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3"})}),(0,s.jsx)("span",{className:"text-xs text-gray-600",children:t})]})}function el(e){let{children:t,className:r="",label:a,error:n,hint:l,id:i,...o}=e,c=i||"select-".concat(Math.random().toString(36).substring(2,11)),d=n?"".concat(c,"-error"):void 0,u=l&&!n?"".concat(c,"-hint"):void 0;return(0,s.jsxs)("div",{className:"w-full",children:[a&&(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",htmlFor:c,children:a}),(0,s.jsx)("select",{id:c,className:"w-full h-10 px-3 bg-white border rounded-md text-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-0 transition-colors duration-150 disabled:bg-gray-50 disabled:text-gray-500 disabled:cursor-not-allowed ".concat(n?"border-error focus:ring-error focus:border-error":"border-gray-300 focus:ring-primary-600 focus:border-primary-600"," ").concat(r),"aria-invalid":n?"true":void 0,"aria-describedby":n?d:l?u:void 0,...o,children:t}),l&&!n&&(0,s.jsx)("p",{id:u,className:"mt-1.5 text-sm text-gray-500",children:l}),n&&(0,s.jsx)("p",{id:d,className:"mt-1.5 text-sm text-error",role:"alert",children:n})]})}function ei(e){let{open:t,onOpenChange:r,title:n,children:l,footer:i}=e,o=(0,a.useRef)(null);return((0,a.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&r(!1)},s=e=>{o.current&&!o.current.contains(e.target)&&r(!1)};return document.addEventListener("keydown",e),document.addEventListener("mousedown",s),()=>{document.removeEventListener("keydown",e),document.removeEventListener("mousedown",s)}},[t,r]),t)?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",role:"dialog","aria-modal":"true","aria-labelledby":n?"dialog-title":void 0,children:(0,s.jsxs)("div",{ref:o,className:"bg-slate-900 border border-slate-800 rounded-lg shadow-lg max-w-lg w-full mx-4 max-h-[90vh] overflow-auto",children:[n&&(0,s.jsx)("div",{className:"px-6 py-4 border-b border-slate-800",children:(0,s.jsx)("h2",{id:"dialog-title",className:"text-lg font-semibold text-slate-100",children:n})}),(0,s.jsx)("div",{className:"px-6 py-4",children:l}),i&&(0,s.jsx)("div",{className:"px-6 py-4 border-t border-slate-800 flex justify-end gap-2",children:i})]})}):null}function eo(e){let{organizationId:t}=e,{config:r,loading:l,updateConfig:i}=(0,n.g)(t),{role:o}=(0,p.e)(t),{toast:c}=(0,M.dj)(),{targetNumber:d,setTargetNumber:u}=m(),[x,h]=(0,a.useState)([]),[f,b]=(0,a.useState)([]),[j,y]=(0,a.useState)(!0),[N,w]=(0,a.useState)(!1),[k,C]=(0,a.useState)(!1),[_,S]=(0,a.useState)({phone_number:"",name:""}),[E,A]=(0,a.useState)(""),[I,T]=(0,a.useState)(!1),[L,z]=(0,a.useState)(!1),F=(0,a.useRef)(null),R=(0,a.useRef)(null),D="owner"===o||"admin"===o;(0,a.useEffect)(()=>{t&&e();async function e(){if(t)try{y(!0);let[e,r]=await Promise.all([fetch("/api/voice/targets?orgId=".concat(encodeURIComponent(t)),{credentials:"include"}),fetch("/api/campaigns?orgId=".concat(encodeURIComponent(t)),{credentials:"include"})]);if(e.ok){let t=await e.json();h(t.targets||[])}if(r.ok){let e=await r.json();b(e.campaigns||[])}}catch(e){b([]),h([])}finally{y(!1)}}},[t]),(0,a.useEffect)(()=>{function e(e){R.current&&!R.current.contains(e.target)&&F.current&&!F.current.contains(e.target)&&T(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let O=x.filter(e=>{var t;return e.is_active&&(e.phone_number.includes(d)||(null==(t=e.name)?void 0:t.toLowerCase().includes(d.toLowerCase())))}).slice(0,5),P=e=>/^\+[1-9]\d{1,14}$/.test(e),B=P(d),W=e=>{let t=e.replace(/[^\d+]/g,"");return t.length>0&&!t.startsWith("+")&&(t.startsWith("1")&&t.length>10&&(t=t.slice(1)),t="+1"+t),t};async function q(){if(t&&D){if(!P(_.phone_number))return void c({title:"Invalid phone number",description:"Phone number must be in E.164 format (e.g., +12025551234)",variant:"destructive"});try{w(!0);let r=await fetch("/api/voice/targets",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({organization_id:t,phone_number:_.phone_number,name:_.name||void 0})}),s=await r.json();if(s.success&&s.target)h([...x,s.target]),0===x.length&&await i({target_id:s.target.id}),C(!1),S({phone_number:"",name:""}),c({title:"Target saved",description:"Added ".concat(s.target.phone_number," to your targets.")});else{var e;throw Error((null==(e=s.error)?void 0:e.message)||s.error||"Failed to add target")}}catch(e){c({title:"Error",description:(null==e?void 0:e.message)||"Failed to add target",variant:"destructive"})}finally{w(!1)}}}return j||l?(0,s.jsx)("div",{className:"p-4 bg-white rounded-lg border border-[#E5E5E5]",children:(0,s.jsxs)("div",{className:"animate-pulse space-y-3",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),(0,s.jsx)("div",{className:"h-10 bg-gray-200 rounded"})]})}):(0,s.jsxs)("section",{"aria-labelledby":"target-campaign-selector",className:"w-full p-4 bg-white rounded-lg border border-[#E5E5E5] shadow-sm","data-tour":"target-selector",children:[(0,s.jsx)("h3",{id:"target-campaign-selector",className:"text-base font-semibold text-[#333333] mb-1",children:"Who are you calling?"}),(0,s.jsx)("p",{className:"text-xs text-[#666666] mb-4",children:"Enter a phone number or select from recent targets"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-[#333333] mb-1.5",children:["Phone Number to Call ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-lg text-gray-400",children:"+"}),(0,s.jsx)("input",{ref:F,type:"tel",inputMode:"tel",autoComplete:"off",value:d,onChange:e=>{var t;let r;return r=t=e.target.value,void(/^\d{10,}$/.test(t.replace(/\D/g,""))&&!t.startsWith("+")&&(r=W(t)),u(r),T(r.length>0&&O.length>0),P(r)&&i({quick_dial_number:r,target_id:null}))},onBlur:()=>{if(d&&!d.startsWith("+")){let e=W(d);u(e),P(e)&&i({quick_dial_number:e,target_id:null})}},onFocus:()=>T(d.length>0&&O.length>0),onKeyDown:e=>{if("Enter"===e.key){var t;e.preventDefault(),null==(t=F.current)||t.blur()}},placeholder:"(202) 555-1234 or +12025551234",className:"\n                w-full pl-10 pr-4 py-3 text-lg font-mono rounded-lg border-2 transition-all\n                focus:outline-none focus:ring-2 focus:ring-offset-1\n                ".concat(B?"border-green-400 focus:ring-green-300 bg-green-50":d.length>0?"border-amber-300 focus:ring-amber-200":"border-gray-200 focus:ring-primary-300 focus:border-primary-400","\n              "),"aria-describedby":"target-hint","aria-expanded":I,"aria-autocomplete":"list"}),B&&(0,s.jsx)("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-green-500",children:"✓"})]}),I&&O.length>0&&(0,s.jsxs)("div",{ref:R,className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 px-3 py-1.5 bg-gray-50 border-b",children:"Recent Targets"}),O.map(e=>(0,s.jsxs)("button",{type:"button",onClick:()=>{u(e.phone_number),T(!1),i({target_id:e.id,quick_dial_number:null}),c({title:"Target selected",description:e.name?"".concat(e.name," (").concat(e.phone_number,")"):e.phone_number})},className:"w-full px-3 py-2 text-left hover:bg-primary-50 transition-colors flex items-center justify-between group",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-mono text-gray-900",children:e.phone_number}),e.name&&(0,s.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:e.name})]}),(0,s.jsx)("span",{className:"text-xs text-primary-600 opacity-0 group-hover:opacity-100",children:"Select"})]},e.id))]}),(0,s.jsx)("p",{id:"target-hint",className:"text-xs text-[#666666] mt-1",children:d&&!B?"Include + and country code (e.g., +1 for US)":"E.164 format with country code"})]}),B&&(0,s.jsxs)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,s.jsxs)("div",{className:"text-sm text-green-800 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-lg",children:"✓"}),(0,s.jsxs)("span",{children:["Ready to call ",(0,s.jsx)("span",{className:"font-mono font-bold",children:d})]})]}),E&&P(E)&&(0,s.jsxs)("div",{className:"text-xs text-green-700 mt-1 ml-6",children:["Bridge call via ",E]})]}),(0,s.jsxs)("details",{className:"group border border-gray-200 rounded-lg",open:L,onToggle:e=>z(e.target.open),children:[(0,s.jsxs)("summary",{className:"px-4 py-3 cursor-pointer text-sm font-medium text-gray-600 hover:text-gray-800 flex items-center justify-between list-none",children:[(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-gray-400 group-open:rotate-90 transition-transform",children:"▶"}),"Advanced Options"]}),(E||(null==r?void 0:r.campaign_id))&&(0,s.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-0.5 rounded",children:[E?"Bridge":"",(null==r?void 0:r.campaign_id)?"Campaign":""].filter(Boolean).join(" + ")})]}),(0,s.jsxs)("div",{className:"px-4 pb-4 space-y-4 border-t border-gray-100 pt-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-[#333333]",children:"Call me first at"}),(0,s.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:"Bridge Call"})]}),(0,s.jsx)(v.p,{type:"tel",inputMode:"tel",autoComplete:"off",value:E,onChange:e=>{var t;A(t=e.target.value),(!t||P(t))&&i({from_number:t||null})},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.target.blur())},placeholder:"+12025551234",className:"font-mono"}),(0,s.jsxs)("p",{className:"text-xs text-[#666666] mt-1.5 leading-relaxed",children:[(0,s.jsx)("strong",{children:"How it works:"})," We'll call your phone first. When you answer, we connect you to the target number. This keeps you in control and ensures the call is recorded from your end."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(el,{label:"Campaign",value:(null==r?void 0:r.campaign_id)||"",onChange:e=>{D&&i({campaign_id:e.target.value||null})},disabled:!D,children:[(0,s.jsx)("option",{value:"",children:"None (single call)"}),f.filter(e=>e.is_active).map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsx)("p",{className:"text-xs text-[#666666] mt-1",children:"Group calls under a campaign for reporting"})]}),D&&d&&B&&(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>{S({phone_number:d,name:""}),C(!0)},className:"w-full",children:["\uD83D\uDCBE Save ",d," to Targets"]})]})]}),!D&&(0,s.jsx)("p",{className:"text-xs text-[#666666] italic",children:"Only Owners and Admins can modify target settings."})]}),(0,s.jsxs)(ei,{open:k,onOpenChange:C,title:"Save Target",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(v.p,{label:"Phone Number",type:"tel",value:_.phone_number,onChange:e=>S({..._,phone_number:e.target.value}),placeholder:"+12025551234",required:!0}),(0,s.jsx)(v.p,{label:"Name (makes it easier to find later)",value:_.name,onChange:e=>S({..._,name:e.target.value}),placeholder:"e.g., Main Support Line"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,s.jsx)(g.$,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),(0,s.jsx)(g.$,{onClick:q,disabled:N||!_.phone_number,children:N?"Saving...":"Save Target"})]})]})]})}function ec(e){let{organizationId:t,onCallPlaced:r}=e,{role:l}=(0,p.e)(t),i=(0,p.J)(t,"call","execute"),{config:o,updateConfig:c}=(0,n.g)(t),{toast:d}=(0,M.dj)(),{updates:u,connected:m}=(0,L.x)(t),[x,h]=(0,a.useState)(!1),[b,v]=(0,a.useState)(null),[j,y]=(0,a.useState)(null),[N,w]=(0,a.useState)(0),k=(0,a.useRef)(!1),C=(0,a.useRef)(null);(0,a.useEffect)(()=>{function e(e){let t=e.detail;if(null==t?void 0:t.targetNumber){var r,s;C.current=t,c({quick_dial_number:t.targetNumber,from_number:t.fromNumber||null,record:null==(r=t.record)||r,transcribe:null==(s=t.transcribe)||s})}}return window.addEventListener("onboarding:complete",e),()=>{window.removeEventListener("onboarding:complete",e)}},[c]),(0,a.useEffect)(()=>{if(C.current&&(null==o?void 0:o.quick_dial_number)===C.current.targetNumber){let e=setTimeout(()=>{C.current=null,A()},100);return()=>clearTimeout(e)}},[null==o?void 0:o.quick_dial_number]),(0,a.useEffect)(()=>{b&&u.length&&u.forEach(e=>{var t;if("calls"===e.table&&(null==(t=e.new)?void 0:t.id)===b){let t=e.new.status;y(t),("completed"===t||"failed"===t||"no-answer"===t||"busy"===t)&&(v(null),w(0))}})},[u,b]),(0,a.useEffect)(()=>{if(!b||"in_progress"!==j)return;let e=setInterval(()=>{w(e=>e+1)},1e3);return()=>clearInterval(e)},[b,j]);let _=(null==o?void 0:o.target_id)||(null==o?void 0:o.quick_dial_number),S=(null==o?void 0:o.quick_dial_number)||((null==o?void 0:o.target_id)?"Target: ".concat(o.target_id.slice(0,8),"..."):null),E=(null==o?void 0:o.from_number)||null;async function A(){if(!k.current){if(!t||!i||!_)return void d({title:"Cannot place call",description:"Enter a phone number or select a target first",variant:"destructive"});try{k.current=!0,h(!0),y("initiating");let a={organization_id:t,campaign_id:o.campaign_id||null,modulations:{record:o.record||!1,transcribe:o.transcribe||!1,translate:o.translate||!1,survey:o.survey||!1,synthetic_caller:o.synthetic_caller||!1}};o.quick_dial_number?a.to_number=o.quick_dial_number:o.target_id&&(a.target_id=o.target_id),o.from_number&&(a.from_number=o.from_number,a.flow_type="bridge");let n=await fetch("/api/voice/call",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)});if(!n.ok){var e,s;let t=await n.json().catch(()=>({error:"Failed to place call"})),r="object"==typeof t.error?(null==(e=t.error)?void 0:e.message)||(null==(s=t.error)?void 0:s.code)||JSON.stringify(t.error):t.error||"Failed to place call";throw Error(r)}let l=(await n.json()).call_id;v(l),y("ringing"),w(0),null==r||r(l),d({title:"Call placed",description:"Call ".concat(l.slice(0,8),"... is being initiated")})}catch(e){y(null),d({title:"Error",description:(null==e?void 0:e.message)||"Failed to place call",variant:"destructive"})}finally{h(!1),k.current=!1}}}null==o||o.from_number;let I="completed"===j?"success":"failed"===j||"no-answer"===j||"busy"===j?"error":"in_progress"===j?"success":"ringing"===j?"warning":"default";return i?(0,s.jsx)("section",{className:"bg-white rounded-md border border-gray-200 p-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[_&&(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,s.jsx)("span",{className:"font-medium",children:"Calling:"})," ",(0,s.jsx)("span",{className:"font-mono",children:S})]}),E&&(0,s.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["Agent phone: ",(0,s.jsx)("span",{className:"font-mono",children:E}),(0,s.jsx)("span",{className:"text-xs ml-2",children:"(bridge call)"})]})]}),(0,s.jsx)(g.$,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),A()},disabled:x||!_||null!==b,variant:"primary",size:"lg",className:"w-full h-14 text-base","aria-label":"Place call",children:x?(0,s.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,s.jsxs)("svg",{className:"w-5 h-5 animate-spin",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Placing Call..."]}):b?"Call in Progress":"Place Call"}),b&&j&&(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Status"}),(0,s.jsx)(f.E,{variant:I,children:j})]}),"in_progress"===j&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Duration"}),(0,s.jsx)("span",{className:"text-sm font-mono text-gray-900",children:(e=>{let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))})(N)})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-400",children:["ID: ",b.slice(0,8),"..."]}),!m&&(0,s.jsx)("div",{className:"mt-2 text-xs text-warning",children:"Real-time updates disconnected"})]}),!_&&(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Enter a phone number above to place a call"})]})}):(0,s.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Only Owners, Admins, and Operators can place calls."})})}a.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:"".concat(r||""),...n,children:a})}).displayName="DialogContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:"flex flex-col space-y-1.5 text-center sm:text-left ".concat(r||""),...a})}).displayName="DialogHeader",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 ".concat(r||""),...a})}).displayName="DialogFooter",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h2",{ref:t,className:"text-lg font-semibold leading-none tracking-tight ".concat(r||""),...a})}).displayName="DialogTitle",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:"text-sm text-muted-foreground ".concat(r||""),...a})}).displayName="DialogDescription";let ed=function(e){let{organizationId:t,onCallPlaced:r}=e,l=c(),{config:i}=(0,n.g)(t),{toast:o}=(0,M.dj)(),{targetNumber:d,isValid:u}=m(),{connect:x,disconnect:h,makeCall:p,hangUp:b,mute:v,unmute:j,status:y,callState:N,currentCall:w,isMuted:k,quality:C,error:_}=l;(0,a.useEffect)(()=>{},[y,t]),(0,a.useEffect)(()=>{_&&o({title:"WebRTC Error",description:_,variant:"destructive"})},[_,o]);let S=(null==i?void 0:i.quick_dial_number)||(null==i?void 0:i.target_id),E=(null==i?void 0:i.quick_dial_number)||((null==i?void 0:i.target_id)?"Target: ".concat(i.target_id.slice(0,8),"..."):null),A=(0,a.useCallback)(async()=>{try{await x(),o({title:"Connected",description:"WebRTC is ready for browser calling"})}catch(e){o({title:"Connection Failed",description:(null==e?void 0:e.message)||"Could not connect to WebRTC",variant:"destructive"})}},[x,o]),I=(0,a.useCallback)(async()=>{try{await h(),o({title:"Disconnected",description:"WebRTC session ended"})}catch(e){}},[h,o]),T=(0,a.useCallback)(async()=>{if(!u)return void o({title:"Invalid phone number",description:"Please enter a valid phone number in E.164 format (starts with +)",variant:"destructive"});console.log("[WebRTCCallControls] Attempting call with:",{phoneNumber:d,hasValidNumber:u});try{await p(d),(null==w?void 0:w.id)&&(null==r||r(w.id))}catch(e){o({title:"Call Failed",description:(null==e?void 0:e.message)||"Could not place call",variant:"destructive"})}},[u,d,i,p,w,r,o]),L=(0,a.useCallback)(async()=>{try{await b()}catch(e){}},[b]);return"disconnected"===y||"error"===y?(0,s.jsx)("section",{className:"bg-white rounded-md border border-gray-200 p-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mb-3",children:(0,s.jsx)("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"})})}),(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"Browser Calling"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-4",children:"Connect to enable calling from your browser using your computer's microphone."})]}),(0,s.jsxs)(g.$,{onClick:A,variant:"primary",size:"lg",className:"w-full h-14 text-base",children:[(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"})}),"Connect Microphone"]}),_&&(0,s.jsx)("p",{className:"text-sm text-error text-center",children:_})]})}):"initializing"===y||"connecting"===y?(0,s.jsx)("section",{className:"bg-white rounded-md border border-gray-200 p-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-primary-50 flex items-center justify-center mb-3 animate-pulse",children:(0,s.jsxs)("svg",{className:"w-6 h-6 text-primary-500 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"Connecting..."}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Requesting microphone access and connecting to SignalWire"})]})}):(0,s.jsx)("section",{className:"bg-white rounded-md border border-gray-200 p-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-success animate-pulse"}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Browser connected"})]}),(0,s.jsx)("button",{onClick:I,className:"text-xs text-gray-500 hover:text-gray-700 underline",children:"Disconnect"})]}),S&&"idle"===N&&(0,s.jsx)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200",children:(0,s.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,s.jsx)("span",{className:"font-medium",children:"Calling:"})," ",(0,s.jsx)("span",{className:"font-mono",children:E})]})}),w&&(0,s.jsxs)("div",{className:"p-4 bg-success-light rounded-md border border-success/20",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-success-dark",children:"Active Call"}),(0,s.jsx)(f.E,{variant:"success",children:N})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 font-mono",children:w.phone_number}),(0,s.jsx)("span",{className:"text-lg font-mono text-gray-900 tabular-nums",children:(e=>{let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))})(w.duration)})]}),C&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-success/10 grid grid-cols-2 gap-2 text-xs",children:[C.audio_bitrate&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Bitrate:"})," ",(0,s.jsxs)("span",{className:"font-mono",children:[Math.round(C.audio_bitrate/1e3),"kbps"]})]}),void 0!==C.packet_loss_percent&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Loss:"})," ",(0,s.jsxs)("span",{className:"font-mono",children:[C.packet_loss_percent.toFixed(1),"%"]})]})]})]}),"idle"===N&&(0,s.jsxs)(g.$,{onClick:T,disabled:!u,variant:"primary",size:"lg",className:"w-full h-14 text-base",children:[(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"})}),"Place Call (Browser)"]}),("dialing"===N||"ringing"===N)&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-3 py-4",children:[(0,s.jsx)("svg",{className:"w-8 h-8 text-primary-500 animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"})}),(0,s.jsx)("span",{className:"text-lg font-medium text-gray-700",children:"dialing"===N?"Dialing...":"Ringing..."})]}),(0,s.jsx)(g.$,{onClick:L,variant:"outline",size:"lg",className:"w-full border-error text-error hover:bg-error-light",children:"Cancel"})]}),"active"===N&&(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsxs)(g.$,{onClick:k?j:v,variant:"outline",size:"lg",className:"flex flex-col items-center py-4 ".concat(k?"bg-warning-light border-warning":""),children:[k?(0,s.jsx)("svg",{className:"w-6 h-6 mb-1 text-warning",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 9.75L19.5 12m0 0l2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6l4.72-4.72a.75.75 0 011.28.531V19.94a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.506-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.395C2.806 8.757 3.63 8.25 4.51 8.25H6.75z"})}):(0,s.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"})}),(0,s.jsx)("span",{className:"text-xs",children:k?"Unmute":"Mute"})]}),(0,s.jsxs)(g.$,{onClick:L,variant:"outline",size:"lg",className:"flex flex-col items-center py-4 border-error text-error hover:bg-error-light",children:[(0,s.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 3.75L18 6m0 0l2.25 2.25M18 6l2.25-2.25M18 6l-2.25 2.25m-12 8.25c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"})}),(0,s.jsx)("span",{className:"text-xs",children:"End"})]}),(0,s.jsxs)(g.$,{variant:"outline",size:"lg",className:"flex flex-col items-center py-4 opacity-50",disabled:!0,children:[(0,s.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"})}),(0,s.jsx)("span",{className:"text-xs",children:"More"})]})]}),!u&&"idle"===N&&(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Enter a phone number above to place a call"})]})})};function eu(e){let{mode:t,onModeChange:r,webrtcStatus:a,disabled:n=!1}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide font-medium",children:"Calling Mode"}),"browser"===t&&a&&(0,s.jsx)(f.E,{variant:"connected"===a||"on_call"===a?"success":"connecting"===a||"initializing"===a?"warning":"error"===a?"error":"default",className:"text-xs",children:a})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("button",{onClick:()=>r("phone"),disabled:n,className:"\n            flex flex-col items-center justify-center p-3 rounded-md border-2 transition-all\n            ".concat("phone"===t?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300 hover:bg-gray-50","\n            ").concat(n?"opacity-50 cursor-not-allowed":"cursor-pointer","\n          "),"aria-pressed":"phone"===t,children:[(0,s.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"})}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Phone"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 mt-0.5",children:"Rings your phone"})]}),(0,s.jsxs)("button",{onClick:()=>r("browser"),disabled:n,className:"\n            flex flex-col items-center justify-center p-3 rounded-md border-2 transition-all\n            ".concat("browser"===t?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300 hover:bg-gray-50","\n            ").concat(n?"opacity-50 cursor-not-allowed":"cursor-pointer","\n          "),"aria-pressed":"browser"===t,children:[(0,s.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"})}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Browser"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 mt-0.5",children:"Uses headset"})]})]}),"browser"===t&&(0,s.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Browser calling uses your computer's microphone and speakers. Make sure to grant microphone permission when prompted."})]})}var em=r(1719);function ex(e){let{children:t,className:r="",...a}=e;return(0,s.jsx)("label",{className:"text-sm font-medium ".concat(r),...a,children:t})}var eh=r(7235);let ep={recording:["pro","insights","global","business","enterprise","standard","active"],transcription:["pro","insights","global","business","enterprise","standard","active"],translation:["global","business","enterprise"],real_time_translation_preview:["business","enterprise"],survey:["insights","global","business","enterprise"],secret_shopper:["insights","global","business","enterprise"],booking:["business","enterprise"],voice_cloning:["business","enterprise"]},eg=[{key:"record",label:"Source Recording",desc:"Immutable call audio (never modified)",feature:"recording",plan:"Pro+",badge:"Authoritative"},{key:"transcribe",label:"Canonical Transcript",desc:"AssemblyAI authoritative transcript (evidence-grade)",feature:"transcription",plan:"Pro+",badge:"Authoritative"},{key:"translate",label:"Post-Call Translation",desc:"Authoritative translation from canonical transcript",feature:"translation",plan:"Global+",badge:"Authoritative"},{key:"survey",label:"After-Call Survey",desc:"Automated survey with AI Survey Bot",feature:"survey",plan:"Insights+",badge:"Authoritative"},{key:"synthetic_caller",label:"Secret Shopper",desc:"AI caller with scoring",feature:"secret_shopper",plan:"Insights+",badge:"Authoritative"}],ef=[{value:"scale_1_5",label:"Scale 1-5"},{value:"scale_1_10",label:"Scale 1-10"},{value:"yes_no",label:"Yes/No"},{value:"multiple_choice",label:"Multiple Choice"},{value:"open_ended",label:"Open-ended"}],eb=[{code:"en",label:"English"},{code:"es",label:"Spanish"},{code:"fr",label:"French"}];function ev(e){var t,r,l,i,o;let{callId:c,organizationId:d,initialModulations:u,onChange:m}=e,{role:x,plan:h,loading:g}=(0,p.e)(d),{config:b,updateConfig:v,loading:j}=(0,n.g)(d),{capabilities:y}=function(e){let[t,r]=(0,a.useState)({}),[s,n]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{if(!e){r({}),n(!1);return}let t=!0;return n(!0),fetch("/api/call-capabilities?orgId=".concat(encodeURIComponent(e)),{credentials:"include"}).then(e=>e.json()).then(e=>{t&&(e.success&&e.capabilities?r(e.capabilities):r({}),n(!1))}).catch(()=>{t&&(r({}),n(!1))}),()=>{t=!1}},[e]),{capabilities:t,loading:s}}(d),N=(null==b?void 0:b.survey_prompts)||[],w="object"==typeof(null==b?void 0:b.survey_prompts_locales)&&(null==b?void 0:b.survey_prompts_locales)?b.survey_prompts_locales:{},k=w.en||N,C=Array.isArray(null==b?void 0:b.survey_question_types)?null==b?void 0:b.survey_question_types:[],_=b&&!j?{record:null!=(t=b.record)&&t,transcribe:null!=(r=b.transcribe)&&r,translate:null!=(l=b.translate)&&l,survey:null!=(i=b.survey)&&i,synthetic_caller:null!=(o=b.synthetic_caller)&&o}:u,[S,E]=(0,a.useState)(()=>({..._})),[A,I]=(0,a.useState)(()=>({record:!1,transcribe:!1,translate:!1,survey:!1,synthetic_caller:!1})),[T,L]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(b&&!j){var e,t,r,s,a;E({record:null!=(e=b.record)&&e,transcribe:null!=(t=b.transcribe)&&t,translate:null!=(r=b.translate)&&r,survey:null!=(s=b.survey)&&s,synthetic_caller:null!=(a=b.synthetic_caller)&&a})}else j||E({...u})},[b,j,u]);let z="owner"===x||"admin"===x;async function F(e){if(!z)return void L("Only Owners and Admins can modify settings");L(null);let t={...S},r={...S,[e]:!S[e]};E(r),I(t=>({...t,[e]:!0}));try{await v({[e]:r[e]}),await m(r)}catch(e){var s;E(t),L(null!=(s=null==e?void 0:e.message)?s:"Update failed")}finally{I(t=>({...t,[e]:!1}))}}return(0,s.jsxs)("div",{className:"space-y-3",children:[eg.map(e=>{let{disabled:t,reason:r}=function(e,t){if(g)return{disabled:!0,reason:"Loading..."};if(!h)return{disabled:!0,reason:"Plan not available"};if(!function(e,t){let r=e.toLowerCase(),s=ep[t];return!s||s.includes(r)}(h,t)){var r;return{disabled:!0,reason:"Requires ".concat((null==(r=eg.find(t=>t.key===e))?void 0:r.plan)||"upgrade")}}return z||"record"===e||"transcribe"===e?{disabled:!1}:{disabled:!0,reason:"Owner/Admin only"}}(e.key,e.feature),a=S[e.key],n="translate"===e.key&&!0===y.real_time_translation_preview,l=n?"Live Translation":e.label,i=n?"Real-time assist (preview only, not recorded)":e.desc,o=n?"Preview":e.badge;return(0,s.jsxs)("div",{className:"p-3 bg-gray-50 rounded-md border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ex,{htmlFor:"mod-".concat(e.key),className:"text-sm font-medium text-gray-900",children:l}),(0,s.jsx)(f.E,{variant:"Authoritative"===o?"success":"warning",children:o}),t&&r&&(0,s.jsx)("span",{className:"text-xs text-gray-400",children:r})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:i})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 ml-4",children:[(0,s.jsx)(eh.d,{id:"mod-".concat(e.key),checked:a,onCheckedChange:()=>!t&&!A[e.key]&&F(e.key),disabled:t||A[e.key],"aria-label":e.label}),(0,s.jsx)("span",{className:"text-xs w-10 text-right tabular-nums ".concat(A[e.key]?"text-gray-400":a?"text-success font-medium":"text-gray-400"),children:A[e.key]?"...":a?"On":"Off"})]})]}),"translate"===e.key&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)(el,{label:"From Language",value:(null==b?void 0:b.translate_from)||"",onChange:e=>v({translate_from:e.target.value||void 0}),disabled:!z,hint:a?void 0:"Select before enabling",children:[(0,s.jsx)("option",{value:"",children:"Select..."}),(0,s.jsx)("option",{value:"en",children:"English"}),(0,s.jsx)("option",{value:"es",children:"Spanish"}),(0,s.jsx)("option",{value:"fr",children:"French"}),(0,s.jsx)("option",{value:"de",children:"German"}),(0,s.jsx)("option",{value:"zh",children:"Chinese"}),(0,s.jsx)("option",{value:"ja",children:"Japanese"}),(0,s.jsx)("option",{value:"pt",children:"Portuguese"}),(0,s.jsx)("option",{value:"it",children:"Italian"}),(0,s.jsx)("option",{value:"ko",children:"Korean"}),(0,s.jsx)("option",{value:"ar",children:"Arabic"})]}),(0,s.jsxs)(el,{label:"To Language",value:(null==b?void 0:b.translate_to)||"",onChange:e=>v({translate_to:e.target.value||void 0}),disabled:!z,hint:a?void 0:"Select before enabling",children:[(0,s.jsx)("option",{value:"",children:"Select..."}),(0,s.jsx)("option",{value:"en",children:"English"}),(0,s.jsx)("option",{value:"es",children:"Spanish"}),(0,s.jsx)("option",{value:"fr",children:"French"}),(0,s.jsx)("option",{value:"de",children:"German"}),(0,s.jsx)("option",{value:"zh",children:"Chinese"}),(0,s.jsx)("option",{value:"ja",children:"Japanese"}),(0,s.jsx)("option",{value:"pt",children:"Portuguese"}),(0,s.jsx)("option",{value:"it",children:"Italian"}),(0,s.jsx)("option",{value:"ko",children:"Korean"}),(0,s.jsx)("option",{value:"ar",children:"Arabic"})]})]}),!a&&(!(null==b?void 0:b.translate_from)||!(null==b?void 0:b.translate_to))&&(0,s.jsx)("p",{className:"text-xs text-warning",children:"Select both languages before enabling translation"}),a&&(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white rounded border border-gray-200",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Voice Cloning"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Clone caller voice"})]}),(0,s.jsx)(eh.d,{id:"voice-cloning-toggle",checked:(null==b?void 0:b.use_voice_cloning)||!1,onCheckedChange:e=>v({use_voice_cloning:e}),disabled:!z,"aria-label":"Voice Cloning"})]})]}),a&&"survey"===e.key&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Survey Questions (by locale)"}),(0,s.jsxs)(P,{defaultValue:"en",children:[(0,s.jsx)(B,{className:"mb-2",children:eb.map(e=>(0,s.jsx)(W,{value:e.code,children:e.label},e.code))}),eb.map(e=>{var t;return(0,s.jsx)(q,{value:e.code,children:(0,s.jsx)("textarea",{placeholder:"On a scale of 1-5, how satisfied were you? What could we improve?",value:("en"===(t=e.code)?k:w[t]||[]).join("\n"),onChange:t=>(function(e,t){let r=t.split("\n").filter(e=>e.trim()),s={...w};r.length>0?s[e]=r:delete s[e];let a={survey_prompts_locales:s};if("en"===e){let e=C.filter(e=>e.index<r.length);a.survey_prompts=r.length>0?r:[],a.survey_question_types=e}v(a)})(e.code,t.target.value),disabled:!z,rows:3,className:"w-full text-sm p-2 bg-white border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-600 focus:border-primary-600"})},e.code)})]})]}),k.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-xs font-medium text-gray-700",children:"Question Types"}),k.map((e,t)=>{var r;return(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"text-xs text-gray-600 truncate",children:["Q",t+1,": ",e]}),(0,s.jsx)("select",{value:(null==(r=C.find(e=>e.index===t))?void 0:r.type)||"scale_1_5",onChange:e=>(function(e,t){let r=C.filter(t=>t.index!==e);r.push({index:e,type:t}),r.sort((e,t)=>e.index-t.index),v({survey_question_types:r})})(t,e.target.value),disabled:!z,className:"text-xs bg-white border border-gray-300 rounded px-2 py-1",children:ef.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]},"".concat(t,"-").concat(e.slice(0,16)))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Email Results To"}),(0,s.jsx)("input",{type:"email",placeholder:"results@company.com",value:(null==b?void 0:b.survey_webhook_email)||"",onChange:e=>v({survey_webhook_email:e.target.value||void 0}),disabled:!z,className:"w-full text-sm p-2 bg-white border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-600 focus:border-primary-600"})]})]}),a&&"synthetic_caller"===e.key&&(0,s.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,s.jsx)(el,{label:"Script",value:(null==b?void 0:b.script_id)||"",onChange:e=>v({script_id:e.target.value||null}),disabled:!z,children:(0,s.jsx)("option",{value:"",children:"Select a script..."})})})]},e.key)}),T&&(0,s.jsx)("div",{role:"alert",className:"text-sm text-error bg-error-light rounded-md p-3",children:T})]})}function ej(e){let{onBookingClick:t,onNewBooking:r,limit:n=5}=e,[l,i]=(0,a.useState)([]),[o,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null),m=async()=>{try{c(!0);let e=await fetch("/api/bookings?limit=".concat(n,"&status=pending"),{credentials:"include"}),t=await e.json();if(t.success)i(t.bookings||[]);else{let e="object"==typeof t.error&&null!==t.error?t.error.message||t.error.code||JSON.stringify(t.error):t.error||"Failed to load bookings";u(e)}}catch(e){u(e.message||"Failed to load bookings")}finally{c(!1)}};return((0,a.useEffect)(()=>{m()},[n]),o)?(0,s.jsx)("div",{className:"p-4 text-center text-slate-400",children:"Loading scheduled calls..."}):d?(0,s.jsx)("div",{className:"p-4 text-center text-red-400 text-sm",children:d}):(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-2",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-slate-300",children:"Scheduled Calls"}),r&&(0,s.jsx)(g.$,{size:"sm",variant:"outline",onClick:r,className:"text-xs h-7",children:"+ New"})]}),0===l.length?(0,s.jsx)("div",{className:"p-4 text-center text-slate-500 text-sm",children:"No upcoming scheduled calls"}):(0,s.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,s.jsx)("div",{onClick:()=>null==t?void 0:t(e),className:"p-3 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition-colors cursor-pointer",children:(0,s.jsx)("div",{className:"flex items-start justify-between",children:(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium text-white truncate",children:e.title}),(0,s.jsxs)("span",{className:"text-xs px-2 py-0.5 rounded-full border ".concat((e=>{switch(e){case"pending":return"bg-yellow-500/20 text-yellow-400 border-yellow-500";case"confirmed":return"bg-green-500/20 text-green-400 border-green-500";case"calling":return"bg-blue-500/20 text-blue-400 border-blue-500";case"completed":default:return"bg-slate-500/20 text-slate-400 border-slate-500";case"cancelled":case"failed":return"bg-red-500/20 text-red-400 border-red-500"}})(e.status)),children:[(e=>{switch(e){case"pending":return"○";case"confirmed":case"completed":return"✓";case"calling":return"●";case"cancelled":return"✕";case"failed":return"!";default:return"•"}})(e.status)," ",e.status]})]}),(0,s.jsx)("div",{className:"text-sm text-slate-400 mt-1",children:e.attendee_name||e.attendee_phone}),(0,s.jsxs)("div",{className:"text-xs text-slate-500 mt-1",children:["\uD83D\uDD50 ",(0,s.jsx)(T.u,{date:e.start_time,format:"short"})]})]})})},e.id))}),l.length>0&&(0,s.jsx)("div",{className:"text-center pt-2",children:(0,s.jsx)("button",{className:"text-xs text-blue-400 hover:text-blue-300 transition-colors",onClick:()=>window.location.href="/bookings",children:"View all scheduled calls →"})})]})}var ey=r(37899);function eN(e){var t;let{organizationId:r,onComplete:n,onSkip:l}=e,[i,o]=(0,a.useState)("setup"),[c,d]=(0,a.useState)({targetNumber:"",targetName:"",fromNumber:"",record:!0,transcribe:!0}),[u,m]=(0,a.useState)(null),x=e=>/^\+[1-9]\d{1,14}$/.test(e);return(0,s.jsx)("div",{className:"max-w-md mx-auto",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[(0,s.jsx)("div",{className:"bg-primary-50 px-6 py-4 border-b border-primary-100",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"setup"===i?"Set Up Your First Call":"Ready to Call"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-0.5",children:"setup"===i?"Enter the number you want to call":"Review and place your first call"})]}),(0,s.jsx)("button",{onClick:l,className:"text-sm text-gray-500 hover:text-gray-700",children:"Skip"})]})}),(0,s.jsx)("div",{className:"px-6 py-3 border-b border-gray-100",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"\n                flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium\n                ".concat("ready"===i?"bg-success text-white":"bg-primary-600 text-white","\n              "),children:"ready"===i?(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):"1"}),(0,s.jsx)("div",{className:"flex-1 h-1 rounded ".concat("ready"===i?"bg-success":"bg-gray-200")}),(0,s.jsx)("div",{className:"\n                flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium\n                ".concat("ready"===i?"bg-primary-600 text-white":"bg-gray-100 text-gray-400","\n              "),children:"2"})]})}),(0,s.jsxs)("div",{className:"p-6",children:[u&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-error-light border border-red-200 rounded-md text-error text-sm flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),u]}),"setup"===i&&(0,s.jsxs)("div",{className:"space-y-5",children:[(0,s.jsx)("div",{children:(0,s.jsx)(v.p,{label:"Phone Number to Call *",type:"tel",value:c.targetNumber,onChange:e=>d({...c,targetNumber:e.target.value}),placeholder:"+12025551234",hint:((t=c.targetNumber)&&!t.startsWith("+")?"Add + and country code (e.g., +1 for US)":null)||"E.164 format (include country code)",autoFocus:!0})}),(0,s.jsx)(v.p,{label:"Name (optional)",value:c.targetName||"",onChange:e=>d({...c,targetName:e.target.value}),placeholder:"e.g., Main Support Line",hint:"For your reference"}),(0,s.jsxs)("details",{className:"group",children:[(0,s.jsxs)("summary",{className:"text-sm text-primary-600 cursor-pointer hover:text-primary-700 flex items-center gap-1",children:[(0,s.jsx)("svg",{className:"w-4 h-4 transition-transform group-open:rotate-90",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Add your phone number (for bridge calls)"]}),(0,s.jsx)("div",{className:"mt-3 pl-5",children:(0,s.jsx)(v.p,{label:"Your Phone Number",type:"tel",value:c.fromNumber||"",onChange:e=>d({...c,fromNumber:e.target.value}),placeholder:"+12025559876",hint:"We'll call you first, then connect to target"})})]})]}),"ready"===i&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Calling:"}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-base font-mono font-medium text-gray-900",children:c.targetNumber}),c.targetName&&(0,s.jsx)("p",{className:"text-sm text-gray-500",children:c.targetName})]})]}),c.fromNumber&&(0,s.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t border-gray-200",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Via bridge:"}),(0,s.jsx)("span",{className:"text-sm font-mono text-gray-900",children:c.fromNumber})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Evidence Capture"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>d({...c,record:!c.record}),className:"\n                      flex-1 p-3 rounded-lg border-2 transition-all\n                      ".concat(c.record?"border-success bg-success/5":"border-gray-200 hover:border-gray-300","\n                    "),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Record"}),(0,s.jsx)(eh.d,{checked:c.record,onCheckedChange:e=>d({...c,record:e})})]})}),(0,s.jsx)("button",{type:"button",onClick:()=>d({...c,transcribe:!c.transcribe}),className:"\n                      flex-1 p-3 rounded-lg border-2 transition-all\n                      ".concat(c.transcribe?"border-success bg-success/5":"border-gray-200 hover:border-gray-300","\n                    "),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Transcribe"}),(0,s.jsx)(eh.d,{checked:c.transcribe,onCheckedChange:e=>d({...c,transcribe:e})})]})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500 pt-2",children:[(0,s.jsx)(f.E,{variant:"secondary",className:"text-xs",children:"Immutable Evidence"}),(0,s.jsx)("span",{children:"All calls create court-ready records"})]})]})]}),(0,s.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex gap-3",children:["ready"===i&&(0,s.jsx)(g.$,{variant:"outline",onClick:()=>{m(null),"ready"===i&&o("setup")},children:"Back"}),(0,s.jsx)(g.$,{variant:"primary",onClick:()=>{if(m(null),"setup"===i){if(!c.targetNumber)return void m("Please enter a phone number");if(!x(c.targetNumber))return void m("Please use E.164 format (e.g., +12025551234)");if(c.fromNumber&&!x(c.fromNumber))return void m("Your number should be in E.164 format (e.g., +12025551234)");o("ready")}else"ready"===i&&n(c)},className:"flex-1",children:"ready"===i?(0,s.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)("span",{})," Place Call"]}):"Continue"})]})]})})}function ew(e){let{organizationId:t,onSelect:r,limit:n=5}=e,[l,i]=(0,a.useState)([]),[o,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{if(!t)return void c(!1);!async function(){if(t)try{let e=await fetch("/api/calls?orgId=".concat(encodeURIComponent(t),"&limit=50"),{credentials:"include"});if(!e.ok)return void c(!1);let r=(await e.json()).calls||[],s=new Map;r.forEach(e=>{let t=e.to_number;if(t)if(s.has(t)){let r=s.get(t);r.callCount++,new Date(e.created_at)>new Date(r.lastCalled)&&(r.lastCalled=e.created_at)}else s.set(t,{number:t,name:e.target_name,lastCalled:e.created_at,callCount:1})});let a=Array.from(s.values()).sort((e,t)=>new Date(t.lastCalled).getTime()-new Date(e.lastCalled).getTime());i(a)}catch(e){$.v.error("RecentTargets: failed to fetch recent calls",e,{organizationId:t})}finally{c(!1)}}()},[t]),o)return(0,s.jsxs)("div",{className:"animate-pulse space-y-2",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-24"}),(0,s.jsx)("div",{className:"h-10 bg-gray-100 rounded"}),(0,s.jsx)("div",{className:"h-10 bg-gray-100 rounded"})]});if(0===l.length)return null;let m=d?l:l.slice(0,n);return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Recent"}),l.length>n&&(0,s.jsx)("button",{onClick:()=>u(!d),className:"text-xs text-primary-600 hover:text-primary-700",children:d?"Show less":"+".concat(l.length-n," more")})]}),(0,s.jsx)("div",{className:"space-y-1",children:m.map(e=>(0,s.jsxs)("button",{onClick:()=>r(e.number,e.name),className:"w-full flex items-center gap-3 p-2 rounded-md text-left hover:bg-gray-100 transition-colors group",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-100 group-hover:bg-primary-100 flex items-center justify-center flex-shrink-0",children:(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400 group-hover:text-primary-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-mono text-gray-900 truncate",children:e.number}),e.name&&(0,s.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.name})]}),(0,s.jsxs)("div",{className:"text-right flex-shrink-0",children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:(e=>{let t=new Date(e),r=Math.floor((new Date().getTime()-t.getTime())/6e4),s=Math.floor(r/60),a=Math.floor(s/24);return r<1?"Just now":r<60?"".concat(r,"m ago"):s<24?"".concat(s,"h ago"):a<7?"".concat(a,"d ago"):t.toLocaleDateString()})(e.lastCalled)}),e.callCount>1&&(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:[e.callCount," calls"]})]}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-300 group-hover:text-primary-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},e.number))})]})}let ek=[{id:"tpl_disclosure",type:"disclosure_accepted",label:"Recording Disclosed",promptText:"Confirm that the customer was informed this call is being recorded",description:"The recording disclosure was played at call start. Mark confirmed when customer continues.",isRequired:!0,useCases:["general"],icon:"Volume2",displayOrder:1},{id:"tpl_recording_consent",type:"recording_consent",label:"Recording Consent",promptText:'Ask: "Do you consent to this call being recorded?"',description:"Obtain explicit verbal consent to record the call.",isRequired:!0,useCases:["compliance","legal","healthcare"],icon:"Mic",displayOrder:2},{id:"tpl_identity",type:"identity_verified",label:"Identity Verified",promptText:'Ask: "Can you please confirm your name and [verification question]?"',description:"Verify the caller's identity before discussing sensitive information.",isRequired:!1,useCases:["finance","healthcare","compliance"],icon:"BadgeCheck",displayOrder:3},{id:"tpl_terms",type:"terms_agreed",label:"Terms Acknowledged",promptText:'Ask: "Do you understand and agree to the terms as I\'ve explained them?"',description:"Confirm the customer understands and agrees to terms.",isRequired:!1,useCases:["sales","legal","finance"],icon:"FileText",displayOrder:4},{id:"tpl_price",type:"price_confirmed",label:"Price Confirmed",promptText:'Ask: "To confirm, you\'re agreeing to [price/amount]. Is that correct?"',description:"Obtain verbal confirmation of pricing or amounts.",isRequired:!1,useCases:["sales","finance"],icon:"DollarSign",displayOrder:5},{id:"tpl_scope",type:"scope_confirmed",label:"Scope Confirmed",promptText:'Ask: "Can you confirm you understand the scope of [service/work]?"',description:"Confirm understanding of what is included/excluded.",isRequired:!1,useCases:["sales","support"],icon:"ClipboardList",displayOrder:6},{id:"tpl_authorization",type:"authorization_given",label:"Authorization Given",promptText:'Ask: "Do you authorize us to proceed with [action]?"',description:"Obtain explicit authorization for an action.",isRequired:!1,useCases:["finance","healthcare","legal"],icon:"CheckCircle",displayOrder:7},{id:"tpl_understanding",type:"understanding_confirmed",label:"Understanding Confirmed",promptText:'Ask: "Do you have any questions about what we\'ve discussed?"',description:"Confirm the customer understands the key points.",isRequired:!1,useCases:["general","compliance"],icon:"Lightbulb",displayOrder:8}];function eC(e){switch(e){case"confirmed":return"bg-green-100 text-green-800";case"declined":return"bg-red-100 text-red-800";case"skipped":return"bg-yellow-100 text-yellow-800";case"not_applicable":return"bg-gray-100 text-gray-600";default:return"bg-blue-50 text-blue-800"}}let e_={customer:{label:"Customer",description:"The called party confirmed"},operator:{label:"Operator",description:"The operator confirmed"},third_party:{label:"Third Party",description:"A third party on the call confirmed"},both:{label:"Both Parties",description:"Both operator and customer confirmed"}};function eS(e){let{callId:t,organizationId:r,callDuration:n,templates:l=ek.filter(e=>e.isRequired||e.useCases.includes("general")),onConfirmationCaptured:i,onConfirmationSkipped:o,isCallActive:c=!0}=e,[d,u]=(0,a.useState)(()=>l.map(e=>({id:"".concat(t,"-").concat(e.id),template:e,status:"pending"}))),[m,x]=(0,a.useState)(null),[h,p]=(0,a.useState)("customer"),[b,v]=(0,a.useState)(""),[j,y]=(0,a.useState)(!1),[N,w]=(0,a.useState)(null),[k,C]=(0,a.useState)(""),_=(0,a.useCallback)(async()=>{if(m){y(!0);try{i&&await i({templateId:m.template.id,confirmationType:m.template.type,confirmerRole:h,recordingTimestamp:n,notes:b||void 0}),u(e=>e.map(e=>e.id===m.id?{...e,status:"confirmed",confirmedAt:new Date().toISOString(),confirmerRole:h,recordingTimestamp:n,notes:b}:e)),x(null),p("customer"),v("")}catch(e){$.v.error("Failed to save confirmation",e,{activeItem:null==m?void 0:m.id})}finally{y(!1)}}},[m,h,b,n,i]),S=(0,a.useCallback)(async()=>{if(N&&k){y(!0);try{o&&await o(N.template.id,k),u(e=>e.map(e=>e.id===N.id?{...e,status:"skipped",notes:k}:e)),w(null),C("")}catch(e){$.v.error("Failed to skip confirmation",e,{skipItem:null==N?void 0:N.id})}finally{y(!1)}}},[N,k,o]),E=e=>{let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))},A=d.filter(e=>"confirmed"===e.status).length,I=d.filter(e=>e.template.isRequired).length,T=d.filter(e=>e.template.isRequired&&"confirmed"===e.status).length;return(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"Confirmation Checklist"})}),(0,s.jsxs)(f.E,{variant:T===I?"success":"default",children:[A,"/",d.length," Complete"]})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Ask the customer and mark when confirmed"})]}),(0,s.jsx)("div",{className:"divide-y divide-gray-100",children:d.map(e=>(0,s.jsx)("div",{className:"p-4 ".concat("confirmed"===e.status?"bg-green-50":"skipped"===e.status?"bg-yellow-50":"bg-white hover:bg-gray-50"),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"\n                w-6 h-6 rounded-full flex items-center justify-center text-sm font-medium\n                ".concat(eC(e.status),"\n              "),children:function(e){switch(e){case"confirmed":return"✓";case"declined":return"✗";case"skipped":return"→";case"not_applicable":return"—";default:return"○"}}(e.status)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-base",children:e.template.icon}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:e.template.label}),e.template.isRequired&&(0,s.jsx)(f.E,{variant:"secondary",className:"text-xs",children:"Required"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.template.promptText}),"confirmed"===e.status&&void 0!==e.recordingTimestamp&&(0,s.jsxs)("p",{className:"text-xs text-green-700 mt-1",children:["✓ Confirmed by ",e_[e.confirmerRole||"customer"].label," at ",E(e.recordingTimestamp)]}),"skipped"===e.status&&e.notes&&(0,s.jsxs)("p",{className:"text-xs text-yellow-700 mt-1",children:["Skipped: ",e.notes]})]}),"pending"===e.status&&c&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.$,{size:"sm",variant:"ghost",onClick:()=>w(e),className:"text-gray-500 hover:text-gray-700",children:"Skip"}),(0,s.jsx)(g.$,{size:"sm",onClick:()=>x(e),className:"bg-primary-600 hover:bg-primary-700 text-white",children:"Mark Confirmed"})]}),"pending"!==e.status&&(0,s.jsx)(f.E,{className:eC(e.status),children:"confirmed"===e.status?"Confirmed":"skipped"===e.status?"Skipped":e.status})]})},e.id))}),(0,s.jsx)("div",{className:"px-4 py-2 bg-blue-50 border-t border-blue-100",children:(0,s.jsxs)("p",{className:"text-xs text-blue-700",children:[(0,s.jsx)("strong",{children:"Reminder:"})," You ask the question. The customer answers. You mark it confirmed."]})}),m&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[(0,s.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Confirm: ",m.template.label]})}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:m.template.description}),(0,s.jsxs)("p",{className:"text-sm font-medium text-gray-900 mt-2",children:['"',m.template.promptText,'"']})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Who confirmed?"}),(0,s.jsx)("div",{className:"flex gap-2 flex-wrap",children:Object.keys(e_).map(e=>(0,s.jsx)("button",{onClick:()=>p(e),className:"\n                        px-3 py-1.5 rounded-md text-sm font-medium transition-colors\n                        ".concat(h===e?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200","\n                      "),children:e_[e].label},e))})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,s.jsx)("span",{children:"Recording timestamp:"}),(0,s.jsx)(f.E,{variant:"secondary",children:E(n)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optional)"}),(0,s.jsx)("textarea",{value:b,onChange:e=>v(e.target.value),placeholder:"Any additional context...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm resize-none",rows:2})]})]}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-200 flex gap-2 justify-end",children:[(0,s.jsx)(g.$,{variant:"outline",onClick:()=>{x(null),v("")},disabled:j,children:"Cancel"}),(0,s.jsx)(g.$,{onClick:_,disabled:j,className:"bg-green-600 hover:bg-green-700 text-white",children:j?"Saving...":"Confirm Captured"})]})]})}),N&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[(0,s.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Skip: ",N.template.label]})}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[N.template.isRequired&&(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:(0,s.jsx)("p",{className:"text-sm text-yellow-800",children:"This is a required confirmation. Please provide a reason for skipping."})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for skipping"}),(0,s.jsx)("textarea",{value:k,onChange:e=>C(e.target.value),placeholder:"Why is this being skipped?",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm resize-none",rows:3,required:!0})]})]}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-200 flex gap-2 justify-end",children:[(0,s.jsx)(g.$,{variant:"outline",onClick:()=>{w(null),C("")},disabled:j,children:"Cancel"}),(0,s.jsx)(g.$,{onClick:S,disabled:j||!k.trim(),className:"bg-yellow-600 hover:bg-yellow-700 text-white",children:j?"Saving...":"Skip Confirmation"})]})]})})]})}function eE(e){let{callId:t,organizationId:r,status:n,targetNumber:l,fromNumber:i,duration:o,onViewDetails:c,onEndCall:d,onNewCall:u,showConfirmations:m=!0}=e,[x,h]=(0,a.useState)(!1),[p,b]=(0,a.useState)(!1),v=e=>{let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))},j=async()=>{await navigator.clipboard.writeText(t),h(!0),setTimeout(()=>h(!1),2e3)},y={initiating:{color:"bg-blue-500",label:"Initiating",animate:!0},ringing:{color:"bg-amber-500",label:"Ringing",animate:!0},in_progress:{color:"bg-success",label:"Connected",animate:!0},completed:{color:"bg-gray-400",label:"Completed",animate:!1},failed:{color:"bg-error",label:"Failed",animate:!1},"no-answer":{color:"bg-warning",label:"No Answer",animate:!1},busy:{color:"bg-warning",label:"Busy",animate:!1}},N=y[n]||y.initiating,w=["initiating","ringing","in_progress"].includes(n),k=(0,a.useCallback)(async e=>{if(r)try{if(!(await fetch("/api/calls/".concat(t,"/confirmations"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmation_type:e.confirmationType,prompt_text:e.templateId,confirmer_role:e.confirmerRole,recording_timestamp_seconds:e.recordingTimestamp,verification_method:"verbal",notes:e.notes})})).ok)throw Error("Failed to save confirmation")}catch(e){throw $.v.error("Failed to save confirmation",e,{callId:t,organizationId:r}),e}},[t,r]),C=(0,a.useCallback)(async(e,r)=>{$.v.debug("Confirmation skipped",{callId:t,templateId:e,reason:r})},[t]);return(0,s.jsxs)("div",{className:"\n      rounded-lg border-2 overflow-hidden transition-colors\n      ".concat(w?"border-primary-200 bg-primary-50":"border-gray-200 bg-white","\n    "),children:[(0,s.jsxs)("div",{className:"\n        px-4 py-3 flex items-center gap-3\n        ".concat(w?"bg-primary-100":"bg-gray-50","\n      "),children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(N.color)}),N.animate&&(0,s.jsx)("div",{className:"absolute inset-0 w-3 h-3 rounded-full ".concat(N.color," animate-ping opacity-75")})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:w?"Call Active":"Call ".concat(N.label)}),w&&(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"in_progress"===n?"Duration: ".concat(v(o)):N.label})]}),(0,s.jsx)(f.E,{variant:"completed"===n?"success":"failed"===n?"error":w?"default":"warning",children:N.label})]}),(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Calling"}),(0,s.jsx)("span",{className:"text-sm font-mono text-gray-900",children:l||"Unknown"})]}),i&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"From"}),(0,s.jsx)("span",{className:"text-sm font-mono text-gray-900",children:i})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Call ID"}),(0,s.jsxs)("button",{onClick:j,className:"flex items-center gap-1 text-sm font-mono text-primary-600 hover:text-primary-700",children:[t.slice(0,8),"...",x?(0,s.jsx)("svg",{className:"w-4 h-4 text-success",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})]})]}),("in_progress"===n||"completed"===n)&&o>0&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Duration"}),(0,s.jsx)("span",{className:"text-sm font-mono text-gray-900",children:v(o)})]}),w&&m&&r&&(0,s.jsx)("div",{className:"pt-2 border-t border-gray-100",children:(0,s.jsxs)("button",{onClick:()=>b(!p),className:"w-full flex items-center justify-between py-2 text-sm text-gray-700 hover:text-gray-900",children:[(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:"\uD83D\uDCCB"}),(0,s.jsx)("span",{className:"font-medium",children:"Confirmation Checklist"})]}),(0,s.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(p?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]}),w&&m&&r&&p&&(0,s.jsx)("div",{className:"border-t border-gray-200",children:(0,s.jsx)(eS,{callId:t,organizationId:r,callDuration:o,onConfirmationCaptured:k,onConfirmationSkipped:C,isCallActive:w})}),(0,s.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex gap-2",children:[(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:c,className:"flex-1",children:[(0,s.jsxs)("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View Details"]}),w&&d&&(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:d,className:"text-error border-error hover:bg-error-light",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M5 3a2 2 0 00-2 2v1c0 8.284 6.716 15 15 15h1a2 2 0 002-2v-3.28a1 1 0 00-.684-.948l-4.493-1.498a1 1 0 00-1.21.502l-1.13 2.257a11.042 11.042 0 01-5.516-5.517l2.257-1.128a1 1 0 00.502-1.21L9.228 3.683A1 1 0 008.279 3H5z"})}),"End"]}),!w&&(0,s.jsxs)(g.$,{variant:"primary",size:"sm",onClick:u,className:"flex-1",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 4v16m8-8H4"})}),"New Call"]})]})]})}var eA=r(72560),eI=r(69141),eT=r(8968),eL=r(50906),ez=r(16485);function eF(e){let{currentTab:t,onTabChange:r,callsCount:a,onScheduleClick:n}=e,l=[{id:"dial",label:"Dial",icon:eI.A},{id:"calls",label:"Calls",icon:eT.A},{id:"activity",label:"Activity",icon:eL.A}];return(0,s.jsxs)("nav",{className:"flex border-t border-gray-200 bg-white safe-area-bottom",children:[l.map(e=>{let n=t===e.id,l=e.icon;return(0,s.jsxs)("button",{onClick:()=>r(e.id),className:"\n              flex-1 flex flex-col items-center py-3 px-2 min-h-[56px] transition-colors relative\n              ".concat(n?"text-primary-600 bg-primary-50":"text-gray-500 hover:bg-gray-50","\n            "),"aria-current":n?"page":void 0,children:[(0,s.jsx)(l,{className:"w-5 h-5 mb-1",strokeWidth:2}),(0,s.jsx)("span",{className:"text-xs font-medium",children:e.label}),"calls"===e.id&&a>0&&(0,s.jsx)("span",{className:"absolute top-2 right-1/4 bg-primary-600 text-white text-[10px] font-bold rounded-full min-w-[16px] h-4 flex items-center justify-center px-1",children:a>9?"9+":a})]},e.id)}),(0,s.jsxs)("button",{onClick:n,className:"flex-1 flex flex-col items-center py-3 px-2 min-h-[56px] text-gray-500 hover:bg-gray-50 transition-colors",children:[(0,s.jsx)(ez.A,{className:"w-5 h-5 mb-1",strokeWidth:2}),(0,s.jsx)("span",{className:"text-xs font-medium",children:"Schedule"})]})]})}function eR(e){let{mode:t,onModeChange:r,disabled:a}=e,n=c();return(0,s.jsx)(eu,{mode:t,onModeChange:r,webrtcStatus:n.status,disabled:a})}function eD(e){let{initialCalls:t,organizationId:r,organizationName:l}=e,[i,c]=(0,a.useState)(null),[d,m]=(0,a.useState)(!1),[x,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)(!1),[v,j]=(0,a.useState)("phone"),[w,k]=(0,a.useState)(null),C=function(e){let[t,r]=(0,a.useState)(null),[s,n]=(0,a.useState)(0),l=t&&["completed","failed","busy","no-answer","canceled"].includes(t);(0,a.useEffect)(()=>{if(!e||l)return;let s=!0,a=async()=>{try{let n=await fetch("/api/calls/".concat(encodeURIComponent(e)),{credentials:"include"});if(n.ok&&s){var a;let e=null==(a=(await n.json()).call)?void 0:a.status;e&&e!==t&&r(e)}}catch(e){}};a();let n=setInterval(a,3e3);return()=>{s=!1,clearInterval(n)}},[e,t,l]),(0,a.useEffect)(()=>{if(!e||l)return;let t=setInterval(()=>{n(e=>e+1)},1e3);return()=>clearInterval(t)},[e,l]);let i=(0,a.useCallback)(()=>{r(null),n(0)},[]);return{status:t,duration:s,setStatus:r,reset:i,isActive:!!e&&!l}}(w),[_,S]=(0,a.useState)("dial"),{updates:E}=(0,L.x)(r);(0,a.useEffect)(()=>{0===t.length&&p(!0)},[t.length]),(0,a.useEffect)(()=>{w&&E.length&&E.forEach(e=>{var t;if("calls"===e.table&&(null==(t=e.new)?void 0:t.id)===w){let t=e.new.status;C.setStatus(t)}})},[E,w,C]),(0,a.useEffect)(()=>{function e(e){var t,r;let s=null==(t=e.detail)?void 0:t.callId;s&&(c(s),S("dial"),null==(r=document.getElementById("call-detail-container"))||r.scrollIntoView({behavior:"smooth"}))}return window.addEventListener("call:select",e),()=>{window.removeEventListener("call:select",e)}},[]);let A=e=>{k(e),C.setStatus("initiating"),C.reset(),c(e)},I=async e=>{p(!1);let t=new CustomEvent("onboarding:complete",{detail:{targetNumber:e.targetNumber,targetName:e.targetName,fromNumber:e.fromNumber,record:e.record,transcribe:e.transcribe}});window.dispatchEvent(t)},T=(e,t)=>{},F=()=>{k(null),C.reset()};async function R(e){}return x&&0===t.length?(0,s.jsx)(n.U,{organizationId:r,children:(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(b,{organizationId:r,organizationName:l}),(0,s.jsx)("div",{className:"py-12 px-4",children:(0,s.jsx)(eN,{organizationId:r,onComplete:I,onSkip:()=>p(!1)})})]})}):(0,s.jsx)(n.U,{organizationId:r,children:(0,s.jsx)(h,{children:(0,s.jsx)(o,{organizationId:r,children:(0,s.jsx)(u,{children:(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50",children:[(0,s.jsx)(b,{organizationId:r,organizationName:l}),(0,s.jsxs)("div",{className:"hidden lg:flex flex-1 overflow-hidden",children:[(0,s.jsxs)("aside",{className:"w-72 border-r border-gray-200 flex flex-col overflow-hidden bg-white","data-tour":"call-list",children:[(0,s.jsx)("div",{className:"border-b border-gray-200 p-4",children:(0,s.jsx)(ej,{onBookingClick:e=>{},onNewBooking:()=>m(!0),limit:3})}),(0,s.jsx)(z,{calls:t,selectedCallId:i,organizationId:r,onSelect:c})]}),(0,s.jsx)("main",{className:"flex-1 overflow-y-auto p-6",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[w&&C.status&&(0,s.jsx)(eE,{callId:w,organizationId:r||void 0,status:C.status,duration:C.duration,onViewDetails:()=>c(w),onNewCall:F,showConfirmations:!0}),(0,s.jsx)("div",{className:"space-y-4","data-tour":"target-selector",children:(0,s.jsx)(eo,{organizationId:r})}),(0,s.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:(0,s.jsx)(eR,{mode:v,onModeChange:j,disabled:!!w})}),(0,s.jsxs)("div",{"data-tour":"place-call",children:["phone"===v&&!w&&(0,s.jsx)(ec,{organizationId:r,onCallPlaced:A}),"browser"===v&&(0,s.jsx)(ed,{organizationId:r,onCallPlaced:A})]}),(0,s.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:(0,s.jsx)(ew,{organizationId:r,onSelect:T,limit:3})}),(0,s.jsxs)("section",{className:"bg-white rounded-md border border-gray-200","data-tour":"call-options",children:[(0,s.jsxs)("button",{onClick:()=>f(!g),className:"w-full px-4 py-3 flex items-center justify-between text-left hover:bg-gray-50 transition-colors",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-sm font-semibold text-gray-900",children:"Call Options"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Recording, transcription, and more"})]}),g?(0,s.jsx)(N.A,{className:"w-5 h-5 text-gray-400"}):(0,s.jsx)(y.A,{className:"w-5 h-5 text-gray-400"})]}),g&&(0,s.jsx)("div",{className:"px-4 pb-4 border-t border-gray-100",children:(0,s.jsx)(ev,{callId:"org-default",organizationId:r,initialModulations:{record:!1,transcribe:!1,translate:!1,survey:!1,synthetic_caller:!1},onChange:R})})]}),(0,s.jsx)("div",{id:"call-detail-container",children:(0,s.jsx)(ea,{callId:i,organizationId:r,onModulationChange:R})})]})}),(0,s.jsx)("aside",{className:"w-72 border-l border-gray-200 overflow-y-auto p-4 bg-white","data-tour":"activity-feed",children:(0,s.jsx)(em.A,{organizationId:r,limit:20})})]}),(0,s.jsxs)("div",{className:"flex lg:hidden flex-col flex-1 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["dial"===_&&(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[w&&C.status&&(0,s.jsx)(eE,{callId:w,organizationId:r||void 0,status:C.status,duration:C.duration,onViewDetails:()=>c(w),onNewCall:F,showConfirmations:!0}),(0,s.jsx)(eo,{organizationId:r}),(0,s.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:(0,s.jsx)(eR,{mode:v,onModeChange:j,disabled:!!w})}),"phone"===v&&!w&&(0,s.jsx)(ec,{organizationId:r,onCallPlaced:A}),"browser"===v&&(0,s.jsx)(ed,{organizationId:r,onCallPlaced:A}),(0,s.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:(0,s.jsx)(ew,{organizationId:r,onSelect:T,limit:3})}),(0,s.jsxs)("details",{className:"bg-white rounded-md border border-gray-200 group",children:[(0,s.jsxs)("summary",{className:"p-4 cursor-pointer font-medium text-gray-900 flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Call Options"}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Tap to expand"})]}),(0,s.jsx)("div",{className:"p-4 pt-0 border-t border-gray-200",children:(0,s.jsx)(ev,{callId:"org-default",organizationId:r,initialModulations:{record:!1,transcribe:!1,translate:!1,survey:!1,synthetic_caller:!1},onChange:R})})]}),(0,s.jsxs)("details",{className:"bg-white rounded-md border border-gray-200",children:[(0,s.jsxs)("summary",{className:"p-4 cursor-pointer font-medium text-gray-900 flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Scheduled Calls"}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Tap to view"})]}),(0,s.jsx)("div",{className:"p-4 pt-0 border-t border-gray-200",children:(0,s.jsx)(ej,{onBookingClick:e=>{},onNewBooking:()=>m(!0),limit:5})})]}),(0,s.jsx)("div",{id:"call-detail-container",children:(0,s.jsx)(ea,{callId:i,organizationId:r,onModulationChange:R})})]}),"calls"===_&&(0,s.jsx)(z,{calls:t,selectedCallId:i,organizationId:r,onSelect:e=>{c(e),S("dial")}}),"activity"===_&&(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)(em.A,{organizationId:r,limit:30})})]}),(0,s.jsx)(eF,{currentTab:_,onTabChange:S,callsCount:t.length,onScheduleClick:()=>m(!0)})]}),(0,s.jsx)(ey.L,{isOpen:d,onClose:()=>m(!1),onSuccess:e=>{m(!1)}}),(0,s.jsx)(eA.WB,{tourId:"voice",steps:eA.AN})]})})})})})}},95897:(e,t,r)=>{Promise.resolve().then(r.bind(r,68882)),Promise.resolve().then(r.bind(r,81606)),Promise.resolve().then(r.t.bind(r,52619,23))},98075:(e,t,r)=>{"use strict";r.d(t,{U:()=>o,g:()=>c});var s=r(95155),a=r(12115);let n={recording_enabled:"record",transcription_enabled:"transcribe",translation_enabled:"translate",translation_from:"translate_from",translation_to:"translate_to",survey_enabled:"survey",secret_shopper_enabled:"synthetic_caller"};function l(e){let t={};for(let[r,s]of Object.entries(e))t[n[r]||r]=s;return t}let i=(0,a.createContext)(null);function o(e){let{organizationId:t,children:r}=e,[n,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(!t){o(null),d(!1);return}!async function(){if(t)try{d(!0),m(null);let e=await fetch("/api/voice/config?orgId=".concat(encodeURIComponent(t)),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch voice config");let r=await e.json();o(r.config||{})}catch(e){m((null==e?void 0:e.message)||"Failed to load config"),o(null)}finally{d(!1)}}()},[t]);let x=(0,a.useCallback)(async e=>{if(!t)throw Error("Organization ID required");try{var r,s,a,i,c;m(null);let{quick_dial_number:d,from_number:u,target_id:x,campaign_id:h,...p}=e,g={};if("quick_dial_number"in e&&(g.quick_dial_number=d),"from_number"in e&&(g.from_number=u),"target_id"in e&&(g.target_id=x),"campaign_id"in e&&(g.campaign_id=h),Object.keys(g).length>0&&o(e=>({...e||{},...g})),0===Object.keys(p).length)return{...n||{},...g};let f=l(p),b=await fetch("/api/voice/config",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orgId:t,modulations:f})});if(!b.ok){let e=await b.json().catch(()=>({error:"Failed to update config"}));throw Error((null==(r=e.error)?void 0:r.message)||e.error||"Failed to update config")}let v={...(await b.json()).config||{},quick_dial_number:null!=(s=g.quick_dial_number)?s:null==n?void 0:n.quick_dial_number,from_number:null!=(a=g.from_number)?a:null==n?void 0:n.from_number,target_id:null!=(i=g.target_id)?i:null==n?void 0:n.target_id,campaign_id:null!=(c=g.campaign_id)?c:null==n?void 0:n.campaign_id};return o(v),v}catch(e){throw m((null==e?void 0:e.message)||"Failed to update config"),e}},[t,n]);return(0,s.jsx)(i.Provider,{value:{config:n,loading:c,error:u,updateConfig:x},children:r})}function c(e){let t=(0,a.useContext)(i);if(t)return t;let[r,s]=(0,a.useState)(null),[n,o]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(!e){s(null),o(!1);return}!async function(){if(e)try{o(!0),d(null);let t=await fetch("/api/voice/config?orgId=".concat(encodeURIComponent(e)),{credentials:"include"});if(!t.ok)throw Error("Failed to fetch voice config");let r=await t.json();s(r.config||{})}catch(e){d((null==e?void 0:e.message)||"Failed to load config"),s(null)}finally{o(!1)}}()},[e]);let u=(0,a.useCallback)(async t=>{var a,n,i,o,c;if(!e)throw Error("Organization ID required");let{quick_dial_number:d,from_number:u,target_id:m,campaign_id:x,...h}=t,p={};if("quick_dial_number"in t&&(p.quick_dial_number=d),"from_number"in t&&(p.from_number=u),"target_id"in t&&(p.target_id=m),"campaign_id"in t&&(p.campaign_id=x),Object.keys(p).length>0&&s(e=>({...e||{},...p})),0===Object.keys(h).length)return{...r||{},...p};let g=l(h),f=await fetch("/api/voice/config",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orgId:e,modulations:g})});if(!f.ok){let e=await f.json().catch(()=>({error:"Failed to update config"}));throw Error((null==(a=e.error)?void 0:a.message)||e.error||"Failed to update config")}let b={...(await f.json()).config||{},quick_dial_number:null!=(n=p.quick_dial_number)?n:null==r?void 0:r.quick_dial_number,from_number:null!=(i=p.from_number)?i:null==r?void 0:r.from_number,target_id:null!=(o=p.target_id)?o:null==r?void 0:r.target_id,campaign_id:null!=(c=p.campaign_id)?c:null==r?void 0:r.campaign_id};return s(b),b},[e,r]);return{config:r,loading:n,error:c,updateConfig:u}}}},e=>{e.O(0,[8803,2619,7627,385,2560,7198,9655,8441,1255,7358],()=>e(e.s=95897)),_N_E=e.O()}]);