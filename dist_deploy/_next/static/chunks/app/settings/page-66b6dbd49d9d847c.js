(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4662],{7235:(e,t,s)=>{"use strict";s.d(t,{d:()=>r});var a=s(95155);function r(e){let{checked:t=!1,onChange:s,onCheckedChange:r,disabled:l=!1,className:i="",...n}=e;return(0,a.jsx)("button",{type:"button",role:"switch","aria-checked":t,"aria-disabled":l,onClick:()=>{if(l)return;let e=!t;null==s||s(e),null==r||r(e)},disabled:l,className:"inline-flex items-center h-6 w-11 rounded-full p-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 ".concat(l?"bg-gray-200 cursor-not-allowed opacity-60":t?"bg-primary-600 cursor-pointer":"bg-gray-300 cursor-pointer hover:bg-gray-400"," ").concat(i),...n,children:(0,a.jsx)("span",{className:"inline-block h-5 w-5 rounded-full bg-white transform transition-transform shadow-sm ".concat(t?"translate-x-5":"translate-x-0")})})}s(12115)},12862:(e,t,s)=>{"use strict";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=await fetch(e,{...t,method:"GET",credentials:"include"});if(!s.ok){var a;let e=await s.json().catch(()=>({message:s.statusText}));throw new i(s.status,(null==(a=e.error)?void 0:a.message)||e.message||"Request failed")}return s.json()}async function r(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={"Content-Type":"application/json",...s.headers},r=await fetch(e,{...s,method:"POST",credentials:"include",headers:a,body:t?JSON.stringify(t):void 0});if(!r.ok){var l;let e=await r.json().catch(()=>({message:r.statusText}));throw new i(r.status,(null==(l=e.error)?void 0:l.message)||e.message||"Request failed")}return r.json()}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=await fetch(e,{...t,method:"DELETE",credentials:"include"});if(!s.ok){var a;let e=await s.json().catch(()=>({message:s.statusText}));throw new i(s.status,(null==(a=e.error)?void 0:a.message)||e.message||"Request failed")}return s.json()}s.d(t,{$P:()=>r,Al:()=>l,Vg:()=>a});class i extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}}},21297:(e,t,s)=>{"use strict";s.d(t,{J:()=>i,e:()=>l});var a=s(12115),r=s(12862);function l(e){let[t,s]=(0,a.useState)({role:null,plan:null,loading:!0,error:null});return(0,a.useEffect)(()=>{if(!e)return void s({role:null,plan:null,loading:!1,error:null});!async function(){if(e)try{let t=await (0,r.Vg)("/api/rbac/context?orgId=".concat(encodeURIComponent(e)));s({role:t.role||null,plan:t.plan||null,loading:!1,error:null})}catch(e){s({role:null,plan:null,loading:!1,error:(null==e?void 0:e.message)||"Failed to load permissions"})}}()},[e]),t}function i(e,t,s){let{role:a,plan:r,loading:i}=l(e);return!i&&!!a&&!!r&&(["owner","admin"].includes(a)||"read"===s&&["operator","analyst","viewer"].includes(a)||"execute"===s&&"operator"===a)&&("free"!==r||"call"===t)}},25015:(e,t,s)=>{Promise.resolve().then(s.bind(s,30240))},30240:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eN});var a=s(95155),r=s(12115),l=s(36489),i=s(20063),n=s(97003),d=s(33789);let o={owner:"bg-amber-900/50 text-amber-300 border-amber-600",admin:"bg-purple-900/50 text-purple-300 border-purple-600",operator:"bg-blue-900/50 text-blue-300 border-blue-600",analyst:"bg-green-900/50 text-green-300 border-green-600",viewer:"bg-slate-700/50 text-slate-300 border-slate-600"},c={owner:"Full access, billing, and team management",admin:"Manage team, calls, and settings",operator:"Make calls, view recordings, run campaigns",analyst:"View recordings, transcripts, and analytics",viewer:"View-only access to dashboards"};function m(e){var t;let{organizationId:s}=e,[l,i]=(0,r.useState)([]),[m,x]=(0,r.useState)([]),[u,h]=(0,r.useState)(null),[p,g]=(0,r.useState)(!0),[y,b]=(0,r.useState)(null),[j,f]=(0,r.useState)(!1),[v,N]=(0,r.useState)(""),[w,k]=(0,r.useState)("operator"),[_,C]=(0,r.useState)(!1),[S,E]=(0,r.useState)(null);async function A(){if(s)try{g(!0);let t=await fetch("/api/team/members",{credentials:"include"}),s=await t.json();if(s.success)i(s.members||[]),x(s.pending_invites||[]),h(s.current_user_id);else{var e;b((null==(e=s.error)?void 0:e.message)||"Failed to load team")}}catch(e){b("Failed to load team")}finally{g(!1)}}async function T(e){if(e.preventDefault(),v.trim()){C(!0),b(null),E(null);try{let e=await fetch("/api/team/invite",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:v.trim(),role:w})}),s=await e.json();if(s.success)E("Invitation sent to ".concat(v)),N(""),f(!1),A();else{var t;b((null==(t=s.error)?void 0:t.message)||"Failed to send invitation")}}catch(e){b("Failed to send invitation")}finally{C(!1)}}}async function L(e,t){try{let a=await fetch("/api/team/members",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({member_id:e,role:t})}),r=await a.json();if(r.success)A();else{var s;b((null==(s=r.error)?void 0:s.message)||"Failed to update role")}}catch(e){b("Failed to update role")}}async function I(e){if(confirm("Are you sure you want to remove this team member?"))try{let s=await fetch("/api/team/members?member_id=".concat(e),{method:"DELETE",credentials:"include"}),a=await s.json();if(a.success)A();else{var t;b((null==(t=a.error)?void 0:t.message)||"Failed to remove member")}}catch(e){b("Failed to remove member")}}async function F(e){try{let s=await fetch("/api/team/invite?invite_id=".concat(e),{method:"DELETE",credentials:"include"}),a=await s.json();if(a.success)A();else{var t;b((null==(t=a.error)?void 0:t.message)||"Failed to cancel invitation")}}catch(e){b("Failed to cancel invitation")}}(0,r.useEffect)(()=>{A()},[s]);let D=null==(t=l.find(e=>{var t;return(null==(t=e.user)?void 0:t.id)===u}))?void 0:t.role,P="owner"===D||"admin"===D;return p?(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-teal-500 border-t-transparent rounded-full mx-auto"}),(0,a.jsx)("p",{className:"text-slate-400 mt-4",children:"Loading team..."})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDC65"})," Team Management"]}),(0,a.jsxs)("p",{className:"text-sm text-slate-400",children:[l.length," member",1!==l.length?"s":"",m.length>0&&" • ".concat(m.length," pending invite").concat(1!==m.length?"s":"")]})]}),P&&(0,a.jsx)(n.$,{onClick:()=>f(!0),className:"bg-teal-600 hover:bg-teal-700",children:"+ Invite Member"})]}),y&&(0,a.jsx)("div",{className:"p-3 bg-red-900/30 border border-red-700 rounded-lg text-red-400 text-sm",children:y}),S&&(0,a.jsx)("div",{className:"p-3 bg-green-900/30 border border-green-700 rounded-lg text-green-400 text-sm",children:S}),j&&(0,a.jsxs)("form",{onSubmit:T,className:"p-4 bg-slate-800/50 rounded-xl border border-slate-700",children:[(0,a.jsx)("h3",{className:"font-medium text-white mb-4",children:"Invite Team Member"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)(d.p,{type:"email",placeholder:"colleague@company.com",value:v,onChange:e=>N(e.target.value),required:!0,className:"bg-slate-700 border-slate-600"})}),(0,a.jsxs)("select",{value:w,onChange:e=>k(e.target.value),className:"p-2 bg-slate-700 border border-slate-600 rounded-lg text-white",children:[(0,a.jsx)("option",{value:"admin",children:"Admin"}),(0,a.jsx)("option",{value:"operator",children:"Operator"}),(0,a.jsx)("option",{value:"analyst",children:"Analyst"}),(0,a.jsx)("option",{value:"viewer",children:"Viewer"})]})]}),(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:c[w]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,a.jsx)(n.$,{type:"submit",disabled:_,className:"bg-teal-600 hover:bg-teal-700",children:_?"Sending...":"Send Invitation"}),(0,a.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>f(!1),children:"Cancel"})]})]}),(0,a.jsx)("div",{className:"bg-slate-800/50 rounded-xl border border-slate-700 overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-slate-900/50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left p-4 text-xs text-slate-400 uppercase tracking-wide",children:"Member"}),(0,a.jsx)("th",{className:"text-left p-4 text-xs text-slate-400 uppercase tracking-wide",children:"Role"}),(0,a.jsx)("th",{className:"text-left p-4 text-xs text-slate-400 uppercase tracking-wide",children:"Joined"}),P&&(0,a.jsx)("th",{className:"text-right p-4 text-xs text-slate-400 uppercase tracking-wide",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-700",children:l.map(e=>{var t,s,r,l,i,n;return(0,a.jsxs)("tr",{className:"hover:bg-slate-700/30",children:[(0,a.jsx)("td",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-teal-500 to-blue-500 flex items-center justify-center text-white font-bold",children:(null==(s=e.user)||null==(t=s.email)?void 0:t.charAt(0).toUpperCase())||"?"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-white font-medium",children:null==(r=e.user)?void 0:r.email}),(null==(l=e.user)?void 0:l.id)===u&&(0,a.jsx)("span",{className:"text-xs text-teal-400",children:"You"})]})]})}),(0,a.jsx)("td",{className:"p-4",children:P&&"owner"!==e.role&&(null==(i=e.user)?void 0:i.id)!==u?(0,a.jsxs)("select",{value:e.role,onChange:t=>L(e.id,t.target.value),className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(o[e.role]," bg-transparent cursor-pointer"),children:[(0,a.jsx)("option",{value:"admin",children:"Admin"}),(0,a.jsx)("option",{value:"operator",children:"Operator"}),(0,a.jsx)("option",{value:"analyst",children:"Analyst"}),(0,a.jsx)("option",{value:"viewer",children:"Viewer"})]}):(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(o[e.role]),children:e.role.charAt(0).toUpperCase()+e.role.slice(1)})}),(0,a.jsx)("td",{className:"p-4 text-sm text-slate-400",children:new Date(e.created_at).toLocaleDateString()}),P&&(0,a.jsx)("td",{className:"p-4 text-right",children:"owner"!==e.role&&(null==(n=e.user)?void 0:n.id)!==u&&(0,a.jsx)("button",{onClick:()=>I(e.id),className:"text-red-400 hover:text-red-300 text-sm",children:"Remove"})})]},e.id)})})]})}),m.length>0&&(0,a.jsxs)("div",{className:"bg-slate-800/50 rounded-xl border border-slate-700 p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-slate-300 mb-4",children:"Pending Invitations"}),(0,a.jsx)("div",{className:"space-y-2",children:m.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-slate-700/30 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xl",children:"✉️"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-white",children:e.email}),(0,a.jsxs)("p",{className:"text-xs text-slate-400",children:["Role: ",e.role," • Expires ",new Date(e.expires_at).toLocaleDateString()]})]})]}),P&&(0,a.jsx)("button",{onClick:()=>F(e.id),className:"text-slate-400 hover:text-red-400 text-sm",children:"Cancel"})]},e.id))})]}),(0,a.jsxs)("div",{className:"bg-slate-800/30 rounded-xl border border-slate-700/50 p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-slate-300 mb-3",children:"Role Permissions"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3",children:Object.entries(c).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"text-center p-2",children:[(0,a.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-xs font-medium border ".concat(o[t]," mb-2"),children:t.charAt(0).toUpperCase()+t.slice(1)}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:s})]},t)})})]})]})}var x=s(67812),u=s(2479);function h(e){let{organizationId:t}=e,[s,l]=(0,r.useState)([]),[i,o]=(0,r.useState)(null),[c,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(!0),[g,y]=(0,r.useState)(null),[b,j]=(0,r.useState)(!1),[f,v]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[k,_]=(0,r.useState)("idle"),[C,S]=(0,r.useState)(""),[E,A]=(0,r.useState)(!1),T=async()=>{try{p(!0);let t=await fetch("/api/caller-id/verify",{credentials:"include"}),s=await t.json();if(s.success)l(s.numbers||[]),o(s.current_mask),m(s.signalwire_number);else{var e;y("object"==typeof s.error?null==(e=s.error)?void 0:e.message:s.error)}}catch(e){y(e.message)}finally{p(!1)}};(0,r.useEffect)(()=>{t&&T()},[t]);let L=async()=>{if(f)try{A(!0),y(null);let t=await fetch("/api/caller-id/verify",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({phone_number:f,display_name:N||void 0})}),s=await t.json();if(s.success)_("calling"),setTimeout(()=>{_("enter_code")},5e3);else{var e;y("object"==typeof s.error?null==(e=s.error)?void 0:e.message:s.error)}}catch(e){y(e.message)}finally{A(!1)}},I=async()=>{if(!C||6!==C.length)return void y("Please enter the 6-digit code");try{A(!0),y(null);let t=await fetch("/api/caller-id/verify",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({phone_number:f,code:C})}),s=await t.json();if(s.success&&s.verified)j(!1),v(""),w(""),_("idle"),S(""),T();else{var e;let t="object"==typeof s.error?null==(e=s.error)?void 0:e.message:s.error;y(t||"Verification failed")}}catch(e){y(e.message)}finally{A(!1)}},F=async(e,s)=>{try{(await fetch("/api/voice/config",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orgId:t,modulations:{caller_id_mask:s,caller_id_verified:!0}})})).ok&&T()}catch(a){u.v.error("CallerIdManager: failed to set default mask",a,{organizationId:t,numberId:e,phoneNumber:s})}};return t?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"Caller ID Masking"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Display a different number when making outbound calls"})]}),(0,a.jsx)(n.$,{onClick:()=>j(!b),variant:b?"outline":"primary",size:"sm",children:b?"Cancel":"Add Number"})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"Currently Displayed As:"}),(0,a.jsx)("div",{className:"text-base font-mono text-gray-900",children:i||c||"Default SignalWire Number"}),i&&i!==c&&(0,a.jsx)(x.E,{variant:"success",className:"mt-2",children:"Custom Mask Active"})]}),g&&(0,a.jsx)("div",{className:"p-3 bg-error-light border border-red-200 rounded-md text-error text-sm",role:"alert",children:g}),b&&(0,a.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200 space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:"Verify New Number"}),"idle"===k&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.p,{label:"Phone Number",type:"tel",value:f,onChange:e=>v(e.target.value),placeholder:"+12025551234",hint:"E.164 format required"}),(0,a.jsx)(d.p,{label:"Display Name (optional)",value:N,onChange:e=>w(e.target.value),placeholder:"Main Office"}),(0,a.jsx)(n.$,{onClick:L,disabled:E||!f,className:"w-full",variant:"primary",children:E?"Calling...":"Call to Verify"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"We will call this number and speak a 6-digit verification code"})]}),"calling"===k&&(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 mx-auto mb-4 rounded-full bg-primary-100 flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-primary-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,a.jsxs)("div",{className:"text-gray-900 mb-2",children:["Calling ",f,"..."]}),(0,a.jsx)("div",{className:"text-gray-500 text-sm",children:"Answer the call and listen for the 6-digit code"})]}),"enter_code"===k&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-center mb-4",children:(0,a.jsx)("div",{className:"text-gray-900 mb-2",children:"Enter the 6-digit code you heard:"})}),(0,a.jsx)(d.p,{type:"text",value:C,onChange:e=>S(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"123456",maxLength:6,className:"text-center text-xl tracking-widest"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>{_("idle"),S("")},className:"flex-1",children:"Try Again"}),(0,a.jsx)(n.$,{onClick:I,disabled:E||6!==C.length,className:"flex-1",variant:"primary",children:E?"Verifying...":"Verify"})]})]})]}),h?(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Loading..."}):0===s.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No verified numbers yet. Add one above."}):(0,a.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md border border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-mono text-gray-900",children:e.phone_number}),e.is_verified?(0,a.jsx)(x.E,{variant:"success",children:"Verified"}):(0,a.jsx)(x.E,{variant:"warning",children:"Pending"}),e.is_default&&(0,a.jsx)(x.E,{variant:"info",children:"Default"})]}),e.display_name&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.display_name})]}),e.is_verified&&!e.is_default&&(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>F(e.id,e.phone_number),children:"Set as Default"})]},e.id))}),(0,a.jsxs)("div",{className:"p-3 bg-info-light border border-blue-200 rounded-md text-sm",children:[(0,a.jsx)("strong",{className:"text-blue-700",children:"How it works:"}),(0,a.jsxs)("ul",{className:"text-gray-700 mt-1 list-disc list-inside",children:[(0,a.jsx)("li",{children:"We call your number and speak a verification code"}),(0,a.jsx)("li",{children:"Enter the code to prove you own the number"}),(0,a.jsx)("li",{children:"Once verified, outbound calls will display this number"})]})]})]}):(0,a.jsx)("div",{className:"text-gray-500 p-4",children:"Organization required"})}let p=[{value:"professional",label:"Professional - Formal, business-like"},{value:"casual",label:"Casual - Friendly, relaxed"},{value:"frustrated",label:"Frustrated - Impatient, testing patience"},{value:"elderly",label:"Elderly - Slower, may need repetition"},{value:"non-native",label:"Non-native - Accent, simpler vocabulary"},{value:"detailed",label:"Detail-oriented - Many questions"}],g={signalwire:[{value:"rime.spore",label:"English - Spore (Default)"},{value:"rime.koda",label:"English - Koda"},{value:"rime.alberto",label:"Spanish - Alberto"},{value:"rime.viola",label:"French - Viola"},{value:"rime.stella",label:"German - Stella"}],elevenlabs:[{value:"rachel",label:"Rachel (Female, Professional)"},{value:"adam",label:"Adam (Male, Conversational)"},{value:"custom",label:"Custom Voice ID"}]};function y(e){var t,s;let{organizationId:l}=e,[i,o]=(0,r.useState)([]),[c,m]=(0,r.useState)(!0),[h,y]=(0,r.useState)(null),[b,j]=(0,r.useState)(!1),[f,v]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),[k,_]=(0,r.useState)({type:"keyword",value:"",weight:20}),C=async()=>{if(l)try{m(!0);let e=await fetch("/api/shopper/scripts/manage?orgId=".concat(l),{credentials:"include"}),t=await e.json();if(t.success)o(t.scripts||[]);else{let e="object"==typeof t.error&&null!==t.error?t.error.message||t.error.code||JSON.stringify(t.error):t.error||"Failed to load scripts";y(e)}}catch(e){y(e.message||"Failed to load scripts")}finally{m(!1)}};(0,r.useEffect)(()=>{C()},[l]);let S=()=>{w({name:"",description:"",script_text:"Hello, I'm calling to inquire about your services.\n\n[Wait for response]\n\nI'd like to schedule an appointment for next week if possible.\n\n[Wait for response]\n\nWhat availability do you have?\n\n[Wait for response]\n\nThat sounds good. Can you tell me about your pricing?\n\n[Wait for response]\n\nThank you for the information. I'll get back to you soon.",persona:"professional",tts_provider:"signalwire",tts_voice:"rime.spore",expected_outcomes:[{type:"keyword",value:["appointment","schedule","available"],weight:30},{type:"sentiment",value:"positive",weight:40},{type:"duration_min",value:60,weight:20},{type:"response_time",value:5,weight:10}],is_active:!0}),j(!0)},E=async()=>{if(N&&l)try{v(!0);let e=await fetch("/api/shopper/scripts/manage",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...N,organization_id:l})}),t=await e.json();if(t.success)j(!1),w(null),C();else{let e="object"==typeof t.error&&null!==t.error?t.error.message||t.error.code||JSON.stringify(t.error):t.error||"Failed to save script";y(e)}}catch(e){y(e.message||"Failed to save script")}finally{v(!1)}},A=async e=>{if(confirm("Delete this script?"))try{(await fetch("/api/shopper/scripts/manage?id=".concat(e,"&orgId=").concat(l),{method:"DELETE",credentials:"include"})).ok&&C()}catch(t){u.v.error("ShopperScriptManager: failed to delete script",t,{organizationId:l,scriptId:e})}};return l?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-blue-800",children:"AI Quality Evaluation - Internal QA Only"}),(0,a.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"These scripts are for internal quality assurance evaluations only. AI evaluation calls include an automatic disclosure and cannot be used for capturing customer agreements or confirmations."})]})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Quality Evaluation Scripts"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Create scripts for AI-powered QA evaluations. For internal evaluation purposes only."})]}),(0,a.jsx)(n.$,{onClick:S,variant:"primary",children:"New Script"})]}),h&&(0,a.jsx)("div",{className:"p-3 bg-error-light border border-red-200 rounded-md text-error text-sm",children:h}),c&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Loading scripts..."}),!c&&0===i.length&&!b&&(0,a.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-md border border-gray-200",children:[(0,a.jsxs)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Evaluation Scripts Yet"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"Create an AI quality evaluation script to test your call handling"}),(0,a.jsx)(n.$,{onClick:S,children:"Create Your First Script"})]}),!c&&i.length>0&&!b&&(0,a.jsx)("div",{className:"space-y-3",children:i.map(e=>{var t;return(0,a.jsx)("div",{className:"p-4 bg-white rounded-md border border-gray-200 hover:border-gray-300 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)(x.E,{variant:e.is_active?"success":"default",children:e.is_active?"Active":"Inactive"}),(0,a.jsx)(x.E,{variant:"default",children:e.persona})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:e.description}),(0,a.jsxs)("div",{className:"flex gap-4 text-xs text-gray-400",children:[(0,a.jsxs)("span",{children:["TTS: ",e.tts_provider]}),(0,a.jsxs)("span",{children:["Voice: ",e.tts_voice]}),(0,a.jsxs)("span",{children:["Outcomes: ",(null==(t=e.expected_outcomes)?void 0:t.length)||0]}),(0,a.jsxs)("span",{children:["Used: ",e.use_count," times"]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>{w({...e}),j(!0)},children:"Edit"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>A(e.id),className:"text-error hover:text-error",children:"Delete"})]})]})},e.id)})}),b&&N&&(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:N.id?"Edit Script":"New Script"}),(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>j(!1),children:"Cancel"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(d.p,{label:"Script Name",value:N.name||"",onChange:e=>w({...N,name:e.target.value}),placeholder:"Appointment Inquiry Test"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Persona"}),(0,a.jsx)("select",{value:N.persona||"professional",onChange:e=>w({...N,persona:e.target.value}),className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-gray-900 focus:ring-2 focus:ring-primary-600 focus:border-primary-600",children:p.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsx)(d.p,{label:"Description",value:N.description||"",onChange:e=>w({...N,description:e.target.value}),placeholder:"Tests how staff handles appointment requests"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Script Text ",(0,a.jsx)("span",{className:"text-gray-400",children:"(Use [Wait for response] for pauses)"})]}),(0,a.jsx)("textarea",{value:N.script_text||"",onChange:e=>w({...N,script_text:e.target.value}),rows:10,className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-gray-900 font-mono text-sm focus:ring-2 focus:ring-primary-600 focus:border-primary-600",placeholder:"Hello, I'm calling to inquire about..."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"TTS Provider"}),(0,a.jsxs)("select",{value:N.tts_provider||"signalwire",onChange:e=>w({...N,tts_provider:e.target.value,tts_voice:"signalwire"===e.target.value?"rime.spore":"rachel"}),className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-gray-900 focus:ring-2 focus:ring-primary-600 focus:border-primary-600",children:[(0,a.jsx)("option",{value:"signalwire",children:"SignalWire (Default)"}),(0,a.jsx)("option",{value:"elevenlabs",children:"ElevenLabs (Premium)"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Voice"}),(0,a.jsx)("select",{value:N.tts_voice||"",onChange:e=>w({...N,tts_voice:e.target.value}),className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-gray-900 focus:ring-2 focus:ring-primary-600 focus:border-primary-600",children:null==(t=g[N.tts_provider])?void 0:t.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expected Outcomes (for scoring)"}),(0,a.jsx)("div",{className:"space-y-2 mb-4",children:null==(s=N.expected_outcomes)?void 0:s.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[(0,a.jsx)(x.E,{variant:"default",children:e.type}),(0,a.jsx)("span",{className:"text-sm text-gray-700 flex-1",children:Array.isArray(e.value)?e.value.join(", "):String(e.value)}),(0,a.jsxs)("span",{className:"text-xs text-gray-400",children:["Weight: ",e.weight,"%"]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>{var e;N&&w({...N,expected_outcomes:null==(e=N.expected_outcomes)?void 0:e.filter((e,s)=>s!==t)})},className:"text-error",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))}),(0,a.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("select",{value:k.type,onChange:e=>_({...k,type:e.target.value}),className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-gray-900 text-sm focus:ring-2 focus:ring-primary-600 focus:border-primary-600",children:[(0,a.jsx)("option",{value:"keyword",children:"Keyword (comma-separated)"}),(0,a.jsx)("option",{value:"sentiment",children:"Sentiment (positive/negative/neutral)"}),(0,a.jsx)("option",{value:"duration_min",children:"Minimum Duration (seconds)"}),(0,a.jsx)("option",{value:"duration_max",children:"Maximum Duration (seconds)"}),(0,a.jsx)("option",{value:"response_time",children:"Response Time (seconds)"})]})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(d.p,{value:k.value||"",onChange:e=>_({...k,value:e.target.value}),placeholder:"keyword"===k.type?"appointment, schedule":"positive"})}),(0,a.jsx)("div",{className:"w-20",children:(0,a.jsx)(d.p,{type:"number",value:k.weight||20,onChange:e=>_({...k,weight:parseInt(e.target.value)}),placeholder:"Weight"})}),(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>{if(!N||!k.type||!k.value)return;let e={type:k.type,value:"keyword"===k.type?k.value.split(",").map(e=>e.trim()):k.value,weight:k.weight||20};w({...N,expected_outcomes:[...N.expected_outcomes||[],e]}),_({type:"keyword",value:"",weight:20})},children:"Add"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),(0,a.jsx)(n.$,{onClick:E,disabled:f||!N.name||!N.script_text,variant:"primary",children:f?"Saving...":"Save Script"})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-info-light border border-blue-200 rounded-md",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"How Secret Shopper Works"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1 list-disc list-inside",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Script:"})," The synthetic caller follows this conversation script"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"TTS:"})," Uses SignalWire or ElevenLabs to speak the script naturally"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Expected Outcomes:"})," What we check for when scoring the call"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Sentiment Analysis:"})," AI analyzes the overall tone of the call"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Scoring:"})," Weighted scores based on outcomes (0-100 scale)"]})]})]})]}):(0,a.jsx)("div",{className:"text-gray-500 p-4",children:"Organization required"})}let b=[{id:"qa-basic",name:"QA Fundamentals",description:"Baseline QA checks for call quality and compliance.",criteria:[{id:"greeting",name:"Proper greeting",weight:20,type:"boolean"},{id:"resolution",name:"Issue resolution",weight:30,type:"text",min:70},{id:"compliance",name:"Compliance disclosure",weight:30,type:"boolean"},{id:"duration",name:"Call duration",weight:20,type:"numeric",min:60,max:600}]},{id:"sales-qa",name:"Sales QA",description:"Sales-oriented criteria focused on conversion signals.",criteria:[{id:"needs",name:"Needs discovery",weight:25,type:"text",min:70},{id:"pricing",name:"Pricing clarity",weight:25,type:"text",min:70},{id:"next_step",name:"Clear next step",weight:25,type:"boolean"},{id:"sentiment",name:"Positive sentiment",weight:25,type:"text",min:60}]},{id:"compliance",name:"Compliance Essentials",description:"Disclosure and policy adherence checks.",criteria:[{id:"consent",name:"Consent captured",weight:40,type:"boolean"},{id:"disclosure",name:"Required disclosure",weight:40,type:"boolean"},{id:"duration",name:"Call duration",weight:20,type:"numeric",min:30,max:900}]}];function j(e){let{organizationId:t,disabled:s}=e,[l,i]=(0,r.useState)(null),[d,o]=(0,r.useState)(null);async function c(e){if(t&&!s){i(e.id),o(null);try{let t=await fetch("/api/scorecards",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:e.name,description:e.description,structure:{criteria:e.criteria}})});if(!t.ok){var a;let e=await t.json().catch(()=>({}));throw Error((null==e||null==(a=e.error)?void 0:a.message)||"Failed to create scorecard")}}catch(e){o((null==e?void 0:e.message)||"Failed to create scorecard")}finally{i(null)}}}return(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"Scorecard Template Library"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Start with vetted templates and customize as needed."})]}),d&&(0,a.jsx)("div",{className:"p-3 bg-error-light border border-red-200 rounded-md text-error text-sm",children:d}),(0,a.jsx)("div",{className:"grid md:grid-cols-3 gap-4",children:b.map(e=>(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-md p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:e.name}),(0,a.jsx)(x.E,{variant:"info",children:"Template"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-3",children:e.description}),(0,a.jsx)("ul",{className:"text-xs text-gray-600 space-y-1 mb-4",children:e.criteria.map(e=>(0,a.jsxs)("li",{children:["• ",e.name]},e.id))}),(0,a.jsx)(n.$,{variant:"secondary",size:"sm",onClick:()=>c(e),disabled:!!s||l===e.id,children:l===e.id?"Creating...":"Use Template"})]},e.id))})]})}var f=s(98075);function v(e){var t,s,l;let{organizationId:i,onTargetSelect:o}=e,[c,m]=(0,r.useState)([]),[h,p]=(0,r.useState)(!0),[g,y]=(0,r.useState)(null),[b,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),[w,k]=(0,r.useState)(""),[_,C]=(0,r.useState)(""),[S,E]=(0,r.useState)(""),{config:A,updateConfig:T}=(0,f.g)(i),L=null==A?void 0:A.target_id,I=async()=>{if(i)try{p(!0),y(null);let t=await fetch("/api/voice/targets?orgId=".concat(encodeURIComponent(i)),{credentials:"include"}),s=await t.json();if(s.success)m(s.targets||[]);else{var e;y((null==(e=s.error)?void 0:e.message)||s.error||"Failed to load targets")}}catch(e){y(e.message||"Failed to load targets")}finally{p(!1)}};(0,r.useEffect)(()=>{I()},[i]);let F=async()=>{if(w&&i){if(!/^\+[1-9]\d{1,14}$/.test(w))return void y("Phone number must be in E.164 format (e.g., +12025551234)");try{var e,t;N(!0),y(null);let s=await fetch("/api/voice/targets",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({organization_id:i,phone_number:w,name:_||void 0,description:S||void 0})}),a=await s.json();a.success?(j(!1),k(""),C(""),E(""),I(),0===c.length&&(null==(e=a.target)?void 0:e.id)&&D(a.target.id)):y((null==(t=a.error)?void 0:t.message)||a.error||"Failed to add target")}catch(e){y(e.message||"Failed to add target")}finally{N(!1)}}},D=async e=>{if(i)try{y(null),await T({target_id:e}),null==o||o(e)}catch(e){y(e.message||"Failed to select target")}},P=async e=>{if(confirm("Delete this target number?"))try{(await fetch("/api/voice/targets?id=".concat(e,"&orgId=").concat(i),{method:"DELETE",credentials:"include"})).ok&&(L===e&&(await T({target_id:null}),null==o||o(null)),I())}catch(t){u.v.error("VoiceTargetManager: failed to delete target",t,{organizationId:i,targetId:e})}};return i?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Call Targets"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Add phone numbers to call for testing and monitoring"})]}),(0,a.jsx)(n.$,{onClick:()=>j(!b),variant:b?"outline":"primary",children:b?"Cancel":"Add Number"})]}),L&&(0,a.jsxs)("div",{className:"p-4 bg-success-light rounded-md border border-green-200",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"Currently Selected Target:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg font-mono text-gray-900",children:(null==(t=c.find(e=>e.id===L))?void 0:t.phone_number)||L}),(0,a.jsx)(x.E,{variant:"success",children:"Active"})]}),(null==(s=c.find(e=>e.id===L))?void 0:s.name)&&(0,a.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:null==(l=c.find(e=>e.id===L))?void 0:l.name})]}),g&&(0,a.jsx)("div",{className:"p-3 bg-error-light border border-red-200 rounded-md text-error text-sm",children:g}),b&&(0,a.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200 space-y-4",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:"Add New Target Number"}),(0,a.jsx)(d.p,{label:"Phone Number",type:"tel",value:w,onChange:e=>k(e.target.value),placeholder:"+12025551234",hint:"E.164 format required (e.g., +12025551234)"}),(0,a.jsx)(d.p,{label:"Name (optional)",value:_,onChange:e=>C(e.target.value),placeholder:"Main Support Line"}),(0,a.jsx)(d.p,{label:"Description (optional)",value:S,onChange:e=>E(e.target.value),placeholder:"24/7 customer support line"}),(0,a.jsx)(n.$,{onClick:F,disabled:v||!w,variant:"primary",className:"w-full",children:v?"Adding...":"Add Target Number"})]}),h?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Loading targets..."}):0===c.length?(0,a.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-md border border-gray-200",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Target Numbers"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"Add a phone number to start making test calls"}),(0,a.jsx)(n.$,{onClick:()=>j(!0),children:"Add Your First Target"})]}):(0,a.jsx)("div",{className:"space-y-2",children:c.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-md border transition-colors cursor-pointer ".concat(L===e.id?"bg-success-light border-green-200":"bg-white border-gray-200 hover:border-gray-300"),onClick:()=>D(e.id),children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-mono text-gray-900",children:e.phone_number}),L===e.id&&(0,a.jsx)(x.E,{variant:"success",children:"Selected"}),e.is_active?(0,a.jsx)(x.E,{variant:"default",children:"Active"}):(0,a.jsx)(x.E,{variant:"warning",children:"Inactive"})]}),e.name&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-xs text-gray-400",children:e.description})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),D(e.id)},disabled:L===e.id,children:L===e.id?"Selected":"Select"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),P(e.id)},className:"text-error hover:text-error",children:"Delete"})]})]},e.id))}),(0,a.jsxs)("div",{className:"p-3 bg-info-light border border-blue-200 rounded-md text-sm",children:[(0,a.jsx)("strong",{className:"text-gray-900",children:"How it works:"}),(0,a.jsxs)("ul",{className:"text-gray-600 mt-1 list-disc list-inside",children:[(0,a.jsx)("li",{children:"Add phone numbers you want to call (support lines, test numbers)"}),(0,a.jsx)("li",{children:"Select a target to make it active for the next call"}),(0,a.jsx)("li",{children:"All calls will go to the selected target number"}),(0,a.jsx)("li",{children:"Use with Secret Shopper scripts for quality testing"})]})]})]}):(0,a.jsx)("div",{className:"text-gray-500 p-4",children:"Organization required"})}var N=s(21297);let w=[{value:"scale",label:"Rating Scale (1-5)"},{value:"yes_no",label:"Yes/No"},{value:"text",label:"Free Text"},{value:"multiple_choice",label:"Multiple Choice"}];function k(e){var t,s,l,i,o,c;let{organizationId:m}=e,[h,p]=(0,r.useState)([]),[g,y]=(0,r.useState)(!0),[b,j]=(0,r.useState)(null),[f,v]=(0,r.useState)(!1),[k,_]=(0,r.useState)(!1),{role:C,plan:S}=(0,N.e)(m),E="owner"===C||"admin"===C,A=S&&["insights","global","business","enterprise"].includes(S),[T,L]=(0,r.useState)(null),[I,F]=(0,r.useState)({text:"",type:"scale",required:!0}),[D,P]=(0,r.useState)(""),R=async()=>{if(m)try{y(!0),j(null);let s=await fetch("/api/surveys?orgId=".concat(encodeURIComponent(m)),{credentials:"include"}),a=await s.json();if(a.success)p(a.surveys||[]);else{var e,t;(null==(e=a.error)?void 0:e.code)==="PLAN_LIMIT_EXCEEDED"?p([]):j((null==(t=a.error)?void 0:t.message)||a.error||"Failed to load surveys")}}catch(e){j(e.message||"Failed to load surveys")}finally{y(!1)}};(0,r.useEffect)(()=>{R()},[m]);let M=()=>{L({name:"",description:"",questions:[],is_active:!0}),v(!0)},z=async()=>{if(T&&m&&T.name)try{_(!0),j(null);let t=await fetch("/api/surveys",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...T,organization_id:m})}),s=await t.json();if(s.success)v(!1),L(null),R();else{var e;j((null==(e=s.error)?void 0:e.message)||s.error||"Failed to save survey")}}catch(e){j(e.message||"Failed to save survey")}finally{_(!1)}},W=async e=>{if(confirm("Delete this survey?"))try{(await fetch("/api/surveys?id=".concat(e,"&orgId=").concat(m),{method:"DELETE",credentials:"include"})).ok&&R()}catch(t){u.v.error("SurveyBuilder: failed to delete survey",t,{organizationId:m,surveyId:e})}},q=()=>{D.trim()&&(F({...I,options:[...I.options||[],D.trim()]}),P(""))};return m?A?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Survey Builder"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Create after-call surveys to gather customer feedback"})]}),E&&(0,a.jsx)(n.$,{onClick:M,variant:"primary",children:"New Survey"})]}),b&&(0,a.jsx)("div",{className:"p-3 bg-error-light border border-red-200 rounded-md text-error text-sm",children:b}),g&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Loading surveys..."}),!g&&0===h.length&&!f&&(0,a.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-md border border-gray-200",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Surveys Yet"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"Create a survey to collect feedback after calls"}),E&&(0,a.jsx)(n.$,{onClick:M,children:"Create Your First Survey"})]}),!g&&h.length>0&&!f&&(0,a.jsx)("div",{className:"space-y-3",children:h.map(e=>{var t;return(0,a.jsxs)("div",{className:"p-4 bg-white rounded-md border border-gray-200 hover:border-gray-300 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)(x.E,{variant:e.is_active?"success":"default",children:e.is_active?"Active":"Inactive"})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:e.description}),(0,a.jsxs)("div",{className:"flex gap-4 text-xs text-gray-400",children:[(0,a.jsxs)("span",{children:[(null==(t=e.questions)?void 0:t.length)||0," questions"]}),(0,a.jsxs)("span",{children:["Created ",new Date(e.created_at).toLocaleDateString()]}),void 0!==e.use_count&&(0,a.jsxs)("span",{children:[e.use_count," responses"]})]})]}),E&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>{L({...e}),v(!0)},children:"Edit"}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>W(e.id),className:"text-error hover:text-error",children:"Delete"})]})]}),e.questions&&e.questions.length>0&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400 mb-2",children:"Questions:"}),(0,a.jsxs)("div",{className:"space-y-1",children:[e.questions.slice(0,3).map((e,t)=>(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[t+1,". ",e.text,(0,a.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",e.type,")"]})]},e.id)),e.questions.length>3&&(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:["+",e.questions.length-3," more questions"]})]})]})]},e.id)})}),f&&T&&(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:T.id?"Edit Survey":"New Survey"}),(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>v(!1),children:"Cancel"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,a.jsx)(d.p,{label:"Survey Name",value:T.name||"",onChange:e=>L({...T,name:e.target.value}),placeholder:"Customer Satisfaction Survey"}),(0,a.jsx)(d.p,{label:"Description",value:T.description||"",onChange:e=>L({...T,description:e.target.value}),placeholder:"Post-call survey to measure satisfaction"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Questions (",(null==(t=T.questions)?void 0:t.length)||0,")"]}),(0,a.jsx)("div",{className:"space-y-2 mb-4",children:null==(s=T.questions)?void 0:s.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-gray-50 rounded-md",children:[(0,a.jsxs)("span",{className:"text-gray-400 text-sm w-6",children:[t+1,"."]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:e.text}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)(x.E,{variant:"default",children:e.type}),e.required&&(0,a.jsx)(x.E,{variant:"warning",children:"Required"})]})]}),(0,a.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>{var t,s;return t=e.id,void(T&&L({...T,questions:null==(s=T.questions)?void 0:s.filter(e=>e.id!==t)}))},className:"text-error",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-md border border-gray-200 space-y-3",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Add Question"}),(0,a.jsx)(d.p,{label:"Question Text",value:I.text||"",onChange:e=>F({...I,text:e.target.value}),placeholder:"How satisfied were you with our service today?"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),(0,a.jsx)("select",{value:I.type||"scale",onChange:e=>F({...I,type:e.target.value,options:"multiple_choice"===e.target.value?[]:void 0}),className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-gray-900 text-sm focus:ring-2 focus:ring-primary-600 focus:border-primary-600",children:w.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsx)("div",{className:"flex items-end gap-2",children:(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[(0,a.jsx)("input",{type:"checkbox",checked:null==(o=I.required)||o,onChange:e=>F({...I,required:e.target.checked}),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-600"}),"Required"]})})]}),"multiple_choice"===I.type&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Options"}),(0,a.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,a.jsx)(d.p,{value:D,onChange:e=>P(e.target.value),placeholder:"Add option",onKeyDown:e=>"Enter"===e.key&&q()}),(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:q,children:"Add"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:null==(l=I.options)?void 0:l.map((e,t)=>(0,a.jsxs)(x.E,{variant:"default",className:"gap-1",children:[e,(0,a.jsx)("button",{onClick:()=>{var e;F({...I,options:null==(e=I.options)?void 0:e.filter((e,s)=>s!==t)})},className:"ml-1 hover:text-error",children:(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))})]}),(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>{var e,t;if(!T||!I.text||!I.type)return;let s={id:"q_".concat(Date.now()),text:I.text,type:I.type,options:"multiple_choice"===I.type?I.options:void 0,required:null==(t=I.required)||t,order:((null==(e=T.questions)?void 0:e.length)||0)+1};L({...T,questions:[...T.questions||[],s]}),F({text:"",type:"scale",required:!0,options:[]})},disabled:!I.text,className:"w-full",children:"Add Question"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"survey-active",checked:null==(c=T.is_active)||c,onChange:e=>L({...T,is_active:e.target.checked}),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-600"}),(0,a.jsx)("label",{htmlFor:"survey-active",className:"text-sm text-gray-700",children:"Survey is active and can be assigned to calls"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),(0,a.jsx)(n.$,{onClick:z,disabled:k||!T.name||!(null==(i=T.questions)?void 0:i.length),variant:"primary",children:k?"Saving...":"Save Survey"})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-info-light border border-blue-200 rounded-md",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"How Surveys Work"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1 list-disc list-inside",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"After-Call:"})," Survey runs automatically after call ends"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"AI-Powered:"})," Voice bot asks questions using natural TTS"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Analytics:"})," Results appear in call artifacts and dashboard"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Scale Questions:"}),' "Rate 1 to 5" with voice recognition']}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Text Questions:"})," Open-ended responses transcribed"]})]})]})]}):(0,a.jsxs)("div",{className:"text-center py-12 bg-warning-light rounded-md border border-amber-200",children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-warning",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Survey Feature"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"After-call surveys require the Insights plan or higher"}),(0,a.jsx)(n.$,{onClick:()=>window.location.href="/settings?tab=billing",children:"Upgrade Plan"})]}):(0,a.jsx)("div",{className:"text-gray-500 p-4",children:"Organization required"})}var _=s(7235);function C(e){var t,s;let{organizationId:l,canEdit:i}=e,[n,d]=(0,r.useState)(null),[o,c]=(0,r.useState)([]),[m,h]=(0,r.useState)(!0),[p,g]=(0,r.useState)(!1),[y,b]=(0,r.useState)(null),[j,f]=(0,r.useState)(!1),[v,N]=(0,r.useState)(""),[w,k]=(0,r.useState)(""),[C,S]=(0,r.useState)(!1);async function E(e){g(!0),b(null);try{let t=await fetch("/api/retention",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to save policy");let s=await t.json();d(s.policy)}catch(t){b("Failed to save retention policy"),u.v.error("RetentionSettings: failed to save policy",t,{organizationId:l,updates:e})}finally{g(!1)}}async function A(){if(v.trim()){g(!0),b(null);try{let e=await fetch("/api/retention/legal-holds",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({hold_name:v,matter_reference:w||void 0,applies_to_all:C})});if(!e.ok)throw Error("Failed to create legal hold");let t=await e.json();c(e=>[t.legal_hold,...e]),f(!1),N(""),k(""),S(!1)}catch(e){b("Failed to create legal hold"),u.v.error("RetentionSettings: failed to create legal hold",e,{organizationId:l,holdName:v,appliesToAll:C})}finally{g(!1)}}}async function T(e,t){g(!0),b(null);try{if(!(await fetch("/api/retention/legal-holds",{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({hold_id:e,release_reason:t})})).ok)throw Error("Failed to release legal hold");c(t=>t.map(t=>t.id===e?{...t,status:"released"}:t))}catch(t){b("Failed to release legal hold"),u.v.error("RetentionSettings: failed to release legal hold",t,{organizationId:l,holdId:e})}finally{g(!1)}}if((0,r.useEffect)(()=>{!async function(){try{let[e,t]=await Promise.all([fetch("/api/retention",{credentials:"include"}),fetch("/api/retention/legal-holds",{credentials:"include"})]);if(e.ok){let t=await e.json();d(t.policy)}if(t.ok){let e=await t.json();c(e.legal_holds||[])}}catch(e){b("Failed to load retention settings"),u.v.error("RetentionSettings: failed to load policy or holds",e,{organizationId:l})}finally{h(!1)}}()},[l]),m)return(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{className:"ml-3 text-gray-500",children:"Loading retention settings..."})]});let L=o.filter(e=>"active"===e.status);return(0,a.jsxs)("div",{className:"space-y-8",children:[y&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 text-sm text-red-700",children:y}),(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Retention Policy"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Configure how long call evidence is retained and when it's automatically archived."})]}),(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-6 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Default Retention Class"}),(0,a.jsxs)("select",{value:(null==n?void 0:n.default_retention_class)||"default",onChange:e=>E({default_retention_class:e.target.value}),disabled:!i||p,className:"w-full md:w-auto px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100",children:[(0,a.jsx)("option",{value:"default",children:"Default (Standard)"}),(0,a.jsx)("option",{value:"regulated",children:"Regulated (Extended retention)"}),(0,a.jsx)("option",{value:"legal_hold",children:"Legal Hold (Indefinite)"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Applied to all new calls. Existing calls are not affected."})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Auto-Archive After (Days)"}),(0,a.jsx)("input",{type:"number",min:"0",value:null!=(t=null==n?void 0:n.auto_archive_after_days)?t:90,onChange:e=>E({auto_archive_after_days:parseInt(e.target.value)||null}),disabled:!i||p,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"0 = Never auto-archive"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Regulated Retention (Days)"}),(0,a.jsx)("input",{type:"number",min:"0",value:null!=(s=null==n?void 0:n.regulated_retention_days)?s:2555,onChange:e=>E({regulated_retention_days:parseInt(e.target.value)||0}),disabled:!i||p,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"~7 years (2555 days) for regulatory compliance"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Legal Hold Contact Email"}),(0,a.jsx)("input",{type:"email",value:(null==n?void 0:n.legal_hold_contact_email)||"",onChange:e=>E({legal_hold_contact_email:e.target.value||null}),disabled:!i||p,placeholder:"legal@company.com",className:"w-full md:w-96 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Notified when legal holds are created or released"})]})]})]}),(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Legal Holds"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Preserve evidence for litigation, audits, or regulatory requests."})]}),i&&(0,a.jsx)("button",{onClick:()=>f(!0),disabled:p,className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 disabled:opacity-50",children:"Create Legal Hold"})]}),L.length>0&&(0,a.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-amber-600 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-amber-800",children:[L.length," Active Legal Hold",1!==L.length?"s":""]}),(0,a.jsx)("p",{className:"text-xs text-amber-700 mt-1",children:"Evidence under legal hold cannot be deleted or exported without release."})]})]})}),j&&(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-6 space-y-4",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"New Legal Hold"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hold Name *"}),(0,a.jsx)("input",{type:"text",value:v,onChange:e=>N(e.target.value),placeholder:"e.g., Smith v. Company - Document Preservation",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Matter Reference"}),(0,a.jsx)("input",{type:"text",value:w,onChange:e=>k(e.target.value),placeholder:"e.g., Case #2026-CV-1234",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary-500"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(_.d,{checked:C,onCheckedChange:S,"aria-label":"Apply to all calls"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Apply to all calls"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Hold all current and future call evidence"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{onClick:()=>f(!1),className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-900",children:"Cancel"}),(0,a.jsx)("button",{onClick:A,disabled:!v.trim()||p,className:"px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-md hover:bg-primary-700 disabled:opacity-50",children:p?"Creating...":"Create Hold"})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 divide-y divide-gray-200",children:0===o.length?(0,a.jsx)("div",{className:"p-6 text-center text-sm text-gray-500",children:"No legal holds. Evidence can be exported and deleted normally."}):o.map(e=>(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.hold_name}),(0,a.jsx)(x.E,{variant:"active"===e.status?"warning":"default",children:e.status})]}),e.matter_reference&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:e.matter_reference}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.applies_to_all?"All calls":"".concat(e.affected_call_count," calls")," \xb7 ","Created ",new Date(e.created_at).toLocaleDateString()]})]}),i&&"active"===e.status&&(0,a.jsx)("button",{onClick:()=>{let t=prompt("Enter reason for releasing this legal hold:");t&&T(e.id,t)},disabled:p,className:"text-xs text-red-600 hover:text-red-700 font-medium",children:"Release"})]})},e.id))})]}),(0,a.jsxs)("section",{className:"bg-white rounded-md border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:"Export Compliance"}),(0,a.jsxs)("ul",{className:"space-y-3 text-sm text-gray-600",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-success mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("span",{children:"All export requests are logged in the audit trail"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-success mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("span",{children:"Calls under legal hold cannot be exported until released"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-success mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("span",{children:"Retention policy compliance is verified before each export"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-success mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("span",{children:"Export bundles include cryptographic integrity verification"})]})]})]})]})}function S(e){let{organizationId:t,plan:s}=e,[l,i]=(0,r.useState)(null),[n,d]=(0,r.useState)(!0),[o,c]=(0,r.useState)(null);if((0,r.useEffect)(()=>{async function e(){try{d(!0);let e=await fetch("/api/usage",{credentials:"include"});if(!e.ok)throw Error("Failed to fetch usage data");let t=await e.json();i(t)}catch(e){u.v.error("Failed to fetch usage",e,{organizationId:t}),c(e.message||"Failed to load usage data")}finally{d(!1)}}t&&e()},[t]),n)return(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-center h-32",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{className:"ml-3 text-gray-500",children:"Loading usage..."})]})});if(o||!l)return(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-amber-600",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("span",{className:"text-sm",children:o||"Unable to load usage data"})]})});let{usage:m,limits:h}=l,p=h.max_calls?Math.min(m.calls/h.max_calls*100,100):0,g=h.max_minutes?Math.min(m.minutes/h.max_minutes*100,100):0,y=p>=80,b=g>=80;return(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Current Plan"}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-gray-900 capitalize",children:s||"Free"})]}),(0,a.jsx)(x.E,{variant:"success",children:"Active"})]}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Calls this month"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[m.calls," ",h.max_calls?"/ ".concat(h.max_calls):""]})]}),h.max_calls&&(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all ".concat(y?"bg-amber-500":"bg-primary-600"),style:{width:"".concat(p,"%")}})}),y&&(0,a.jsxs)("p",{className:"text-xs text-amber-600 flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Approaching call limit"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Minutes used"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[m.minutes," ",h.max_minutes?"/ ".concat(h.max_minutes):""]})]}),h.max_minutes&&(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all ".concat(b?"bg-amber-500":"bg-primary-600"),style:{width:"".concat(g,"%")}})}),b&&(0,a.jsxs)("p",{className:"text-xs text-amber-600 flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Approaching minute limit"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Transcriptions"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:m.transcriptions})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Translations"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:m.translations})]})]})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Live Translation"}),(0,a.jsx)(x.E,{variant:h.allow_live_translation?"default":"secondary",children:h.allow_live_translation?"Enabled":"Disabled"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Survey Calls"}),(0,a.jsx)(x.E,{variant:h.allow_survey_calls?"default":"secondary",children:h.allow_survey_calls?"Enabled":"Disabled"})]})]}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Billing period: ",new Date(m.period_start).toLocaleDateString()," - ",new Date(m.period_end).toLocaleDateString()]})})]})}var E=s(83209),A=s(2546),T=s(25016);let L=A.bL,I=A.l9,F=A.ZL,D=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(A.hJ,{className:(0,T.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});D.displayName=A.hJ.displayName;let P=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsxs)(F,{children:[(0,a.jsx)(D,{}),(0,a.jsx)(A.UC,{ref:t,className:(0,T.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});P.displayName=A.UC.displayName;let R=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,T.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};R.displayName="AlertDialogHeader";let M=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,T.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};M.displayName="AlertDialogFooter";let z=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(A.hE,{ref:t,className:(0,T.cn)("text-lg font-semibold",s),...r})});z.displayName=A.hE.displayName;let W=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(A.VY,{ref:t,className:(0,T.cn)("text-sm text-gray-500",s),...r})});W.displayName=A.VY.displayName;let q=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(A.rc,{ref:t,className:(0,T.cn)("inline-flex h-10 items-center justify-center rounded-md bg-gray-900 px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-gray-900/90 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...r})});q.displayName=A.rc.displayName;let B=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(A.ZD,{ref:t,className:(0,T.cn)("mt-2 inline-flex h-10 items-center justify-center rounded-md border border-gray-200 bg-white px-4 py-2 text-sm font-semibold transition-colors hover:bg-gray-100 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 sm:mt-0",s),...r})});B.displayName=A.ZD.displayName;var O=s(42529),U=s(78874),$=s(35299),V=s(78519),H=s(95704);function J(e){let{organizationId:t,role:s}=e,l=(0,i.useRouter)(),[d,o]=(0,r.useState)(null),[c,m]=(0,r.useState)(!0),[h,p]=(0,r.useState)(!1),[g,y]=(0,r.useState)(!1),[b,j]=(0,r.useState)(null),f="owner"===s||"admin"===s;(0,r.useEffect)(()=>{v()},[t]);let v=async()=>{try{m(!0),j(null);let e=await fetch("/api/billing/subscription?orgId=".concat(t),{credentials:"include"});if(!e.ok){if(404===e.status)return void o(null);throw Error("Failed to fetch subscription")}let s=await e.json();o(s.subscription)}catch(e){u.v.error("Error fetching subscription",e,{organizationId:t}),j(e instanceof Error?e.message:"Failed to load subscription")}finally{m(!1)}},N=async()=>{if(f)try{y(!0),j(null);let e=await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:H.env.NEXT_PUBLIC_STRIPE_PRO_PRICE_ID,organizationId:t}),credentials:"include"});if(!e.ok)throw Error("Failed to create checkout session");let{url:s}=await e.json();window.location.href=s}catch(e){u.v.error("Error upgrading subscription",e,{organizationId:t}),j(e instanceof Error?e.message:"Failed to upgrade")}finally{y(!1)}},w=async()=>{if(f)try{y(!0),j(null);let e=await fetch("/api/billing/portal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organizationId:t}),credentials:"include"});if(!e.ok)throw Error("Failed to access billing portal");let{url:s}=await e.json();window.location.href=s}catch(e){u.v.error("Error accessing billing portal",e,{organizationId:t}),j(e instanceof Error?e.message:"Failed to access billing portal")}finally{y(!1)}},k=async()=>{if(f)try{if(p(!0),j(null),!(await fetch("/api/billing/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organizationId:t}),credentials:"include"})).ok)throw Error("Failed to cancel subscription");await v(),l.refresh()}catch(e){u.v.error("Error canceling subscription",e,{organizationId:t}),j(e instanceof Error?e.message:"Failed to cancel subscription")}finally{p(!1)}};return c?(0,a.jsxs)(E.Zp,{children:[(0,a.jsxs)(E.aR,{children:[(0,a.jsx)(E.ZB,{children:"Subscription"}),(0,a.jsx)(E.BT,{children:"Manage your subscription plan"})]}),(0,a.jsx)(E.Wu,{className:"flex items-center justify-center py-12",children:(0,a.jsx)($.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})]}):d?(0,a.jsxs)(E.Zp,{children:[(0,a.jsxs)(E.aR,{children:[(0,a.jsxs)(E.ZB,{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Subscription"}),(e=>{let t={active:{label:"Active",variant:"success",icon:O.A},trialing:{label:"Trial",variant:"default",icon:O.A},past_due:{label:"Past Due",variant:"error",icon:U.A},canceled:{label:"Canceled",variant:"secondary",icon:U.A},incomplete:{label:"Incomplete",variant:"error",icon:U.A}}[e],s=t.icon;return(0,a.jsxs)(x.E,{variant:t.variant,className:"flex items-center gap-1",children:[(0,a.jsx)(s,{className:"h-3 w-3"}),t.label]})})(d.status)]}),(0,a.jsx)(E.BT,{children:"Manage your subscription plan"})]}),(0,a.jsx)(E.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Plan"}),(0,a.jsx)("span",{className:"text-sm",children:d.plan_name})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Amount"}),(0,a.jsxs)("span",{className:"text-sm font-semibold",children:[(0,T.vv)(d.amount,d.currency),"/",d.interval]})]})]}),(0,a.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Current Period"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[(0,T.Yq)(d.current_period_start)," -"," ",(0,T.Yq)(d.current_period_end)]})]}),d.trial_end&&new Date(d.trial_end)>new Date&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Trial Ends"}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:(0,T.Yq)(d.trial_end)})]}),d.cancel_at_period_end?(0,a.jsx)("div",{className:"rounded-lg bg-destructive/10 p-3",children:(0,a.jsxs)("p",{className:"text-sm font-medium text-destructive",children:["Subscription will be canceled on ",(0,T.Yq)(d.current_period_end)]})}):(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Next Billing Date"}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:(0,T.Yq)(d.current_period_end)})]})]}),b&&(0,a.jsx)("div",{className:"rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:b})]})}),(0,a.jsxs)(E.wL,{className:"flex gap-2",children:[(0,a.jsx)(n.$,{onClick:w,disabled:!f||g,variant:"outline",className:"flex-1",children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.A,{className:"mr-2 h-4 w-4"}),"Manage Subscription"]})}),!d.cancel_at_period_end&&(0,a.jsxs)(L,{children:[(0,a.jsx)(I,{asChild:!0,children:(0,a.jsx)(n.$,{variant:"destructive",disabled:!f||h,children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Canceling..."]}):"Cancel"})}),(0,a.jsxs)(P,{children:[(0,a.jsxs)(R,{children:[(0,a.jsx)(z,{children:"Cancel Subscription"}),(0,a.jsxs)(W,{children:["Are you sure you want to cancel your subscription? You'll continue to have access until ",(0,T.Yq)(d.current_period_end),", then your plan will revert to Free."]})]}),(0,a.jsxs)(M,{children:[(0,a.jsx)(B,{children:"Keep Subscription"}),(0,a.jsx)(q,{onClick:k,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Cancel Subscription"})]})]})]})]})]}):(0,a.jsxs)(E.Zp,{children:[(0,a.jsxs)(E.aR,{children:[(0,a.jsx)(E.ZB,{children:"Subscription"}),(0,a.jsx)(E.BT,{children:"You're currently on the Free plan"})]}),(0,a.jsx)(E.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:"Free Plan"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"10 calls/month • Basic features"})]}),(0,a.jsx)(x.E,{variant:"secondary",children:"Free"})]}),b&&(0,a.jsx)("div",{className:"rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:b})]})}),(0,a.jsx)(E.wL,{children:(0,a.jsx)(n.$,{onClick:N,disabled:!f||g,className:"w-full",children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.A,{className:"mr-2 h-4 w-4"}),"Upgrade to Pro"]})})})]})}var Z=s(6191),Y=s(71360);function Q(e){let{organizationId:t,role:s}=e,[l,i]=(0,r.useState)([]),[d,o]=(0,r.useState)(!0),[c,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(!1),[g,y]=(0,r.useState)(null),b="owner"===s||"admin"===s;(0,r.useEffect)(()=>{j()},[t]);let j=async()=>{try{o(!0),y(null);let e=await fetch("/api/billing/payment-methods?orgId=".concat(t),{credentials:"include"});if(!e.ok){if(404===e.status)return void i([]);throw Error("Failed to fetch payment methods")}let s=await e.json();i(s.paymentMethods||[])}catch(e){u.v.error("Error fetching payment methods",e,{organizationId:t}),y(e instanceof Error?e.message:"Failed to load payment methods")}finally{o(!1)}},f=async()=>{if(b)try{p(!0),y(null);let e=await fetch("/api/billing/portal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organizationId:t}),credentials:"include"});if(!e.ok)throw Error("Failed to access billing portal");let{url:s}=await e.json();window.location.href=s}catch(e){u.v.error("Error accessing billing portal",e,{organizationId:t}),y(e instanceof Error?e.message:"Failed to add payment method")}finally{p(!1)}},v=async e=>{if(b)try{if(m(e),y(null),!(await fetch("/api/billing/payment-methods/".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({organizationId:t}),credentials:"include"})).ok)throw Error("Failed to remove payment method");await j()}catch(s){u.v.error("Error removing payment method",s,{organizationId:t,paymentMethodId:e}),y(s instanceof Error?s.message:"Failed to remove payment method")}finally{m(null)}};return d?(0,a.jsxs)(E.Zp,{children:[(0,a.jsxs)(E.aR,{children:[(0,a.jsx)(E.ZB,{children:"Payment Methods"}),(0,a.jsx)(E.BT,{children:"Manage your payment methods"})]}),(0,a.jsx)(E.Wu,{className:"flex items-center justify-center py-12",children:(0,a.jsx)($.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})]}):(0,a.jsxs)(E.Zp,{children:[(0,a.jsx)(E.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(E.ZB,{children:"Payment Methods"}),(0,a.jsx)(E.BT,{children:"Manage your payment methods"})]}),(0,a.jsx)(n.$,{onClick:f,disabled:!b||h,size:"sm",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.A,{className:"mr-2 h-4 w-4"}),"Add Payment Method"]})})]})}),(0,a.jsx)(E.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[g&&(0,a.jsx)("div",{className:"rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:g}),0===l.length?(0,a.jsxs)("div",{className:"rounded-lg border border-dashed p-8 text-center",children:[(0,a.jsx)(V.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,a.jsx)("p",{className:"mt-4 text-sm font-medium",children:"No payment methods"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Add a payment method to manage your subscription"})]}):(0,a.jsx)("div",{className:"space-y-3",children:l.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(e.card.brand,(0,a.jsx)(V.A,{className:"h-5 w-5"})),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("p",{className:"font-medium capitalize",children:[e.card.brand," •••• ",e.card.last4]}),e.is_default&&(0,a.jsxs)(x.E,{variant:"secondary",className:"flex items-center gap-1",children:[(0,a.jsx)(O.A,{className:"h-3 w-3"}),"Default"]})]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Expires ",e.card.exp_month.toString().padStart(2,"0"),"/",e.card.exp_year]})]})]}),!e.is_default&&(0,a.jsxs)(L,{children:[(0,a.jsx)(I,{asChild:!0,children:(0,a.jsx)(n.$,{variant:"ghost",size:"sm",disabled:!b||c===e.id,children:c===e.id?(0,a.jsx)($.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(Y.A,{className:"h-4 w-4 text-destructive"})})}),(0,a.jsxs)(P,{children:[(0,a.jsxs)(R,{children:[(0,a.jsx)(z,{children:"Remove Payment Method"}),(0,a.jsx)(W,{children:"Are you sure you want to remove this payment method? This action cannot be undone."})]}),(0,a.jsxs)(M,{children:[(0,a.jsx)(B,{children:"Cancel"}),(0,a.jsx)(q,{onClick:()=>v(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})]})]},e.id))})]})})]})}var G=s(96633),K=s(53409),X=s(39867),ee=s(90368),et=s(27937);function es(e){let{organizationId:t,role:s}=e,[l,i]=(0,r.useState)([]),[d,o]=(0,r.useState)(!0),[c,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(1),[g,y]=(0,r.useState)(!1),b="owner"===s||"admin"===s;(0,r.useEffect)(()=>{b&&j()},[t,h,b]);let j=async()=>{try{o(!0),m(null);let e=await fetch("/api/billing/invoices?orgId=".concat(t,"&page=").concat(h,"&limit=").concat(10),{credentials:"include"});if(!e.ok){if(404===e.status){i([]),y(!1);return}throw Error("Failed to fetch invoices")}let s=await e.json();i(s.invoices||[]),y(s.hasMore||!1)}catch(e){u.v.error("Error fetching invoices",e,{organizationId:t,page:h}),m(e instanceof Error?e.message:"Failed to load invoices")}finally{o(!1)}};return b?d&&0===l.length?(0,a.jsxs)(E.Zp,{children:[(0,a.jsxs)(E.aR,{children:[(0,a.jsx)(E.ZB,{children:"Invoice History"}),(0,a.jsx)(E.BT,{children:"View and download past invoices"})]}),(0,a.jsx)(E.Wu,{className:"flex items-center justify-center py-12",children:(0,a.jsx)($.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})]}):(0,a.jsxs)(E.Zp,{children:[(0,a.jsxs)(E.aR,{children:[(0,a.jsx)(E.ZB,{children:"Invoice History"}),(0,a.jsx)(E.BT,{children:"View and download past invoices"})]}),(0,a.jsx)(E.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[c&&(0,a.jsx)("div",{className:"rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:c}),0===l.length?(0,a.jsxs)("div",{className:"rounded-lg border border-dashed p-8 text-center",children:[(0,a.jsx)(K.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,a.jsx)("p",{className:"mt-4 text-sm font-medium",children:"No invoices yet"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Your invoices will appear here once you have a paid subscription"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"rounded-lg border",children:(0,a.jsxs)(G.XI,{children:[(0,a.jsx)(G.A0,{children:(0,a.jsxs)(G.Hj,{children:[(0,a.jsx)(G.nd,{children:"Invoice"}),(0,a.jsx)(G.nd,{children:"Date"}),(0,a.jsx)(G.nd,{children:"Amount"}),(0,a.jsx)(G.nd,{children:"Status"}),(0,a.jsx)(G.nd,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(G.BF,{children:l.map(e=>(0,a.jsxs)(G.Hj,{children:[(0,a.jsx)(G.nA,{className:"font-medium",children:e.number||e.id.substring(0,8)}),(0,a.jsx)(G.nA,{children:(0,T.Yq)(e.created,{year:"numeric",month:"short",day:"numeric"})}),(0,a.jsx)(G.nA,{children:(0,T.vv)(e.amount_paid,e.currency)}),(0,a.jsx)(G.nA,{children:(e=>{let t={paid:{label:"Paid",variant:"success"},open:{label:"Open",variant:"default"},draft:{label:"Draft",variant:"secondary"},void:{label:"Void",variant:"secondary"},uncollectible:{label:"Uncollectible",variant:"error"}}[e];return(0,a.jsx)(x.E,{variant:t.variant,children:t.label})})(e.status)}),(0,a.jsx)(G.nA,{className:"text-right",children:e.invoice_pdf&&(0,a.jsx)(n.$,{variant:"ghost",size:"sm",asChild:!0,children:(0,a.jsxs)("a",{href:e.invoice_pdf,target:"_blank",rel:"noopener noreferrer",children:[(0,a.jsx)(X.A,{className:"mr-2 h-4 w-4"}),"Download"]})})})]},e.id))})]})}),(h>1||g)&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>p(e=>Math.max(1,e-1)),disabled:1===h||d,children:[(0,a.jsx)(ee.A,{className:"mr-2 h-4 w-4"}),"Previous"]}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",h]}),(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>p(e=>e+1),disabled:!g||d,children:["Next",(0,a.jsx)(et.A,{className:"ml-2 h-4 w-4"})]})]})]})]})})]}):(0,a.jsxs)(E.Zp,{children:[(0,a.jsxs)(E.aR,{children:[(0,a.jsx)(E.ZB,{children:"Invoice History"}),(0,a.jsx)(E.BT,{children:"View and download past invoices"})]}),(0,a.jsx)(E.Wu,{children:(0,a.jsx)("div",{className:"rounded-lg border border-dashed p-8 text-center",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"You don't have permission to view invoices"})})})]})}var ea=s(5917),er=s(65229),el=s(68854),ei=s(56154),en=s(95704);let ed=[{name:"Calls per month",free:"10",pro:"Unlimited"},{name:"Call transcriptions",free:!0,pro:!0},{name:"Real-time translation",free:!1,pro:!0},{name:"AI sentiment analysis",free:!1,pro:!0},{name:"Call recording",free:!0,pro:!0},{name:"Quality scorecards",free:"Basic",pro:"Advanced"},{name:"Team management",free:"3 users",pro:"Unlimited"},{name:"Analytics & reporting",free:"Basic",pro:"Advanced"},{name:"Campaign management",free:!1,pro:!0},{name:"Report builder",free:!1,pro:!0},{name:"Custom webhooks",free:!1,pro:!0},{name:"API access",free:"Limited",pro:"Full"},{name:"Priority support",free:!1,pro:!0},{name:"SLA guarantee",free:!1,pro:!0}];function eo(e){let{currentPlan:t,organizationId:s,role:l}=e;(0,i.useRouter)();let[d,o]=(0,r.useState)(!1),[c,m]=(0,r.useState)(null),h="owner"===l||"admin"===l,p="free"===t,g=async()=>{if(h)try{o(!0),m(null);let e=await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:en.env.NEXT_PUBLIC_STRIPE_PRO_PRICE_ID,organizationId:s}),credentials:"include"});if(!e.ok)throw Error("Failed to create checkout session");let{url:t}=await e.json();window.location.href=t}catch(e){u.v.error("Error upgrading plan",e,{organizationId:s,currentPlan:t}),m(e instanceof Error?e.message:"Failed to upgrade")}finally{o(!1)}},y=e=>"boolean"==typeof e?e?(0,a.jsx)(ea.A,{className:"h-5 w-5 text-green-600"}):(0,a.jsx)(er.A,{className:"h-5 w-5 text-gray-400"}):(0,a.jsx)("span",{className:"text-sm font-medium",children:e});return(0,a.jsxs)(E.Zp,{children:[(0,a.jsxs)(E.aR,{children:[(0,a.jsx)(E.ZB,{children:"Compare Plans"}),(0,a.jsx)(E.BT,{children:"Choose the plan that best fits your needs"})]}),(0,a.jsx)(E.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[c&&(0,a.jsx)("div",{className:"rounded-lg bg-destructive/10 p-3 text-sm text-destructive",children:c}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsx)("div",{}),(0,a.jsx)(E.Zp,{className:"free"===t?"border-primary":"",children:(0,a.jsxs)(E.aR,{className:"pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(E.ZB,{className:"text-lg",children:"Free"}),"free"===t&&(0,a.jsx)(x.E,{variant:"secondary",children:"Current"})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:"$0"}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"/month"})]})]})}),(0,a.jsx)(E.Zp,{className:"pro"===t?"border-primary":"border-primary/50",children:(0,a.jsxs)(E.aR,{className:"pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.ZB,{className:"text-lg",children:"Pro"}),(0,a.jsx)(el.A,{className:"h-5 w-5 text-yellow-500"})]}),"pro"===t&&(0,a.jsx)(x.E,{children:"Current"})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:"$99"}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"/month"})]})]})})]}),(0,a.jsx)("div",{className:"rounded-lg border",children:(0,a.jsx)("div",{className:"divide-y",children:ed.map((e,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 p-4 hover:bg-muted/50",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("span",{className:"text-sm font-medium",children:e.name})}),(0,a.jsx)("div",{className:"flex items-center justify-center",children:y(e.free)}),(0,a.jsx)("div",{className:"flex items-center justify-center",children:y(e.pro)})]},t))})}),p&&(0,a.jsx)(E.Zp,{className:"border-primary bg-primary/5",children:(0,a.jsx)(E.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"rounded-full bg-primary/10 p-3",children:(0,a.jsx)(ei.A,{className:"h-6 w-6 text-primary"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Unlock Pro Features"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Upgrade to Pro for unlimited calls, advanced analytics, campaign management, and priority support."}),(0,a.jsx)(n.$,{onClick:g,disabled:!h||d,className:"mt-4",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(el.A,{className:"mr-2 h-4 w-4"}),"Upgrade to Pro"]})})]})]})})})]})}),(0,a.jsx)(E.wL,{className:"text-sm text-muted-foreground",children:"Need more? Contact us for Enterprise pricing with custom features and SLAs."})]})}let ec=[{value:"en",label:"English"},{value:"es",label:"Spanish"},{value:"fr",label:"French"},{value:"de",label:"German"},{value:"it",label:"Italian"},{value:"pt",label:"Portuguese"},{value:"ja",label:"Japanese"},{value:"zh",label:"Chinese"},{value:"ko",label:"Korean"},{value:"ar",label:"Arabic"}],em=[{value:"gpt-4o-mini",label:"GPT-4o Mini (Recommended)",description:"Fast, cost-effective"},{value:"gpt-4o",label:"GPT-4o",description:"Balanced performance"},{value:"gpt-4-turbo",label:"GPT-4 Turbo",description:"Maximum capability"}];function ex(e){var t,s,l,i,n,d,o,c,m;let{organizationId:u,plan:h,canEdit:p}=e,[g,y]=(0,r.useState)(null),[b,j]=(0,r.useState)(!0),[f,v]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),[k,C]=(0,r.useState)(null),[S,E]=(0,r.useState)({ai_features_enabled:!0,ai_agent_temperature:.3,ai_agent_model:"gpt-4o-mini"});async function A(){try{j(!0);let e=await fetch("/api/ai-config",{credentials:"include"});if(!e.ok)throw Error("Failed to load AI configuration");let t=await e.json();y(t),E(t.config)}catch(e){w(e.message||"Failed to load configuration")}finally{j(!1)}}async function T(){try{v(!0),w(null),C(null);let e=await fetch("/api/ai-config",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(S),credentials:"include"});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to save configuration")}C("Configuration saved successfully"),setTimeout(()=>C(null),3e3)}catch(e){w(e.message||"Failed to save configuration")}finally{v(!1)}}function L(e){E(t=>({...t,...e}))}if((0,r.useEffect)(()=>{A()},[u]),b)return(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-center h-32",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{className:"ml-3 text-gray-500",children:"Loading configuration..."})]})});if(N&&!g)return(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("span",{className:"text-sm",children:N})]})});let I=(null==g?void 0:g.features_available)||{live_translation:!1,custom_agent_id:!1,custom_prompts:!1,voice_cloning:!1};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-primary-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Agent Configuration"})]}),(0,a.jsx)(x.E,{variant:S.ai_features_enabled?"default":"secondary",children:S.ai_features_enabled?"Enabled":"Disabled"})]}),N&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),N]}),k&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md text-sm",children:k}),(0,a.jsx)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"AI Features"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Enable AI-powered call enhancements"})]}),(0,a.jsx)(_.d,{checked:null==(i=S.ai_features_enabled)||i,onCheckedChange:e=>L({ai_features_enabled:e}),disabled:!p})]})}),S.ai_features_enabled&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"Live Translation"}),!I.live_translation&&(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})]}),(0,a.jsx)(_.d,{checked:null!=(n=S.live_translate)&&n,onCheckedChange:e=>L({live_translate:e}),disabled:!p||!I.live_translation})]}),!I.live_translation&&(0,a.jsx)("p",{className:"text-xs text-amber-600",children:"Upgrade to Business or Enterprise for live translation"}),S.live_translate&&(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Translate From"}),(0,a.jsxs)("select",{value:S.translate_from||"",onChange:e=>L({translate_from:e.target.value}),disabled:!p,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-600 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Select language"}),ec.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Translate To"}),(0,a.jsxs)("select",{value:S.translate_to||"",onChange:e=>L({translate_to:e.target.value}),disabled:!p,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-600 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Select language"}),ec.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"Voice Cloning"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Clone voices for personalized translations"})]}),!I.voice_cloning&&(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})]}),(0,a.jsx)(_.d,{checked:null!=(d=S.use_voice_cloning)&&d,onCheckedChange:e=>L({use_voice_cloning:e}),disabled:!p||!I.voice_cloning})]}),!I.voice_cloning&&(0,a.jsx)("p",{className:"text-xs text-amber-600 mt-2",children:"Upgrade to Business or Enterprise for voice cloning"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"AI Model"}),(0,a.jsx)("select",{value:S.ai_agent_model||"gpt-4o-mini",onChange:e=>L({ai_agent_model:e.target.value}),disabled:!p,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-600 focus:border-transparent",children:em.map(e=>(0,a.jsxs)("option",{value:e.value,children:[e.label," - ",e.description]},e.value))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:["Temperature: ",null!=(o=S.ai_agent_temperature)?o:.3]}),(0,a.jsx)("input",{type:"range",min:"0",max:"2",step:"0.1",value:null!=(c=S.ai_agent_temperature)?c:.3,onChange:e=>L({ai_agent_temperature:parseFloat(e.target.value)}),disabled:!p,className:"w-full"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Lower values (0-0.5) are more focused and deterministic. Higher values (1-2) are more creative."})]}),I.custom_agent_id&&(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Custom AI Agent ID (Optional)"}),(0,a.jsx)("input",{type:"text",value:S.ai_agent_id||"",onChange:e=>L({ai_agent_id:e.target.value}),disabled:!p,placeholder:"SignalWire AI Agent ID",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-600 focus:border-transparent"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank to use default agent. Enter your SignalWire AI Agent ID for custom configuration."})]}),I.custom_prompts&&(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Custom System Prompt (Optional)"}),(0,a.jsx)("textarea",{value:S.ai_agent_prompt||"",onChange:e=>L({ai_agent_prompt:e.target.value}),disabled:!p,rows:4,placeholder:"Custom instructions for the AI agent...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-600 focus:border-transparent font-mono text-sm"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Override default translation prompt with custom instructions."})]}),(I.custom_agent_id||I.custom_prompts)&&(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900",children:"Post-Prompt Webhook URL (Optional)"}),(0,a.jsx)(x.E,{variant:"secondary",className:"text-xs",children:"Advanced"})]}),(0,a.jsx)("input",{type:"url",value:S.ai_post_prompt_url||"",onChange:e=>L({ai_post_prompt_url:e.target.value}),disabled:!p,placeholder:"https://your-domain.com/webhooks/ai-agent",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-600 focus:border-transparent font-mono text-sm"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Webhook endpoint called after AI agent completes processing. Must be HTTPS. Used for custom integrations and workflow triggers."}),(0,a.jsx)("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:(0,a.jsxs)("p",{className:"text-xs text-gray-700",children:[(0,a.jsx)("strong",{className:"text-gray-900",children:"Webhook Payload:"})," Receives call metadata, AI model used, processing time, and agent output. See"," ",(0,a.jsx)("a",{href:"/docs/webhooks/ai-agent",className:"text-primary-600 hover:text-primary-700 underline",children:"webhook documentation"})," ","for payload schema."]})})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-primary-50 to-blue-50 rounded-md border border-primary-200 p-4",children:[(0,a.jsxs)("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-primary-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Current Configuration"]}),(0,a.jsxs)("dl",{className:"space-y-2 text-xs",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("dt",{className:"text-gray-600",children:"AI Features:"}),(0,a.jsx)("dd",{className:"font-medium text-gray-900",children:S.ai_features_enabled?"✓ Enabled":"✗ Disabled"})]}),S.ai_features_enabled&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("dt",{className:"text-gray-600",children:"Model:"}),(0,a.jsx)("dd",{className:"font-medium text-gray-900",children:(null==(t=em.find(e=>e.value===S.ai_agent_model))?void 0:t.label)||"GPT-4o Mini"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("dt",{className:"text-gray-600",children:"Temperature:"}),(0,a.jsx)("dd",{className:"font-medium text-gray-900",children:null!=(m=S.ai_agent_temperature)?m:.3})]}),S.live_translate&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("dt",{className:"text-gray-600",children:"Live Translation:"}),(0,a.jsxs)("dd",{className:"font-medium text-gray-900",children:[null==(s=S.translate_from)?void 0:s.toUpperCase()," → ",null==(l=S.translate_to)?void 0:l.toUpperCase()]})]}),S.use_voice_cloning&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("dt",{className:"text-gray-600",children:"Voice Cloning:"}),(0,a.jsx)("dd",{className:"font-medium text-gray-900",children:"✓ Enabled"})]}),S.ai_agent_id&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("dt",{className:"text-gray-600",children:"Custom Agent:"}),(0,a.jsx)("dd",{className:"font-mono text-xs text-gray-900 truncate max-w-[200px]",title:S.ai_agent_id,children:S.ai_agent_id})]}),S.ai_post_prompt_url&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("dt",{className:"text-gray-600",children:"Webhook:"}),(0,a.jsx)("dd",{className:"font-medium text-gray-900",children:"✓ Configured"})]})]})]})]}),p&&(0,a.jsx)("button",{onClick:T,disabled:f,className:"w-full py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-md font-medium transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:f?"Saving...":"Save Configuration"}),!p&&(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Contact your organization owner or admin to modify AI settings"})]})]})}let eu=["call.started","call.answered","call.completed","call.failed","call.disposition_set","recording.available","recording.transcribed","transcript.completed","translation.completed","survey.completed","scorecard.completed","evidence.exported"];function eh(e){var t,s;let{organizationId:l,webhook:i,onClose:n,onSuccess:d}=e,o=!!i,[c,m]=(0,r.useState)((null==i?void 0:i.name)||""),[x,u]=(0,r.useState)((null==i?void 0:i.url)||""),[h,p]=(0,r.useState)((null==i?void 0:i.events)||[]),[g,y]=(0,r.useState)((null==i?void 0:i.retry_policy)||"exponential"),[b,j]=(0,r.useState)((null==i||null==(t=i.max_retries)?void 0:t.toString())||"5"),[f,v]=(0,r.useState)((null==i||null==(s=i.timeout_ms)?void 0:s.toString())||"30000"),[N,w]=(0,r.useState)((null==i?void 0:i.headers)?Object.entries(i.headers).map(e=>{let[t,s]=e;return{key:t,value:s}}):[]),[k,_]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),[E,A]=(0,r.useState)(null),[T,L]=(0,r.useState)(null),[I,F]=(0,r.useState)(null),[D,P]=(0,r.useState)(null),[R,M]=(0,r.useState)(null);function z(e){return!e||e.length<1||e.length>100?(F("Name must be 1-100 characters"),!1):(F(null),!0)}function W(e){try{let t=new URL(e);if(!["http:","https:"].includes(t.protocol))return P("URL must use HTTP or HTTPS"),!1;return P(null),!0}catch(e){return P("Invalid URL format"),!1}}function q(e,t,s){let a=[...N];a[e][t]=s,w(a)}async function B(e){e.preventDefault();let t=z(c),s=W(x),a=0===h.length?(M("Select at least one event type"),!1):(M(null),!0);if(t&&s&&a)try{var r,l;S(!0),A(null);let e={};N.forEach(t=>{t.key&&t.value&&(e[t.key]=t.value)});let t={name:c,url:x,events:h,headers:e,retry_policy:g,max_retries:parseInt(b),timeout_ms:parseInt(f)},s=o?"/api/webhooks/subscriptions/".concat(i.id):"/api/webhooks/subscriptions",a=await fetch(s,{method:o?"PATCH":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(!a.ok){let e=await a.json();throw Error((null==(l=e.error)?void 0:l.message)||"Failed to save webhook")}let m=await a.json();!o&&(null==(r=m.subscription)?void 0:r.secret)?L(m.subscription.secret):(d(),n())}catch(e){A(e.message||"Failed to save webhook")}finally{S(!1)}}return T?(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-2xl",children:"✓"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Webhook Created!"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Save this secret - it won't be shown again."})]}),(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Webhook Secret"}),(0,a.jsx)("code",{className:"block bg-white p-3 rounded border border-gray-300 font-mono text-sm text-gray-900 break-all",children:T}),(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(T)},className:"mt-3 w-full px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Copy Secret"})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{d(),n()},className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Done"})})]})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("form",{onSubmit:B,children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:o?"Edit Webhook":"Create Webhook"}),(0,a.jsx)("button",{type:"button",onClick:n,className:"text-gray-400 hover:text-gray-500 text-2xl leading-none","aria-label":"Close",children:"\xd7"})]}),E&&(0,a.jsx)("div",{className:"mx-6 mt-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:E})}),(0,a.jsxs)("div",{className:"px-6 py-4 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Webhook Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:c,onChange:e=>m(e.target.value),onBlur:e=>z(e.target.value),placeholder:"Slack notifications",className:"block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600 sm:text-sm ".concat(I?"border-red-300":"border-gray-300"),required:!0}),I&&(0,a.jsx)("p",{className:"mt-1 text-xs text-red-600",children:I}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Internal name to identify this webhook"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Endpoint URL ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"url",value:x,onChange:e=>u(e.target.value),onBlur:e=>W(e.target.value),placeholder:"https://your-app.com/webhooks/word-is-bond",className:"block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600 sm:text-sm ".concat(D?"border-red-300":"border-gray-300"),required:!0}),D&&(0,a.jsx)("p",{className:"mt-1 text-xs text-red-600",children:D}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Must be HTTPS"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Events to Subscribe ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3 border border-gray-200 rounded-md p-4",children:eu.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:h.includes(e),onChange:()=>{h.includes(e)?p(h.filter(t=>t!==e)):p([...h,e])},className:"h-4 w-4 text-primary-600 focus:ring-primary-600 border-gray-300 rounded"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e})]},e))}),R&&(0,a.jsx)("p",{className:"mt-1 text-xs text-red-600",children:R}),(0,a.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["Select at least one event type (",h.length," selected)"]})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>_(!k),className:"flex items-center gap-2 text-sm font-medium text-gray-700 hover:text-gray-900",children:[(0,a.jsx)("span",{children:k?"▼":"▶"}),"Advanced Settings"]}),k&&(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Retry Policy"}),(0,a.jsxs)("select",{value:g,onChange:e=>y(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600 sm:text-sm",children:[(0,a.jsx)("option",{value:"none",children:"None - Don't retry failed deliveries"}),(0,a.jsx)("option",{value:"fixed",children:"Fixed - Retry with fixed interval"}),(0,a.jsx)("option",{value:"exponential",children:"Exponential - Exponential backoff (recommended)"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Retries"}),(0,a.jsx)("input",{type:"number",min:"0",max:"10",value:b,onChange:e=>j(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600 sm:text-sm"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Maximum 10 retries"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timeout (ms)"}),(0,a.jsx)("input",{type:"number",min:"1000",max:"60000",step:"1000",value:f,onChange:e=>v(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600 sm:text-sm"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"1000-60000ms (1-60 seconds)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Headers"}),(0,a.jsxs)("div",{className:"space-y-2",children:[N.map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Header name",value:e.key,onChange:e=>q(t,"key",e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600 sm:text-sm"}),(0,a.jsx)("input",{type:"text",placeholder:"Header value",value:e.value,onChange:e=>q(t,"value",e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600 sm:text-sm"}),(0,a.jsx)("button",{type:"button",onClick:()=>{w(N.filter((e,s)=>s!==t))},className:"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Remove"})]},t)),(0,a.jsx)("button",{type:"button",onClick:function(){w([...N,{key:"",value:""}])},className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"+ Add Header"})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Add custom headers for authentication or API keys"})]})]})]})]}),(0,a.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 sticky bottom-0 bg-white",children:[(0,a.jsx)("button",{type:"button",onClick:n,disabled:C,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:C||!c||!x||0===h.length,className:"px-4 py-2 bg-primary-600 text-white rounded-md text-sm font-medium hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:C?"Saving...":o?"Update Webhook":"Create Webhook"})]})]})})})}function ep(e){let{status:t}=e,s={pending:{bg:"bg-blue-100",text:"text-blue-700",label:"Pending",icon:"⏱️"},processing:{bg:"bg-blue-100",text:"text-blue-700",label:"Processing",icon:"⚙️"},delivered:{bg:"bg-green-100",text:"text-green-700",label:"Delivered",icon:"✓"},failed:{bg:"bg-red-100",text:"text-red-700",label:"Failed",icon:"✕"},retrying:{bg:"bg-amber-100",text:"text-amber-700",label:"Retrying",icon:"↻"}}[t];return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(s.bg," ").concat(s.text),role:"status","aria-label":"Status: ".concat(s.label),children:[(0,a.jsx)("span",{"aria-hidden":"true",children:s.icon}),s.label]})}function eg(e){let{webhookId:t,webhookName:s,onClose:l}=e,[i,n]=(0,r.useState)([]),[d,o]=(0,r.useState)(!0),[c,m]=(0,r.useState)(null),[x,u]=(0,r.useState)("all"),[h,p]=(0,r.useState)(0),[g,y]=(0,r.useState)(0);async function b(){try{var e;o(!0),m(null);let s=new URLSearchParams({limit:"50",offset:h.toString()});"all"!==x&&s.append("status",x);let a=await fetch("/api/webhooks/subscriptions/".concat(t,"/deliveries?").concat(s),{credentials:"include"});if(!a.ok)throw Error("Failed to load delivery logs");let r=await a.json();n(r.deliveries||[]),y((null==(e=r.pagination)?void 0:e.total)||0)}catch(e){m(e.message||"Failed to load delivery logs")}finally{o(!1)}}(0,r.useEffect)(()=>{b()},[t,x,h]);let j=h+50<g;return(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Delivery Logs"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:s})]}),(0,a.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-gray-500 text-2xl leading-none","aria-label":"Close",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by status"}),(0,a.jsxs)("select",{value:x,onChange:e=>{u(e.target.value),p(0)},className:"block w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600 sm:text-sm",children:[(0,a.jsx)("option",{value:"all",children:"All Statuses"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"delivered",children:"Delivered"}),(0,a.jsx)("option",{value:"failed",children:"Failed"}),(0,a.jsx)("option",{value:"retrying",children:"Retrying"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:d?(0,a.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),(0,a.jsx)("span",{className:"ml-3 text-gray-500",children:"Loading..."})]}):c?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-red-600",children:c}),(0,a.jsx)("button",{onClick:b,className:"mt-4 px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Retry"})]}):0===i.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500",children:"No deliveries yet"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Deliveries will appear here when events are triggered"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Event"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Response"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attempts"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700",children:e.event_type})}),(0,a.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,a.jsx)(ep,{status:e.status})}),(0,a.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(e.created_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,a.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:e.response_status?(0,a.jsxs)("span",{className:e.response_status>=200&&e.response_status<300?"text-green-600":"text-red-600",children:[e.response_status,e.response_time_ms&&" (".concat(e.response_time_ms,"ms)")]}):e.last_error?(0,a.jsx)("span",{className:"text-red-600 text-xs",title:e.last_error,children:"Error"}):(0,a.jsx)("span",{className:"text-gray-400",children:"—"})}),(0,a.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-600",children:[e.attempts," / ",e.max_attempts]})]},e.id))})]})})}),!d&&i.length>0&&(0,a.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["Showing ",h+1,"-",Math.min(h+i.length,g)," of ",g]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:function(){h>0&&p(Math.max(0,h-50))},disabled:0===h,className:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,a.jsx)("button",{onClick:function(){h+50<g&&p(h+50)},disabled:!j,className:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})})}function ey(e){let{organizationId:t,canEdit:s}=e,[l,i]=(0,r.useState)([]),[n,d]=(0,r.useState)(!0),[o,c]=(0,r.useState)(null),[m,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),[g,y]=(0,r.useState)(null),[b,j]=(0,r.useState)(null),[f,v]=(0,r.useState)(null);async function N(){try{d(!0),c(null);let e=await fetch("/api/webhooks/subscriptions",{credentials:"include"});if(!e.ok)throw Error("Failed to load webhooks");let t=await e.json();i(t.subscriptions||[])}catch(e){c(e.message||"Failed to load webhooks")}finally{d(!1)}}async function w(e){if(s)try{if(!(await fetch("/api/webhooks/subscriptions/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({active:!e.active})})).ok)throw Error("Failed to update webhook");await N()}catch(e){alert(e.message||"Failed to update webhook")}}async function k(e){if(s&&confirm("Are you sure you want to delete this webhook? This action cannot be undone."))try{if(j(e),!(await fetch("/api/webhooks/subscriptions/".concat(e),{method:"DELETE",credentials:"include"})).ok)throw Error("Failed to delete webhook");await N()}catch(e){alert(e.message||"Failed to delete webhook")}finally{j(null)}}async function C(e){if(s)try{v(e.id);let t=await fetch("/api/webhooks/subscriptions/".concat(e.id,"/test"),{method:"POST",credentials:"include"});if(!t.ok)throw Error("Failed to send test webhook");let s=await t.json();alert("Test webhook sent! Check your endpoint for delivery.\n\nDelivery ID: ".concat(s.delivery.id))}catch(e){alert(e.message||"Failed to send test webhook")}finally{v(null)}}return((0,r.useEffect)(()=>{N()},[t]),n)?(0,a.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),(0,a.jsx)("span",{className:"ml-3 text-gray-500",children:"Loading webhooks..."})]}):o?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-red-600",children:o}),(0,a.jsx)("button",{onClick:N,className:"mt-4 px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Retry"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Webhook Subscriptions"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Receive real-time notifications when events occur"})]}),s&&(0,a.jsx)("button",{onClick:()=>{p(null),u(!0)},className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 text-sm font-medium",children:"Create Webhook"})]}),0===l.length?(0,a.jsxs)("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No webhooks"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new webhook subscription."}),s&&(0,a.jsx)("button",{onClick:()=>{p(null),u(!0)},className:"mt-4 px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 text-sm font-medium",children:"Create Webhook"})]}):(0,a.jsx)("div",{className:"space-y-4",children:l.map(e=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6 hover:border-gray-300 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h4",{className:"text-base font-semibold text-gray-900",children:e.name}),e.active?(0,a.jsx)(x.E,{variant:"default",className:"bg-green-100 text-green-700",children:"Active"}):(0,a.jsx)(x.E,{variant:"default",className:"bg-gray-100 text-gray-700",children:"Inactive"})]}),s&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(_.d,{checked:e.active,onCheckedChange:()=>w(e),"aria-label":"Toggle active"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-xl font-bold",onClick:e=>{var t;null==(t=e.currentTarget.nextElementSibling)||t.classList.toggle("hidden")},children:"⋮"}),(0,a.jsxs)("div",{className:"hidden absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:[(0,a.jsx)("button",{onClick:()=>{p(e),u(!0)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>C(e),disabled:f===e.id,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 disabled:opacity-50",children:f===e.id?"Sending...":"Test"}),(0,a.jsx)("button",{onClick:()=>y({id:e.id,name:e.name}),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"View Logs"}),(0,a.jsx)("button",{onClick:()=>k(e.id),disabled:b===e.id,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 disabled:opacity-50 border-t border-gray-200",children:b===e.id?"Deleting...":"Delete"})]})]})]})]}),(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("code",{className:"text-sm text-gray-600 truncate flex-1",title:e.url,children:e.url}),(0,a.jsx)("button",{onClick:()=>{var t;return t=e.url,void navigator.clipboard.writeText(t)},className:"text-gray-400 hover:text-gray-600 text-sm",title:"Copy URL",children:"\uD83D\uDCCB"})]})}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.events.slice(0,3).map(e=>(0,a.jsx)(x.E,{variant:"default",className:"bg-blue-100 text-blue-700",children:e},e)),e.events.length>3&&(0,a.jsxs)(x.E,{variant:"default",className:"bg-gray-100 text-gray-700",children:["+",e.events.length-3," more"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["Created ",new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:["Retry: ",e.retry_policy]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:["Secret: ",e.secret]})]})]},e.id))})]}),m&&(0,a.jsx)(eh,{organizationId:t,webhook:h,onClose:()=>{u(!1),p(null)},onSuccess:()=>{N()}}),g&&(0,a.jsx)(eg,{webhookId:g.id,webhookName:g.name,onClose:()=>y(null)})]})}var eb=s(76806),ej=s(72560);function ef(){var e,t;let{data:s}=(0,l.useSession)(),n=(0,i.useSearchParams)(),d=null==s||null==(e=s.user)?void 0:e.id,o=n.get("tab"),[c,p]=(0,r.useState)(o||"call-config"),[g,b]=r.useState(null),[f,w]=r.useState(null),[_,E]=r.useState(!0);(0,r.useEffect)(()=>{if(!d)return void E(!1);!async function(){try{let e=await fetch("/api/users/".concat(d,"/organization"),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch organization");let t=await e.json();t.organization_id&&(b(t.organization_id),w(t.organization_name||null))}catch(e){u.v.error("Failed to fetch organization",e,{userId:d})}finally{E(!1)}}()},[d]);let{role:A,plan:T}=(0,N.e)(g);if(_)return(0,a.jsx)("main",{className:"min-h-screen bg-gray-50 p-8",children:(0,a.jsx)("div",{className:"max-w-5xl mx-auto",children:(0,a.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{className:"ml-3 text-gray-500",children:"Loading..."})]})})});if(!s||!d)return(0,a.jsx)("main",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto text-center px-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Sign in required"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Please sign in to access your settings."}),(0,a.jsx)("a",{href:"/signin?callbackUrl=/settings",className:"inline-flex items-center justify-center px-6 py-3 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors",children:"Sign In"}),(0,a.jsxs)("p",{className:"mt-4 text-sm text-gray-500",children:["Don't have an account?"," ",(0,a.jsx)("a",{href:"/signup",className:"text-primary-600 hover:text-primary-700",children:"Create one"})]})]})});if(!g)return(0,a.jsx)("main",{className:"min-h-screen bg-gray-50 p-8",children:(0,a.jsxs)("div",{className:"max-w-5xl mx-auto text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"No Organization"}),(0,a.jsx)("p",{className:"text-gray-500",children:"You need to be part of an organization to access settings."})]})});let L=(null==s||null==(t=s.user)?void 0:t.email)||void 0;return(0,a.jsxs)(eb.AppShell,{organizationName:f||void 0,userEmail:L,children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,a.jsxs)("div",{className:"max-w-5xl mx-auto px-6 py-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Settings"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[f||"Your Organization",T&&(0,a.jsx)(x.E,{variant:"default",className:"ml-2",children:T.charAt(0).toUpperCase()+T.slice(1)})]})]})}),(0,a.jsxs)("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[(0,a.jsx)("nav",{className:"flex flex-wrap gap-2 mb-8","data-tour":"settings-tabs",children:[{id:"call-config",label:"Call Configuration",description:"Targets, Caller ID, defaults"},{id:"ai-control",label:"AI & Intelligence",description:"Transcription, translation, surveys"},{id:"quality",label:"Quality Assurance",description:"AI quality evaluation scripts"},{id:"team",label:"Team & Access",description:"Members, roles, permissions"},{id:"webhooks",label:"Webhooks",description:"Event subscriptions & integrations"},{id:"billing",label:"Billing",description:"Plan and payment"}].map(e=>(0,a.jsx)("button",{onClick:()=>p(e.id),"data-tour":"tab-".concat(e.id),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(c===e.id?"bg-primary-600 text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:e.label},e.id))}),(0,a.jsxs)("div",{className:"space-y-8",children:["call-config"===c&&(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Call Targets"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Add and manage phone numbers you want to test or monitor."})]}),(0,a.jsx)(v,{organizationId:g})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-8",children:(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Caller ID Management"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Verify and manage phone numbers that appear as your caller ID."})]}),(0,a.jsx)(h,{organizationId:g})]})})]}),"ai-control"===c&&(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)(ev,{organizationId:g,canEdit:"owner"===A||"admin"===A}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-8",children:(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"AI Agent Configuration"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Configure live translation, voice cloning, and AI model settings."})]}),(0,a.jsx)(ex,{organizationId:g,plan:T||"free",canEdit:"owner"===A||"admin"===A})]})}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-8",children:(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Survey Builder"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Create after-call surveys to gather customer feedback."})]}),(0,a.jsx)(k,{organizationId:g})]})})]}),"quality"===c&&(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"AI Quality Evaluation Scripts"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Create and manage scripts for AI-powered quality evaluations. For internal QA purposes only."})]}),(0,a.jsx)(y,{organizationId:g}),(0,a.jsxs)("div",{className:"border-t border-gray-200 pt-8",children:[(0,a.jsx)(j,{organizationId:g,disabled:"business"!==T&&"enterprise"!==T}),"business"!==T&&"enterprise"!==T&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Upgrade to Business for scorecard templates and QA alerts."})]})]}),"compliance"===c&&(0,a.jsx)(C,{organizationId:g,canEdit:"owner"===A||"admin"===A}),"team"===c&&(0,a.jsx)(m,{organizationId:g}),"webhooks"===c&&(0,a.jsx)("div",{className:"space-y-8",children:(0,a.jsx)("section",{className:"space-y-6",children:(0,a.jsx)(ey,{organizationId:g,canEdit:"owner"===A||"admin"===A})})}),"billing"===c&&(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Billing & Plan"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Manage your subscription and payment methods."})]}),(0,a.jsx)(S,{organizationId:g,plan:T||"free"}),(0,a.jsx)(J,{organizationId:g,role:A||"viewer"}),(0,a.jsx)(Q,{organizationId:g,role:A||"viewer"}),(0,a.jsx)(es,{organizationId:g,role:A||"viewer"}),(0,a.jsx)(eo,{currentPlan:T||"free",organizationId:g,role:A||"viewer"}),(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-4",children:"Upgrade Drivers"}),(0,a.jsx)("div",{className:"grid md:grid-cols-3 gap-4",children:[{title:"Audit‑Ready Evidence",detail:"Custody‑grade bundles with canonical hashing."},{title:"Export + Debug Bundle",detail:"Deterministic exports with manifests + provenance."},{title:"Verification Ready",detail:"Verify bundles and manifests independently."}].map(e=>(0,a.jsxs)("div",{className:"bg-gray-50 rounded-md p-4 border border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.detail})]},e.title))}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("a",{href:"/pricing",className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"View pricing and plan details"})})]})]}),A&&(0,a.jsxs)("div",{className:"text-sm text-gray-500 border-t border-gray-200 pt-4",children:["Your role: ",(0,a.jsx)("span",{className:"text-gray-900 font-medium",children:A}),"owner"===A||"admin"===A?(0,a.jsx)("span",{className:"text-success ml-2",children:"Full settings access"}):(0,a.jsx)("span",{className:"text-warning ml-2",children:"Limited access"})]})]})]}),(0,a.jsx)(ej.WB,{tourId:"settings",steps:ej.V$})]})}function ev(e){let{organizationId:t,canEdit:s}=e,{config:r,updateConfig:l,loading:i}=(0,f.g)(t),n=[{key:"transcribe",label:"AI Transcription",description:"Disable: Source recordings remain. Manual review only.",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},{key:"translate",label:"AI Translation",description:"Disable: Canonical transcripts remain. Translation off.",icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})})}];return i?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{className:"ml-3 text-gray-500",children:"Loading AI settings..."})]}):(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"AI Control & Independence"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"You own your data. We make that real."})]}),(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-md bg-success-light flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-success",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"Evidence Independence"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Disable any AI feature without losing your source evidence"})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:n.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-md border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"text-gray-400",children:e.icon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.label}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.description})]})]}),(0,a.jsx)(_.d,{checked:null!=(t=null==r?void 0:r[e.key])&&t,onCheckedChange:t=>l({[e.key]:t}),disabled:!s,"aria-label":e.label})]},e.key)})}),(0,a.jsx)("div",{className:"mt-6 p-4 bg-info-light rounded-md border border-blue-200",children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{className:"text-gray-900",children:"Why this matters:"})," Your call evidence must be defensible in disputes, audits, and legal proceedings. AI assists — but never replaces — the source of truth. Source recordings and canonical transcripts are always preserved, regardless of AI settings."]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-md border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:"Evidence Guarantee"}),(0,a.jsxs)("ul",{className:"space-y-3 text-sm text-gray-600",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-success mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{className:"text-gray-900",children:"Source recordings"})," are never modified after capture"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-success mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{className:"text-gray-900",children:"Canonical transcripts"})," are versioned and cryptographically hashed"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-success mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{className:"text-gray-900",children:"Evidence manifests"})," provide full provenance chain"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-success mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{className:"text-gray-900",children:"Export bundles"})," are self-contained and vendor-independent"]})]})]})]})]})}function eN(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("main",{className:"min-h-screen bg-gray-50 p-8",children:(0,a.jsxs)("div",{className:"max-w-5xl mx-auto flex items-center justify-center h-64",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("span",{className:"ml-3 text-gray-500",children:"Loading..."})]})}),children:(0,a.jsx)(ef,{})})}},33789:(e,t,s)=>{"use strict";s.d(t,{p:()=>r});var a=s(95155);let r=(0,s(12115).forwardRef)((e,t)=>{let{className:s="",label:r,error:l,hint:i,id:n,...d}=e,o=n||"input-".concat(Math.random().toString(36).substring(2,11)),c="\n      w-full h-10 px-3\n      bg-white border rounded-md\n      text-gray-900 placeholder-gray-400\n      transition-colors duration-150\n      focus:outline-none focus:ring-2 focus:ring-offset-0\n      disabled:bg-gray-50 disabled:text-gray-500 disabled:cursor-not-allowed\n      ".concat(l?"border-error focus:ring-error focus:border-error":"border-gray-300 focus:ring-primary-600 focus:border-primary-600","\n    ").replace(/\s+/g," ").trim();return(0,a.jsxs)("div",{className:"w-full",children:[r&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",htmlFor:o,children:r}),(0,a.jsx)("input",{ref:t,id:o,className:"".concat(c," ").concat(s),"aria-invalid":l?"true":void 0,"aria-describedby":l?"".concat(o,"-error"):i?"".concat(o,"-hint"):void 0,...d}),i&&!l&&(0,a.jsx)("p",{id:"".concat(o,"-hint"),className:"mt-1.5 text-sm text-gray-500",children:i}),l&&(0,a.jsx)("p",{id:"".concat(o,"-error"),className:"mt-1.5 text-sm text-error",role:"alert",children:l})]})});r.displayName="Input"},83209:(e,t,s)=>{"use strict";s.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>i,aR:()=>n,wL:()=>m});var a=s(95155),r=s(12115),l=s(25016);function i(e){let{children:t,className:s="",header:r,footer:i,padding:n="md",...d}=e;return(0,a.jsxs)("div",{className:(0,l.cn)("bg-white border border-gray-200 rounded-md",s),...d,children:[r&&(0,a.jsx)("div",{className:"px-4 py-3 border-b border-gray-200",children:r}),(0,a.jsx)("div",{className:{none:"",sm:"p-3",md:"p-4",lg:"p-6"}[n],children:t}),i&&(0,a.jsx)("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50",children:i})]})}let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...r})});n.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});d.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-gray-500",s),...r})});o.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...r})});c.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...r})});m.displayName="CardFooter"},96633:(e,t,s)=>{"use strict";s.d(t,{A0:()=>n,BF:()=>d,Hj:()=>o,XI:()=>i,nA:()=>m,nd:()=>c});var a=s(95155),r=s(12115),l=s(25016);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",s),...r})})});i.displayName="Table";let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",s),...r})});n.displayName="TableHeader";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...r})});d.displayName="TableBody",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-gray-50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-gray-50 data-[state=selected]:bg-gray-100",s),...r})});o.displayName="TableRow";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-gray-500 [&:has([role=checkbox])]:pr-0",s),...r})});c.displayName="TableHead";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});m.displayName="TableCell",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-gray-500",s),...r})}).displayName="TableCaption"},98075:(e,t,s)=>{"use strict";s.d(t,{U:()=>d,g:()=>o});var a=s(95155),r=s(12115);let l={recording_enabled:"record",transcription_enabled:"transcribe",translation_enabled:"translate",translation_from:"translate_from",translation_to:"translate_to",survey_enabled:"survey",secret_shopper_enabled:"synthetic_caller"};function i(e){let t={};for(let[s,a]of Object.entries(e))t[l[s]||s]=a;return t}let n=(0,r.createContext)(null);function d(e){let{organizationId:t,children:s}=e,[l,d]=(0,r.useState)(null),[o,c]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!t){d(null),c(!1);return}!async function(){if(t)try{c(!0),x(null);let e=await fetch("/api/voice/config?orgId=".concat(encodeURIComponent(t)),{credentials:"include"});if(!e.ok)throw Error("Failed to fetch voice config");let s=await e.json();d(s.config||{})}catch(e){x((null==e?void 0:e.message)||"Failed to load config"),d(null)}finally{c(!1)}}()},[t]);let u=(0,r.useCallback)(async e=>{if(!t)throw Error("Organization ID required");try{var s,a,r,n,o;x(null);let{quick_dial_number:c,from_number:m,target_id:u,campaign_id:h,...p}=e,g={};if("quick_dial_number"in e&&(g.quick_dial_number=c),"from_number"in e&&(g.from_number=m),"target_id"in e&&(g.target_id=u),"campaign_id"in e&&(g.campaign_id=h),Object.keys(g).length>0&&d(e=>({...e||{},...g})),0===Object.keys(p).length)return{...l||{},...g};let y=i(p),b=await fetch("/api/voice/config",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orgId:t,modulations:y})});if(!b.ok){let e=await b.json().catch(()=>({error:"Failed to update config"}));throw Error((null==(s=e.error)?void 0:s.message)||e.error||"Failed to update config")}let j={...(await b.json()).config||{},quick_dial_number:null!=(a=g.quick_dial_number)?a:null==l?void 0:l.quick_dial_number,from_number:null!=(r=g.from_number)?r:null==l?void 0:l.from_number,target_id:null!=(n=g.target_id)?n:null==l?void 0:l.target_id,campaign_id:null!=(o=g.campaign_id)?o:null==l?void 0:l.campaign_id};return d(j),j}catch(e){throw x((null==e?void 0:e.message)||"Failed to update config"),e}},[t,l]);return(0,a.jsx)(n.Provider,{value:{config:l,loading:o,error:m,updateConfig:u},children:s})}function o(e){let t=(0,r.useContext)(n);if(t)return t;let[s,a]=(0,r.useState)(null),[l,d]=(0,r.useState)(!0),[o,c]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!e){a(null),d(!1);return}!async function(){if(e)try{d(!0),c(null);let t=await fetch("/api/voice/config?orgId=".concat(encodeURIComponent(e)),{credentials:"include"});if(!t.ok)throw Error("Failed to fetch voice config");let s=await t.json();a(s.config||{})}catch(e){c((null==e?void 0:e.message)||"Failed to load config"),a(null)}finally{d(!1)}}()},[e]);let m=(0,r.useCallback)(async t=>{var r,l,n,d,o;if(!e)throw Error("Organization ID required");let{quick_dial_number:c,from_number:m,target_id:x,campaign_id:u,...h}=t,p={};if("quick_dial_number"in t&&(p.quick_dial_number=c),"from_number"in t&&(p.from_number=m),"target_id"in t&&(p.target_id=x),"campaign_id"in t&&(p.campaign_id=u),Object.keys(p).length>0&&a(e=>({...e||{},...p})),0===Object.keys(h).length)return{...s||{},...p};let g=i(h),y=await fetch("/api/voice/config",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orgId:e,modulations:g})});if(!y.ok){let e=await y.json().catch(()=>({error:"Failed to update config"}));throw Error((null==(r=e.error)?void 0:r.message)||e.error||"Failed to update config")}let b={...(await y.json()).config||{},quick_dial_number:null!=(l=p.quick_dial_number)?l:null==s?void 0:s.quick_dial_number,from_number:null!=(n=p.from_number)?n:null==s?void 0:s.from_number,target_id:null!=(d=p.target_id)?d:null==s?void 0:s.target_id,campaign_id:null!=(o=p.campaign_id)?o:null==s?void 0:s.campaign_id};return a(b),b},[e,s]);return{config:s,loading:l,error:o,updateConfig:m}}}},e=>{e.O(0,[2619,5239,6964,7627,1887,9851,9871,2560,8441,1255,7358],()=>e(e.s=25015)),_N_E=e.O()}]);