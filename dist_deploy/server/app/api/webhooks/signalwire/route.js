"use strict";(()=>{var a={};a.id=5004,a.ids=[5004],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{a.exports=require("querystring")},12412:a=>{a.exports=require("assert")},14985:a=>{a.exports=require("dns")},15456:(a,b,c)=>{c.d(b,{Eb:()=>i,Tf:()=>h,YO:()=>j});var d=c(60387),e=c(30477);let f={maxAttempts:5,windowMs:9e5,blockMs:9e5};async function g(a,b=f){let c=Date.now(),h=c-b.windowMs;try{let{rows:e}=await (0,d.P)(`SELECT attempted_at, succeeded FROM login_attempts 
       WHERE username = $1 AND attempted_at >= $2 
       ORDER BY attempted_at DESC`,[a,new Date(h).toISOString()]);if(e){let a,d=e.filter(a=>!a.succeeded),f=d.length,g=d[0];if(g&&f>=b.maxAttempts&&(a=new Date(g.attempted_at).getTime()+b.blockMs)>c)return{allowed:!1,remaining:0,resetAt:a,blockedUntil:a};let h=Math.max(0,b.maxAttempts-f);return{allowed:h>0,remaining:h,resetAt:c+b.windowMs,blockedUntil:a}}}catch(a){e.v.warn("rateLimit: DB query failed, using in-memory fallback",{error:a.message})}global.__rateLimiter||(global.__rateLimiter=new Map);let i=global.__rateLimiter,j=i.get(a)||{attempts:[],blockedUntil:0};if(j.attempts=j.attempts.filter(a=>a>h),j.blockedUntil&&j.blockedUntil>c)return{allowed:!1,remaining:0,resetAt:j.blockedUntil,blockedUntil:j.blockedUntil};let k=j.attempts.length;return k>=b.maxAttempts?(j.blockedUntil=c+b.blockMs,i.set(a,j),{allowed:!1,remaining:0,resetAt:j.blockedUntil,blockedUntil:j.blockedUntil}):{allowed:!0,remaining:b.maxAttempts-k,resetAt:c+b.windowMs}}function h(a){let b=a.headers.get("x-forwarded-for");if(b)return b.split(",")[0].trim();let c=a.headers.get("x-real-ip");return c||"unknown"}async function i(a,b=100,c=6e4){let d=await g(a,{maxAttempts:b,windowMs:c,blockMs:c}),e=d.resetAt-Date.now();return{allowed:d.allowed,remaining:d.remaining,resetIn:Math.max(0,e)}}function j(a,b){return async c=>{let d=b?.identifier?b.identifier(c):h(c),e=b?.config||f,i=await g(d,e);if(!i.allowed)return new Response(JSON.stringify({success:!1,error:{code:"RATE_LIMIT_EXCEEDED",message:"Too many requests. Please try again later.",severity:"MEDIUM"}}),{status:429,headers:{"Content-Type":"application/json","X-RateLimit-Limit":String(e.maxAttempts),"X-RateLimit-Remaining":String(i.remaining),"X-RateLimit-Reset":String(Math.ceil(i.resetAt/1e3)),...i.blockedUntil?{"Retry-After":String(Math.ceil((i.blockedUntil-Date.now())/1e3))}:{}}});let j=await a(c);return j.headers.set("X-RateLimit-Limit",String(e.maxAttempts)),j.headers.set("X-RateLimit-Remaining",String(i.remaining)),j.headers.set("X-RateLimit-Reset",String(Math.ceil(i.resetAt/1e3))),j}}},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19917:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>N,patchFetch:()=>M,routeModule:()=>I,serverHooks:()=>L,workAsyncStorage:()=>J,workUnitAsyncStorage:()=>K});var d={};c.r(d),c.d(d,{POST:()=>H,dynamic:()=>C,runtime:()=>D});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(10641),v=c(32524),w=c(60387),x=c(94458),y=c(84988),z=c(30477),A=c(15456),B=c(4667);let C="force-dynamic",D="nodejs";async function E(a){let b=new URL(a.url);z.v.info("SignalWire webhook: incoming request",{path:b.pathname,hasQueryParams:b.search.length>0,queryParams:b.search||"none"});let c="true"===process.env.SIGNALWIRE_SKIP_SIGNATURE_VALIDATION,d=process.env.SIGNALWIRE_TOKEN||process.env.SIGNALWIRE_API_TOKEN;if(d&&!c){let c=a.headers.get("X-SignalWire-Signature")||a.headers.get("X-Twilio-Signature")||a.headers.get("X-Signature")||a.headers.get("Signature");if(c){let e=await a.text(),f=`https://voxsouth.online${b.pathname}${b.search}`;if(z.v.debug("SignalWire webhook: validating signature",{webhookUrl:f.substring(0,60)+"...",hasSignature:!!c}),!(0,x.Ll)(e,c,d,f))return z.v.error("SignalWire webhook: Invalid signature",void 0,{signaturePrefix:c.substring(0,10),source:"signalwire-webhook"}),u.NextResponse.json({success:!1,error:{code:"WEBHOOK_SIGNATURE_INVALID",message:"Invalid webhook signature"}},{status:401});a=new Request(a.url,{method:a.method,headers:a.headers,body:e})}else if(1)return z.v.warn("SignalWire webhook: Signature header missing in production"),u.NextResponse.json({success:!1,error:{code:"WEBHOOK_SIGNATURE_MISSING",message:"Webhook signature required"}},{status:401})}try{await F(a)}catch(a){z.v.error("SignalWire webhook async processing failed",a)}return u.NextResponse.json({ok:!0,received:!0})}async function F(a){try{let b=await (0,B.JY)(a),d=b.CallSid||b.call_sid,e=b.CallStatus||b.call_status,f=b.RecordingSid||b.recording_sid,g=b.RecordingUrl||b.recording_url,h=b.RecordingDuration||b.recording_duration,i=b.CallDuration||b.call_duration,j=b.EventType||b.event_type||(f?"recording":"call"),k=b.RecordingStatus||b.recording_status,l=!!f||!!g||k;if(z.v.info("SignalWire webhook received",{callSid:d?"[REDACTED]":null,callStatus:e,eventType:j,isRecordingCallback:l,hasRecording:!!f,recordingStatus:k||"not-present"}),f||g||k?z.v.info("SignalWire webhook: Recording artifact detected",{recordingSid:f?"[REDACTED]":"MISSING",recordingDuration:h||"MISSING",recordingStatus:k||"MISSING"}):"completed"===e&&z.v.warn("SignalWire webhook: Call completed but NO RECORDING FIELDS",{payloadKeys:Object.keys(b).sort()}),!d)return void z.v.warn("SignalWire webhook: missing CallSid, skipping");let m=new URL(a.url).searchParams.get("callId"),n=null;if(m)try{let a=await (0,w.P)("SELECT id, organization_id, status, started_at, ended_at, call_sid FROM calls WHERE id = $1 LIMIT 1",[m]);a.rows.length>0&&!(n=a.rows[0]).call_sid&&d&&(await (0,w.P)("UPDATE calls SET call_sid = $1 WHERE id = $2",[d,n.id]),z.v.debug("SignalWire webhook: linked call_sid via callId param",{callId:n.id}))}catch(a){z.v.error("SignalWire webhook: error finding call by ID",a)}if(!n)try{let a=await (0,w.P)("SELECT id, organization_id, status, started_at, ended_at FROM calls WHERE call_sid = $1 LIMIT 1",[d]);a.rows.length>0&&(n=a.rows[0])}catch(a){z.v.error("SignalWire webhook: error finding call by SID",a)}if(!n)return void z.v.warn("SignalWire webhook: call not found",{callIdFromUrl:m||"not-provided"});let o=n.id,p=n.organization_id,q=!1;try{let a=await (0,w.P)("SELECT plan FROM organizations WHERE id = $1 LIMIT 1",[p]),b=String(a.rows[0]?.plan??"").toLowerCase(),c=["business","enterprise"].includes(b),d=(0,y.TS)();if(c&&d){let a=(await (0,w.P)("SELECT live_translate, translate_from, translate_to FROM voice_configs WHERE organization_id = $1 LIMIT 1",[p])).rows[0];a?.live_translate===!0&&a?.translate_from&&a?.translate_to&&(q=!0)}}catch(a){z.v.warn("SignalWire webhook: failed to check live translation",{error:a})}if("call"===j||e){let a={completed:"completed",failed:"failed","no-answer":"failed",busy:"failed",ringing:"in_progress","in-progress":"in_progress",queued:"pending"}[e?.toLowerCase()]||e||"unknown",b={status:a};("completed"===a||"failed"===a)&&(b.ended_at=new Date().toISOString());let f="",g=[a],h=2;if(("in_progress"===a||"completed"===a)&&!n.started_at){let a=parseInt(String(i||0),10)||1,c=b.ended_at?new Date(b.ended_at):new Date;b.started_at=new Date(c.getTime()-1e3*a).toISOString(),f=`, started_at = $${h++}`,g.push(b.started_at)}let j="";b.ended_at&&(j=`, ended_at = $${h++}`,g.push(b.ended_at)),g.push(o);try{if(await (0,w.P)(`UPDATE calls SET status = $1 ${f} ${j} WHERE id = $${h}`,g),z.v.info("SignalWire webhook: updated call status",{callId:o,status:a}),["completed","failed"].includes(a)){let{captureAttentionEvent:e}=await Promise.all([c.e(1742),c.e(8499)]).then(c.bind(c,30880));await e({organizationId:p,eventType:"call_completed",sourceTable:"calls",sourceId:o,payload:{callSid:d,status:a,duration:i,ended_at:b.ended_at},inputRefs:[{table:"calls",id:o}]})}}catch(a){z.v.error("SignalWire webhook: failed to update call/RTI",a,{callId:o})}}if(f&&g){let a=null;try{a=(await (0,w.P)("SELECT id, status FROM recordings WHERE recording_sid = $1 LIMIT 1",[f])).rows[0]}catch(a){z.v.error("SignalWire webhook: failed to check existing recording",a)}let b=null;try{let a=await (0,w.P)("SELECT tool_id FROM organizations WHERE id = $1 LIMIT 1",[p]);b=a.rows[0]?.tool_id}catch(a){z.v.error("SignalWire webhook: failed to fetch org tool",a)}if(!b){z.v.warn("SignalWire webhook: organization has no tool_id, attempting to assign",{organizationId:p});try{let a=await (0,w.P)("SELECT id FROM tools WHERE name = 'voice' LIMIT 1",[]);if(a.rows[0]?.id)b=a.rows[0].id,await (0,w.P)("UPDATE organizations SET tool_id = $1 WHERE id = $2",[b,p]),z.v.info("SignalWire webhook: assigned tool_id to organization",{organizationId:p,toolId:b});else{let a=(0,v.A)();await (0,w.P)("INSERT INTO tools (id, name, description) VALUES ($1, 'voice', 'Voice operations tool')",[a]),b=a,await (0,w.P)("UPDATE organizations SET tool_id = $1 WHERE id = $2",[a,p]),z.v.info("SignalWire webhook: created voice tool and assigned to org",{organizationId:p,toolId:a})}}catch(a){z.v.error("SignalWire webhook: failed to auto-assign tool",a)}}if(b){let e=h?Math.round(parseInt(String(h),10)):i?Math.round(parseInt(String(i),10)):null;if(a){let b="UPDATE recordings SET recording_url = $1, duration_seconds = $2, status = 'completed', updated_at = NOW()",c=[g,e],d=3;q&&(b+=`, has_live_translation = $${d++}, live_translation_provider = $${d++}`,c.push(!0,"signalwire")),b+=` WHERE id = $${d}`,c.push(a.id);try{await (0,w.P)(b,c),z.v.info("SignalWire webhook: updated recording",{recordingId:a.id}),await G(o,a.id,p,g)}catch(a){z.v.error("SignalWire webhook: failed to update recording",a)}}else{let a=(0,v.A)(),h=["id","organization_id","call_sid","call_id","recording_sid","recording_url","duration_seconds","status","tool_id","source","created_at","updated_at"],i=[a,p,d,o,f,g,e,"completed",b,"signalwire",new Date().toISOString(),new Date().toISOString()];q&&(h.push("has_live_translation","live_translation_provider"),i.push(!0,"signalwire"));let j=i.map((a,b)=>`$${b+1}`).join(","),k=h.join(",");try{await (0,w.P)(`INSERT INTO recordings (${k}) VALUES (${j})`,i),z.v.info("SignalWire webhook: created recording",{recordingId:a,callId:o});let b=(0,v.A)();try{await (0,w.P)(`INSERT INTO audit_logs (id, organization_id, resource_type, resource_id, action, actor_type, actor_label, after, created_at)
                       VALUES ($1, $2, 'recordings', $3, 'create', 'vendor', 'signalwire-webhook', $4, NOW())`,[b,p,a,JSON.stringify({call_id:o,recording_sid:f})])}catch(a){}(async()=>{try{let{storeRecording:b}=await c.e(7528).then(c.bind(c,37528));await b(g,p,o,a)}catch(b){z.v.error("SignalWire webhook: failed to store recording",b,{recordingId:a})}})(),await G(o,a,p,g)}catch(a){z.v.error("SignalWire webhook: failed to create recording",a)}}}else z.v.error("SignalWire webhook: could not assign tool_id, recording not saved",{organizationId:p})}}catch(a){z.v.error("SignalWire webhook processing error",a)}}async function G(a,b,c,d){try{let e=await (0,w.P)("SELECT transcribe FROM voice_configs WHERE organization_id = $1 LIMIT 1",[c]);if(e.rows[0]?.transcribe!==!0)return;let f=(await (0,w.P)("SELECT id, status, output FROM ai_runs WHERE call_id = $1 AND model = 'assemblyai-v1'",[a])).rows,g=(0,v.A)(),h=!0;if(f.length>0){let a=f.find(a=>a.output?.recording_id===b||d&&a.output?.recording_url===d);if(a){if("processing"===a.status||"completed"===a.status)return;g=a.id,h=!1}else{let a=f.find(a=>"queued"===a.status&&(!a.output||0===Object.keys(a.output).length||!0===a.output.pending));a&&(g=a.id,h=!1)}}let i=await (0,w.P)("SELECT id FROM systems WHERE key = 'system-ai' LIMIT 1",[]),j=i.rows[0]?.id;if(!j)return;let k=d;if(!k){let a=await (0,w.P)("SELECT recording_url FROM recordings WHERE id = $1 LIMIT 1",[b]);k=a.rows[0]?.recording_url}if(!k)return;let l=await (0,w.P)("SELECT plan FROM organizations WHERE id = $1 LIMIT 1",[c]);if(l.rows[0]?.plan==="free"||!process.env.ASSEMBLYAI_API_KEY)return;h?await (0,w.P)(`INSERT INTO ai_runs (id, call_id, system_id, model, status, started_at, produced_by, is_authoritative, output)
             VALUES ($1, $2, $3, 'assemblyai-v1', 'queued', NOW(), 'model', true, $4)`,[g,a,j,JSON.stringify({recording_id:b,recording_url:k})]):await (0,w.P)("UPDATE ai_runs SET output = $1 WHERE id = $2",[JSON.stringify({recording_id:b,recording_url:k}),g]);let m=await fetch("https://api.assemblyai.com/v2/transcript",{method:"POST",headers:{Authorization:process.env.ASSEMBLYAI_API_KEY,"Content-Type":"application/json"},body:JSON.stringify({audio_url:k,webhook_url:"https://voxsouth.online/api/webhooks/assemblyai",sentiment_analysis:!0,entity_detection:!0,auto_chapters:!0,speaker_labels:!0,content_safety:!0,iab_categories:!0,language_detection:!0})});if(m.ok){let a=await m.json();await (0,w.P)("UPDATE ai_runs SET status = 'processing', produced_by = 'model', is_authoritative = true, output = $1 WHERE id = $2",[JSON.stringify({job_id:a.id,status:"queued"}),g]),z.v.info("SignalWire webhook: triggered AssemblyAI transcription",{aiRunId:g,jobId:a.id})}else{let a=await m.text();await (0,w.P)("UPDATE ai_runs SET status = 'failed', produced_by = 'model', is_authoritative = true, output = $1 WHERE id = $2",[JSON.stringify({error:a,status_code:m.status}),g])}}catch(b){z.v.error("SignalWire webhook: Transcription trigger error",b,{callId:a})}}let H=(0,A.YO)(E,{identifier:a=>`webhook-signalwire-${(0,A.Tf)(a)}`,config:{maxAttempts:1e3,windowMs:6e4,blockMs:3e5}}),I=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/webhooks/signalwire/route",pathname:"/api/webhooks/signalwire",filename:"route",bundlePath:"app/api/webhooks/signalwire/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\webhooks\\signalwire\\route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:J,workUnitAsyncStorage:K,serverHooks:L}=I;function M(){return(0,g.patchFetch)({workAsyncStorage:J,workUnitAsyncStorage:K})}async function N(a,b,c){var d;let e="/api/webhooks/signalwire/route";"/index"===e&&(e="/");let g=await I.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||I.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===I.isDev||!E,H=E&&!G,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>I.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>I.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await I.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await I.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await I.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},21820:a=>{a.exports=require("os")},27910:a=>{a.exports=require("stream")},28354:a=>{a.exports=require("util")},29021:a=>{a.exports=require("fs")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32524:(a,b,c)=>{c.d(b,{A:()=>i});var d=c(55511);let e={randomUUID:d.randomUUID},f=new Uint8Array(256),g=f.length,h=[];for(let a=0;a<256;++a)h.push((a+256).toString(16).slice(1));let i=function(a,b,c){if(e.randomUUID&&!b&&!a)return e.randomUUID();let i=(a=a||{}).random??a.rng?.()??(g>f.length-16&&((0,d.randomFillSync)(f),g=0),f.slice(g,g+=16));if(i.length<16)throw Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,b){if((c=c||0)<0||c+16>b.length)throw RangeError(`UUID byte range ${c}:${c+15} is out of buffer bounds`);for(let a=0;a<16;++a)b[c+a]=i[a];return b}return function(a,b=0){return(h[a[b+0]]+h[a[b+1]]+h[a[b+2]]+h[a[b+3]]+"-"+h[a[b+4]]+h[a[b+5]]+"-"+h[a[b+6]]+h[a[b+7]]+"-"+h[a[b+8]]+h[a[b+9]]+"-"+h[a[b+10]]+h[a[b+11]]+h[a[b+12]]+h[a[b+13]]+h[a[b+14]]+h[a[b+15]]).toLowerCase()}(i)}},33873:a=>{a.exports=require("path")},34631:a=>{a.exports=require("tls")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{a.exports=require("crypto")},55591:a=>{a.exports=require("https")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{a.exports=require("zlib")},77598:a=>{a.exports=require("node:crypto")},79428:a=>{a.exports=require("buffer")},79551:a=>{a.exports=require("url")},79646:a=>{a.exports=require("child_process")},81630:a=>{a.exports=require("http")},84988:(a,b,c)=>{c.d(b,{TS:()=>f,cX:()=>e}),c(30477);let d=[{name:"SIGNALWIRE_PROJECT_ID",required:!0,description:"SignalWire project ID for call execution",validate:a=>a.length>0||"Must not be empty"},{name:"SIGNALWIRE_TOKEN",required:!0,description:"SignalWire API token",validate:a=>a.length>0||"Must not be empty"},{name:"SIGNALWIRE_SPACE",required:!0,description:"SignalWire space URL",validate:a=>a.includes("signalwire.com")||"Must be a valid SignalWire space URL"},{name:"ASSEMBLYAI_API_KEY",required:!0,description:"AssemblyAI API key for transcription",validate:a=>a.length>0||"Must not be empty"},{name:"NEXT_PUBLIC_SUPABASE_URL",required:!0,description:"Supabase project URL",validate:a=>a.startsWith("https://")||"Must be a valid HTTPS URL"},{name:"NEXT_PUBLIC_SUPABASE_ANON_KEY",required:!0,description:"Supabase anonymous key",validate:a=>a.length>0||"Must not be empty"},{name:"SUPABASE_SERVICE_ROLE_KEY",required:!0,description:"Supabase service role key (server-side only)",validate:a=>a.length>0||"Must not be empty"},{name:"NEXT_PUBLIC_APP_URL",required:!0,description:"Public application URL for webhooks",validate:a=>a.startsWith("https://")||a.startsWith("http://localhost")||"Must be a valid URL"},{name:"NEXTAUTH_SECRET",required:!0,description:"NextAuth secret for session encryption",validate:a=>a.length>=32||"Must be at least 32 characters"},{name:"OPENAI_API_KEY",required:!1,description:"OpenAI API key for translation (optional)",validate:a=>a.length>0||"Must not be empty if provided"},{name:"ELEVENLABS_API_KEY",required:!1,description:"ElevenLabs API key for text-to-speech (optional)",validate:a=>a.startsWith("sk_")||'Must start with "sk_"'},{name:"TRANSLATION_LIVE_ASSIST_PREVIEW",required:!1,description:"Enable live translation preview feature (SignalWire AI Agents)",validate:a=>"true"===a||"false"===a||'Must be "true" or "false"'}];function e(){let a=[],b=[];for(let c of d){let d=process.env[c.name];if(d){if(c.validate){let e=c.validate(d);if(!0!==e){let d="string"==typeof e?e:"Invalid value";c.required?a.push({name:c.name,message:`${c.description}: ${d}`}):b.push({name:c.name,message:`${c.description}: ${d}`})}}}else c.required?a.push({name:c.name,message:`Required environment variable missing: ${c.description}`}):b.push({name:c.name,message:`Optional environment variable not set: ${c.description}`})}return{valid:0===a.length,errors:a,warnings:b}}function f(){return"true"===process.env.TRANSLATION_LIVE_ASSIST_PREVIEW}},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{a.exports=require("net")},94458:(a,b,c)=>{c.d(b,{Ll:()=>f,OM:()=>g});var d=c(77598),e=c.n(d);function f(a,b,c,d){if("true"===process.env.SIGNALWIRE_SKIP_SIGNATURE_VALIDATION)return!0;try{let f=a;if(d){let b=new URLSearchParams(a),c=Array.from(b.entries()).sort((a,b)=>a[0].localeCompare(b[0])).map(([a,b])=>`${a}${b}`).join("");f=d+c}let g=e().createHmac("sha1",c).update(f).digest("base64");try{return e().timingSafeEqual(Buffer.from(b),Buffer.from(g))}catch{return b===g}}catch(a){return!1}}function g(a,b,c){try{let d=e().createHmac("sha256",c).update(a).digest("hex");return e().timingSafeEqual(Buffer.from(b),Buffer.from(d))}catch(a){return!1}}},94735:a=>{a.exports=require("events")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4996,1692,4680,6802,1093,9376,6147,8794],()=>b(b.s=19917));module.exports=c})();