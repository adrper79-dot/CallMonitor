"use strict";(()=>{var a={};a.id=5510,a.ids=[5510],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{a.exports=require("querystring")},12412:a=>{a.exports=require("assert")},14985:a=>{a.exports=require("dns")},17793:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>J,patchFetch:()=>I,routeModule:()=>E,serverHooks:()=>H,workAsyncStorage:()=>F,workUnitAsyncStorage:()=>G});var d={};c.r(d),c.d(d,{GET:()=>D,POST:()=>C,dynamic:()=>A,runtime:()=>B});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(10641),v=c(60387);function w(a){let b=[{answer:{}}];return a&&b.push({ai:{prompt:{text:`Say: "${a}" then hang up politely.`},voice:"rime.spore",model:"gpt-4o-mini",temperature:.1,max_tokens:50}}),b.push({hangup:{}}),{version:"1.0.0",sections:{main:b}}}var x=c(4667),y=c(30477),z=c(32524);let A="force-dynamic",B="nodejs";async function C(a){try{let b=await (0,x.JY)(a),c=b.CallSid||b.call_sid;b.From||b.from,b.To||b.to;let d=new URL(a.url),e=d.searchParams.get("scriptId"),f=d.searchParams.get("orgId"),g=d.searchParams.get("callId")||c||`shopper-${Date.now()}`;if(y.v.info("SWML shopper: incoming call",{callSid:c?"[REDACTED]":null,scriptId:e,orgId:f,callId:g}),!e&&!f)return y.v.warn("SWML shopper: missing scriptId or orgId"),(0,x.NA)(w("Sorry, this evaluation could not be configured. Goodbye."));let h=null,i=f;if(e){let{rows:a}=await (0,v.P)("SELECT * FROM shopper_scripts WHERE id = $1 LIMIT 1",[e]);(h=a?.[0])&&(i=h.organization_id)}if(!h&&i){let{rows:a}=await (0,v.P)(`SELECT shopper_script, shopper_expected_outcomes FROM voice_configs 
         WHERE organization_id = $1 AND shopper_script IS NOT NULL LIMIT 1`,[i]);a?.[0]?.shopper_script&&(h={script_content:a[0].shopper_script,expected_outcomes:a[0].shopper_expected_outcomes||[],persona:"a typical customer",voice:"en"})}if(!h||!h.script_content)return y.v.warn("SWML shopper: no script found",{scriptId:e,orgId:f}),(0,x.NA)(w("Sorry, no evaluation script was found. Goodbye."));let j=function(a){let{callId:b,organizationId:c,scriptId:d,script:e,persona:f,voice:g,expectedOutcomes:h,targetName:i,recordCall:j=!0}=a,k="https://voxsouth.online",l=[];return l.push({answer:{}}),j&&l.push({record_call:{format:"mp3",stereo:!0,recording_status_callback:`${k}/api/webhooks/signalwire`}}),l.push({ai:{prompt:{text:function(a,b,c){let d=c||"the representative";return`You are an AI conducting a quality assurance evaluation call. You are role-playing as ${b||"a typical customer who is polite but has specific needs"}.

YOUR SCRIPT AND OBJECTIVES:
${a}

IMPORTANT GUIDELINES:
1. Stay in character throughout the call - you ARE the customer
2. Follow the script naturally, adapting to responses while hitting key points
3. Don't reveal you're an AI or conducting an evaluation
4. React naturally to what ${d} says - if they answer a question, acknowledge it
5. If they deviate from expected service, note it mentally but stay polite
6. Ask clarifying questions if responses are unclear
7. Complete all script objectives before ending the call
8. Thank them politely at the end

CONVERSATION STYLE:
- Be conversational, not robotic
- Use natural pauses and filler words occasionally
- Show appropriate emotions (frustration if service is poor, satisfaction if good)
- Match the energy and pace of ${d}

After the call, your responses and the conversation will be analyzed for:
- Whether your script objectives were met
- The quality of service provided
- Response times and professionalism
- Sentiment and tone

Begin the call now. Follow your script and objectives.`}(e,f,i)},voice:g?.startsWith("rime.")||g?.includes(".")?g:({en:"rime.spore","en-US":"rime.spore","en-female":"rime.kira","en-male":"rime.spore",es:"rime.alberto","es-US":"rime.alberto",fr:"rime.viola",de:"rime.stella",it:"rime.paola",pt:"rime.luana",ja:"rime.akari",zh:"rime.ling",ko:"rime.yeonjun"})[g||"en"]||"rime.spore",model:"gpt-4o-mini",temperature:.6,max_tokens:250,post_prompt_url:`${k}/api/shopper/results?callId=${b}&scriptId=${d||""}&orgId=${c}`,params:{save_conversation:!0,callmonitor_call_id:b,callmonitor_org_id:c,callmonitor_type:"secret_shopper",callmonitor_script_id:d,expected_outcomes:h||[]}}}),l.push({hangup:{}}),{version:"1.0.0",sections:{main:l}}}({callId:g,organizationId:i||"unknown",scriptId:e||void 0,script:h.script_content,persona:h.persona,voice:h.voice,expectedOutcomes:h.expected_outcomes,targetName:h.target_name,recordCall:!0});if(y.v.info("SWML shopper: generated SWML",{organizationId:i,scriptId:e,callId:g,hasScript:!!h.script_content,outcomeCount:h.expected_outcomes?.length||0}),c&&i)try{await (0,v.P)(`INSERT INTO calls (id, organization_id, call_sid, status, started_at)
             VALUES ($1, $2, $3, 'ringing', NOW())`,[(0,z.A)(),i,c])}catch(a){y.v.warn("SWML shopper: could not create call record",{error:a?.message})}return(0,x.NA)(j)}catch(a){return y.v.error("SWML shopper error",a),(0,x.NA)(w("We encountered an error. Please try again later. Goodbye."))}}async function D(){return u.NextResponse.json({ok:!0,route:"/api/voice/swml/shopper",method:"Use POST for SWML generation",description:"SWML endpoint for Secret Shopper AI Agent evaluations",params:{scriptId:"shopper_scripts.id - the evaluation script to use",orgId:"organization_id (fallback if scriptId not provided)",callId:"call ID for tracking (auto-generated if not provided)"}})}let E=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/voice/swml/shopper/route",pathname:"/api/voice/swml/shopper",filename:"route",bundlePath:"app/api/voice/swml/shopper/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\voice\\swml\\shopper\\route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:F,workUnitAsyncStorage:G,serverHooks:H}=E;function I(){return(0,g.patchFetch)({workAsyncStorage:F,workUnitAsyncStorage:G})}async function J(a,b,c){var d;let e="/api/voice/swml/shopper/route";"/index"===e&&(e="/");let g=await E.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),F=!!(y.dynamicRoutes[D]||y.routes[C]);if(F&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||E.isDev||x||(G="/index"===(G=C)?"/":G);let H=!0===E.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>E.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>E.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await E.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await E.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await E.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:a=>{a.exports=require("os")},27910:a=>{a.exports=require("stream")},28354:a=>{a.exports=require("util")},29021:a=>{a.exports=require("fs")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32524:(a,b,c)=>{c.d(b,{A:()=>i});var d=c(55511);let e={randomUUID:d.randomUUID},f=new Uint8Array(256),g=f.length,h=[];for(let a=0;a<256;++a)h.push((a+256).toString(16).slice(1));let i=function(a,b,c){if(e.randomUUID&&!b&&!a)return e.randomUUID();let i=(a=a||{}).random??a.rng?.()??(g>f.length-16&&((0,d.randomFillSync)(f),g=0),f.slice(g,g+=16));if(i.length<16)throw Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,b){if((c=c||0)<0||c+16>b.length)throw RangeError(`UUID byte range ${c}:${c+15} is out of buffer bounds`);for(let a=0;a<16;++a)b[c+a]=i[a];return b}return function(a,b=0){return(h[a[b+0]]+h[a[b+1]]+h[a[b+2]]+h[a[b+3]]+"-"+h[a[b+4]]+h[a[b+5]]+"-"+h[a[b+6]]+h[a[b+7]]+"-"+h[a[b+8]]+h[a[b+9]]+"-"+h[a[b+10]]+h[a[b+11]]+h[a[b+12]]+h[a[b+13]]+h[a[b+14]]+h[a[b+15]]).toLowerCase()}(i)}},33873:a=>{a.exports=require("path")},34631:a=>{a.exports=require("tls")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{a.exports=require("crypto")},55591:a=>{a.exports=require("https")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{a.exports=require("zlib")},77598:a=>{a.exports=require("node:crypto")},79428:a=>{a.exports=require("buffer")},79551:a=>{a.exports=require("url")},79646:a=>{a.exports=require("child_process")},81630:a=>{a.exports=require("http")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{a.exports=require("net")},94735:a=>{a.exports=require("events")}};var b=require("../../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4996,1692,4680,6802,1093,9376,6147,8794],()=>b(b.s=17793));module.exports=c})();