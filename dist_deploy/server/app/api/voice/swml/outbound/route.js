"use strict";(()=>{var a={};a.id=5433,a.ids=[5433],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{a.exports=require("querystring")},12412:a=>{a.exports=require("assert")},14985:a=>{a.exports=require("dns")},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:a=>{a.exports=require("os")},27910:a=>{a.exports=require("stream")},28354:a=>{a.exports=require("util")},29021:a=>{a.exports=require("fs")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{a.exports=require("path")},34631:a=>{a.exports=require("tls")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{a.exports=require("crypto")},55591:a=>{a.exports=require("https")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{a.exports=require("zlib")},77598:a=>{a.exports=require("node:crypto")},79428:a=>{a.exports=require("buffer")},79551:a=>{a.exports=require("url")},79646:a=>{a.exports=require("child_process")},81630:a=>{a.exports=require("http")},84988:(a,b,c)=>{c.d(b,{TS:()=>f,cX:()=>e}),c(30477);let d=[{name:"SIGNALWIRE_PROJECT_ID",required:!0,description:"SignalWire project ID for call execution",validate:a=>a.length>0||"Must not be empty"},{name:"SIGNALWIRE_TOKEN",required:!0,description:"SignalWire API token",validate:a=>a.length>0||"Must not be empty"},{name:"SIGNALWIRE_SPACE",required:!0,description:"SignalWire space URL",validate:a=>a.includes("signalwire.com")||"Must be a valid SignalWire space URL"},{name:"ASSEMBLYAI_API_KEY",required:!0,description:"AssemblyAI API key for transcription",validate:a=>a.length>0||"Must not be empty"},{name:"NEXT_PUBLIC_SUPABASE_URL",required:!0,description:"Supabase project URL",validate:a=>a.startsWith("https://")||"Must be a valid HTTPS URL"},{name:"NEXT_PUBLIC_SUPABASE_ANON_KEY",required:!0,description:"Supabase anonymous key",validate:a=>a.length>0||"Must not be empty"},{name:"SUPABASE_SERVICE_ROLE_KEY",required:!0,description:"Supabase service role key (server-side only)",validate:a=>a.length>0||"Must not be empty"},{name:"NEXT_PUBLIC_APP_URL",required:!0,description:"Public application URL for webhooks",validate:a=>a.startsWith("https://")||a.startsWith("http://localhost")||"Must be a valid URL"},{name:"NEXTAUTH_SECRET",required:!0,description:"NextAuth secret for session encryption",validate:a=>a.length>=32||"Must be at least 32 characters"},{name:"OPENAI_API_KEY",required:!1,description:"OpenAI API key for translation (optional)",validate:a=>a.length>0||"Must not be empty if provided"},{name:"ELEVENLABS_API_KEY",required:!1,description:"ElevenLabs API key for text-to-speech (optional)",validate:a=>a.startsWith("sk_")||'Must start with "sk_"'},{name:"TRANSLATION_LIVE_ASSIST_PREVIEW",required:!1,description:"Enable live translation preview feature (SignalWire AI Agents)",validate:a=>"true"===a||"false"===a||'Must be "true" or "false"'}];function e(){let a=[],b=[];for(let c of d){let d=process.env[c.name];if(d){if(c.validate){let e=c.validate(d);if(!0!==e){let d="string"==typeof e?e:"Invalid value";c.required?a.push({name:c.name,message:`${c.description}: ${d}`}):b.push({name:c.name,message:`${c.description}: ${d}`})}}}else c.required?a.push({name:c.name,message:`Required environment variable missing: ${c.description}`}):b.push({name:c.name,message:`Optional environment variable not set: ${c.description}`})}return{valid:0===a.length,errors:a,warnings:b}}function f(){return"true"===process.env.TRANSLATION_LIVE_ASSIST_PREVIEW}},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{a.exports=require("net")},94735:a=>{a.exports=require("events")},95931:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>L,patchFetch:()=>K,routeModule:()=>G,serverHooks:()=>J,workAsyncStorage:()=>H,workUnitAsyncStorage:()=>I});var d={};c.r(d),c.d(d,{GET:()=>F,POST:()=>E,dynamic:()=>B,runtime:()=>C});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(10641),v=c(60387);function w(a){return({en:"English","en-US":"English (US)",es:"Spanish","es-US":"Spanish (US)","es-ES":"Spanish (Spain)",fr:"French","fr-FR":"French",de:"German","de-DE":"German",it:"Italian","it-IT":"Italian",pt:"Portuguese","pt-BR":"Portuguese (Brazil)","pt-PT":"Portuguese (Portugal)",ja:"Japanese","ja-JP":"Japanese",zh:"Chinese","zh-CN":"Chinese (Simplified)",ko:"Korean","ko-KR":"Korean"})[a.toLowerCase()]||"English"}function x(a){return({en:"rime.spore","en-US":"rime.spore",es:"rime.alberto","es-US":"rime.alberto","es-ES":"rime.alberto",fr:"rime.viola","fr-FR":"rime.viola",de:"rime.stella","de-DE":"rime.stella",it:"rime.paola","it-IT":"rime.paola",pt:"rime.luana","pt-BR":"rime.luana","pt-PT":"rime.luana",ja:"rime.akari","ja-JP":"rime.akari",zh:"rime.ling","zh-CN":"rime.ling",ko:"rime.yeonjun","ko-KR":"rime.yeonjun"})[a.toLowerCase()]||"rime.spore"}var y=c(84988),z=c(4667),A=c(30477);let B="force-dynamic",C="nodejs",D={version:"1.0.0",sections:{main:[{answer:{}},{hangup:{}}]}};async function E(a){try{let b=await (0,z.JY)(a),c=b.From??b.from,d=b.To??b.to,e=b.CallSid??b.call_sid,f=new URL(a.url).searchParams.get("callId");A.v.info("SWML outbound webhook",{from:c?"[REDACTED]":null,to:d?"[REDACTED]":null,callId:f});let g=null,h=null;if(e){let{rows:a}=await (0,v.P)("SELECT organization_id FROM calls WHERE call_sid = $1 LIMIT 1",[e]);a?.[0]&&(g=a[0].organization_id)}else if(f){let{rows:a}=await (0,v.P)("SELECT organization_id FROM calls WHERE id = $1 LIMIT 1",[f]);a?.[0]&&(g=a[0].organization_id)}if(!g)return A.v.warn("SWML outbound: could not find organization_id",{callId:f}),(0,z.NA)(D);let{rows:i}=await (0,v.P)("SELECT record, live_translate, translate_from, translate_to FROM voice_configs WHERE organization_id = $1 LIMIT 1",[g]);if(h=i?.[0]||null,!h?.live_translate||!h?.translate_from||!h?.translate_to)return A.v.warn("SWML outbound: translation not enabled",{organizationId:g}),(0,z.NA)(D);if(!(0,y.TS)())return A.v.warn("SWML outbound: feature flag disabled",{organizationId:g}),(0,z.NA)(D);let j=f||e||`swml-${Date.now()}`,k=function(a,b=!0){let c=function(a){let{callId:b,organizationId:c,translationFrom:d,translationTo:e,detectedLanguage:f=d}=a,g=a=>({en:"en-US-Neural2-J","en-US":"en-US-Neural2-J",es:"es-US-Neural2-A","es-US":"es-US-Neural2-A","es-ES":"es-ES-Neural2-A",fr:"fr-FR-Neural2-A","fr-FR":"fr-FR-Neural2-A",de:"de-DE-Neural2-A","de-DE":"de-DE-Neural2-A",it:"it-IT-Neural2-A","it-IT":"it-IT-Neural2-A",pt:"pt-BR-Neural2-A","pt-BR":"pt-BR-Neural2-A","pt-PT":"pt-PT-Neural2-A",ja:"ja-JP-Neural2-A","ja-JP":"ja-JP-Neural2-A",zh:"zh-CN-Neural2-A","zh-CN":"zh-CN-Neural2-A",ko:"ko-KR-Neural2-A","ko-KR":"ko-KR-Neural2-A"})[a.toLowerCase()]||"en-US-Neural2-J",h=g(e),i=g(f);return{agent:{name:"Word Is Bond Live Translation Agent (Preview)",version:"1.0.0",description:"Real-time bi-directional translation executed by SignalWire AI. Canonical transcript and evidence provided by AssemblyAI.",languages:{primary:e||"en-US",secondary:f||d||"en-US",target:e||"en-US"},prompt:{system:"You are a live, real-time translator for phone calls. Your role is to listen to one speaker, translate their speech accurately and naturally into the target language, and speak the translation immediately. Do NOT add commentary, summaries, or opinions. Preserve tone, intent, and nuance. Speak clearly and at natural speed. If the speaker switches languages, detect and adapt seamlessly. Do NOT persist any data â€” this is ephemeral execution only.",user:`Translate from ${d||"auto"} to ${e||"en-US"} in real time.`},voice:{primary:h,secondary:i},model:"gpt-4o-mini",temperature:.3,max_tokens:150,timeout:3e4},execution:{type:"live_translation",trigger:"call_answered",on_event:["speech_detected","language_changed","silence_timeout"]},metadata:{callmonitor_call_id:b,callmonitor_org_id:c,callmonitor_provider:"signalwire",canonical_transcript_source:"assemblyai",feature_flag:"translation_live_assist_preview"},fallback:{on_failure:"continue_without_translation",log_to:"callmonitor_audit_logs",notify:"callmonitor_kpi_live_translation_failure"}}}(a),d=[];d.push({answer:{}});let e={prompt:{text:c.agent.prompt.system},languages:[{name:w(c.agent.languages.primary),code:c.agent.languages.primary,voice:x(c.agent.languages.primary)}],model:c.agent.model,temperature:c.agent.temperature,max_tokens:c.agent.max_tokens};return c.agent.languages.secondary!==c.agent.languages.primary&&e.languages.push({name:w(c.agent.languages.secondary),code:c.agent.languages.secondary,voice:x(c.agent.languages.secondary)}),d.push({ai:e}),b&&d.push({record_call:{format:"mp3",stereo:!1,recording_status_callback:"https://voxsouth.online/api/webhooks/signalwire"}}),{version:"1.0.0",sections:{main:d}}}({callId:j,organizationId:g,translationFrom:h.translate_from,translationTo:h.translate_to},!0===h.record);return A.v.info("SWML outbound: generated SWML",{organizationId:g,callId:j}),(0,z.NA)(k)}catch(a){return A.v.error("SWML outbound error",a),(0,z.NA)(D)}}async function F(){return u.NextResponse.json({ok:!0,route:"/api/voice/swml/outbound",method:"Use POST for SWML generation",description:"SWML endpoint for live translation calls"})}let G=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/voice/swml/outbound/route",pathname:"/api/voice/swml/outbound",filename:"route",bundlePath:"app/api/voice/swml/outbound/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\voice\\swml\\outbound\\route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:H,workUnitAsyncStorage:I,serverHooks:J}=G;function K(){return(0,g.patchFetch)({workAsyncStorage:H,workUnitAsyncStorage:I})}async function L(a,b,c){var d;let e="/api/voice/swml/outbound/route";"/index"===e&&(e="/");let g=await G.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||G.isDev||x||(F="/index"===(F=C)?"/":F);let H=!0===G.isDev||!E,I=E&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>G.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>G.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await G.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await G.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await G.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}}};var b=require("../../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4996,1692,4680,6802,1093,9376,6147,8794],()=>b(b.s=95931));module.exports=c})();