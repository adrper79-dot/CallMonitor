"use strict";(()=>{var a={};a.id=4875,a.ids=[4875],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10812:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>J,patchFetch:()=>I,routeModule:()=>E,serverHooks:()=>H,workAsyncStorage:()=>F,workUnitAsyncStorage:()=>G});var d={};c.r(d),c.d(d,{GET:()=>D,POST:()=>C,dynamic:()=>A,runtime:()=>B});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(10641),v=c(60387);function w(a){let b=[{answer:{}}];return a&&b.push({say:{text:a}}),b.push({hangup:{}}),{version:"1.0.0",sections:{main:b}}}var x=c(4667),y=c(30477),z=c(32524);let A="force-dynamic",B="nodejs";async function C(a){try{let b=await (0,x.JY)(a),c=b.CallSid||b.call_sid;b.From||b.from,b.To||b.to;let d=new URL(a.url),e=d.searchParams.get("configId"),f=d.searchParams.get("orgId");y.v.info("SWML survey: inbound call",{callSid:c?"[REDACTED]":null,configId:e,orgId:f});let g=null,h=null;if(e){let{rows:a}=await (0,v.P)(`SELECT id, organization_id, survey, survey_prompts, survey_prompts_locales, translate_to, survey_voice, survey_webhook_email
         FROM voice_configs WHERE id = $1 LIMIT 1`,[e]);g=a?.[0],h=g?.organization_id}else if(f){let{rows:a}=await (0,v.P)(`SELECT id, organization_id, survey, survey_prompts, survey_prompts_locales, translate_to, survey_voice, survey_webhook_email
         FROM voice_configs WHERE organization_id = $1 LIMIT 1`,[f]);g=a?.[0],h=f}if(!g||!g.survey)return y.v.warn("SWML survey: not enabled or config not found",{configId:e,orgId:f}),(0,x.R$)(w("Sorry, this survey is not currently available. Goodbye."));let i=c||`survey-${Date.now()}`,{prompts:j}=function(a){let b=a?.translate_to||"en",c=a?.survey_prompts_locales?.[b];return Array.isArray(c)&&c.length>0?{prompts:c,locale:b}:{prompts:Array.isArray(a?.survey_prompts)?a.survey_prompts:[],locale:b}}(g),k=function(a){let{callId:b,organizationId:c,prompts:d,voice:e,postPromptWebhook:f,recordCall:g=!0}=a,h=[];return h.push({answer:{}}),g&&h.push({record_call:{format:"mp3",stereo:!1,recording_status_callback:"https://voxsouth.online/api/webhooks/signalwire"}}),h.push({ai:{prompt:{text:function(a){let b=`IMPORTANT: You MUST begin by saying: "This is an automated customer satisfaction survey. Your responses will be recorded for quality improvement purposes. This survey does not constitute any agreement or commitment. You may end the call at any time."

After the disclaimer, proceed with the survey questions.

`;if(0===a.length)return`${b}You are a friendly survey assistant. Ask the caller:
1. How was your overall experience today?
2. On a scale of 1-5, how likely are you to recommend us?
3. Is there anything we could improve?

Wait for each response before asking the next question.
After all questions, thank them and provide a brief summary of their feedback.
Keep responses natural and conversational.`;let c=a.map((a,b)=>`${b+1}. ${a}`).join("\n");return`${b}You are a professional survey assistant conducting a customer feedback survey.

Ask these questions ONE AT A TIME, waiting for the caller's response before proceeding:

${c}

Guidelines:
- Be friendly and conversational
- Wait for each response before asking the next question
- If the caller seems confused, clarify the question
- After all questions, thank them and summarize their responses briefly
- Keep responses natural - don't sound robotic

Begin by greeting the caller and explaining you have ${a.length} quick question${a.length>1?"s":""} for them.`}(d)},voice:e?.startsWith("rime.")||e?.includes(".")?e:({en:"rime.spore","en-US":"rime.spore",es:"rime.alberto","es-US":"rime.alberto",fr:"rime.viola",de:"rime.stella",it:"rime.paola",pt:"rime.luana",ja:"rime.akari",zh:"rime.ling",ko:"rime.yeonjun"})[e||"en"]||"rime.spore",model:"gpt-4o-mini",temperature:.4,max_tokens:200,post_prompt_url:f,params:{save_conversation:!0,callmonitor_call_id:b,callmonitor_org_id:c,callmonitor_type:"ai_survey"}}}),h.push({hangup:{}}),{version:"1.0.0",sections:{main:h}}}({callId:i,organizationId:h||"unknown",prompts:j,voice:g.survey_voice,postPromptWebhook:`https://voxsouth.online/api/survey/ai-results?configId=${g.id}&callId=${i}`,recordCall:!0});if(y.v.info("SWML survey: generated SWML",{organizationId:h,configId:g.id,promptCount:j.length}),c&&h)try{await (0,v.P)(`INSERT INTO calls (id, organization_id, call_sid, status, started_at)
             VALUES ($1, $2, $3, 'ringing', NOW())`,[(0,z.A)(),h,c])}catch(a){y.v.warn("SWML survey: could not create call record",{error:a?.message})}return(0,x.R$)(k)}catch(a){return y.v.error("SWML survey error",a),(0,x.R$)(w("We encountered an error. Please try again later. Goodbye."))}}async function D(){return u.NextResponse.json({ok:!0,route:"/api/voice/swml/survey",method:"Use POST for SWML generation",description:"SWML endpoint for AI Survey Bot",params:{configId:"voice_configs.id",orgId:"organization_id (fallback)"}})}let E=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/voice/swml/survey/route",pathname:"/api/voice/swml/survey",filename:"route",bundlePath:"app/api/voice/swml/survey/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\Users\\Ultimate Warrior\\My project\\gemini-project\\app\\api\\voice\\swml\\survey\\route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:F,workUnitAsyncStorage:G,serverHooks:H}=E;function I(){return(0,g.patchFetch)({workAsyncStorage:F,workUnitAsyncStorage:G})}async function J(a,b,c){var d;let e="/api/voice/swml/survey/route";"/index"===e&&(e="/");let g=await E.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),F=!!(y.dynamicRoutes[D]||y.routes[C]);if(F&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||E.isDev||x||(G="/index"===(G=C)?"/":G);let H=!0===E.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>E.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>E.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await E.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await E.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await E.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{a.exports=require("querystring")},12412:a=>{a.exports=require("assert")},14985:a=>{a.exports=require("dns")},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:a=>{a.exports=require("os")},27910:a=>{a.exports=require("stream")},28354:a=>{a.exports=require("util")},29021:a=>{a.exports=require("fs")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32524:(a,b,c)=>{c.d(b,{A:()=>i});var d=c(55511);let e={randomUUID:d.randomUUID},f=new Uint8Array(256),g=f.length,h=[];for(let a=0;a<256;++a)h.push((a+256).toString(16).slice(1));let i=function(a,b,c){if(e.randomUUID&&!b&&!a)return e.randomUUID();let i=(a=a||{}).random??a.rng?.()??(g>f.length-16&&((0,d.randomFillSync)(f),g=0),f.slice(g,g+=16));if(i.length<16)throw Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,b){if((c=c||0)<0||c+16>b.length)throw RangeError(`UUID byte range ${c}:${c+15} is out of buffer bounds`);for(let a=0;a<16;++a)b[c+a]=i[a];return b}return function(a,b=0){return(h[a[b+0]]+h[a[b+1]]+h[a[b+2]]+h[a[b+3]]+"-"+h[a[b+4]]+h[a[b+5]]+"-"+h[a[b+6]]+h[a[b+7]]+"-"+h[a[b+8]]+h[a[b+9]]+"-"+h[a[b+10]]+h[a[b+11]]+h[a[b+12]]+h[a[b+13]]+h[a[b+14]]+h[a[b+15]]).toLowerCase()}(i)}},33873:a=>{a.exports=require("path")},34631:a=>{a.exports=require("tls")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{a.exports=require("crypto")},55591:a=>{a.exports=require("https")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{a.exports=require("zlib")},77598:a=>{a.exports=require("node:crypto")},79428:a=>{a.exports=require("buffer")},79551:a=>{a.exports=require("url")},79646:a=>{a.exports=require("child_process")},81630:a=>{a.exports=require("http")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{a.exports=require("net")},94735:a=>{a.exports=require("events")}};var b=require("../../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4996,1692,4680,6802,1093,9376,6147,8794],()=>b(b.s=10812));module.exports=c})();