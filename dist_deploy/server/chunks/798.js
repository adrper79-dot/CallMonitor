exports.id=798,exports.ids=[798],exports.modules={19891:(a,b,c)=>{"use strict";c.d(b,{En:()=>i,Ip:()=>g,Ry:()=>h});let d=new Map,e=new Map,f={status:"healthy",criticalErrors:0,highErrors:0,lastUpdated:new Date().toISOString()};function g(){return Array.from(d.values())}function h(){return Array.from(e.values())}function i(){return{...f}}},30477:(a,b,c)=>{"use strict";c.d(b,{v:()=>e});class d{constructor(){this.isDevelopment=!1,this.isTest=!1}shouldLog(a){return!this.isTest&&(!!this.isDevelopment||"warn"===a||"error"===a)}formatMessage(a,b,c){let d=new Date().toISOString(),e=c?` ${JSON.stringify(c)}`:"";return`[${d}] [${a.toUpperCase()}] ${b}${e}`}debug(a,b){this.shouldLog("debug")&&console.log(this.formatMessage("debug",a,b))}info(a,b){this.shouldLog("info")&&console.log(this.formatMessage("info",a,b))}warn(a,b){this.shouldLog("warn")&&console.warn(this.formatMessage("warn",a,b))}error(a,b,c){if(this.shouldLog("error")){let d=b instanceof Error?{name:b.name,message:b.message,stack:b.stack,...c}:{error:b,...c};console.error(this.formatMessage("error",a,d))}}apiRequest(a,b,c){this.info(`API Request: ${a} ${b}`,c)}apiResponse(a,b,c,d){let e={statusCode:c,duration:d};c>=500?this.error(`API Response: ${a} ${b}`,void 0,e):c>=400?this.warn(`API Response: ${a} ${b}`,e):this.info(`API Response: ${a} ${b}`,e)}dbQuery(a,b){this.debug("Database query",{query:a.substring(0,100),params:b})}externalCall(a,b,c){this.info(`External call: ${a}`,{endpoint:b,...c})}}let e=new d},36238:(a,b,c)=>{"use strict";c.d(b,{wT:()=>g,kU:()=>f});var d=c(10641);function e(a,b,c=500,f="MEDIUM"){let g=`ERR_${new Date().toISOString().slice(0,10).replace(/-/g,"")}_${Math.random().toString(36).substring(2,8).toUpperCase()}`;return d.NextResponse.json({success:!1,error:{id:g,code:a,message:b,severity:f.toLowerCase()}},{status:c})}function f(a,b=200){return d.NextResponse.json({success:!0,...a},{status:b})}c(59175),c(50980),c(19891);let g={unauthorized:()=>e("UNAUTHORIZED","Authentication required",401,"MEDIUM"),forbidden:()=>e("FORBIDDEN","You do not have permission to access this resource",403,"MEDIUM"),notFound:(a="Resource")=>e("NOT_FOUND",`${a} not found`,404,"LOW"),badRequest:(a="Invalid request")=>e("BAD_REQUEST",a,400,"LOW"),internal:(a="An unexpected error occurred")=>e("INTERNAL_ERROR",a,500,"HIGH"),dbError:(a="Database operation failed")=>e("DB_ERROR",a,500,"HIGH"),validationError:a=>e("VALIDATION_ERROR",a,400,"LOW"),serviceUnavailable:a=>e("SERVICE_UNAVAILABLE",`${a} is temporarily unavailable`,503,"HIGH")}},39727:()=>{},47990:()=>{},50980:(a,b,c)=>{"use strict";c.r(b),c.d(b,{ERROR_CATALOG:()=>d,getDefaultError:()=>f,getErrorDefinition:()=>e});let d={AUTH_REQUIRED:{code:"AUTH_REQUIRED",category:"AUTH",severity:"HIGH",internalMessage:"Authentication required",userMessage:"Please sign in to continue",httpStatus:401,shouldAlert:!1,trackKPI:!0},AUTH_ORG_MISMATCH:{code:"AUTH_ORG_MISMATCH",category:"AUTH",severity:"HIGH",internalMessage:"User not authorized for organization",userMessage:"You do not have access to this organization",httpStatus:401,shouldAlert:!1,trackKPI:!0},FORBIDDEN:{code:"FORBIDDEN",category:"AUTH",severity:"HIGH",internalMessage:"Insufficient permissions",userMessage:"You do not have permission to perform this action",httpStatus:403,shouldAlert:!1,trackKPI:!0},DB_QUERY_FAILED:{code:"DB_QUERY_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database query failed",userMessage:"Could not retrieve data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},DB_INSERT_FAILED:{code:"DB_INSERT_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database insert failed",userMessage:"Could not save data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},DB_UPDATE_FAILED:{code:"DB_UPDATE_FAILED",category:"DB",severity:"HIGH",internalMessage:"Database update failed",userMessage:"Could not update data. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},CALL_START_FAILED:{code:"CALL_START_FAILED",category:"VOICE",severity:"HIGH",internalMessage:"Failed to start call",userMessage:"Unable to place call. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SIGNALWIRE_CONFIG_MISSING:{code:"SIGNALWIRE_CONFIG_MISSING",category:"EXTERNAL",severity:"CRITICAL",internalMessage:"SignalWire credentials missing",userMessage:"System configuration error. Please contact support.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SIGNALWIRE_API_ERROR:{code:"SIGNALWIRE_API_ERROR",category:"EXTERNAL",severity:"HIGH",internalMessage:"SignalWire API error",userMessage:"Call service temporarily unavailable. Please try again.",httpStatus:502,shouldAlert:!0,trackKPI:!0},ASSEMBLYAI_API_ERROR:{code:"ASSEMBLYAI_API_ERROR",category:"AI",severity:"HIGH",internalMessage:"AssemblyAI API error",userMessage:"Transcription service temporarily unavailable.",httpStatus:502,shouldAlert:!0,trackKPI:!0},TRANSCRIPTION_FAILED:{code:"TRANSCRIPTION_FAILED",category:"AI",severity:"MEDIUM",internalMessage:"Transcription processing failed",userMessage:"Transcription could not be completed.",httpStatus:500,shouldAlert:!1,trackKPI:!0},LIVE_TRANSLATE_EXECUTION_FAILED:{code:"LIVE_TRANSLATE_EXECUTION_FAILED",category:"EXTERNAL",severity:"MEDIUM",internalMessage:"Live translation execution failed",userMessage:"Live translation encountered an issue. Post-call transcript is still available.",httpStatus:500,shouldAlert:!1,trackKPI:!0},LIVE_TRANSLATE_VENDOR_DOWN:{code:"LIVE_TRANSLATE_VENDOR_DOWN",category:"EXTERNAL",severity:"HIGH",internalMessage:"Live translation vendor service unavailable",userMessage:"Live translation service is temporarily unavailable. Post-call transcript will be available.",httpStatus:503,shouldAlert:!0,trackKPI:!0},PLAN_LIMIT_EXCEEDED:{code:"PLAN_LIMIT_EXCEEDED",category:"ORG",severity:"MEDIUM",internalMessage:"Plan limit exceeded",userMessage:"This feature is not available on your current plan. Please upgrade.",httpStatus:403,shouldAlert:!1,trackKPI:!0},ORG_NOT_FOUND:{code:"ORG_NOT_FOUND",category:"ORG",severity:"MEDIUM",internalMessage:"Organization not found",userMessage:"Organization not found",httpStatus:404,shouldAlert:!1,trackKPI:!1},SYSTEM_ERROR:{code:"SYSTEM_ERROR",category:"SYSTEM",severity:"CRITICAL",internalMessage:"Unexpected system error",userMessage:"An unexpected error occurred. Please try again.",httpStatus:500,shouldAlert:!0,trackKPI:!0},SERVICE_UNAVAILABLE:{code:"SERVICE_UNAVAILABLE",category:"SYSTEM",severity:"HIGH",internalMessage:"Service temporarily unavailable",userMessage:"Service temporarily unavailable. Please try again later.",httpStatus:503,shouldAlert:!0,trackKPI:!0},INVALID_INPUT:{code:"INVALID_INPUT",category:"USER",severity:"MEDIUM",internalMessage:"Invalid input provided",userMessage:"Invalid input. Please check your request and try again.",httpStatus:400,shouldAlert:!1,trackKPI:!1},INVALID_PHONE:{code:"INVALID_PHONE",category:"USER",severity:"MEDIUM",internalMessage:"Invalid phone number format",userMessage:"The phone number provided is invalid. Please verify and try again.",httpStatus:400,shouldAlert:!1,trackKPI:!1}};function e(a){return d[a]||null}function f(){return d.SYSTEM_ERROR}},56042:(a,b,c)=>{"use strict";c.d(b,{CS:()=>h,um:()=>i});var d=c(30477),e=c(60387),f=c(32524);async function g(a){try{d.v.info("Audit log",{event:a.event_type,action:a.action,status:a.status,actor:a.actor_id,resource:a.resource_id});let b=(0,f.A)(),c="user"===a.actor_type?a.actor_id:null,g="system"===a.actor_type?a.actor_id:null,h={event_type:a.event_type,status:a.status,metadata:a.metadata||{},error_message:a.error_message,ip_address:a.ip_address,user_agent:a.user_agent};return await (0,e.P)(`INSERT INTO audit_logs (
        id, 
        organization_id, 
        user_id, 
        system_id, 
        resource_type, 
        resource_id, 
        action, 
        actor_type, 
        actor_label, 
        before, 
        after, 
        created_at
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, NOW())`,[b,a.organization_id||null,c||null,g||null,a.resource_type||null,a.resource_id||null,a.action,a.actor_type||"system",a.event_type,null,JSON.stringify(h)]),!0}catch(b){return d.v.error("Audit log write exception",b,{event_type:a.event_type}),!1}}async function h(a,b,c,d){return g({event_type:{organizations:"USER_ACTION",subscriptions:"SUBSCRIPTION_UPDATED",campaigns:"CAMPAIGN_EXECUTED",reports:"REPORT_GENERATED"}[a]||"USER_ACTION",resource_type:a,resource_id:b,action:c,status:"success",metadata:d})}async function i(a,b,c){return g({event_type:"USER_ACTION",resource_type:a,resource_id:b,action:"error",status:"failure",error_message:c.message,metadata:c})}},59175:(a,b,c)=>{"use strict";c.d(b,{u:()=>d});class d extends Error{constructor(a,b,d,e){if("string"==typeof a){super(a);let c=new Date().toISOString().slice(0,10).replace(/-/g,""),f=Math.random().toString(36).slice(2,8).toUpperCase();this.id=`ERR_${c}_${f}`,this.code=d||"UNKNOWN_ERROR",this.user_message=a,this.severity="MEDIUM",this.retriable=!1,this.details=e,this.httpStatus=b||500}else{if(super(a.message),a.id)this.id=a.id;else{let a=new Date().toISOString().slice(0,10).replace(/-/g,""),b=Math.random().toString(36).slice(2,8).toUpperCase();this.id=`ERR_${a}_${b}`}this.code=a.code,this.user_message=a.user_message,this.severity=a.severity??"MEDIUM",this.retriable=!!a.retriable,this.details=a.details;try{let{getErrorDefinition:a}=c(50980),b=a(this.code);this.httpStatus=b?.httpStatus||500}catch{this.httpStatus=500}}}toJSON(){return{id:this.id,code:this.code,message:this.message,user_message:this.user_message,severity:this.severity,httpStatus:this.httpStatus}}}},60387:(a,b,c)=>{"use strict";c.d(b,{Ay:()=>h,P:()=>f,d_:()=>e,ro:()=>g});var d=c(9608);if("undefined"==typeof WebSocket)try{let a=c(45361);d.Vz.webSocketConstructor=a}catch(a){}let e=()=>{let a=(()=>{try{let a=globalThis.HYPERDRIVE||globalThis.env?.HYPERDRIVE||globalThis.__env__?.HYPERDRIVE||globalThis.CF_BINDINGS?.HYPERDRIVE;if(a?.connectionString)return console.log("Using Hyperdrive connection"),a.connectionString}catch(a){console.warn("Hyperdrive binding not accessible:",a)}try{let a=globalThis.env||globalThis.__env__||globalThis.ENVIRONMENT||globalThis.CF_BINDINGS;if(a?.NEON_PG_CONN)return console.log("Using Worker secret for database connection"),a.NEON_PG_CONN}catch(a){console.warn("Worker secrets not accessible:",a)}let a=process.env.NEON_PG_CONN||process.env.PG_CONN||process.env.DATABASE_URL;return a?(console.log("Using process.env for database connection"),a):(console.error("No database connection configured in any location"),null)})();return a?new d.bC({connectionString:a}):(console.warn("No Postgres connection configured - returning null pool"),null)};async function f(a,b,c){try{let d=e();if(!d)return console.warn("Pool not available, returning mock response"),{rows:[],rowCount:0};let f=await d.connect();try{return c?.organizationId&&await f.query("SELECT set_config('app.current_organization_id', $1, true)",[c.organizationId]),c?.userId&&await f.query("SELECT set_config('app.current_user_id', $1, true)",[c.userId]),await f.query(a,b)}finally{f.release()}}catch(a){return console.error("Database query failed:",a),{rows:[],rowCount:0}}}async function g(a,b){let c=e(),d=await c.connect();try{await d.query("BEGIN"),b?.organizationId&&await d.query("SELECT set_config('app.current_organization_id', $1, true)",[b.organizationId]);let c=await a(d);return await d.query("COMMIT"),c}catch(a){throw await d.query("ROLLBACK"),a}finally{d.release()}}let h={query:f}},78335:()=>{},94498:(a,b,c)=>{"use strict";c.d(b,{J5:()=>q,M2:()=>o,NP:()=>p,_4:()=>j,fw:()=>l,oE:()=>m,uV:()=>n});var d=c(89627),e=c(60387),f=c(59175),g=c(30477),h=c(56042);let i=null,j=new Proxy({},{get:(a,b)=>Reflect.get(function(){if(!i){let a=process.env.STRIPE_SECRET_KEY;if(!a)throw Error("STRIPE_SECRET_KEY not configured");i=new d.A(a,{apiVersion:"2025-12-15.clover",typescript:!0,httpClient:d.A.createFetchHttpClient()})}return i}(),b)});async function k(a){let{organizationId:b,organizationName:c,email:d}=a;try{let{rows:a}=await (0,e.P)(`SELECT stripe_customer_id FROM stripe_subscriptions 
       WHERE organization_id = $1 
       ORDER BY created_at DESC LIMIT 1`,[b],{organizationId:b}),f=a[0];if(f?.stripe_customer_id)return g.v.info("getOrCreateCustomer: existing customer found",{organizationId:b,customerId:f.stripe_customer_id}),f.stripe_customer_id;let i=await j.customers.create({email:d,name:c,metadata:{organization_id:b}});return g.v.info("getOrCreateCustomer: new customer created",{organizationId:b,customerId:i.id}),await (0,h.CS)("organizations",b,"stripe_customer_created",{customer_id:i.id}),i.id}catch(a){throw g.v.error("getOrCreateCustomer: failed",a,{organizationId:b}),await (0,h.um)("organizations",b,{message:"Failed to create Stripe customer",error:a.message}),new f.u("Failed to create billing customer",500,"STRIPE_CUSTOMER_ERROR",a)}}async function l(a){let{organizationId:b,organizationName:c,userEmail:d,priceId:e,successUrl:i,cancelUrl:l}=a;try{let a=await k({organizationId:b,organizationName:c,email:d}),f=await j.checkout.sessions.create({customer:a,mode:"subscription",line_items:[{price:e,quantity:1}],success_url:i,cancel_url:l,metadata:{organization_id:b},subscription_data:{metadata:{organization_id:b}},allow_promotion_codes:!0,billing_address_collection:"required"});return g.v.info("createCheckoutSession: session created",{organizationId:b,sessionId:f.id}),await (0,h.CS)("organizations",b,"stripe_checkout_created",{session_id:f.id,price_id:e}),f.url}catch(a){throw g.v.error("createCheckoutSession: failed",a,{organizationId:b,priceId:e}),await (0,h.um)("organizations",b,{message:"Failed to create checkout session",error:a.message}),new f.u("Failed to create checkout session",500,"STRIPE_CHECKOUT_ERROR",a)}}async function m(a,b){try{let{rows:c}=await (0,e.P)(`SELECT stripe_customer_id FROM stripe_subscriptions 
       WHERE organization_id = $1 
       ORDER BY created_at DESC LIMIT 1`,[a],{organizationId:a}),d=c[0];if(!d?.stripe_customer_id)throw new f.u("No active subscription found",404,"NO_SUBSCRIPTION");let i=await j.billingPortal.sessions.create({customer:d.stripe_customer_id,return_url:b});return g.v.info("createBillingPortalSession: session created",{organizationId:a,sessionId:i.id}),await (0,h.CS)("organizations",a,"stripe_portal_accessed",{session_id:i.id}),i.url}catch(b){if(g.v.error("createBillingPortalSession: failed",b,{organizationId:a}),await (0,h.um)("organizations",a,{message:"Failed to create billing portal session",error:b.message}),b instanceof f.u)throw b;throw new f.u("Failed to access billing portal",500,"STRIPE_PORTAL_ERROR",b)}}async function n(a){try{let{rows:b}=await (0,e.P)(`SELECT * FROM stripe_subscriptions 
       WHERE organization_id = $1 
       ORDER BY current_period_end DESC LIMIT 1`,[a],{organizationId:a});return b[0]||null}catch(b){throw g.v.error("getSubscription: failed",b,{organizationId:a}),new f.u("Failed to fetch subscription",500,"SUBSCRIPTION_FETCH_ERROR",b)}}async function o(a){try{let{rows:b}=await (0,e.P)(`SELECT stripe_subscription_id FROM stripe_subscriptions 
       WHERE organization_id = $1 AND status IN ('active', 'trialing')
       ORDER BY current_period_end DESC LIMIT 1`,[a],{organizationId:a}),c=b[0];if(!c)throw new f.u("No active subscription found",404,"NO_ACTIVE_SUBSCRIPTION");await j.subscriptions.update(c.stripe_subscription_id,{cancel_at_period_end:!0}),g.v.info("cancelSubscription: subscription cancelled at period end",{organizationId:a,subscriptionId:c.stripe_subscription_id}),await (0,h.CS)("organizations",a,"subscription_cancelled",{subscription_id:c.stripe_subscription_id,cancel_at_period_end:!0})}catch(b){if(g.v.error("cancelSubscription: failed",b,{organizationId:a}),await (0,h.um)("organizations",a,{message:"Failed to cancel subscription",error:b.message}),b instanceof f.u)throw b;throw new f.u("Failed to cancel subscription",500,"SUBSCRIPTION_CANCEL_ERROR",b)}}async function p(a,b=10){try{let{rows:c}=await (0,e.P)(`SELECT * FROM stripe_invoices 
       WHERE organization_id = $1 
       ORDER BY invoice_date DESC LIMIT $2`,[a,b],{organizationId:a});return c||[]}catch(b){throw g.v.error("getInvoices: failed",b,{organizationId:a}),new f.u("Failed to fetch invoices",500,"INVOICES_FETCH_ERROR",b)}}async function q(a){try{let{rows:b}=await (0,e.P)(`SELECT * FROM stripe_payment_methods 
       WHERE organization_id = $1 
       ORDER BY is_default DESC`,[a],{organizationId:a});return b||[]}catch(b){throw g.v.error("getPaymentMethods: failed",b,{organizationId:a}),new f.u("Failed to fetch payment methods",500,"PAYMENT_METHODS_FETCH_ERROR",b)}}process.env.STRIPE_PRICE_PRO_MONTHLY,process.env.STRIPE_PRICE_PRO_YEARLY,process.env.STRIPE_PRICE_BUSINESS_MONTHLY,process.env.STRIPE_PRICE_BUSINESS_YEARLY,process.env.STRIPE_PRICE_ENTERPRISE_MONTHLY,process.env.STRIPE_PRICE_ENTERPRISE_YEARLY},96487:()=>{}};