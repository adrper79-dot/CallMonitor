exports.id=6980,exports.ids=[6980],exports.modules={3208:(a,b,c)=>{"use strict";c.d(b,{A:()=>g});var d=c(81742),e=c(60387);let f=null,g=new Proxy({},{get(a,b){let c=function(){if(f)return f;if(process.env.NEON_PG_CONN||process.env.PG_CONN||process.env.DATABASE_URL)return f=function(){function a(a){return'"'+a.replace(/"/g,'""')+'"'}class b{constructor(a){this.selects=null,this.where=[],this.table=a}select(a){return this.selects=a,this}eq(b,c){let d=this._nextParamIndex();return this.where.push({clause:`${a(b)} = $${d}`,params:[c]}),this}limit(a){return this.limitCount=a,this}order(b,c="asc"){return this.orderBy=`${a(b)} ${c.toUpperCase()}`,this}async single(){let{text:a,params:b}=this._buildSelect(!0);try{return{data:(await e.Ay.query(a,b)).rows[0]||null,error:null}}catch(a){return{data:null,error:a}}}async insert(b){let c=Object.keys(b),d=c.map((a,b)=>`$${b+1}`),f=c.map(a=>b[a]),g=`INSERT INTO ${a(this.table)} (${c.map(a).join(",")}) VALUES (${d.join(",")}) RETURNING *`;try{return{data:(await e.Ay.query(g,f)).rows,error:null}}catch(a){return{data:null,error:a}}}async update(b){let c=Object.keys(b),d=c.map((b,c)=>`${a(b)} = $${c+1}`),f=c.map(a=>b[a]),g=this._gatherWhereParams(),h=`UPDATE ${a(this.table)} SET ${d.join(",")} ${this._whereClause(g.length)} RETURNING *`;try{return{data:(await e.Ay.query(h,f.concat(g))).rows,error:null}}catch(a){return{data:null,error:a}}}_gatherWhereParams(){return this.where.flatMap(a=>a.params)}_whereClause(a=0){return 0===this.where.length?"":"WHERE "+this.where.map((b,c)=>(this._paramOffsetForIndex(c),b.clause.replace(/\$(\d+)/g,(b,c)=>`$${a+parseInt(c,10)}`))).join(" AND ")}_nextParamIndex(){return this.where.flatMap(a=>a.params).length+1}_paramOffsetForIndex(a){return this.where.slice(0,a).flatMap(a=>a.params).length+1}_buildSelect(b=!1){let c=this.selects||"*",d=this._gatherWhereParams(),e=this._whereClause(0),f=b||this.limitCount?`LIMIT ${b?1:this.limitCount}`:"",g=this.orderBy?`ORDER BY ${this.orderBy}`:"";return{text:`SELECT ${c} FROM ${a(this.table)} ${e} ${g} ${f}`,params:d}}}return new Proxy({},{get:(a,c)=>function(a){if("from"===c)return function(a){return new b(a)}}})}();let a=process.env.SUPABASE_URL||process.env.NEXT_PUBLIC_SUPABASE_URL,b=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!a)throw Error("Missing SUPABASE_URL or NEXT_PUBLIC_SUPABASE_URL environment variable");if(!b)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY environment variable");return f=(0,d.UU)(a,b,{auth:{autoRefreshToken:!1,persistSession:!1}})}(),g=c[b];return"function"==typeof g?g.bind(c):g}})},6391:(a,b,c)=>{"use strict";c.d(b,{z:()=>f});var d=c(21124);c(38301);let e={primary:"bg-primary-600",blue:"bg-primary-600",green:"bg-success",orange:"bg-warning",red:"bg-error"};function f({value:a,label:b,color:c="primary",showValue:f=!1,className:g=""}){let h=Math.max(0,Math.min(100,a)),i=e[c];return(0,d.jsxs)("div",{className:g,children:[b&&(0,d.jsxs)("div",{className:"flex justify-between text-xs mb-1",children:[(0,d.jsx)("span",{className:"text-gray-500",id:`progress-label-${b.replace(/\s+/g,"-").toLowerCase()}`,children:b}),f&&(0,d.jsxs)("span",{className:"text-gray-900 font-medium tabular-nums",children:[Math.round(h),"%"]})]}),(0,d.jsx)("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",role:"progressbar","aria-valuenow":Math.round(h),"aria-valuemin":0,"aria-valuemax":100,"aria-label":b||`Progress: ${Math.round(h)}%`,children:(0,d.jsx)("div",{className:`h-full ${i} transition-all duration-300 ease-out`,style:{width:`${h}%`}})})]})}},26701:(a,b,c)=>{"use strict";c.d(b,{A:()=>i});var d=c(21124),e=c(38301),f=c(55794),g=c(22544),h=c(19217);function i({callId:a,organizationId:b,limit:c=10,events:i}){let[j,k]=(0,e.useState)(i||[]),[l,m]=(0,e.useState)("all"),{updates:n,connected:o}=(0,f.x)(b||null),{data:p}=(0,f.n)(async()=>{if(!b)return[];try{let a=await fetch(`/api/audit-logs?orgId=${encodeURIComponent(b)}&limit=${c}`,{credentials:"include"});if(401===a.status)return[];if(a.ok)return(await a.json()).events||[];return[]}catch{return[]}},3e4,!o&&!!b),q=j.filter(b=>a?b.call_id===a:"all"===l||b.type.includes(l)).slice(0,c);return(0,d.jsxs)("section",{"aria-label":"Activity feed",className:"w-full",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,d.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Activity"}),!o&&(0,d.jsx)("span",{className:"text-xs text-warning","aria-label":"Real-time disconnected",children:"Offline"})]}),!a&&(0,d.jsxs)("div",{className:"flex gap-1 mb-3",children:[(0,d.jsx)(h.$,{variant:"all"===l?"secondary":"ghost",size:"sm",onClick:()=>m("all"),className:"text-xs",children:"All"}),(0,d.jsx)(h.$,{variant:"call"===l?"secondary":"ghost",size:"sm",onClick:()=>m("call"),className:"text-xs",children:"Calls"}),(0,d.jsx)(h.$,{variant:"transcript"===l?"secondary":"ghost",size:"sm",onClick:()=>m("transcript"),className:"text-xs",children:"Transcripts"})]}),(0,d.jsxs)("div",{role:"status","aria-live":"polite",className:"sr-only",children:[q.length," events shown"]}),(0,d.jsx)("div",{className:"max-h-[60vh] overflow-y-auto",children:0===q.length?(0,d.jsx)("div",{className:"py-8 text-center text-sm text-gray-400",children:"No recent activity"}):(0,d.jsx)("ul",{className:"space-y-2",children:q.map(a=>(0,d.jsx)("li",{className:`p-3 bg-gray-50 rounded-md border border-gray-200 transition-colors ${a.call_id?"cursor-pointer hover:bg-gray-100":""}`,onClick:()=>a.call_id&&void(a.call_id&&window.dispatchEvent(new CustomEvent("call:select",{detail:{callId:a.call_id}}))),children:(0,d.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("p",{className:"text-sm text-gray-900",children:a.title}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(a.timestamp).toLocaleString()}),a.call_id&&(0,d.jsxs)("p",{className:"text-xs text-primary-600 mt-1",children:["Call: ",a.call_id.slice(0,8),"..."]})]}),(0,d.jsx)(g.E,{variant:"error"===a.status?"error":"warning"===a.status?"warning":"success"===a.status?"success":"default",children:a.status||"info"})]})},a.id))})})]})}},30477:(a,b,c)=>{"use strict";c.d(b,{v:()=>e});class d{constructor(){this.isDevelopment=!1,this.isTest=!1}shouldLog(a){return!this.isTest&&(!!this.isDevelopment||"warn"===a||"error"===a)}formatMessage(a,b,c){let d=new Date().toISOString(),e=c?` ${JSON.stringify(c)}`:"";return`[${d}] [${a.toUpperCase()}] ${b}${e}`}debug(a,b){this.shouldLog("debug")&&console.log(this.formatMessage("debug",a,b))}info(a,b){this.shouldLog("info")&&console.log(this.formatMessage("info",a,b))}warn(a,b){this.shouldLog("warn")&&console.warn(this.formatMessage("warn",a,b))}error(a,b,c){if(this.shouldLog("error")){let d=b instanceof Error?{name:b.name,message:b.message,stack:b.stack,...c}:{error:b,...c};console.error(this.formatMessage("error",a,d))}}apiRequest(a,b,c){this.info(`API Request: ${a} ${b}`,c)}apiResponse(a,b,c,d){let e={statusCode:c,duration:d};c>=500?this.error(`API Response: ${a} ${b}`,void 0,e):c>=400?this.warn(`API Response: ${a} ${b}`,e):this.info(`API Response: ${a} ${b}`,e)}dbQuery(a,b){this.debug("Database query",{query:a.substring(0,100),params:b})}externalCall(a,b,c){this.info(`External call: ${a}`,{endpoint:b,...c})}}let e=new d},39727:()=>{},47990:()=>{},55108:(a,b,c)=>{"use strict";async function d(a,b={}){let c=await fetch(a,{...b,method:"GET",credentials:"include"});if(!c.ok){let a=await c.json().catch(()=>({message:c.statusText}));throw new g(c.status,a.error?.message||a.message||"Request failed")}return c.json()}async function e(a,b,c={}){let d={"Content-Type":"application/json",...c.headers},f=await fetch(a,{...c,method:"POST",credentials:"include",headers:d,body:b?JSON.stringify(b):void 0});if(!f.ok){let a=await f.json().catch(()=>({message:f.statusText}));throw new g(f.status,a.error?.message||a.message||"Request failed")}return f.json()}async function f(a,b={}){let c=await fetch(a,{...b,method:"DELETE",credentials:"include"});if(!c.ok){let a=await c.json().catch(()=>({message:c.statusText}));throw new g(c.status,a.error?.message||a.message||"Request failed")}return c.json()}c.d(b,{$P:()=>e,Al:()=>f,Vg:()=>d});class g extends Error{constructor(a,b){super(b),this.status=a,this.name="ApiError"}}},55794:(a,b,c)=>{"use strict";c.d(b,{n:()=>f,x:()=>e});var d=c(38301);function e(a){let[b,c]=(0,d.useState)([]),[e,f]=(0,d.useState)(!1);return(0,d.useRef)(null),(0,d.useRef)(new Date),{updates:b,connected:e,clearUpdates:(0,d.useCallback)(()=>c([]),[])}}function f(a,b=5e3,c=!0){let[e,g]=(0,d.useState)([]),[h,i]=(0,d.useState)(!0);return{data:e,loading:h}}},60387:(a,b,c)=>{"use strict";c.d(b,{Ay:()=>h,P:()=>f,d_:()=>e,ro:()=>g});var d=c(9608);if("undefined"==typeof WebSocket)try{let a=c(45361);d.Vz.webSocketConstructor=a}catch(a){}let e=()=>{let a=(()=>{try{let a=globalThis.HYPERDRIVE||globalThis.env?.HYPERDRIVE||globalThis.__env__?.HYPERDRIVE||globalThis.CF_BINDINGS?.HYPERDRIVE;if(a?.connectionString)return console.log("Using Hyperdrive connection"),a.connectionString}catch(a){console.warn("Hyperdrive binding not accessible:",a)}try{let a=globalThis.env||globalThis.__env__||globalThis.ENVIRONMENT||globalThis.CF_BINDINGS;if(a?.NEON_PG_CONN)return console.log("Using Worker secret for database connection"),a.NEON_PG_CONN}catch(a){console.warn("Worker secrets not accessible:",a)}let a=process.env.NEON_PG_CONN||process.env.PG_CONN||process.env.DATABASE_URL;return a?(console.log("Using process.env for database connection"),a):(console.error("No database connection configured in any location"),null)})();return a?new d.bC({connectionString:a}):(console.warn("No Postgres connection configured - returning null pool"),null)};async function f(a,b,c){try{let d=e();if(!d)return console.warn("Pool not available, returning mock response"),{rows:[],rowCount:0};let f=await d.connect();try{return c?.organizationId&&await f.query("SELECT set_config('app.current_organization_id', $1, true)",[c.organizationId]),c?.userId&&await f.query("SELECT set_config('app.current_user_id', $1, true)",[c.userId]),await f.query(a,b)}finally{f.release()}}catch(a){return console.error("Database query failed:",a),{rows:[],rowCount:0}}}async function g(a,b){let c=e(),d=await c.connect();try{await d.query("BEGIN"),b?.organizationId&&await d.query("SELECT set_config('app.current_organization_id', $1, true)",[b.organizationId]);let c=await a(d);return await d.query("COMMIT"),c}catch(a){throw await d.query("ROLLBACK"),a}finally{d.release()}}let h={query:f}},88900:(a,b,c)=>{"use strict";c.d(b,{u:()=>f});var d=c(21124),e=c(38301);function f({date:a,fallback:b="â€”",format:c="short",className:f}){let g,[h,i]=(0,e.useState)(!1);if(!a)return(0,d.jsx)("span",{className:f,children:b});let j="string"==typeof a?new Date(a):a;if(!h){let a=j.toISOString().slice(0,16).replace("T"," ");return(0,d.jsx)("span",{className:f,suppressHydrationWarning:!0,children:a})}try{switch(c){case"short":g=j.toLocaleString(void 0,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});break;case"long":g=j.toLocaleString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"});break;case"time":g=j.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});break;case"relative":g=function(a){let b=Math.floor((new Date().getTime()-a.getTime())/1e3),c=Math.floor(b/60),d=Math.floor(c/60),e=Math.floor(d/24);return b<60?"Just now":c<60?`${c}m ago`:d<24?`${d}h ago`:e<7?`${e}d ago`:a.toLocaleDateString(void 0,{month:"short",day:"numeric"})}(j);break;default:g=j.toLocaleString()}}catch{g=j.toISOString().slice(0,16).replace("T"," ")}return(0,d.jsx)("span",{className:f,suppressHydrationWarning:!0,children:g})}},92179:(a,b,c)=>{"use strict";c.d(b,{J:()=>f,e:()=>e});var d=c(38301);function e(a){let[b,c]=(0,d.useState)({role:null,plan:null,loading:!0,error:null});return b}function f(a,b,c){let{role:d,plan:f,loading:g}=e(a);return!g&&!!d&&!!f&&(["owner","admin"].includes(d)||"read"===c&&["operator","analyst","viewer"].includes(d)||"execute"===c&&"operator"===d)&&("free"!==f||"call"===b)}c(55108)}};