"use strict";exports.id=7528,exports.ids=[7528],exports.modules={37528:(a,b,c)=>{c.d(b,{storeRecording:()=>f});var d=c(30477),e=c(60387);async function f(a,b,c,f){try{let g=process.env.SIGNALWIRE_PROJECT_ID,h=process.env.SIGNALWIRE_TOKEN;if(!g||!h)return d.v.error("recordingStorage: SignalWire credentials not configured"),null;let i=`Basic ${Buffer.from(`${g}:${h}`).toString("base64")}`;d.v.debug("recordingStorage: downloading from SignalWire",{recordingId:f});let j=await fetch(a,{method:"GET",headers:{Accept:"audio/*",Authorization:i}});if(!j.ok)return d.v.error("recordingStorage: failed to download from SignalWire",void 0,{status:j.status,statusText:j.statusText}),null;let k=await j.arrayBuffer(),l=j.headers.get("content-type")||"audio/wav",m=l.includes("mp3")?"mp3":"wav",n=Buffer.from(k),o=`${b}/${c}/${f}.${m}`;try{let a=globalThis.RECORDINGS_BUCKET;if(!a)throw Error("R2 Binding RECORDINGS_BUCKET not found");d.v.info("recordingStorage: uploading to R2",{storagePath:o}),await a.put(o,n,{httpMetadata:{contentType:l}})}catch(a){return d.v.error("recordingStorage: R2 upload failed",a),null}d.v.info("recordingStorage: uploaded to R2",{recordingId:f,storagePath:o,sizeBytes:n.byteLength});let p=`https://${process.env.PUBLIC_ASSETS_URL||"assets.gemini-project.com"}/${o}`;return await (0,e.P)("UPDATE recordings SET recording_url = $1, updated_at = NOW() WHERE id = $2",[p,f]),d.v.info("recordingStorage: stored recording and updated DB",{recordingId:f,storagePath:o}),o}catch(a){return d.v.error("recordingStorage: error",a,{recordingId:f}),null}}}};